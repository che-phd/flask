
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flask Documentation (0.12.x)</title>
    <link rel="stylesheet" href="_static/flask.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/_static/css/badge_only.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/flask-icon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="canonical" href="https://flask.palletsprojects.com/en/1.1.x/index.html#document-index">
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = './';</script>
   
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">Flask Documentation (0.12.x)</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
    <p class="version-warning"><strong>Warning:</strong> This is an old version. The latest stable version is <a href="index.html#document-index/../1.1.x/index.html#document-index">Version 1.1.x</a>.</p>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="hide-header section" id="welcome-to-flask">
<h1>Welcome to Flask<a class="headerlink" href="#welcome-to-flask" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://palletsprojects.com/p/flask/"><img alt="Flask: web development, one drop at a time" class="align-center" src="_images/flask-logo.png" /></a>
<p>Welcome to Flask’s documentation.  This documentation is divided into
different parts.  I recommend that you get started with
<a class="reference internal" href="index.html#installation"><span class="std std-ref">Installation</span></a> and then head over to the <a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Quickstart</span></a>.
Besides the quickstart, there is also a more detailed <a class="reference internal" href="index.html#tutorial"><span class="std std-ref">Tutorial</span></a> that
shows how to create a complete (albeit small) application with Flask.  If
you’d rather dive into the internals of Flask, check out
the <a class="reference internal" href="index.html#api"><span class="std std-ref">API</span></a> documentation.  Common patterns are described in the
<a class="reference internal" href="index.html#patterns"><span class="std std-ref">Patterns for Flask</span></a> section.</p>
<p>Flask depends on two external libraries: the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> template
engine and the <a class="reference external" href="http://werkzeug.pocoo.org/">Werkzeug</a> WSGI toolkit.  These libraries are not documented
here.  If you want to dive into their documentation, check out the
following links:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://jinja.pocoo.org/docs">Jinja2 Documentation</a></p></li>
<li><p><a class="reference external" href="http://werkzeug.pocoo.org/docs">Werkzeug Documentation</a></p></li>
</ul>
<div class="section" id="user-s-guide">
<h2>User’s Guide<a class="headerlink" href="#user-s-guide" title="Permalink to this headline">¶</a></h2>
<p>This part of the documentation, which is mostly prose, begins with some
background information about Flask, then focuses on step-by-step
instructions for web development with Flask.</p>
<div class="toctree-wrapper compound">
<span id="document-foreword"></span><div class="section" id="foreword">
<h3>Foreword<a class="headerlink" href="#foreword" title="Permalink to this headline">¶</a></h3>
<p>Read this before you get started with Flask.  This hopefully answers some
questions about the purpose and goals of the project, and when you
should or should not be using it.</p>
<div class="section" id="what-does-micro-mean">
<h4>What does “micro” mean?<a class="headerlink" href="#what-does-micro-mean" title="Permalink to this headline">¶</a></h4>
<p>“Micro” does not mean that your whole web application has to fit into a single
Python file (although it certainly can), nor does it mean that Flask is lacking
in functionality. The “micro” in microframework means Flask aims to keep the
core simple but extensible. Flask won’t make many decisions for you, such as
what database to use. Those decisions that it does make, such as what
templating engine to use, are easy to change.  Everything else is up to you, so
that Flask can be everything you need and nothing you don’t.</p>
<p>By default, Flask does not include a database abstraction layer, form
validation or anything else where different libraries already exist that can
handle that. Instead, Flask supports extensions to add such functionality to
your application as if it was implemented in Flask itself. Numerous extensions
provide database integration, form validation, upload handling, various open
authentication technologies, and more. Flask may be “micro”, but it’s ready for
production use on a variety of needs.</p>
</div>
<div class="section" id="configuration-and-conventions">
<h4>Configuration and Conventions<a class="headerlink" href="#configuration-and-conventions" title="Permalink to this headline">¶</a></h4>
<p>Flask has many configuration values, with sensible defaults, and a few
conventions when getting started.  By convention, templates and static files are
stored in subdirectories within the application’s Python source tree, with the
names <code class="file docutils literal notranslate"><span class="pre">templates</span></code> and <code class="file docutils literal notranslate"><span class="pre">static</span></code> respectively. While this can be changed, you
usually don’t have to, especially when getting started.</p>
</div>
<div class="section" id="growing-with-flask">
<h4>Growing with Flask<a class="headerlink" href="#growing-with-flask" title="Permalink to this headline">¶</a></h4>
<p>Once you have Flask up and running, you’ll find a variety of extensions
available in the community to integrate your project for production. The Flask
core team reviews extensions and ensures approved extensions do not break with
future releases.</p>
<p>As your codebase grows, you are free to make the design decisions appropriate
for your project.  Flask will continue to provide a very simple glue layer to
the best that Python has to offer.  You can implement advanced patterns in
SQLAlchemy or another database tool, introduce non-relational data persistence
as appropriate, and take advantage of framework-agnostic tools built for WSGI,
the Python web interface.</p>
<p>Flask includes many hooks to customize its behavior. Should you need more
customization, the Flask class is built for subclassing. If you are interested
in that, check out the <a class="reference internal" href="index.html#becomingbig"><span class="std std-ref">Becoming Big</span></a> chapter.  If you are curious about
the Flask design principles, head over to the section about <a class="reference internal" href="index.html#design"><span class="std std-ref">Design Decisions in Flask</span></a>.</p>
<p>Continue to <a class="reference internal" href="index.html#installation"><span class="std std-ref">Installation</span></a>, the <a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Quickstart</span></a>, or the
<a class="reference internal" href="index.html#advanced-foreword"><span class="std std-ref">Foreword for Experienced Programmers</span></a>.</p>
</div>
</div>
<span id="document-advanced_foreword"></span><div class="section" id="foreword-for-experienced-programmers">
<span id="advanced-foreword"></span><h3>Foreword for Experienced Programmers<a class="headerlink" href="#foreword-for-experienced-programmers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="thread-locals-in-flask">
<h4>Thread-Locals in Flask<a class="headerlink" href="#thread-locals-in-flask" title="Permalink to this headline">¶</a></h4>
<p>One of the design decisions in Flask was that simple tasks should be simple;
they should not take a lot of code and yet they should not limit you. Because
of that, Flask has a few design choices that some people might find surprising or
unorthodox. For example, Flask uses thread-local objects internally so that you
don’t have to pass objects around from function to function within a request in
order to stay threadsafe. This approach is convenient, but requires a valid
request context for dependency injection or when attempting to reuse code which
uses a value pegged to the request.  The Flask project is honest about
thread-locals, does not hide them, and calls out in the code and documentation
where they are used.</p>
</div>
<div class="section" id="develop-for-the-web-with-caution">
<h4>Develop for the Web with Caution<a class="headerlink" href="#develop-for-the-web-with-caution" title="Permalink to this headline">¶</a></h4>
<p>Always keep security in mind when building web applications.</p>
<p>If you write a web application, you are probably allowing users to register
and leave their data on your server.  The users are entrusting you with data.
And even if you are the only user that might leave data in your application,
you still want that data to be stored securely.</p>
<p>Unfortunately, there are many ways the security of a web application can be
compromised.  Flask protects you against one of the most common security
problems of modern web applications: cross-site scripting (XSS).  Unless you
deliberately mark insecure HTML as secure, Flask and the underlying Jinja2
template engine have you covered.  But there are many more ways to cause
security problems.</p>
<p>The documentation will warn you about aspects of web development that require
attention to security.  Some of these security concerns are far more complex
than one might think, and we all sometimes underestimate the likelihood that a
vulnerability will be exploited - until a clever attacker figures out a way to
exploit our applications.  And don’t think that your application is not
important enough to attract an attacker.  Depending on the kind of attack,
chances are that automated bots are probing for ways to fill your database with
spam, links to malicious software, and the like.</p>
<p>Flask is no different from any other framework in that you the developer must
build with caution, watching for exploits when building to your requirements.</p>
</div>
<div class="section" id="python-3-support-in-flask">
<h4>Python 3 Support in Flask<a class="headerlink" href="#python-3-support-in-flask" title="Permalink to this headline">¶</a></h4>
<p>Flask, its dependencies, and most Flask extensions all support Python 3.
If you want to use Flask with Python 3 have a look at the <a class="reference internal" href="index.html#python3-support"><span class="std std-ref">Python 3 Support</span></a> page.</p>
<p>Continue to <a class="reference internal" href="index.html#installation"><span class="std std-ref">Installation</span></a> or the <a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Quickstart</span></a>.</p>
</div>
</div>
<span id="document-installation"></span><div class="section" id="installation">
<span id="id1"></span><h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Flask depends on some external libraries, like <a class="reference external" href="http://werkzeug.pocoo.org/">Werkzeug</a> and <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a>.
Werkzeug is a toolkit for WSGI, the standard Python interface between web
applications and a variety of servers for both development and deployment.
Jinja2 renders templates.</p>
<p>So how do you get all that on your computer quickly?  There are many ways you
could do that, but the most kick-ass method is virtualenv, so let’s have a look
at that first.</p>
<p>You will need Python 2.6 or newer to get started, so be sure to have an
up-to-date Python 2.x installation.  For using Flask with Python 3 have a
look at <a class="reference internal" href="index.html#python3-support"><span class="std std-ref">Python 3 Support</span></a>.</p>
<div class="section" id="virtualenv">
<span id="id2"></span><h4>virtualenv<a class="headerlink" href="#virtualenv" title="Permalink to this headline">¶</a></h4>
<p>Virtualenv is probably what you want to use during development, and if you have
shell access to your production machines, you’ll probably want to use it there,
too.</p>
<p>What problem does virtualenv solve?  If you like Python as much as I do,
chances are you want to use it for other projects besides Flask-based web
applications.  But the more projects you have, the more likely it is that you
will be working with different versions of Python itself, or at least different
versions of Python libraries.  Let’s face it: quite often libraries break
backwards compatibility, and it’s unlikely that any serious application will
have zero dependencies.  So what do you do if two or more of your projects have
conflicting dependencies?</p>
<p>Virtualenv to the rescue!  Virtualenv enables multiple side-by-side
installations of Python, one for each project.  It doesn’t actually install
separate copies of Python, but it does provide a clever way to keep different
project environments isolated.  Let’s see how virtualenv works.</p>
<p>If you are on Mac OS X or Linux, chances are that the following
command will work for you:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo pip install virtualenv
</pre></div>
</div>
<p>It will probably install virtualenv on your system.  Maybe it’s even
in your package manager.  If you use Ubuntu, try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install python-virtualenv
</pre></div>
</div>
<p>If you are on Windows and don’t have the <code class="docutils literal notranslate"><span class="pre">easy_install</span></code> command, you must
install it first.  Check the <a class="reference internal" href="#windows-easy-install"><span class="std std-ref">pip and setuptools on Windows</span></a> section for more
information about how to do that.  Once you have it installed, run the same
commands as above, but without the <code class="docutils literal notranslate"><span class="pre">sudo</span></code> prefix.</p>
<p>Once you have virtualenv installed, just fire up a shell and create
your own environment.  I usually create a project folder and a <code class="file docutils literal notranslate"><span class="pre">venv</span></code>
folder within:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir myproject
$ cd myproject
$ virtualenv venv
New python executable in venv/bin/python
Installing setuptools, pip............done.
</pre></div>
</div>
<p>Now, whenever you want to work on a project, you only have to activate the
corresponding environment.  On OS X and Linux, do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ . venv/bin/activate
</pre></div>
</div>
<p>If you are a Windows user, the following command is for you:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ venv\Scripts\activate
</pre></div>
</div>
<p>Either way, you should now be using your virtualenv (notice how the prompt of
your shell has changed to show the active environment).</p>
<p>And if you want to go back to the real world, use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ deactivate
</pre></div>
</div>
<p>After doing this, the prompt of your shell should be as familiar as before.</p>
<p>Now, let’s move on. Enter the following command to get Flask activated in your
virtualenv:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install Flask
</pre></div>
</div>
<p>A few seconds later and you are good to go.</p>
</div>
<div class="section" id="system-wide-installation">
<h4>System-Wide Installation<a class="headerlink" href="#system-wide-installation" title="Permalink to this headline">¶</a></h4>
<p>This is possible as well, though I do not recommend it.  Just run
<code class="docutils literal notranslate"><span class="pre">pip</span></code> with root privileges:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo pip install Flask
</pre></div>
</div>
<p>(On Windows systems, run it in a command-prompt window with administrator
privileges, and leave out <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.)</p>
</div>
<div class="section" id="living-on-the-edge">
<h4>Living on the Edge<a class="headerlink" href="#living-on-the-edge" title="Permalink to this headline">¶</a></h4>
<p>If you want to work with the latest version of Flask, there are two ways: you
can either let <code class="docutils literal notranslate"><span class="pre">pip</span></code> pull in the development version, or you can tell
it to operate on a git checkout.  Either way, virtualenv is recommended.</p>
<p>Get the git checkout in a new virtualenv and run in development mode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone http://github.com/pallets/flask.git
Initialized empty Git repository in ~/dev/flask/.git/
$ cd flask
$ virtualenv venv
New python executable in venv/bin/python
Installing setuptools, pip............done.
$ . venv/bin/activate
$ python setup.py develop
...
Finished processing dependencies for Flask
</pre></div>
</div>
<p>This will pull in the dependencies and activate the git head as the current
version inside the virtualenv.  Then all you have to do is run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span>
<span class="pre">origin</span></code> to update to the latest version.</p>
</div>
<div class="section" id="pip-and-setuptools-on-windows">
<span id="windows-easy-install"></span><h4><cite>pip</cite> and <cite>setuptools</cite> on Windows<a class="headerlink" href="#pip-and-setuptools-on-windows" title="Permalink to this headline">¶</a></h4>
<p>Sometimes getting the standard “Python packaging tools” like <code class="docutils literal notranslate"><span class="pre">pip</span></code>, <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>
and <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> can be a little trickier, but nothing very hard. The crucial
package you will need is pip - this will let you install
anything else (like virtualenv). Fortunately there is a “bootstrap script”
you can run to install.</p>
<p>If you don’t currently have <code class="docutils literal notranslate"><span class="pre">pip</span></code>, then <cite>get-pip.py</cite> will install it for you.</p>
<p><a class="reference external" href="https://bootstrap.pypa.io/get-pip.py">get-pip.py</a></p>
<p>It should be double-clickable once you download it. If you already have <code class="docutils literal notranslate"><span class="pre">pip</span></code>,
you can upgrade them by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">pip</span> <span class="n">setuptools</span>
</pre></div>
</div>
<p>Most often, once you pull up a command prompt you want to be able to type <code class="docutils literal notranslate"><span class="pre">pip</span></code>
and <code class="docutils literal notranslate"><span class="pre">python</span></code> which will run those things, but this might not automatically happen
on Windows, because it doesn’t know where those executables are (give either a try!).</p>
<p>To fix this, you should be able to navigate to your Python install directory
(e.g <code class="file docutils literal notranslate"><span class="pre">C:Python27</span></code>), then go to <code class="file docutils literal notranslate"><span class="pre">Tools</span></code>, then <code class="file docutils literal notranslate"><span class="pre">Scripts</span></code>, then find the
<code class="file docutils literal notranslate"><span class="pre">win_add2path.py</span></code> file and run that. Open a <strong>new</strong> Command Prompt and
check that you can now just type <code class="docutils literal notranslate"><span class="pre">python</span></code> to bring up the interpreter.</p>
<p>Finally, to install <a class="reference internal" href="#virtualenv">virtualenv</a>, you can simply run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">virtualenv</span>
</pre></div>
</div>
<p>Then you can be off on your way following the installation instructions above.</p>
</div>
</div>
<span id="document-quickstart"></span><div class="section" id="quickstart">
<span id="id1"></span><h3>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h3>
<p>Eager to get started?  This page gives a good introduction to Flask.  It
assumes you already have Flask installed.  If you do not, head over to the
<a class="reference internal" href="index.html#installation"><span class="std std-ref">Installation</span></a> section.</p>
<div class="section" id="a-minimal-application">
<h4>A Minimal Application<a class="headerlink" href="#a-minimal-application" title="Permalink to this headline">¶</a></h4>
<p>A minimal Flask application looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello, World!&#39;</span>
</pre></div>
</div>
<p>So what did that code do?</p>
<ol class="arabic simple">
<li><p>First we imported the <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> class.  An instance of this
class will be our WSGI application.</p></li>
<li><p>Next we create an instance of this class. The first argument is the name of
the application’s module or package.  If you are using a single module (as
in this example), you should use <code class="docutils literal notranslate"><span class="pre">__name__</span></code> because depending on if it’s
started as application or imported as module the name will be different
(<code class="docutils literal notranslate"><span class="pre">'__main__'</span></code> versus the actual import name). This is needed so that
Flask knows where to look for templates, static files, and so on. For more
information have a look at the <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> documentation.</p></li>
<li><p>We then use the <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> decorator to tell Flask what URL
should trigger our function.</p></li>
<li><p>The function is given a name which is also used to generate URLs for that
particular function, and returns the message we want to display in the
user’s browser.</p></li>
</ol>
<p>Just save it as <code class="file docutils literal notranslate"><span class="pre">hello.py</span></code> or something similar. Make sure to not call
your application <code class="file docutils literal notranslate"><span class="pre">flask.py</span></code> because this would conflict with Flask
itself.</p>
<p>To run the application you can either use the <strong class="command">flask</strong> command or
python’s <code class="docutils literal notranslate"><span class="pre">-m</span></code> switch with Flask.  Before you can do that you need
to tell your terminal the application to work with by exporting the
<code class="docutils literal notranslate"><span class="pre">FLASK_APP</span></code> environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export FLASK_APP=hello.py
$ flask run
 * Running on http://127.0.0.1:5000/
</pre></div>
</div>
<p>If you are on Windows you need to use <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of <code class="docutils literal notranslate"><span class="pre">export</span></code>.</p>
<p>Alternatively you can use <strong class="command">python -m flask</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export FLASK_APP=hello.py
$ python -m flask run
 * Running on http://127.0.0.1:5000/
</pre></div>
</div>
<p>This launches a very simple builtin server, which is good enough for testing
but probably not what you want to use in production. For deployment options see
<a class="reference internal" href="index.html#deployment"><span class="std std-ref">Deployment Options</span></a>.</p>
<p>Now head over to <a class="reference external" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>, and you
should see your hello world greeting.</p>
<div class="admonition-externally-visible-server admonition" id="public-server">
<p class="admonition-title">Externally Visible Server</p>
<p>If you run the server you will notice that the server is only accessible
from your own computer, not from any other in the network.  This is the
default because in debugging mode a user of the application can execute
arbitrary Python code on your computer.</p>
<p>If you have the debugger disabled or trust the users on your network,
you can make the server publicly available simply by adding
<code class="docutils literal notranslate"><span class="pre">--host=0.0.0.0</span></code> to the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flask</span> <span class="n">run</span> <span class="o">--</span><span class="n">host</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
</pre></div>
</div>
<p>This tells your operating system to listen on all public IPs.</p>
</div>
</div>
<div class="section" id="what-to-do-if-the-server-does-not-start">
<h4>What to do if the Server does not Start<a class="headerlink" href="#what-to-do-if-the-server-does-not-start" title="Permalink to this headline">¶</a></h4>
<p>In case the <strong class="command">python -m flask</strong> fails or <strong class="command">flask</strong> does not exist,
there are multiple reasons this might be the case.  First of all you need
to look at the error message.</p>
<div class="section" id="old-version-of-flask">
<h5>Old Version of Flask<a class="headerlink" href="#old-version-of-flask" title="Permalink to this headline">¶</a></h5>
<p>Versions of Flask older than 0.11 use to have different ways to start the
application.  In short, the <strong class="command">flask</strong> command did not exist, and
neither did <strong class="command">python -m flask</strong>.  In that case you have two options:
either upgrade to newer Flask versions or have a look at the <a class="reference internal" href="index.html#server"><span class="std std-ref">Development Server</span></a>
docs to see the alternative method for running a server.</p>
</div>
<div class="section" id="invalid-import-name">
<h5>Invalid Import Name<a class="headerlink" href="#invalid-import-name" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">FLASK_APP</span></code> environment variable is the name of the module to import at
<strong class="command">flask run</strong>. In case that module is incorrectly named you will get an
import error upon start (or if debug is enabled when you navigate to the
application). It will tell you what it tried to import and why it failed.</p>
<p>The most common reason is a typo or because you did not actually create an
<code class="docutils literal notranslate"><span class="pre">app</span></code> object.</p>
</div>
</div>
<div class="section" id="debug-mode">
<span id="id2"></span><h4>Debug Mode<a class="headerlink" href="#debug-mode" title="Permalink to this headline">¶</a></h4>
<p>(Want to just log errors and stack traces? See <a class="reference internal" href="index.html#application-errors"><span class="std std-ref">Application Errors</span></a>)</p>
<p>The <strong class="command">flask</strong> script is nice to start a local development server, but
you would have to restart it manually after each change to your code.
That is not very nice and Flask can do better.  If you enable debug
support the server will reload itself on code changes, and it will also
provide you with a helpful debugger if things go wrong.</p>
<p>To enable debug mode you can export the <code class="docutils literal notranslate"><span class="pre">FLASK_DEBUG</span></code> environment variable
before running the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export FLASK_DEBUG=1
$ flask run
</pre></div>
</div>
<p>(On Windows you need to use <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of <code class="docutils literal notranslate"><span class="pre">export</span></code>).</p>
<p>This does the following things:</p>
<ol class="arabic simple">
<li><p>it activates the debugger</p></li>
<li><p>it activates the automatic reloader</p></li>
<li><p>it enables the debug mode on the Flask application.</p></li>
</ol>
<p>There are more parameters that are explained in the <a class="reference internal" href="index.html#server"><span class="std std-ref">Development Server</span></a> docs.</p>
<div class="admonition-attention admonition">
<p class="admonition-title">Attention</p>
<p>Even though the interactive debugger does not work in forking environments
(which makes it nearly impossible to use on production servers), it still
allows the execution of arbitrary code. This makes it a major security risk
and therefore it <strong>must never be used on production machines</strong>.</p>
</div>
<p>Screenshot of the debugger in action:</p>
<img alt="screenshot of debugger in action" class="screenshot align-center" src="_images/debugger.png" />
<p>Have another debugger in mind? See <a class="reference internal" href="index.html#working-with-debuggers"><span class="std std-ref">Working with Debuggers</span></a>.</p>
</div>
<div class="section" id="routing">
<h4>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h4>
<p>Modern web applications have beautiful URLs.  This helps people remember
the URLs, which is especially handy for applications that are used from
mobile devices with slower network connections.  If the user can directly
go to the desired page without having to hit the index page it is more
likely they will like the page and come back next time.</p>
<p>As you have seen above, the <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> decorator is used to
bind a function to a URL.  Here are some basic examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Index Page&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello, World&#39;</span>
</pre></div>
</div>
<p>But there is more to it!  You can make certain parts of the URL dynamic and
attach multiple rules to a function.</p>
<div class="section" id="variable-rules">
<h5>Variable Rules<a class="headerlink" href="#variable-rules" title="Permalink to this headline">¶</a></h5>
<p>To add variable parts to a URL you can mark these special sections as
<code class="docutils literal notranslate"><span class="pre">&lt;variable_name&gt;</span></code>.  Such a part is then passed as a keyword argument to your
function.  Optionally a converter can be used by specifying a rule with
<code class="docutils literal notranslate"><span class="pre">&lt;converter:variable_name&gt;</span></code>.  Here are some nice examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_user_profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="c1"># show the user profile for that user</span>
    <span class="k">return</span> <span class="s1">&#39;User </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">username</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post/&lt;int:post_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_post</span><span class="p">(</span><span class="n">post_id</span><span class="p">):</span>
    <span class="c1"># show the post with the given id, the id is an integer</span>
    <span class="k">return</span> <span class="s1">&#39;Post </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">post_id</span>
</pre></div>
</div>
<p>The following converters exist:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><cite>string</cite></p></td>
<td><p>accepts any text without a slash (the default)</p></td>
</tr>
<tr class="row-even"><td><p><cite>int</cite></p></td>
<td><p>accepts integers</p></td>
</tr>
<tr class="row-odd"><td><p><cite>float</cite></p></td>
<td><p>like <code class="docutils literal notranslate"><span class="pre">int</span></code> but for floating point values</p></td>
</tr>
<tr class="row-even"><td><p><cite>path</cite></p></td>
<td><p>like the default but also accepts slashes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>any</cite></p></td>
<td><p>matches one of the items provided</p></td>
</tr>
<tr class="row-even"><td><p><cite>uuid</cite></p></td>
<td><p>accepts UUID strings</p></td>
</tr>
</tbody>
</table>
<div class="admonition-unique-urls-redirection-behavior admonition">
<p class="admonition-title">Unique URLs / Redirection Behavior</p>
<p>Flask’s URL rules are based on Werkzeug’s routing module.  The idea
behind that module is to ensure beautiful and unique URLs based on
precedents laid down by Apache and earlier HTTP servers.</p>
<p>Take these two rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/projects/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">projects</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;The project page&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;The about page&#39;</span>
</pre></div>
</div>
<p>Though they look rather similar, they differ in their use of the trailing
slash in the URL <em>definition</em>.  In the first case, the canonical URL for the
<code class="docutils literal notranslate"><span class="pre">projects</span></code> endpoint has a trailing slash.  In that sense, it is similar to
a folder on a filesystem.  Accessing it without a trailing slash will cause
Flask to redirect to the canonical URL with the trailing slash.</p>
<p>In the second case, however, the URL is defined without a trailing slash,
rather like the pathname of a file on UNIX-like systems. Accessing the URL
with a trailing slash will produce a 404 “Not Found” error.</p>
<p>This behavior allows relative URLs to continue working even if the trailing
slash is omitted, consistent with how Apache and other servers work.  Also,
the URLs will stay unique, which helps search engines avoid indexing the
same page twice.</p>
</div>
</div>
<div class="section" id="url-building">
<span id="id3"></span><h5>URL Building<a class="headerlink" href="#url-building" title="Permalink to this headline">¶</a></h5>
<p>If it can match URLs, can Flask also generate them?  Of course it can.  To
build a URL to a specific function you can use the <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a>
function.  It accepts the name of the function as first argument and a number
of keyword arguments, each corresponding to the variable part of the URL rule.
Unknown variable parts are appended to the URL as query parameters.  Here are
some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">url_for</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">login</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">():</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;John Doe&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">/</span>
<span class="go">/login</span>
<span class="go">/login?next=/</span>
<span class="go">/user/John%20Doe</span>
</pre></div>
</div>
<p>(This also uses the <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a> method, explained
below.  It tells Flask to behave as though it is handling a request, even
though we are interacting with it through a Python shell.  Have a look at the
explanation below. <a class="reference internal" href="#context-locals"><span class="std std-ref">Context Locals</span></a>).</p>
<p>Why would you want to build URLs using the URL reversing function
<a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> instead of hard-coding them into your templates?
There are three good reasons for this:</p>
<ol class="arabic simple">
<li><p>Reversing is often more descriptive than hard-coding the URLs.  More
importantly, it allows you to change URLs in one go, without having to
remember to change URLs all over the place.</p></li>
<li><p>URL building will handle escaping of special characters and Unicode
data transparently for you, so you don’t have to deal with them.</p></li>
<li><p>If your application is placed outside the URL root - say, in
<code class="docutils literal notranslate"><span class="pre">/myapplication</span></code> instead of <code class="docutils literal notranslate"><span class="pre">/</span></code> - <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> will handle
that properly for you.</p></li>
</ol>
</div>
<div class="section" id="http-methods">
<h5>HTTP Methods<a class="headerlink" href="#http-methods" title="Permalink to this headline">¶</a></h5>
<p>HTTP (the protocol web applications are speaking) knows different methods for
accessing URLs.  By default, a route only answers to <code class="docutils literal notranslate"><span class="pre">GET</span></code> requests, but that
can be changed by providing the <code class="docutils literal notranslate"><span class="pre">methods</span></code> argument to the
<a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> decorator.  Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">do_the_login</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">show_the_login_form</span><span class="p">()</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">GET</span></code> is present, <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> will be added automatically for you.  You
don’t have to deal with that.  It will also make sure that <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> requests
are handled as the <a class="reference external" href="http://www.ietf.org/rfc/rfc2068.txt">HTTP RFC</a> (the document describing the HTTP
protocol) demands, so you can completely ignore that part of the HTTP
specification.  Likewise, as of Flask 0.6, <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> is implemented for you
automatically as well.</p>
<p>You have no idea what an HTTP method is?  Worry not, here is a quick
introduction to HTTP methods and why they matter:</p>
<p>The HTTP method (also often called “the verb”) tells the server what the
client wants to <em>do</em> with the requested page.  The following methods are
very common:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt><dd><p>The browser tells the server to just <em>get</em> the information stored on
that page and send it.  This is probably the most common method.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">HEAD</span></code></dt><dd><p>The browser tells the server to get the information, but it is only
interested in the <em>headers</em>, not the content of the page.  An
application is supposed to handle that as if a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request was
received but to not deliver the actual content.  In Flask you don’t
have to deal with that at all, the underlying Werkzeug library handles
that for you.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">POST</span></code></dt><dd><p>The browser tells the server that it wants to <em>post</em> some new
information to that URL and that the server must ensure the data is
stored and only stored once.  This is how HTML forms usually
transmit data to the server.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PUT</span></code></dt><dd><p>Similar to <code class="docutils literal notranslate"><span class="pre">POST</span></code> but the server might trigger the store procedure
multiple times by overwriting the old values more than once.  Now you
might be asking why this is useful, but there are some good reasons
to do it this way.  Consider that the connection is lost during
transmission: in this situation a system between the browser and the
server might receive the request safely a second time without breaking
things.  With <code class="docutils literal notranslate"><span class="pre">POST</span></code> that would not be possible because it must only
be triggered once.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></dt><dd><p>Remove the information at the given location.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code></dt><dd><p>Provides a quick way for a client to figure out which methods are
supported by this URL.  Starting with Flask 0.6, this is implemented
for you automatically.</p>
</dd>
</dl>
<p>Now the interesting part is that in HTML4 and XHTML1, the only methods a
form can submit to the server are <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">POST</span></code>.  But with JavaScript
and future HTML standards you can use the other methods as well.  Furthermore
HTTP has become quite popular lately and browsers are no longer the only
clients that are using HTTP. For instance, many revision control systems
use it.</p>
</div>
</div>
<div class="section" id="static-files">
<h4>Static Files<a class="headerlink" href="#static-files" title="Permalink to this headline">¶</a></h4>
<p>Dynamic web applications also need static files.  That’s usually where
the CSS and JavaScript files are coming from.  Ideally your web server is
configured to serve them for you, but during development Flask can do that
as well.  Just create a folder called <code class="file docutils literal notranslate"><span class="pre">static</span></code> in your package or next to
your module and it will be available at <code class="docutils literal notranslate"><span class="pre">/static</span></code> on the application.</p>
<p>To generate URLs for static files, use the special <code class="docutils literal notranslate"><span class="pre">'static'</span></code> endpoint name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The file has to be stored on the filesystem as <code class="file docutils literal notranslate"><span class="pre">static/style.css</span></code>.</p>
</div>
<div class="section" id="rendering-templates">
<h4>Rendering Templates<a class="headerlink" href="#rendering-templates" title="Permalink to this headline">¶</a></h4>
<p>Generating HTML from within Python is not fun, and actually pretty
cumbersome because you have to do the HTML escaping on your own to keep
the application secure.  Because of that Flask configures the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> template engine for you automatically.</p>
<p>To render a template you can use the <a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code></a>
method.  All you have to do is provide the name of the template and the
variables you want to pass to the template engine as keyword arguments.
Here’s a simple example of how to render a template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">render_template</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello/&#39;</span><span class="p">)</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;hello.html&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Flask will look for templates in the <code class="file docutils literal notranslate"><span class="pre">templates</span></code> folder.  So if your
application is a module, this folder is next to that module, if it’s a
package it’s actually inside your package:</p>
<p><strong>Case 1</strong>: a module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">templates</span>
    <span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p><strong>Case 2</strong>: a package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">application</span>
    <span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="o">/</span><span class="n">templates</span>
        <span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>For templates you can use the full power of Jinja2 templates.  Head over
to the official <a class="reference external" href="http://jinja.pocoo.org/docs/templates">Jinja2 Template Documentation</a> for more information.</p>
<p>Here is an example template:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello from Flask<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">name</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello, World!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Inside templates you also have access to the <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>,
<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a> and <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> <a class="footnote-reference brackets" href="#id5" id="id4">1</a> objects
as well as the <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a> function.</p>
<p>Templates are especially useful if inheritance is used.  If you want to
know how that works, head over to the <a class="reference internal" href="index.html#template-inheritance"><span class="std std-ref">Template Inheritance</span></a> pattern
documentation.  Basically template inheritance makes it possible to keep
certain elements on each page (like header, navigation and footer).</p>
<p>Automatic escaping is enabled, so if <code class="docutils literal notranslate"><span class="pre">name</span></code> contains HTML it will be escaped
automatically.  If you can trust a variable and you know that it will be
safe HTML (for example because it came from a module that converts wiki
markup to HTML) you can mark it as safe by using the
<a class="reference external" href="https://jinja.palletsprojects.com/en/2.11.x/api/#jinja2.Markup" title="(in Jinja v2.11.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a> class or by using the <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter in the
template.  Head over to the Jinja 2 documentation for more examples.</p>
<p>Here is a basic introduction to how the <a class="reference external" href="https://jinja.palletsprojects.com/en/2.11.x/api/#jinja2.Markup" title="(in Jinja v2.11.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a> class works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Markup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;strong&gt;Hello </span><span class="si">%s</span><span class="s1">!&lt;/strong&gt;&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="s1">&#39;&lt;blink&gt;hacker&lt;/blink&gt;&#39;</span>
<span class="go">Markup(u&#39;&lt;strong&gt;Hello &amp;lt;blink&amp;gt;hacker&amp;lt;/blink&amp;gt;!&lt;/strong&gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;&lt;blink&gt;hacker&lt;/blink&gt;&#39;</span><span class="p">)</span>
<span class="go">Markup(u&#39;&amp;lt;blink&amp;gt;hacker&amp;lt;/blink&amp;gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;em&gt;Marked up&lt;/em&gt; &amp;raquo; HTML&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">striptags</span><span class="p">()</span>
<span class="go">u&#39;Marked up \xbb HTML&#39;</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5: </span>Autoescaping is no longer enabled for all templates.  The following
extensions for templates trigger autoescaping: <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.htm</span></code>,
<code class="docutils literal notranslate"><span class="pre">.xml</span></code>, <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code>.  Templates loaded from a string will have
autoescaping disabled.</p>
</div>
</details><dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>Unsure what that <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> object is? It’s something in which
you can store information for your own needs, check the documentation of
that object (<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a>) and the <a class="reference internal" href="index.html#sqlite3"><span class="std std-ref">Using SQLite 3 with Flask</span></a> for more
information.</p>
</dd>
</dl>
</div>
<div class="section" id="accessing-request-data">
<h4>Accessing Request Data<a class="headerlink" href="#accessing-request-data" title="Permalink to this headline">¶</a></h4>
<p>For web applications it’s crucial to react to the data a client sends to
the server.  In Flask this information is provided by the global
<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> object.  If you have some experience with Python
you might be wondering how that object can be global and how Flask
manages to still be threadsafe.  The answer is context locals:</p>
<div class="section" id="context-locals">
<span id="id6"></span><h5>Context Locals<a class="headerlink" href="#context-locals" title="Permalink to this headline">¶</a></h5>
<div class="admonition-insider-information admonition">
<p class="admonition-title">Insider Information</p>
<p>If you want to understand how that works and how you can implement
tests with context locals, read this section, otherwise just skip it.</p>
</div>
<p>Certain objects in Flask are global objects, but not of the usual kind.
These objects are actually proxies to objects that are local to a specific
context.  What a mouthful.  But that is actually quite easy to understand.</p>
<p>Imagine the context being the handling thread.  A request comes in and the
web server decides to spawn a new thread (or something else, the
underlying object is capable of dealing with concurrency systems other
than threads).  When Flask starts its internal request handling it
figures out that the current thread is the active context and binds the
current application and the WSGI environments to that context (thread).
It does that in an intelligent way so that one application can invoke another
application without breaking.</p>
<p>So what does this mean to you?  Basically you can completely ignore that
this is the case unless you are doing something like unit testing.  You
will notice that code which depends on a request object will suddenly break
because there is no request object.  The solution is creating a request
object yourself and binding it to the context.  The easiest solution for
unit testing is to use the <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a>
context manager.  In combination with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement it will bind a
test request so that you can interact with it.  Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">):</span>
    <span class="c1"># now you can do something with the request until the</span>
    <span class="c1"># end of the with block, such as basic assertions:</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/hello&#39;</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span>
</pre></div>
</div>
<p>The other possibility is passing a whole WSGI environment to the
<a class="reference internal" href="index.html#flask.Flask.request_context" title="flask.Flask.request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_context()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-request-object">
<h5>The Request Object<a class="headerlink" href="#the-request-object" title="Permalink to this headline">¶</a></h5>
<p>The request object is documented in the API section and we will not cover
it here in detail (see <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>). Here is a broad overview of
some of the most common operations.  First of all you have to import it from
the <code class="docutils literal notranslate"><span class="pre">flask</span></code> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>
</pre></div>
</div>
<p>The current request method is available by using the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">method</span></code> attribute.  To access form data (data
transmitted in a <code class="docutils literal notranslate"><span class="pre">POST</span></code> or <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request) you can use the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">form</span></code> attribute.  Here is a full example of the two
attributes mentioned above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valid_login</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                       <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">log_the_user_in</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid username/password&#39;</span>
    <span class="c1"># the code below is executed if the request method</span>
    <span class="c1"># was GET or the credentials were invalid</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>What happens if the key does not exist in the <code class="docutils literal notranslate"><span class="pre">form</span></code> attribute?  In that
case a special <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a> is raised.  You can catch it like a
standard <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a> but if you don’t do that, a HTTP 400 Bad Request
error page is shown instead.  So for many situations you don’t have to
deal with that problem.</p>
<p>To access parameters submitted in the URL (<code class="docutils literal notranslate"><span class="pre">?key=value</span></code>) you can use the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">searchword</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We recommend accessing URL parameters with <cite>get</cite> or by catching the
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a> because users might change the URL and presenting them a 400
bad request page in that case is not user friendly.</p>
<p>For a full list of methods and attributes of the request object, head over
to the <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> documentation.</p>
</div>
<div class="section" id="file-uploads">
<h5>File Uploads<a class="headerlink" href="#file-uploads" title="Permalink to this headline">¶</a></h5>
<p>You can handle uploaded files with Flask easily.  Just make sure not to
forget to set the <code class="docutils literal notranslate"><span class="pre">enctype=&quot;multipart/form-data&quot;</span></code> attribute on your HTML
form, otherwise the browser will not transmit your files at all.</p>
<p>Uploaded files are stored in memory or at a temporary location on the
filesystem.  You can access those files by looking at the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code> attribute on the request object.  Each
uploaded file is stored in that dictionary.  It behaves just like a
standard Python <code class="xref py py-class docutils literal notranslate"><span class="pre">file</span></code> object, but it also has a
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage.save" title="(in Werkzeug v1.0.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> method that allows you to store that
file on the filesystem of the server.  Here is a simple example showing how
that works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;the_file&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/var/www/uploads/uploaded_file.txt&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If you want to know how the file was named on the client before it was
uploaded to your application, you can access the
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage.filename" title="(in Werkzeug v1.0.x)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">filename</span></code></a> attribute.  However please keep in
mind that this value can be forged so never ever trust that value.  If you
want to use the filename of the client to store the file on the server,
pass it through the <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/utils/#werkzeug.utils.secure_filename" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">secure_filename()</span></code></a> function that
Werkzeug provides for you:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="k">import</span> <span class="n">secure_filename</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;the_file&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/var/www/uploads/&#39;</span> <span class="o">+</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>For some better examples, checkout the <a class="reference internal" href="index.html#uploading-files"><span class="std std-ref">Uploading Files</span></a> pattern.</p>
</div>
<div class="section" id="cookies">
<h5>Cookies<a class="headerlink" href="#cookies" title="Permalink to this headline">¶</a></h5>
<p>To access cookies you can use the <a class="reference internal" href="index.html#flask.Request.cookies" title="flask.Request.cookies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cookies</span></code></a>
attribute.  To set cookies you can use the
<a class="reference internal" href="index.html#flask.Response.set_cookie" title="flask.Response.set_cookie"><code class="xref py py-attr docutils literal notranslate"><span class="pre">set_cookie</span></code></a> method of response objects.  The
<a class="reference internal" href="index.html#flask.Request.cookies" title="flask.Request.cookies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cookies</span></code></a> attribute of request objects is a
dictionary with all the cookies the client transmits.  If you want to use
sessions, do not use the cookies directly but instead use the
<a class="reference internal" href="#sessions"><span class="std std-ref">Sessions</span></a> in Flask that add some security on top of cookies for you.</p>
<p>Reading cookies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
    <span class="c1"># use cookies.get(key) instead of cookies[key] to not get a</span>
    <span class="c1"># KeyError if the cookie is missing.</span>
</pre></div>
</div>
<p>Storing cookies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">make_response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;the username&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
<p>Note that cookies are set on response objects.  Since you normally
just return strings from the view functions Flask will convert them into
response objects for you.  If you explicitly want to do that you can use
the <a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_response()</span></code></a> function and then modify it.</p>
<p>Sometimes you might want to set a cookie at a point where the response
object does not exist yet.  This is possible by utilizing the
<a class="reference internal" href="index.html#deferred-callbacks"><span class="std std-ref">Deferred Request Callbacks</span></a> pattern.</p>
<p>For this also see <a class="reference internal" href="#about-responses"><span class="std std-ref">About Responses</span></a>.</p>
</div>
</div>
<div class="section" id="redirects-and-errors">
<h4>Redirects and Errors<a class="headerlink" href="#redirects-and-errors" title="Permalink to this headline">¶</a></h4>
<p>To redirect a user to another endpoint, use the <a class="reference internal" href="index.html#flask.redirect" title="flask.redirect"><code class="xref py py-func docutils literal notranslate"><span class="pre">redirect()</span></code></a>
function; to abort a request early with an error code, use the
<a class="reference internal" href="index.html#flask.abort" title="flask.abort"><code class="xref py py-func docutils literal notranslate"><span class="pre">abort()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">abort</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="n">this_is_never_executed</span><span class="p">()</span>
</pre></div>
</div>
<p>This is a rather pointless example because a user will be redirected from
the index to a page they cannot access (401 means access denied) but it
shows how that works.</p>
<p>By default a black and white error page is shown for each error code.  If
you want to customize the error page, you can use the
<a class="reference internal" href="index.html#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">render_template</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;page_not_found.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">404</span></code> after the <a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code></a> call.  This
tells Flask that the status code of that page should be 404 which means
not found.  By default 200 is assumed which translates to: all went well.</p>
<p>See <a class="reference internal" href="index.html#error-handlers"><span class="std std-ref">Error handlers</span></a> for more details.</p>
</div>
<div class="section" id="about-responses">
<span id="id7"></span><h4>About Responses<a class="headerlink" href="#about-responses" title="Permalink to this headline">¶</a></h4>
<p>The return value from a view function is automatically converted into a
response object for you.  If the return value is a string it’s converted
into a response object with the string as response body, a <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code>
status code and a <em class="mimetype">text/html</em> mimetype.  The logic that Flask applies to
converting return values into response objects is as follows:</p>
<ol class="arabic simple">
<li><p>If a response object of the correct type is returned it’s directly
returned from the view.</p></li>
<li><p>If it’s a string, a response object is created with that data and the
default parameters.</p></li>
<li><p>If a tuple is returned the items in the tuple can provide extra
information.  Such tuples have to be in the form <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">status,</span>
<span class="pre">headers)</span></code> or <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">headers)</span></code> where at least one item has
to be in the tuple.  The <code class="docutils literal notranslate"><span class="pre">status</span></code> value will override the status code
and <code class="docutils literal notranslate"><span class="pre">headers</span></code> can be a list or dictionary of additional header values.</p></li>
<li><p>If none of that works, Flask will assume the return value is a
valid WSGI application and convert that into a response object.</p></li>
</ol>
<p>If you want to get hold of the resulting response object inside the view
you can use the <a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_response()</span></code></a> function.</p>
<p>Imagine you have a view like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;error.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
</pre></div>
</div>
<p>You just need to wrap the return expression with
<a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_response()</span></code></a> and get the response object to modify it, then
return it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;error.html&#39;</span><span class="p">),</span> <span class="mi">404</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Something&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;A value&#39;</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
</div>
<div class="section" id="sessions">
<span id="id8"></span><h4>Sessions<a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a></h4>
<p>In addition to the request object there is also a second object called
<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a> which allows you to store information specific to a
user from one request to the next.  This is implemented on top of cookies
for you and signs the cookies cryptographically.  What this means is that
the user could look at the contents of your cookie but not modify it,
unless they know the secret key used for signing.</p>
<p>In order to use sessions you have to set a secret key.  Here is how
sessions work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">escape</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Logged in as </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">escape</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s1">&#39;You are not logged in&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        &lt;form method=&quot;post&quot;&gt;</span>
<span class="s1">            &lt;p&gt;&lt;input type=text name=username&gt;</span>
<span class="s1">            &lt;p&gt;&lt;input type=submit value=Login&gt;</span>
<span class="s1">        &lt;/form&gt;</span>
<span class="s1">    &#39;&#39;&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="c1"># remove the username from the session if it&#39;s there</span>
    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>

<span class="c1"># set the secret key.  keep this really secret:</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;A0Zr98j/3yX R~XHH!jmN]LWX/,?RT&#39;</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="index.html#flask.escape" title="flask.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a> mentioned here does escaping for you if you are
not using the template engine (as in this example).</p>
<div class="admonition-how-to-generate-good-secret-keys admonition">
<p class="admonition-title">How to generate good secret keys</p>
<p>The problem with random is that it’s hard to judge what is truly random.  And
a secret key should be as random as possible.  Your operating system
has ways to generate pretty random stuff based on a cryptographic
random generator which can be used to get such a key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="go">&#39;\xfd{H\xe5&lt;\x95\xf9\xe3\x96.5\xd1\x01O&lt;!\xd5\xa2\xa0\x9fR&quot;\xa1\xa8&#39;</span>

<span class="go">Just take that thing and copy/paste it into your code and you&#39;re done.</span>
</pre></div>
</div>
</div>
<p>A note on cookie-based sessions: Flask will take the values you put into the
session object and serialize them into a cookie.  If you are finding some
values do not persist across requests, cookies are indeed enabled, and you are
not getting a clear error message, check the size of the cookie in your page
responses compared to the size supported by web browsers.</p>
<p>Besides the default client-side based sessions, if you want to handle
sessions on the server-side instead, there are several
Flask extensions that support this.</p>
</div>
<div class="section" id="message-flashing">
<h4>Message Flashing<a class="headerlink" href="#message-flashing" title="Permalink to this headline">¶</a></h4>
<p>Good applications and user interfaces are all about feedback.  If the user
does not get enough feedback they will probably end up hating the
application.  Flask provides a really simple way to give feedback to a
user with the flashing system.  The flashing system basically makes it
possible to record a message at the end of a request and access it on the next
(and only the next) request.  This is usually combined with a layout
template to expose the message.</p>
<p>To flash a message use the <a class="reference internal" href="index.html#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a> method, to get hold of the
messages you can use <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a> which is also
available in the templates.  Check out the <a class="reference internal" href="index.html#message-flashing-pattern"><span class="std std-ref">Message Flashing</span></a>
for a full example.</p>
</div>
<div class="section" id="logging">
<h4>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details><p>Sometimes you might be in a situation where you deal with data that
should be correct, but actually is not.  For example you may have some client-side
code that sends an HTTP request to the server but it’s obviously
malformed.  This might be caused by a user tampering with the data, or the
client code failing.  Most of the time it’s okay to reply with <code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span>
<span class="pre">Request</span></code> in that situation, but sometimes that won’t do and the code has
to continue working.</p>
<p>You may still want to log that something fishy happened.  This is where
loggers come in handy.  As of Flask 0.3 a logger is preconfigured for you
to use.</p>
<p>Here are some example log calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;A value for debugging&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;A warning occurred (</span><span class="si">%d</span><span class="s1"> apples)&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;An error occurred&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The attached <a class="reference internal" href="index.html#flask.Flask.logger" title="flask.Flask.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">logger</span></code></a> is a standard logging
<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Logger</span></code></a>, so head over to the official <a class="reference external" href="https://docs.python.org/library/logging.html">logging
documentation</a> for more
information.</p>
<p>Read more on <a class="reference internal" href="index.html#application-errors"><span class="std std-ref">Application Errors</span></a>.</p>
</div>
<div class="section" id="hooking-in-wsgi-middlewares">
<h4>Hooking in WSGI Middlewares<a class="headerlink" href="#hooking-in-wsgi-middlewares" title="Permalink to this headline">¶</a></h4>
<p>If you want to add a WSGI middleware to your application you can wrap the
internal WSGI application.  For example if you want to use one of the
middlewares from the Werkzeug package to work around bugs in lighttpd, you
can do it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.fixers</span> <span class="k">import</span> <span class="n">LighttpdCGIRootFix</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">LighttpdCGIRootFix</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-flask-extensions">
<h4>Using Flask Extensions<a class="headerlink" href="#using-flask-extensions" title="Permalink to this headline">¶</a></h4>
<p>Extensions are packages that help you accomplish common tasks. For
example, Flask-SQLAlchemy provides SQLAlchemy support that makes it simple
and easy to use with Flask.</p>
<p>For more on Flask extensions, have a look at <a class="reference internal" href="index.html#extensions"><span class="std std-ref">Flask Extensions</span></a>.</p>
</div>
<div class="section" id="deploying-to-a-web-server">
<h4>Deploying to a Web Server<a class="headerlink" href="#deploying-to-a-web-server" title="Permalink to this headline">¶</a></h4>
<p>Ready to deploy your new Flask app? Go to <a class="reference internal" href="index.html#deployment"><span class="std std-ref">Deployment Options</span></a>.</p>
</div>
</div>
<span id="document-tutorial/index"></span><div class="section" id="tutorial">
<span id="id1"></span><h3>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h3>
<p>You want to develop an application with Python and Flask?  Here you have
the chance to learn by example.  In this tutorial, we will create a simple
microblogging application.  It only supports one user that can create
text-only entries and there are no feeds or comments, but it still
features everything you need to get started.  We will use Flask and SQLite
as a database (which comes out of the box with Python) so there is nothing
else you need.</p>
<p>If you want the full source code in advance or for comparison, check out
the <a class="reference external" href="https://github.com/pallets/flask/tree/master/examples/flaskr">example source</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-tutorial/introduction"></span><div class="section" id="introducing-flaskr">
<span id="tutorial-introduction"></span><h4>Introducing Flaskr<a class="headerlink" href="#introducing-flaskr" title="Permalink to this headline">¶</a></h4>
<p>This tutorial will demonstrate a blogging application named Flaskr, but feel
free to choose your own less Web-2.0-ish name ;)  Essentially, it will do the
following things:</p>
<ol class="arabic simple">
<li><p>Let the user sign in and out with credentials specified in the
configuration.  Only one user is supported.</p></li>
<li><p>When the user is logged in, they can add new entries to the page
consisting of a text-only title and some HTML for the text.  This HTML
is not sanitized because we trust the user here.</p></li>
<li><p>The index page shows all entries so far in reverse chronological order
(newest on top) and the user can add new ones from there if logged in.</p></li>
</ol>
<p>SQLite3 will be used directly for this application because it’s good enough
for an application of this size.  For larger applications, however,
it makes a lot of sense to use <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a>, as it handles database
connections in a more intelligent way, allowing you to target different
relational databases at once and more.  You might also want to consider
one of the popular NoSQL databases if your data is more suited for those.</p>
<p>Here a screenshot of the final application:</p>
<img alt="screenshot of the final application" class="screenshot align-center" src="_images/flaskr.png" />
<p>Continue with <a class="reference internal" href="index.html#tutorial-folders"><span class="std std-ref">Step 0: Creating The Folders</span></a>.</p>
</div>
<span id="document-tutorial/folders"></span><div class="section" id="step-0-creating-the-folders">
<span id="tutorial-folders"></span><h4>Step 0: Creating The Folders<a class="headerlink" href="#step-0-creating-the-folders" title="Permalink to this headline">¶</a></h4>
<p>Before getting started, you will need to create the folders needed for this
application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">flaskr</span>
    <span class="o">/</span><span class="n">flaskr</span>
        <span class="o">/</span><span class="n">static</span>
        <span class="o">/</span><span class="n">templates</span>
</pre></div>
</div>
<p>The application will be installed and run as Python package.  This is the
recommended way to install and run Flask applications.  You will see exactly
how to run <code class="docutils literal notranslate"><span class="pre">flaskr</span></code> later on in this tutorial.  For now go ahead and create
the applications directory structure.  In the next few steps you will be
creating the database schema as well as the main module.</p>
<p>As a quick side note, the files inside of the <code class="file docutils literal notranslate"><span class="pre">static</span></code> folder are
available to users of the application via HTTP.  This is the place where CSS and
JavaScript files go.  Inside the <code class="file docutils literal notranslate"><span class="pre">templates</span></code> folder, Flask will look for
<a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> templates.  You will see examples of this later on.</p>
<p>For now you should continue with <a class="reference internal" href="index.html#tutorial-schema"><span class="std std-ref">Step 1: Database Schema</span></a>.</p>
</div>
<span id="document-tutorial/schema"></span><div class="section" id="step-1-database-schema">
<span id="tutorial-schema"></span><h4>Step 1: Database Schema<a class="headerlink" href="#step-1-database-schema" title="Permalink to this headline">¶</a></h4>
<p>In this step, you will create the database schema.  Only a single table is
needed for this application and it will only support SQLite.  All you need to do
is put the following contents into a file named <code class="file docutils literal notranslate"><span class="pre">schema.sql</span></code> in the
<code class="file docutils literal notranslate"><span class="pre">flaskr/flaskr</span></code> folder:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">drop</span> <span class="k">table</span> <span class="k">if</span> <span class="k">exists</span> <span class="n">entries</span><span class="p">;</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">entries</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">primary</span> <span class="k">key</span> <span class="n">autoincrement</span><span class="p">,</span>
  <span class="n">title</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="s1">&#39;text&#39;</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</pre></div>
</div>
<p>This schema consists of a single table called <code class="docutils literal notranslate"><span class="pre">entries</span></code>.  Each row in
this table has an <code class="docutils literal notranslate"><span class="pre">id</span></code>, a <code class="docutils literal notranslate"><span class="pre">title</span></code>, and a <code class="docutils literal notranslate"><span class="pre">text</span></code>.  The <code class="docutils literal notranslate"><span class="pre">id</span></code> is an
automatically incrementing integer and a primary key, the other two are
strings that must not be null.</p>
<p>Continue with <a class="reference internal" href="index.html#tutorial-setup"><span class="std std-ref">Step 2: Application Setup Code</span></a>.</p>
</div>
<span id="document-tutorial/setup"></span><div class="section" id="step-2-application-setup-code">
<span id="tutorial-setup"></span><h4>Step 2: Application Setup Code<a class="headerlink" href="#step-2-application-setup-code" title="Permalink to this headline">¶</a></h4>
<p>Now that the schema is in place, you can create the application module,
<code class="file docutils literal notranslate"><span class="pre">flaskr.py</span></code>.  This file should be placed inside of the
<code class="file docutils literal notranslate"><span class="pre">flaskr/flaskr</span></code> folder.  The first several lines of code in the
application module are the needed import statements.  After that there will be a
few lines of configuration code. For small applications like <code class="docutils literal notranslate"><span class="pre">flaskr</span></code>, it is
possible to drop the configuration directly into the module.  However, a cleaner
solution is to create a separate <code class="docutils literal notranslate"><span class="pre">.ini</span></code> or <code class="docutils literal notranslate"><span class="pre">.py</span></code> file, load that, and
import the values from there.</p>
<p>Here are the import statements (in <code class="file docutils literal notranslate"><span class="pre">flaskr.py</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># all the imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> \
     <span class="n">render_template</span><span class="p">,</span> <span class="n">flash</span>
</pre></div>
</div>
<p>The next couple lines will create the actual application instance and
initialize it with the config from the same file in <code class="file docutils literal notranslate"><span class="pre">flaskr.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span> <span class="c1"># create the application instance :)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span> <span class="c1"># load config from this file , flaskr.py</span>

<span class="c1"># Load default config and override config from an environment variable</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">DATABASE</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s1">&#39;flaskr.db&#39;</span><span class="p">),</span>
    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s1">&#39;development key&#39;</span><span class="p">,</span>
    <span class="n">USERNAME</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="n">PASSWORD</span><span class="o">=</span><span class="s1">&#39;default&#39;</span>
<span class="p">))</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;FLASKR_SETTINGS&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="index.html#flask.Config" title="flask.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> object works similarly to a dictionary, so it can be
updated with new values.</p>
<div class="admonition-database-path admonition">
<p class="admonition-title">Database Path</p>
<p>Operating systems know the concept of a current working directory for
each process.  Unfortunately, you cannot depend on this in web
applications because you might have more than one application in the
same process.</p>
<p>For this reason the <code class="docutils literal notranslate"><span class="pre">app.root_path</span></code> attribute can be used to
get the path to the application.  Together with the <code class="docutils literal notranslate"><span class="pre">os.path</span></code> module,
files can then easily be found.  In this example, we place the
database right next to it.</p>
<p>For a real-world application, it’s recommended to use
<a class="reference internal" href="index.html#instance-folders"><span class="std std-ref">Instance Folders</span></a> instead.</p>
</div>
<p>Usually, it is a good idea to load a separate, environment-specific
configuration file.  Flask allows you to import multiple configurations and it
will use the setting defined in the last import.  This enables robust
configuration setups.  <a class="reference internal" href="index.html#flask.Config.from_envvar" title="flask.Config.from_envvar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_envvar()</span></code></a> can help achieve this.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;FLASKR_SETTINGS&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Simply define the environment variable <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">FLASKR_SETTINGS</span></code> that points to
a config file to be loaded.  The silent switch just tells Flask to not complain
if no such environment key is set.</p>
<p>In addition to that, you can use the <a class="reference internal" href="index.html#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a>
method on the config object and provide it with an import name of a
module.  Flask will then initialize the variable from that module.  Note
that in all cases, only variable names that are uppercase are considered.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code> is needed to keep the client-side sessions secure.
Choose that key wisely and as hard to guess and complex as possible.</p>
<p>Lastly, you will add a method that allows for easy connections to the
specified database.  This can be used to open a connection on request and
also from the interactive Python shell or a script.  This will come in
handy later.  You can create a simple database connection through SQLite and
then tell it to use the <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Row" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Row</span></code></a> object to represent rows.
This allows the rows to be treated as if they were dictionaries instead of
tuples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Connects to the specific database.&quot;&quot;&quot;</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>
    <span class="n">rv</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="k">return</span> <span class="n">rv</span>
</pre></div>
</div>
<p>In the next section you will see how to run the application.</p>
<p>Continue with <a class="reference internal" href="index.html#tutorial-packaging"><span class="std std-ref">Step 3: Installing flaskr as a Package</span></a>.</p>
</div>
<span id="document-tutorial/packaging"></span><div class="section" id="step-3-installing-flaskr-as-a-package">
<span id="tutorial-packaging"></span><h4>Step 3: Installing flaskr as a Package<a class="headerlink" href="#step-3-installing-flaskr-as-a-package" title="Permalink to this headline">¶</a></h4>
<p>Flask is now shipped with built-in support for <a class="reference external" href="http://click.pocoo.org">Click</a>.  Click provides
Flask with enhanced and extensible command line utilities.  Later in this
tutorial you will see exactly how to extend the <code class="docutils literal notranslate"><span class="pre">flask</span></code> command line
interface (CLI).</p>
<p>A useful pattern to manage a Flask application is to install your app
following the <a class="reference external" href="https://packaging.python.org">Python Packaging Guide</a>.  Presently this involves
creating two new files; <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> and <code class="file docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> in the
projects root directory.  You also need to add an <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code>
file to make the <code class="file docutils literal notranslate"><span class="pre">flaskr/flaskr</span></code> directory a package.  After these
changes, your code structure should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">flaskr</span>
    <span class="o">/</span><span class="n">flaskr</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="o">/</span><span class="n">static</span>
        <span class="o">/</span><span class="n">templates</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">py</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
    <span class="n">MANIFEST</span><span class="o">.</span><span class="ow">in</span>
</pre></div>
</div>
<p>The content of the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file for <code class="docutils literal notranslate"><span class="pre">flaskr</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;flaskr&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flaskr&#39;</span><span class="p">],</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;flask&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When using setuptools, it is also necessary to specify any special files
that should be included in your package (in the <code class="file docutils literal notranslate"><span class="pre">MANIFEST.in</span></code>).
In this case, the static and templates directories need to be included,
as well as the schema. Create the <code class="file docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> and add the
following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graft</span> <span class="n">flaskr</span><span class="o">/</span><span class="n">templates</span>
<span class="n">graft</span> <span class="n">flaskr</span><span class="o">/</span><span class="n">static</span>
<span class="n">include</span> <span class="n">flaskr</span><span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>To simplify locating the application, add the following import statement
into this file, <code class="file docutils literal notranslate"><span class="pre">flaskr/__init__.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.flaskr</span> <span class="kn">import</span> <span class="n">app</span>
</pre></div>
</div>
<p>This import statement brings the application instance into the top-level
of the application package.  When it is time to run the application, the
Flask development server needs the location of the app instance.  This
import statement simplifies the location process.  Without it the export
statement a few steps below would need to be
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">FLASK_APP=flaskr.flaskr</span></code>.</p>
<p>At this point you should be able to install the application.  As usual, it
is recommended to install your Flask application within a <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a>.
With that said, go ahead and install the application with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">editable</span> <span class="o">.</span>
</pre></div>
</div>
<p>The above installation command assumes that it is run within the projects
root directory, <cite>flaskr/</cite>.  The <cite>editable</cite> flag allows editing
source code without having to reinstall the Flask app each time you make
changes.  The flaskr app is now installed in your virtualenv (see output
of <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">freeze</span></code>).</p>
<p>With that out of the way, you should be able to start up the application.
Do this with the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">flaskr</span>
<span class="n">export</span> <span class="n">FLASK_DEBUG</span><span class="o">=</span><span class="n">true</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
<p>(In case you are on Windows you need to use <cite>set</cite> instead of <cite>export</cite>).
The <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">FLASK_DEBUG</span></code> flag enables or disables the interactive debugger.
<em>Never leave debug mode activated in a production system</em>, because it will
allow users to execute code on the server!</p>
<p>You will see a message telling you that server has started along with
the address at which you can access it.</p>
<p>When you head over to the server in your browser, you will get a 404 error
because we don’t have any views yet.  That will be addressed a little later,
but first, you should get the database working.</p>
<div class="admonition-externally-visible-server admonition">
<p class="admonition-title">Externally Visible Server</p>
<p>Want your server to be publicly available?  Check out the
<a class="reference internal" href="index.html#public-server"><span class="std std-ref">externally visible server</span></a> section for more
information.</p>
</div>
<p>Continue with <a class="reference internal" href="index.html#tutorial-dbcon"><span class="std std-ref">Step 4: Database Connections</span></a>.</p>
</div>
<span id="document-tutorial/dbcon"></span><div class="section" id="step-4-database-connections">
<span id="tutorial-dbcon"></span><h4>Step 4: Database Connections<a class="headerlink" href="#step-4-database-connections" title="Permalink to this headline">¶</a></h4>
<p>You currently have a function for establishing a database connection with
<cite>connect_db</cite>, but by itself, it is not particularly useful.  Creating and
closing database connections all the time is very inefficient, so you will
need to keep it around for longer.  Because database connections
encapsulate a transaction, you will need to make sure that only one
request at a time uses the connection. An elegant way to do this is by
utilizing the <em>application context</em>.</p>
<p>Flask provides two contexts: the <em>application context</em> and the
<em>request context</em>.  For the time being, all you have to know is that there
are special variables that use these.  For instance, the
<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">request</span></code></a> variable is the request object associated with
the current request, whereas <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> is a general purpose
variable associated with the current application context.  The tutorial
will cover some more details of this later on.</p>
<p>For the time being, all you have to know is that you can store information
safely on the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> object.</p>
<p>So when do you put it on there?  To do that you can make a helper
function.  The first time the function is called, it will create a database
connection for the current context, and successive calls will return the
already established connection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Opens a new database connection if there is none yet for the</span>
<span class="sd">    current application context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;sqlite_db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span> <span class="o">=</span> <span class="n">connect_db</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span>
</pre></div>
</div>
<p>Now you know how to connect, but how can you properly disconnect?  For
that, Flask provides us with the <a class="reference internal" href="index.html#flask.Flask.teardown_appcontext" title="flask.Flask.teardown_appcontext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_appcontext()</span></code></a>
decorator.  It’s executed every time the application context tears down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">close_db</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the database again at the end of the request.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;sqlite_db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Functions marked with <a class="reference internal" href="index.html#flask.Flask.teardown_appcontext" title="flask.Flask.teardown_appcontext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_appcontext()</span></code></a> are called
every time the app context tears down.  What does this mean?
Essentially, the app context is created before the request comes in and is
destroyed (torn down) whenever the request finishes.  A teardown can
happen because of two reasons: either everything went well (the error
parameter will be <code class="docutils literal notranslate"><span class="pre">None</span></code>) or an exception happened, in which case the error
is passed to the teardown function.</p>
<p>Curious about what these contexts mean?  Have a look at the
<a class="reference internal" href="index.html#app-context"><span class="std std-ref">The Application Context</span></a> documentation to learn more.</p>
<p>Continue to <a class="reference internal" href="index.html#tutorial-dbinit"><span class="std std-ref">Step 5: Creating The Database</span></a>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Where do I put this code?</p>
<p>If you’ve been following along in this tutorial, you might be wondering
where to put the code from this step and the next.  A logical place is to
group these module-level functions together, and put your new
<code class="docutils literal notranslate"><span class="pre">get_db</span></code> and <code class="docutils literal notranslate"><span class="pre">close_db</span></code> functions below your existing
<code class="docutils literal notranslate"><span class="pre">connect_db</span></code> function (following the tutorial line-by-line).</p>
<p>If you need a moment to find your bearings, take a look at how the
<a class="reference external" href="https://github.com/pallets/flask/tree/master/examples/flaskr">example source</a> is organized.  In Flask, you
can put all of your application code into a single Python module.
You don’t have to, and if your app
<a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">grows larger</span></a>, it’s a good idea not to.</p>
</div>
</div>
<span id="document-tutorial/dbinit"></span><div class="section" id="step-5-creating-the-database">
<span id="tutorial-dbinit"></span><h4>Step 5: Creating The Database<a class="headerlink" href="#step-5-creating-the-database" title="Permalink to this headline">¶</a></h4>
<p>As outlined earlier, Flaskr is a database powered application, and more
precisely, it is an application powered by a relational database system.  Such
systems need a schema that tells them how to store that information.
Before starting the server for the first time, it’s important to create
that schema.</p>
<p>Such a schema can be created by piping the <code class="docutils literal notranslate"><span class="pre">schema.sql</span></code> file into the
<cite>sqlite3</cite> command as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite3</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">flaskr</span><span class="o">.</span><span class="n">db</span> <span class="o">&lt;</span> <span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>The downside of this is that it requires the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> command to be
installed, which is not necessarily the case on every system.  This also
requires that you provide the path to the database, which can introduce
errors.  It’s a good idea to add a function that initializes the database
for you, to the application.</p>
<p>To do this, you can create a function and hook it into a <strong class="command">flask</strong>
command that initializes the database.  For now just take a look at the
code segment below.  A good place to add this function, and command, is
just below the <cite>connect_db</cite> function in <code class="file docutils literal notranslate"><span class="pre">flaskr.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;initdb&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">initdb_command</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Initializes the database.&quot;&quot;&quot;</span>
    <span class="n">init_db</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialized the database.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">app.cli.command()</span></code> decorator registers a new command with the
<strong class="command">flask</strong> script.  When the command executes, Flask will automatically
create an application context which is bound to the right application.
Within the function, you can then access <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.g</span></code></a> and other things as
you might expect.  When the script ends, the application context tears down
and the database connection is released.</p>
<p>You will want to keep an actual function around that initializes the database,
though, so that we can easily create databases in unit tests later on.  (For
more information see <a class="reference internal" href="index.html#testing"><span class="std std-ref">Testing Flask Applications</span></a>.)</p>
<p>The <a class="reference internal" href="index.html#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">open_resource()</span></code></a> method of the application object
is a convenient helper function that will open a resource that the
application provides.  This function opens a file from the resource
location (the <code class="file docutils literal notranslate"><span class="pre">flaskr/flaskr</span></code> folder) and allows you to read from it.
It is used in this example to execute a script on the database connection.</p>
<p>The connection object provided by SQLite can give you a cursor object.
On that cursor, there is a method to execute a complete script.  Finally, you
only have to commit the changes.  SQLite3 and other transactional
databases will not commit unless you explicitly tell it to.</p>
<p>Now, it is possible to create a database with the <strong class="command">flask</strong> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flask</span> <span class="n">initdb</span>
<span class="n">Initialized</span> <span class="n">the</span> <span class="n">database</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition-troubleshooting admonition">
<p class="admonition-title">Troubleshooting</p>
<p>If you get an exception later on stating that a table cannot be found, check
that you did execute the <code class="docutils literal notranslate"><span class="pre">initdb</span></code> command and that your table names are
correct (singular vs. plural, for example).</p>
</div>
<p>Continue with <a class="reference internal" href="index.html#tutorial-views"><span class="std std-ref">Step 6: The View Functions</span></a></p>
</div>
<span id="document-tutorial/views"></span><div class="section" id="step-6-the-view-functions">
<span id="tutorial-views"></span><h4>Step 6: The View Functions<a class="headerlink" href="#step-6-the-view-functions" title="Permalink to this headline">¶</a></h4>
<p>Now that the database connections are working, you can start writing the
view functions.  You will need four of them:</p>
<div class="section" id="show-entries">
<h5>Show Entries<a class="headerlink" href="#show-entries" title="Permalink to this headline">¶</a></h5>
<p>This view shows all the entries stored in the database.  It listens on the
root of the application and will select title and text from the database.
The one with the highest id (the newest entry) will be on top.  The rows
returned from the cursor look a bit like dictionaries because we are using
the <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Row" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Row</span></code></a> row factory.</p>
<p>The view function will pass the entries to the <code class="file docutils literal notranslate"><span class="pre">show_entries.html</span></code>
template and return the rendered one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_entries</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select title, text from entries order by id desc&#39;</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;show_entries.html&#39;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-new-entry">
<h5>Add New Entry<a class="headerlink" href="#add-new-entry" title="Permalink to this headline">¶</a></h5>
<p>This view lets the user add new entries if they are logged in.  This only
responds to <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests; the actual form is shown on the
<cite>show_entries</cite> page.  If everything worked out well, it will
<a class="reference internal" href="index.html#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a> an information message to the next request and
redirect back to the <cite>show_entries</cite> page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/add&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_entry</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logged_in&#39;</span><span class="p">):</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;insert into entries (title, text) values (?, ?)&#39;</span><span class="p">,</span>
                 <span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]])</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;New entry was successfully posted&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;show_entries&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this view checks that the user is logged in (that is, if the
<cite>logged_in</cite> key is present in the session and <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
<div class="admonition-security-note admonition">
<p class="admonition-title">Security Note</p>
<p>Be sure to use question marks when building SQL statements, as done in the
example above.  Otherwise, your app will be vulnerable to SQL injection when
you use string formatting to build SQL statements.
See <a class="reference internal" href="index.html#sqlite3"><span class="std std-ref">Using SQLite 3 with Flask</span></a> for more.</p>
</div>
</div>
<div class="section" id="login-and-logout">
<h5>Login and Logout<a class="headerlink" href="#login-and-logout" title="Permalink to this headline">¶</a></h5>
<p>These functions are used to sign the user in and out.  Login checks the
username and password against the ones from the configuration and sets the
<cite>logged_in</cite> key for the session.  If the user logged in successfully, that
key is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and the user is redirected back to the <cite>show_entries</cite>
page.  In addition, a message is flashed that informs the user that he or
she was logged in successfully.  If an error occurred, the template is
notified about that, and the user is asked again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">]:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid username&#39;</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PASSWORD&#39;</span><span class="p">]:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid password&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;logged_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You were logged in&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;show_entries&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>logout</cite> function, on the other hand, removes that key from the session
again.  There is a neat trick here: if you use the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.pop" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a> method
of the dict and pass a second parameter to it (the default), the method
will delete the key from the dictionary if present or do nothing when that
key is not in there.  This is helpful because now it is not necessary to
check if the user was logged in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;logged_in&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You were logged out&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;show_entries&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition-security-note admonition">
<p class="admonition-title">Security Note</p>
<p>Passwords should never be stored in plain text in a production
system. This tutorial uses plain text passwords for simplicity. If you
plan to release a project based off this tutorial out into the world,
passwords should be both <a class="reference external" href="https://blog.codinghorror.com/youre-probably-storing-passwords-incorrectly/">hashed and salted</a> before being stored in a
database or file.</p>
<p>Fortunately, there are Flask extensions for the purpose of
hashing passwords and verifying passwords against hashes, so adding
this functionality is fairly straight forward. There are also
many general python libraries that can be used for hashing.</p>
<p>You can find a list of recommended Flask extensions
<a class="reference external" href="http://flask.pocoo.org/extensions/">here</a></p>
</div>
<p>Continue with <a class="reference internal" href="index.html#tutorial-templates"><span class="std std-ref">Step 7: The Templates</span></a>.</p>
</div>
</div>
<span id="document-tutorial/templates"></span><div class="section" id="step-7-the-templates">
<span id="tutorial-templates"></span><h4>Step 7: The Templates<a class="headerlink" href="#step-7-the-templates" title="Permalink to this headline">¶</a></h4>
<p>Now it is time to start working on the templates.  As you may have
noticed, if you make requests with the app running, you will get
an exception that Flask cannot find the templates.  The templates
are using <a class="reference external" href="http://jinja.pocoo.org/docs/templates">Jinja2</a> syntax and have autoescaping enabled by
default.  This means that unless you mark a value in the code with
<a class="reference internal" href="index.html#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a> or with the <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter in the template,
Jinja2 will ensure that special characters such as <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are
escaped with their XML equivalents.</p>
<p>We are also using template inheritance which makes it possible to reuse
the layout of the website in all pages.</p>
<p>Put the following templates into the <code class="file docutils literal notranslate"><span class="pre">templates</span></code> folder:</p>
<div class="section" id="layout-html">
<h5>layout.html<a class="headerlink" href="#layout-html" title="Permalink to this headline">¶</a></h5>
<p>This template contains the HTML skeleton, the header and a link to log in
(or log out if the user was already logged in).  It also displays the
flashed messages if there are any.  The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">body</span> <span class="pre">%}</span></code> block can be
replaced by a block of the same name (<code class="docutils literal notranslate"><span class="pre">body</span></code>) in a child template.</p>
<p>The <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a> dict is available in the template as well and
you can use that to check if the user is logged in or not.  Note that in
Jinja you can access missing attributes and items of objects / dicts which
makes the following code work, even if there is no <code class="docutils literal notranslate"><span class="pre">'logged_in'</span></code> key in
the session:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Flaskr<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">stylesheet</span> <span class="na">type</span><span class="o">=</span><span class="s">text/css</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;static&#39;</span><span class="o">,</span> <span class="nv">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">page</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Flaskr<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">metanav</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nv">session.logged_in</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;login&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>log in<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;logout&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>log out<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">get_flashed_messages</span><span class="o">()</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">flash</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="show-entries-html">
<h5>show_entries.html<a class="headerlink" href="#show-entries-html" title="Permalink to this headline">¶</a></h5>
<p>This template extends the <code class="file docutils literal notranslate"><span class="pre">layout.html</span></code> template from above to display the
messages.  Note that the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop iterates over the messages we passed
in with the <a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code></a> function.  Notice that the form is
configured to to submit to the <cite>add_entry</cite> view function and use <code class="docutils literal notranslate"><span class="pre">POST</span></code> as
HTTP method:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">session.logged_in</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;add_entry&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span> <span class="na">class</span><span class="o">=</span><span class="s">add-entry</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Title:
        <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">size</span><span class="o">=</span><span class="s">30</span> <span class="na">name</span><span class="o">=</span><span class="s">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Text:
        <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">text</span> <span class="na">rows</span><span class="o">=</span><span class="s">5</span> <span class="na">cols</span><span class="o">=</span><span class="s">40</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Share</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">entries</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">entry</span> <span class="k">in</span> <span class="nv">entries</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">entry.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">entry.text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>Unbelievable.  No entries here so far<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="login-html">
<h5>login.html<a class="headerlink" href="#login-html" title="Permalink to this headline">¶</a></h5>
<p>This is the login template, which basically just displays a form to allow
the user to login:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">error</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">error</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Error:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> <span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;login&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Username:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">name</span><span class="o">=</span><span class="s">username</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Password:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">password</span> <span class="na">name</span><span class="o">=</span><span class="s">password</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Login</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Continue with <a class="reference internal" href="index.html#tutorial-css"><span class="std std-ref">Step 8: Adding Style</span></a>.</p>
</div>
</div>
<span id="document-tutorial/css"></span><div class="section" id="step-8-adding-style">
<span id="tutorial-css"></span><h4>Step 8: Adding Style<a class="headerlink" href="#step-8-adding-style" title="Permalink to this headline">¶</a></h4>
<p>Now that everything else works, it’s time to add some style to the
application.  Just create a stylesheet called <code class="file docutils literal notranslate"><span class="pre">style.css</span></code> in the
<code class="file docutils literal notranslate"><span class="pre">static</span></code> folder:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">body</span>            <span class="p">{</span> <span class="k">font-family</span><span class="p">:</span> <span class="kc">sans-serif</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">a</span><span class="o">,</span> <span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span>       <span class="p">{</span> <span class="k">color</span><span class="p">:</span> <span class="mh">#377ba8</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span>          <span class="p">{</span> <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Georgia&#39;</span><span class="p">,</span> <span class="kc">serif</span><span class="p">;</span> <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">h1</span>              <span class="p">{</span> <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#eee</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">h2</span>              <span class="p">{</span> <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>

<span class="p">.</span><span class="nc">page</span>           <span class="p">{</span> <span class="k">margin</span><span class="p">:</span> <span class="mi">2</span><span class="kt">em</span> <span class="kc">auto</span><span class="p">;</span> <span class="k">width</span><span class="p">:</span> <span class="mi">35</span><span class="kt">em</span><span class="p">;</span> <span class="k">border</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span>
                  <span class="k">padding</span><span class="p">:</span> <span class="mf">0.8</span><span class="kt">em</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">entries</span>        <span class="p">{</span> <span class="k">list-style</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span> <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">entries</span> <span class="nt">li</span>     <span class="p">{</span> <span class="k">margin</span><span class="p">:</span> <span class="mf">0.8</span><span class="kt">em</span> <span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">entries</span> <span class="nt">li</span> <span class="nt">h2</span>  <span class="p">{</span> <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-1</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">add-entry</span>      <span class="p">{</span> <span class="k">font-size</span><span class="p">:</span> <span class="mf">0.9</span><span class="kt">em</span><span class="p">;</span> <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">add-entry</span> <span class="nt">dl</span>   <span class="p">{</span> <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">metanav</span>        <span class="p">{</span> <span class="k">text-align</span><span class="p">:</span> <span class="kc">right</span><span class="p">;</span> <span class="k">font-size</span><span class="p">:</span> <span class="mf">0.8</span><span class="kt">em</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">0.3</span><span class="kt">em</span><span class="p">;</span>
                  <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#fafafa</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">flash</span>          <span class="p">{</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#cee5F5</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span>
                  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#aacbe2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">error</span>          <span class="p">{</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#f0d6d6</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Continue with <a class="reference internal" href="index.html#tutorial-testing"><span class="std std-ref">Bonus: Testing the Application</span></a>.</p>
</div>
<span id="document-tutorial/testing"></span><div class="section" id="bonus-testing-the-application">
<span id="tutorial-testing"></span><h4>Bonus: Testing the Application<a class="headerlink" href="#bonus-testing-the-application" title="Permalink to this headline">¶</a></h4>
<p>Now that you have finished the application and everything works as
expected, it’s probably not a bad idea to add automated tests to simplify
modifications in the future.  The application above is used as a basic
example of how to perform unit testing in the <a class="reference internal" href="index.html#testing"><span class="std std-ref">Testing Flask Applications</span></a> section of the
documentation.  Go there to see how easy it is to test Flask applications.</p>
<div class="section" id="adding-tests-to-flaskr">
<h5>Adding tests to flaskr<a class="headerlink" href="#adding-tests-to-flaskr" title="Permalink to this headline">¶</a></h5>
<p>Assuming you have seen the <a class="reference internal" href="index.html#testing"><span class="std std-ref">Testing Flask Applications</span></a> section and have either written
your own tests for <code class="docutils literal notranslate"><span class="pre">flaskr</span></code> or have followed along with the examples
provided, you might be wondering about ways to organize the project.</p>
<p>One possible and recommended project structure is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flaskr</span><span class="o">/</span>
    <span class="n">flaskr</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">static</span><span class="o">/</span>
        <span class="n">templates</span><span class="o">/</span>
    <span class="n">tests</span><span class="o">/</span>
        <span class="n">test_flaskr</span><span class="o">.</span><span class="n">py</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
    <span class="n">MANIFEST</span><span class="o">.</span><span class="ow">in</span>
</pre></div>
</div>
<p>For now go ahead a create the <code class="file docutils literal notranslate"><span class="pre">tests/</span></code> directory as well as the
<code class="file docutils literal notranslate"><span class="pre">test_flaskr.py</span></code> file.</p>
</div>
<div class="section" id="running-the-tests">
<h5>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this headline">¶</a></h5>
<p>At this point you can run the tests. Here <code class="docutils literal notranslate"><span class="pre">pytest</span></code> will be used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that <code class="docutils literal notranslate"><span class="pre">pytest</span></code> is installed in the same virtualenv
as flaskr. Otherwise <code class="docutils literal notranslate"><span class="pre">pytest</span></code> test will not be able to import the
required components to test the application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">pytest</span>
</pre></div>
</div>
</div>
<p>Run and watch the tests pass, within the top-level <code class="file docutils literal notranslate"><span class="pre">flaskr/</span></code>
directory as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">py</span><span class="o">.</span><span class="n">test</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-setuptools">
<h5>Testing + setuptools<a class="headerlink" href="#testing-setuptools" title="Permalink to this headline">¶</a></h5>
<p>One way to handle testing is to integrate it with <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>. Here
that requires adding a couple of lines to the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file and
creating a new file <code class="file docutils literal notranslate"><span class="pre">setup.cfg</span></code>. One benefit of running the tests
this way is that you do not have to install <code class="docutils literal notranslate"><span class="pre">pytest</span></code>. Go ahead and
update the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file to contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;flaskr&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flaskr&#39;</span><span class="p">],</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;flask&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">setup_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;pytest-runner&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;pytest&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now create <code class="file docutils literal notranslate"><span class="pre">setup.cfg</span></code> in the project root (alongside
<code class="file docutils literal notranslate"><span class="pre">setup.py</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">aliases</span><span class="p">]</span>
<span class="n">test</span><span class="o">=</span><span class="n">pytest</span>
</pre></div>
</div>
<p>Now you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span>
</pre></div>
</div>
<p>This calls on the alias created in <code class="file docutils literal notranslate"><span class="pre">setup.cfg</span></code> which in turn runs
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> via <code class="docutils literal notranslate"><span class="pre">pytest-runner</span></code>, as the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> script has
been called. (Recall the <cite>setup_requires</cite> argument in <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code>)
Following the standard rules of test-discovery your tests will be
found, run, and hopefully pass.</p>
<p>This is one possible way to run and manage testing.  Here <code class="docutils literal notranslate"><span class="pre">pytest</span></code> is
used, but there are other options such as <code class="docutils literal notranslate"><span class="pre">nose</span></code>.  Integrating testing
with <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> is convenient because it is not necessary to actually
download <code class="docutils literal notranslate"><span class="pre">pytest</span></code> or any other testing framework one might use.</p>
</div>
</div>
</div>
</div>
<span id="document-templating"></span><div class="section" id="templates">
<h3>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h3>
<p>Flask leverages Jinja2 as template engine.  You are obviously free to use
a different template engine, but you still have to install Jinja2 to run
Flask itself.  This requirement is necessary to enable rich extensions.
An extension can depend on Jinja2 being present.</p>
<p>This section only gives a very quick introduction into how Jinja2
is integrated into Flask.  If you want information on the template
engine’s syntax itself, head over to the official <a class="reference external" href="http://jinja.pocoo.org/docs/templates">Jinja2 Template
Documentation</a> for
more information.</p>
<div class="section" id="jinja-setup">
<h4>Jinja Setup<a class="headerlink" href="#jinja-setup" title="Permalink to this headline">¶</a></h4>
<p>Unless customized, Jinja2 is configured by Flask as follows:</p>
<ul class="simple">
<li><p>autoescaping is enabled for all templates ending in <code class="docutils literal notranslate"><span class="pre">.html</span></code>,
<code class="docutils literal notranslate"><span class="pre">.htm</span></code>, <code class="docutils literal notranslate"><span class="pre">.xml</span></code> as well as <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code> when using
<code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code>.</p></li>
<li><p>autoescaping is enabled for all strings when using
<code class="xref py py-func docutils literal notranslate"><span class="pre">render_template_string()</span></code>.</p></li>
<li><p>a template has the ability to opt in/out autoescaping with the
<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">%}</span></code> tag.</p></li>
<li><p>Flask inserts a couple of global functions and helpers into the
Jinja2 context, additionally to the values that are present by
default.</p></li>
</ul>
</div>
<div class="section" id="standard-context">
<h4>Standard Context<a class="headerlink" href="#standard-context" title="Permalink to this headline">¶</a></h4>
<p>The following global variables are available within Jinja2 templates
by default:</p>
<dl class="data">
<dt>
<code class="sig-name descname">config</code></dt>
<dd><p>The current configuration object (<code class="xref py py-data docutils literal notranslate"><span class="pre">flask.config</span></code>)</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.10: </span>This is now always available, even in imported templates.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details></dd></dl>

<dl class="data">
<dt>
<code class="sig-name descname">request</code></dt>
<dd><p>The current request object (<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.request</span></code></a>).  This variable is
unavailable if the template was rendered without an active request
context.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="sig-name descname">session</code></dt>
<dd><p>The current session object (<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.session</span></code></a>).  This variable
is unavailable if the template was rendered without an active request
context.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="sig-name descname">g</code></dt>
<dd><p>The request-bound object for global variables (<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a>).  This
variable is unavailable if the template was rendered without an active
request context.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>The <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.url_for()</span></code></a> function.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-name descname">get_flashed_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>The <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.get_flashed_messages()</span></code></a> function.</p>
</dd></dl>

<div class="admonition-the-jinja-context-behavior admonition">
<p class="admonition-title">The Jinja Context Behavior</p>
<p>These variables are added to the context of variables, they are not
global variables.  The difference is that by default these will not
show up in the context of imported templates.  This is partially caused
by performance considerations, partially to keep things explicit.</p>
<p>What does this mean for you?  If you have a macro you want to import,
that needs to access the request object you have two possibilities:</p>
<ol class="arabic simple">
<li><p>you explicitly pass the request to the macro as parameter, or
the attribute of the request object you are interested in.</p></li>
<li><p>you import the macro “with context”.</p></li>
</ol>
<p>Importing with context looks like this:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">from</span> <span class="s1">&#39;_helpers.html&#39;</span> <span class="k">import</span> <span class="nv">my_macro</span> <span class="k">with context</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="standard-filters">
<h4>Standard Filters<a class="headerlink" href="#standard-filters" title="Permalink to this headline">¶</a></h4>
<p>These filters are available in Jinja2 additionally to the filters provided
by Jinja2 itself:</p>
<dl class="function">
<dt>
<code class="sig-name descname">tojson</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>This function converts the given object into JSON representation.  This
is for example very helpful if you try to generate JavaScript on the
fly.</p>
<p>Note that inside <code class="docutils literal notranslate"><span class="pre">script</span></code> tags no escaping must take place, so make
sure to disable escaping with <code class="docutils literal notranslate"><span class="pre">|safe</span></code> before Flask 0.10 if you intend
to use it inside <code class="docutils literal notranslate"><span class="pre">script</span></code> tags:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span><span class="p">&gt;</span>
    <span class="nx">doSomethingWith</span><span class="p">(</span><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">tojson</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="controlling-autoescaping">
<h4>Controlling Autoescaping<a class="headerlink" href="#controlling-autoescaping" title="Permalink to this headline">¶</a></h4>
<p>Autoescaping is the concept of automatically escaping special characters
for you.  Special characters in the sense of HTML (or XML, and thus XHTML)
are <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> as well as <code class="docutils literal notranslate"><span class="pre">'</span></code>.  Because these characters
carry specific meanings in documents on their own you have to replace them
by so called “entities” if you want to use them for text.  Not doing so
would not only cause user frustration by the inability to use these
characters in text, but can also lead to security problems.  (see
<a class="reference internal" href="index.html#xss"><span class="std std-ref">Cross-Site Scripting (XSS)</span></a>)</p>
<p>Sometimes however you will need to disable autoescaping in templates.
This can be the case if you want to explicitly inject HTML into pages, for
example if they come from a system that generates secure HTML like a
markdown to HTML converter.</p>
<p>There are three ways to accomplish that:</p>
<ul class="simple">
<li><p>In the Python code, wrap the HTML string in a <a class="reference internal" href="index.html#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a>
object before passing it to the template.  This is in general the
recommended way.</p></li>
<li><p>Inside the template, use the <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter to explicitly mark a
string as safe HTML (<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">myvariable|safe</span> <span class="pre">}}</span></code>)</p></li>
<li><p>Temporarily disable the autoescape system altogether.</p></li>
</ul>
<p>To disable the autoescape system in templates, you can use the <code class="docutils literal notranslate"><span class="pre">{%</span>
<span class="pre">autoescape</span> <span class="pre">%}</span></code> block:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">autoescape</span> <span class="kp">false</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>autoescaping is disabled here
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">will_not_be_escaped</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Whenever you do this, please be very cautious about the variables you are
using in this block.</p>
</div>
<div class="section" id="registering-filters">
<span id="id1"></span><h4>Registering Filters<a class="headerlink" href="#registering-filters" title="Permalink to this headline">¶</a></h4>
<p>If you want to register your own filters in Jinja2 you have two ways to do
that.  You can either put them by hand into the
<a class="reference internal" href="index.html#flask.Flask.jinja_env" title="flask.Flask.jinja_env"><code class="xref py py-attr docutils literal notranslate"><span class="pre">jinja_env</span></code></a> of the application or use the
<a class="reference internal" href="index.html#flask.Flask.template_filter" title="flask.Flask.template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_filter()</span></code></a> decorator.</p>
<p>The two following examples work the same and both reverse an object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_filter</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">reverse_filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">reverse_filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">app</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s1">&#39;reverse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reverse_filter</span>
</pre></div>
</div>
<p>In case of the decorator the argument is optional if you want to use the
function name as name of the filter.  Once registered, you can use the filter
in your templates in the same way as Jinja2’s builtin filters, for example if
you have a Python list in context called <cite>mylist</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mylist</span> <span class="o">|</span> <span class="n">reverse</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="context-processors">
<h4>Context Processors<a class="headerlink" href="#context-processors" title="Permalink to this headline">¶</a></h4>
<p>To inject new variables automatically into the context of a template,
context processors exist in Flask.  Context processors run before the
template is rendered and have the ability to inject new values into the
template context.  A context processor is a function that returns a
dictionary.  The keys and values of this dictionary are then merged with
the template context, for all templates in the app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">context_processor</span>
<span class="k">def</span> <span class="nf">inject_user</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p>The context processor above makes a variable called <cite>user</cite> available in
the template with the value of <cite>g.user</cite>.  This example is not very
interesting because <cite>g</cite> is available in templates anyways, but it gives an
idea how this works.</p>
<p>Variables are not limited to values; a context processor can also make
functions available to templates (since Python allows passing around
functions):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">context_processor</span>
<span class="k">def</span> <span class="nf">utility_processor</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">format_price</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;€&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="si">{0:.2f}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">format_price</span><span class="o">=</span><span class="n">format_price</span><span class="p">)</span>
</pre></div>
</div>
<p>The context processor above makes the <cite>format_price</cite> function available to all
templates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">format_price</span><span class="p">(</span><span class="mf">0.33</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>You could also build <cite>format_price</cite> as a template filter (see
<a class="reference internal" href="#registering-filters"><span class="std std-ref">Registering Filters</span></a>), but this demonstrates how to pass functions in a
context processor.</p>
</div>
</div>
<span id="document-testing"></span><div class="section" id="testing-flask-applications">
<span id="testing"></span><h3>Testing Flask Applications<a class="headerlink" href="#testing-flask-applications" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>Something that is untested is broken.</strong></p>
</div></blockquote>
<p>The origin of this quote is unknown and while it is not entirely correct, it is also
not far from the truth.  Untested applications make it hard to
improve existing code and developers of untested applications tend to
become pretty paranoid.  If an application has automated tests, you can
safely make changes and instantly know if anything breaks.</p>
<p>Flask provides a way to test your application by exposing the Werkzeug
test <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/test/#werkzeug.test.Client" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> and handling the context locals for you.
You can then use that with your favourite testing solution.  In this documentation
we will use the <a class="reference external" href="https://docs.python.org/3/library/unittest.html#module-unittest" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> package that comes pre-installed with Python.</p>
<div class="section" id="the-application">
<h4>The Application<a class="headerlink" href="#the-application" title="Permalink to this headline">¶</a></h4>
<p>First, we need an application to test; we will use the application from
the <a class="reference internal" href="index.html#tutorial"><span class="std std-ref">Tutorial</span></a>.  If you don’t have that application yet, get the
sources from <a class="reference external" href="https://github.com/pallets/flask/tree/master/examples/flaskr">the examples</a>.</p>
</div>
<div class="section" id="the-testing-skeleton">
<h4>The Testing Skeleton<a class="headerlink" href="#the-testing-skeleton" title="Permalink to this headline">¶</a></h4>
<p>In order to test the application, we add a second module
(<code class="file docutils literal notranslate"><span class="pre">flaskr_tests.py</span></code>) and create a unittest skeleton there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">flaskr</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="k">class</span> <span class="nc">FlaskrTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">,</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">testing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
            <span class="n">flaskr</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The code in the <a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.setUp" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setUp()</span></code></a> method creates a new test
client and initializes a new database.  This function is called before
each individual test function is run.  To delete the database after the
test, we close the file and remove it from the filesystem in the
<a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.tearDown" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tearDown()</span></code></a> method.  Additionally during setup the
<code class="docutils literal notranslate"><span class="pre">TESTING</span></code> config flag is activated.  What it does is disable the error
catching during request handling so that you get better error reports when
performing test requests against the application.</p>
<p>This test client will give us a simple interface to the application.  We can
trigger test requests to the application, and the client will also keep track
of cookies for us.</p>
<p>Because SQLite3 is filesystem-based we can easily use the tempfile module
to create a temporary database and initialize it.  The
<a class="reference external" href="https://docs.python.org/3/library/tempfile.html#tempfile.mkstemp" title="(in Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mkstemp()</span></code></a> function does two things for us: it returns a
low-level file handle and a random file name, the latter we use as
database name.  We just have to keep the <cite>db_fd</cite> around so that we can use
the <a class="reference external" href="https://docs.python.org/3/library/os.html#os.close" title="(in Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.close()</span></code></a> function to close the file.</p>
<p>If we now run the test suite, we should see the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flaskr_tests.py

----------------------------------------------------------------------
Ran 0 tests in 0.000s

OK
</pre></div>
</div>
<p>Even though it did not run any actual tests, we already know that our flaskr
application is syntactically valid, otherwise the import would have died
with an exception.</p>
</div>
<div class="section" id="the-first-test">
<h4>The First Test<a class="headerlink" href="#the-first-test" title="Permalink to this headline">¶</a></h4>
<p>Now it’s time to start testing the functionality of the application.
Let’s check that the application shows “No entries here so far” if we
access the root of the application (<code class="docutils literal notranslate"><span class="pre">/</span></code>). To do this, we add a new
test method to our class, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlaskrTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">,</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">testing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
            <span class="n">flaskr</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_empty_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;No entries here so far&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Notice that our test functions begin with the word <cite>test</cite>; this allows
<a class="reference external" href="https://docs.python.org/3/library/unittest.html#module-unittest" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> to automatically identify the method as a test to run.</p>
<p>By using <cite>self.app.get</cite> we can send an HTTP <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to the application with
the given path.  The return value will be a <a class="reference internal" href="index.html#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-class docutils literal notranslate"><span class="pre">response_class</span></code></a> object.
We can now use the <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/wrappers/#werkzeug.wrappers.BaseResponse.data" title="(in Werkzeug v1.0.x)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a> attribute to inspect
the return value (as string) from the application.  In this case, we ensure that
<code class="docutils literal notranslate"><span class="pre">'No</span> <span class="pre">entries</span> <span class="pre">here</span> <span class="pre">so</span> <span class="pre">far'</span></code> is part of the output.</p>
<p>Run it again and you should see one passing test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flaskr_tests.py
.
----------------------------------------------------------------------
Ran 1 test in 0.034s

OK
</pre></div>
</div>
</div>
<div class="section" id="logging-in-and-out">
<h4>Logging In and Out<a class="headerlink" href="#logging-in-and-out" title="Permalink to this headline">¶</a></h4>
<p>The majority of the functionality of our application is only available for
the administrative user, so we need a way to log our test client in and out
of the application.  To do this, we fire some requests to the login and logout
pages with the required form data (username and password).  And because the
login and logout pages redirect, we tell the client to <cite>follow_redirects</cite>.</p>
<p>Add the following two methods to your <cite>FlaskrTestCase</cite> class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">password</span>
    <span class="p">),</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can easily test that logging in and out works and that it fails with
invalid credentials.  Add this new test to the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_login_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;You were logged in&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;You were logged out&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;adminx&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;Invalid username&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;defaultx&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;Invalid password&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="section" id="test-adding-messages">
<h4>Test Adding Messages<a class="headerlink" href="#test-adding-messages" title="Permalink to this headline">¶</a></h4>
<p>We should also test that adding messages works.  Add a new test method
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/add&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;Hello&gt;&#39;</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;strong&gt;HTML&lt;/strong&gt; allowed here&#39;</span>
    <span class="p">),</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;No entries here so far&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;&amp;lt;Hello&amp;gt;&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;&lt;strong&gt;HTML&lt;/strong&gt; allowed here&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Here we check that HTML is allowed in the text but not in the title,
which is the intended behavior.</p>
<p>Running that should now give us three passing tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flaskr_tests.py
...
----------------------------------------------------------------------
Ran 3 tests in 0.332s

OK
</pre></div>
</div>
<p>For more complex tests with headers and status codes, check out the
<a class="reference external" href="https://github.com/pallets/flask/tree/0.12.3/examples/minitwit/">MiniTwit Example</a> from the sources which contains a larger test
suite.</p>
</div>
<div class="section" id="other-testing-tricks">
<h4>Other Testing Tricks<a class="headerlink" href="#other-testing-tricks" title="Permalink to this headline">¶</a></h4>
<p>Besides using the test client as shown above, there is also the
<a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a> method that can be used
in combination with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement to activate a request context
temporarily.  With this you can access the <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>,
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> and <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a> objects like in view
functions.  Here is a full example that demonstrates this approach:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Peter&#39;</span>
</pre></div>
</div>
<p>All the other objects that are context bound can be used in the same
way.</p>
<p>If you want to test your application with different configurations and
there does not seem to be a good way to do that, consider switching to
application factories (see <a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a>).</p>
<p>Note however that if you are using a test request context, the
<a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> and <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>
functions are not called automatically.  However
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> functions are indeed executed when
the test request context leaves the <code class="docutils literal notranslate"><span class="pre">with</span></code> block.  If you do want the
<a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> functions to be called as well, you
need to call <a class="reference internal" href="index.html#flask.Flask.preprocess_request" title="flask.Flask.preprocess_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">preprocess_request()</span></code></a> yourself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">preprocess_request</span><span class="p">()</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This can be necessary to open database connections or something similar
depending on how your application was designed.</p>
<p>If you want to call the <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> functions you
need to call into <a class="reference internal" href="index.html#flask.Flask.process_response" title="flask.Flask.process_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_response()</span></code></a> which however
requires that you pass it a response object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This in general is less useful because at that point you can directly
start using the test client.</p>
</div>
<div class="section" id="faking-resources-and-context">
<span id="faking-resources"></span><h4>Faking Resources and Context<a class="headerlink" href="#faking-resources-and-context" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><p>A very common pattern is to store user authorization information and
database connections on the application context or the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.g</span></code></a>
object.  The general pattern for this is to put the object on there on
first usage and then to remove it on a teardown.  Imagine for instance
this code to get the current user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_user</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">fetch_current_user_from_database</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<p>For a test it would be nice to override this user from the outside without
having to change some code.  This can be accomplished with
hooking the <a class="reference internal" href="index.html#flask.appcontext_pushed" title="flask.appcontext_pushed"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.appcontext_pushed</span></code></a> signal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">appcontext_pushed</span><span class="p">,</span> <span class="n">g</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">with</span> <span class="n">appcontext_pushed</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">yield</span>
</pre></div>
</div>
<p>And then to use it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">users_me</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

<span class="k">with</span> <span class="n">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">my_user</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">my_user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="keeping-the-context-around">
<h4>Keeping the Context Around<a class="headerlink" href="#keeping-the-context-around" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.</span></p>
</div>
</details><p>Sometimes it is helpful to trigger a regular request but still keep the
context around for a little longer so that additional introspection can
happen.  With Flask 0.4 this is possible by using the
<a class="reference internal" href="index.html#flask.Flask.test_client" title="flask.Flask.test_client"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_client()</span></code></a> with a <code class="docutils literal notranslate"><span class="pre">with</span></code> block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/?tequila=42&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tequila&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;42&#39;</span>
</pre></div>
</div>
<p>If you were to use just the <a class="reference internal" href="index.html#flask.Flask.test_client" title="flask.Flask.test_client"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_client()</span></code></a> without
the <code class="docutils literal notranslate"><span class="pre">with</span></code> block, the <code class="docutils literal notranslate"><span class="pre">assert</span></code> would fail with an error because <cite>request</cite>
is no longer available (because you are trying to use it outside of the actual request).</p>
</div>
<div class="section" id="accessing-and-modifying-sessions">
<h4>Accessing and Modifying Sessions<a class="headerlink" href="#accessing-and-modifying-sessions" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details><p>Sometimes it can be very helpful to access or modify the sessions from the
test client.  Generally there are two ways for this.  If you just want to
ensure that a session has certain keys set to certain values you can just
keep the context around and access <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.session</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
<p>This however does not make it possible to also modify the session or to
access the session before a request was fired.  Starting with Flask 0.8 we
provide a so called “session transaction” which simulates the appropriate
calls to open a session in the context of the test client and to modify
it.  At the end of the transaction the session is stored.  This works
independently of the session backend used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">c</span><span class="o">.</span><span class="n">session_transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        <span class="n">sess</span><span class="p">[</span><span class="s1">&#39;a_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;a value&#39;</span>

    <span class="c1"># once this is reached the session was stored</span>
</pre></div>
</div>
<p>Note that in this case you have to use the <code class="docutils literal notranslate"><span class="pre">sess</span></code> object instead of the
<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.session</span></code></a> proxy.  The object however itself will provide the
same interface.</p>
</div>
</div>
<span id="document-errorhandling"></span><div class="section" id="application-errors">
<span id="id1"></span><h3>Application Errors<a class="headerlink" href="#application-errors" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details><p>Applications fail, servers fail.  Sooner or later you will see an exception
in production.  Even if your code is 100% correct, you will still see
exceptions from time to time.  Why?  Because everything else involved will
fail.  Here are some situations where perfectly fine code can lead to server
errors:</p>
<ul class="simple">
<li><p>the client terminated the request early and the application was still
reading from the incoming data</p></li>
<li><p>the database server was overloaded and could not handle the query</p></li>
<li><p>a filesystem is full</p></li>
<li><p>a harddrive crashed</p></li>
<li><p>a backend server overloaded</p></li>
<li><p>a programming error in a library you are using</p></li>
<li><p>network connection of the server to another system failed</p></li>
</ul>
<p>And that’s just a small sample of issues you could be facing.  So how do we
deal with that sort of problem?  By default if your application runs in
production mode, Flask will display a very simple page for you and log the
exception to the <a class="reference internal" href="index.html#flask.Flask.logger" title="flask.Flask.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">logger</span></code></a>.</p>
<p>But there is more you can do, and we will cover some better setups to deal
with errors.</p>
<div class="section" id="error-logging-tools">
<h4>Error Logging Tools<a class="headerlink" href="#error-logging-tools" title="Permalink to this headline">¶</a></h4>
<p>Sending error mails, even if just for critical ones, can become
overwhelming if enough users are hitting the error and log files are
typically never looked at. This is why we recommend using <a class="reference external" href="http://www.getsentry.com/">Sentry</a> for dealing with application errors.  It’s
available as an Open Source project <a class="reference external" href="https://github.com/getsentry/sentry">on GitHub</a> and is also available as a <a class="reference external" href="https://getsentry.com/signup/">hosted version</a> which you can try for free. Sentry
aggregates duplicate errors, captures the full stack trace and local
variables for debugging, and sends you mails based on new errors or
frequency thresholds.</p>
<p>To use Sentry you need to install the <cite>raven</cite> client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install raven
</pre></div>
</div>
<p>And then add this to your Flask app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">raven.contrib.flask</span> <span class="k">import</span> <span class="n">Sentry</span>
<span class="n">sentry</span> <span class="o">=</span> <span class="n">Sentry</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">dsn</span><span class="o">=</span><span class="s1">&#39;YOUR_DSN_HERE&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if you are using factories you can also init it later:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">raven.contrib.flask</span> <span class="k">import</span> <span class="n">Sentry</span>
<span class="n">sentry</span> <span class="o">=</span> <span class="n">Sentry</span><span class="p">(</span><span class="n">dsn</span><span class="o">=</span><span class="s1">&#39;YOUR_DSN_HERE&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">sentry</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>The <cite>YOUR_DSN_HERE</cite> value needs to be replaced with the DSN value you get
from your Sentry installation.</p>
<p>Afterwards failures are automatically reported to Sentry and from there
you can receive error notifications.</p>
</div>
<div class="section" id="error-handlers">
<span id="id2"></span><h4>Error handlers<a class="headerlink" href="#error-handlers" title="Permalink to this headline">¶</a></h4>
<p>You might want to show custom error pages to the user when an error occurs.
This can be done by registering error handlers.</p>
<p>Error handlers are normal <a class="reference internal" href="index.html#views"><span class="std std-ref">Pluggable Views</span></a> but instead of being registered for
routes, they are registered for exceptions that are raised while trying to
do something else.</p>
<div class="section" id="registering">
<h5>Registering<a class="headerlink" href="#registering" title="Permalink to this headline">¶</a></h5>
<p>Register error handlers using <a class="reference internal" href="index.html#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> or
<a class="reference internal" href="index.html#flask.Flask.register_error_handler" title="flask.Flask.register_error_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">werkzeug</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BadRequest</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_bad_request</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;bad request!&#39;</span>

<span class="n">app</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="s1">&#39;bad request!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Those two ways are equivalent, but the first one is more clear and leaves
you with a function to call on your whim (and in tests).  Note that
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.HTTPException" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">werkzeug.exceptions.HTTPException</span></code></a> subclasses like
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.BadRequest" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BadRequest</span></code></a> from the example and their HTTP codes
are interchangeable when handed to the registration methods or decorator
(<code class="docutils literal notranslate"><span class="pre">BadRequest.code</span> <span class="pre">==</span> <span class="pre">400</span></code>).</p>
<p>You are however not limited to <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.HTTPException" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a>
or HTTP status codes but can register a handler for every exception class you
like.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11: </span>Errorhandlers are now prioritized by specificity of the exception classes
they are registered for instead of the order they are registered in.</p>
</div>
</details></div>
<div class="section" id="handling">
<h5>Handling<a class="headerlink" href="#handling" title="Permalink to this headline">¶</a></h5>
<p>Once an exception instance is raised, its class hierarchy is traversed,
and searched for in the exception classes for which handlers are registered.
The most specific handler is selected.</p>
<p>E.g. if an instance of <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionRefusedError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionRefusedError</span></code></a> is raised, and a handler
is registered for <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionError</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionRefusedError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionRefusedError</span></code></a>,
the more specific <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionRefusedError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionRefusedError</span></code></a> handler is called on the
exception instance, and its response is shown to the user.</p>
</div>
</div>
<div class="section" id="error-mails">
<h4>Error Mails<a class="headerlink" href="#error-mails" title="Permalink to this headline">¶</a></h4>
<p>If the application runs in production mode (which it will do on your
server) you might not see any log messages.  The reason for that is that
Flask by default will just report to the WSGI error stream or stderr
(depending on what’s available).  Where this ends up is sometimes hard to
find.  Often it’s in your webserver’s log files.</p>
<p>I can pretty much promise you however that if you only use a logfile for
the application errors you will never look at it except for debugging an
issue when a user reported it for you.  What you probably want instead is
a mail the second the exception happened.  Then you get an alert and you
can do something about it.</p>
<p>Flask uses the Python builtin logging system, and it can actually send
you mails for errors which is probably what you want.  Here is how you can
configure the Flask logger to send you mails for exceptions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ADMINS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;yourname@example.com&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="k">import</span> <span class="n">SMTPHandler</span>
    <span class="n">mail_handler</span> <span class="o">=</span> <span class="n">SMTPHandler</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;server-error@example.com&#39;</span><span class="p">,</span>
                               <span class="n">ADMINS</span><span class="p">,</span> <span class="s1">&#39;YourApplication Failed&#39;</span><span class="p">)</span>
    <span class="n">mail_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mail_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>So what just happened?  We created a new
<a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.SMTPHandler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTPHandler</span></code></a> that will send mails with the mail
server listening on <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> to all the <cite>ADMINS</cite> from the address
<em>server-error&#64;example.com</em> with the subject “YourApplication Failed”.  If
your mail server requires credentials, these can also be provided.  For
that check out the documentation for the
<a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.SMTPHandler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTPHandler</span></code></a>.</p>
<p>We also tell the handler to only send errors and more critical messages.
Because we certainly don’t want to get a mail for warnings or other
useless logs that might happen during request handling.</p>
<p>Before you run that in production, please also look at <a class="reference internal" href="#logformat"><span class="std std-ref">Controlling the Log Format</span></a> to
put more information into that error mail.  That will save you from a lot
of frustration.</p>
</div>
<div class="section" id="logging-to-a-file">
<h4>Logging to a File<a class="headerlink" href="#logging-to-a-file" title="Permalink to this headline">¶</a></h4>
<p>Even if you get mails, you probably also want to log warnings.  It’s a
good idea to keep as much information around that might be required to
debug a problem.  By default as of Flask 0.11, errors are logged to your
webserver’s log automatically.  Warnings however are not.  Please note
that Flask itself will not issue any warnings in the core system, so it’s
your responsibility to warn in the code if something seems odd.</p>
<p>There are a couple of handlers provided by the logging system out of the
box but not all of them are useful for basic error logging.  The most
interesting are probably the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.FileHandler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileHandler</span></code></a> - logs messages to a file on the
filesystem.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.RotatingFileHandler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RotatingFileHandler</span></code></a> - logs messages to a file
on the filesystem and will rotate after a certain number of messages.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.NTEventLogHandler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NTEventLogHandler</span></code></a> - will log to the system
event log of a Windows system.  If you are deploying on a Windows box,
this is what you want to use.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.SysLogHandler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SysLogHandler</span></code></a> - sends logs to a UNIX
syslog.</p></li>
</ul>
<p>Once you picked your log handler, do like you did with the SMTP handler
above, just make sure to use a lower setting (I would recommend
<cite>WARNING</cite>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="kn">from</span> <span class="nn">themodule</span> <span class="k">import</span> <span class="n">TheHandlerYouWant</span>
    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">TheHandlerYouWant</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-the-log-format">
<span id="logformat"></span><h4>Controlling the Log Format<a class="headerlink" href="#controlling-the-log-format" title="Permalink to this headline">¶</a></h4>
<p>By default a handler will only write the message string into a file or
send you that message as mail.  A log record stores more information,
and it makes a lot of sense to configure your logger to also contain that
information so that you have a better idea of why that error happened, and
more importantly, where it did.</p>
<p>A formatter can be instantiated with a format string.  Note that
tracebacks are appended to the log entry automatically.  You don’t have to
do that in the log formatter format string.</p>
<p>Here are some example setups:</p>
<div class="section" id="email">
<h5>Email<a class="headerlink" href="#email" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">Formatter</span>
<span class="n">mail_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Message type:       </span><span class="si">%(levelname)s</span><span class="s1"></span>
<span class="s1">Location:           </span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1"></span>
<span class="s1">Module:             </span><span class="si">%(module)s</span><span class="s1"></span>
<span class="s1">Function:           </span><span class="si">%(funcName)s</span><span class="s1"></span>
<span class="s1">Time:               </span><span class="si">%(asctime)s</span><span class="s1"></span>

<span class="s1">Message:</span>

<span class="si">%(message)s</span><span class="s1"></span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="file-logging">
<h5>File logging<a class="headerlink" href="#file-logging" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">Formatter</span>
<span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">(</span>
    <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1"> &#39;</span>
    <span class="s1">&#39;[in </span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">]&#39;</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="complex-log-formatting">
<h5>Complex Log Formatting<a class="headerlink" href="#complex-log-formatting" title="Permalink to this headline">¶</a></h5>
<p>Here is a list of useful formatting variables for the format string.  Note
that this list is not complete, consult the official documentation of the
<a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> package for a full list.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%(levelname)s</span></code></p></td>
<td><p>Text logging level for the message
(<code class="docutils literal notranslate"><span class="pre">'DEBUG'</span></code>, <code class="docutils literal notranslate"><span class="pre">'INFO'</span></code>, <code class="docutils literal notranslate"><span class="pre">'WARNING'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'ERROR'</span></code>, <code class="docutils literal notranslate"><span class="pre">'CRITICAL'</span></code>).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%(pathname)s</span></code></p></td>
<td><p>Full pathname of the source file where the
logging call was issued (if available).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%(filename)s</span></code></p></td>
<td><p>Filename portion of pathname.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%(module)s</span></code></p></td>
<td><p>Module (name portion of filename).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%(funcName)s</span></code></p></td>
<td><p>Name of function containing the logging call.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%(lineno)d</span></code></p></td>
<td><p>Source line number where the logging call was
issued (if available).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%(asctime)s</span></code></p></td>
<td><p>Human-readable time when the
<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.LogRecord" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogRecord</span></code></a> was created.
By default this is of the form
<code class="docutils literal notranslate"><span class="pre">&quot;2003-07-08</span> <span class="pre">16:49:45,896&quot;</span></code> (the numbers after
the comma are millisecond portion of the time).
This can be changed by subclassing the formatter
and overriding the
<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Formatter.formatTime" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">formatTime()</span></code></a> method.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%(message)s</span></code></p></td>
<td><p>The logged message, computed as <code class="docutils literal notranslate"><span class="pre">msg</span> <span class="pre">%</span> <span class="pre">args</span></code></p></td>
</tr>
</tbody>
</table>
<p>If you want to further customize the formatting, you can subclass the
formatter.  The formatter has three interesting methods:</p>
<dl class="simple">
<dt><a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Formatter.format" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">format()</span></code></a>:</dt><dd><p>handles the actual formatting.  It is passed a
<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.LogRecord" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogRecord</span></code></a> object and has to return the formatted
string.</p>
</dd>
<dt><a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Formatter.formatTime" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">formatTime()</span></code></a>:</dt><dd><p>called for <cite>asctime</cite> formatting.  If you want a different time format
you can override this method.</p>
</dd>
<dt><a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Formatter.formatException" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">formatException()</span></code></a></dt><dd><p>called for exception formatting.  It is passed an <code class="xref py py-attr docutils literal notranslate"><span class="pre">exc_info</span></code>
tuple and has to return a string.  The default is usually fine, you
don’t have to override it.</p>
</dd>
</dl>
<p>For more information, head over to the official documentation.</p>
</div>
</div>
<div class="section" id="other-libraries">
<h4>Other Libraries<a class="headerlink" href="#other-libraries" title="Permalink to this headline">¶</a></h4>
<p>So far we only configured the logger your application created itself.
Other libraries might log themselves as well.  For example, SQLAlchemy uses
logging heavily in its core.  While there is a method to configure all
loggers at once in the <a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> package, I would not recommend using
it.  There might be a situation in which you want to have multiple
separate applications running side by side in the same Python interpreter
and then it becomes impossible to have different logging setups for those.</p>
<p>Instead, I would recommend figuring out which loggers you are interested
in, getting the loggers with the <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.getLogger" title="(in Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">getLogger()</span></code></a> function and
iterating over them to attach handlers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">getLogger</span>
<span class="n">loggers</span> <span class="o">=</span> <span class="p">[</span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sqlalchemy&#39;</span><span class="p">),</span>
           <span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;otherlibrary&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">loggers</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mail_handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="debugging-application-errors">
<h3>Debugging Application Errors<a class="headerlink" href="#debugging-application-errors" title="Permalink to this headline">¶</a></h3>
<p>For production applications, configure your application with logging and
notifications as described in <a class="reference internal" href="#application-errors"><span class="std std-ref">Application Errors</span></a>.  This section provides
pointers when debugging deployment configuration and digging deeper with a
full-featured Python debugger.</p>
<div class="section" id="when-in-doubt-run-manually">
<h4>When in Doubt, Run Manually<a class="headerlink" href="#when-in-doubt-run-manually" title="Permalink to this headline">¶</a></h4>
<p>Having problems getting your application configured for production?  If you
have shell access to your host, verify that you can run your application
manually from the shell in the deployment environment.  Be sure to run under
the same user account as the configured deployment to troubleshoot permission
issues.  You can use Flask’s builtin development server with <cite>debug=True</cite> on
your production host, which is helpful in catching configuration issues, but
<strong>be sure to do this temporarily in a controlled environment.</strong> Do not run in
production with <cite>debug=True</cite>.</p>
</div>
<div class="section" id="working-with-debuggers">
<span id="id3"></span><h4>Working with Debuggers<a class="headerlink" href="#working-with-debuggers" title="Permalink to this headline">¶</a></h4>
<p>To dig deeper, possibly to trace code execution, Flask provides a debugger out
of the box (see <a class="reference internal" href="index.html#debug-mode"><span class="std std-ref">Debug Mode</span></a>).  If you would like to use another Python
debugger, note that debuggers interfere with each other.  You have to set some
options in order to use your favorite debugger:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code>        - whether to enable debug mode and catch exceptions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_debugger</span></code> - whether to use the internal Flask debugger</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_reloader</span></code> - whether to reload and fork the process on exception</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">debug</span></code> must be True (i.e., exceptions must be caught) in order for the other
two options to have any value.</p>
<p>If you’re using Aptana/Eclipse for debugging you’ll need to set both
<code class="docutils literal notranslate"><span class="pre">use_debugger</span></code> and <code class="docutils literal notranslate"><span class="pre">use_reloader</span></code> to False.</p>
<p>A possible useful pattern for configuration is to set the following in your
config.yaml (change the block as appropriate for your application, of course):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FLASK</span><span class="p">:</span>
    <span class="n">DEBUG</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">DEBUG_WITH_APTANA</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Then in your application’s entry-point (main.py), you could have something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># To allow aptana to receive errors, set use_debugger=False</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="n">use_debugger</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Disable Flask&#39;s debugger if external debugger is requested</span>
        <span class="n">use_debugger</span> <span class="o">=</span> <span class="ow">not</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEBUG_WITH_APTANA&#39;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">use_debugger</span><span class="o">=</span><span class="n">use_debugger</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="n">use_reloader</span><span class="o">=</span><span class="n">use_debugger</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-config"></span><div class="section" id="configuration-handling">
<span id="config"></span><h3>Configuration Handling<a class="headerlink" href="#configuration-handling" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details><p>Applications need some kind of configuration.  There are different settings
you might want to change depending on the application environment like
toggling the debug mode, setting the secret key, and other such
environment-specific things.</p>
<p>The way Flask is designed usually requires the configuration to be
available when the application starts up.  You can hardcode the
configuration in the code, which for many small applications is not
actually that bad, but there are better ways.</p>
<p>Independent of how you load your config, there is a config object
available which holds the loaded configuration values:
The <a class="reference internal" href="index.html#flask.Flask.config" title="flask.Flask.config"><code class="xref py py-attr docutils literal notranslate"><span class="pre">config</span></code></a> attribute of the <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>
object.  This is the place where Flask itself puts certain configuration
values and also where extensions can put their configuration values.  But
this is also where you can have your own configuration.</p>
<div class="section" id="configuration-basics">
<h4>Configuration Basics<a class="headerlink" href="#configuration-basics" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="index.html#flask.Flask.config" title="flask.Flask.config"><code class="xref py py-attr docutils literal notranslate"><span class="pre">config</span></code></a> is actually a subclass of a dictionary and
can be modified just like any dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Certain configuration values are also forwarded to the
<a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask</span></code></a> object so you can read and write them from there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>To update multiple keys at once you can use the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.update" title="(in Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.update()</span></code></a>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s1">&#39;...&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="builtin-configuration-values">
<h4>Builtin Configuration Values<a class="headerlink" href="#builtin-configuration-values" title="Permalink to this headline">¶</a></h4>
<p>The following configuration values are used internally by Flask:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DEBUG</span></code></p></td>
<td><p>enable/disable debug mode</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TESTING</span></code></p></td>
<td><p>enable/disable testing mode</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PROPAGATE_EXCEPTIONS</span></code></p></td>
<td><p>explicitly enable or disable the
propagation of exceptions.  If not set or
explicitly set to <code class="docutils literal notranslate"><span class="pre">None</span></code> this is
implicitly true if either <code class="docutils literal notranslate"><span class="pre">TESTING</span></code> or
<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> is true.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code></p></td>
<td><p>By default if the application is in
debug mode the request context is not
popped on exceptions to enable debuggers
to introspect the data.  This can be
disabled by this key.  You can also use
this setting to force-enable it for non
debug execution which might be useful to
debug production applications (but also
very risky).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code></p></td>
<td><p>the secret key</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_NAME</span></code></p></td>
<td><p>the name of the session cookie</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_DOMAIN</span></code></p></td>
<td><p>the domain for the session cookie.  If
this is not set, the cookie will be
valid for all subdomains of
<code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_PATH</span></code></p></td>
<td><p>the path for the session cookie.  If
this is not set the cookie will be valid
for all of <code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code> or if
that is not set for <code class="docutils literal notranslate"><span class="pre">'/'</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_HTTPONLY</span></code></p></td>
<td><p>controls if the cookie should be set
with the httponly flag.  Defaults to
<code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_SECURE</span></code></p></td>
<td><p>controls if the cookie should be set
with the secure flag.  Defaults to
<code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PERMANENT_SESSION_LIFETIME</span></code></p></td>
<td><p>the lifetime of a permanent session as
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timedelta</span></code></a> object.
Starting with Flask 0.8 this can also be
an integer representing seconds.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SESSION_REFRESH_EACH_REQUEST</span></code></p></td>
<td><p>this flag controls how permanent
sessions are refreshed.  If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>
(which is the default) then the cookie
is refreshed each request which
automatically bumps the lifetime.  If
set to <code class="docutils literal notranslate"><span class="pre">False</span></code> a <cite>set-cookie</cite> header is
only sent if the session is modified.
Non permanent sessions are not affected
by this.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">USE_X_SENDFILE</span></code></p></td>
<td><p>enable/disable x-sendfile</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOGGER_NAME</span></code></p></td>
<td><p>the name of the logger</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOGGER_HANDLER_POLICY</span></code></p></td>
<td><p>the policy of the default logging
handler.  The default is <code class="docutils literal notranslate"><span class="pre">'always'</span></code>
which means that the default logging
handler is always active.  <code class="docutils literal notranslate"><span class="pre">'debug'</span></code>
will only activate logging in debug
mode, <code class="docutils literal notranslate"><span class="pre">'production'</span></code> will only log in
production and <code class="docutils literal notranslate"><span class="pre">'never'</span></code> disables it
entirely.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></p></td>
<td><p>the name and port number of the server.
Required for subdomain support (e.g.:
<code class="docutils literal notranslate"><span class="pre">'myapp.dev:5000'</span></code>)  Note that
localhost does not support subdomains so
setting this to “localhost” does not
help.  Setting a <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> also
by default enables URL generation
without a request context but with an
application context.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code></p></td>
<td><p>If the application does not occupy
a whole domain or subdomain this can
be set to the path where the application
is configured to live.  This is for
session cookie as path value.  If
domains are used, this should be
<code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code></p></td>
<td><p>If set to a value in bytes, Flask will
reject incoming requests with a
content length greater than this by
returning a 413 status code.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code></p></td>
<td><p>Default cache control max age to use with
<a class="reference internal" href="index.html#flask.Flask.send_static_file" title="flask.Flask.send_static_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_static_file()</span></code></a> (the
default static file handler) and
<a class="reference internal" href="index.html#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>, as
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timedelta</span></code></a> or as seconds.
Override this value on a per-file
basis using the
<a class="reference internal" href="index.html#flask.Flask.get_send_file_max_age" title="flask.Flask.get_send_file_max_age"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_send_file_max_age()</span></code></a>
hook on <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> or
<a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a>,
respectively. Defaults to 43200 (12 hours).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TRAP_HTTP_EXCEPTIONS</span></code></p></td>
<td><p>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> Flask will
not execute the error handlers of HTTP
exceptions but instead treat the
exception like any other and bubble it
through the exception stack.  This is
helpful for hairy debugging situations
where you have to find out where an HTTP
exception is coming from.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TRAP_BAD_REQUEST_ERRORS</span></code></p></td>
<td><p>Werkzeug’s internal data structures that
deal with request specific data will
raise special key errors that are also
bad request exceptions.  Likewise many
operations can implicitly fail with a
BadRequest exception for consistency.
Since it’s nice for debugging to know
why exactly it failed this flag can be
used to debug those situations.  If this
config is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> you will get
a regular traceback instead.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PREFERRED_URL_SCHEME</span></code></p></td>
<td><p>The URL scheme that should be used for
URL generation if no URL scheme is
available.  This defaults to <code class="docutils literal notranslate"><span class="pre">http</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">JSON_AS_ASCII</span></code></p></td>
<td><p>By default Flask serialize object to
ascii-encoded JSON.  If this is set to
<code class="docutils literal notranslate"><span class="pre">False</span></code> Flask will not encode to ASCII
and output strings as-is and return
unicode strings.  <code class="docutils literal notranslate"><span class="pre">jsonify</span></code> will
automatically encode it in <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>
then for transport for instance.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">JSON_SORT_KEYS</span></code></p></td>
<td><p>By default Flask will serialize JSON
objects in a way that the keys are
ordered.  This is done in order to
ensure that independent of the hash seed
of the dictionary the return value will
be consistent to not trash external HTTP
caches.  You can override the default
behavior by changing this variable.
This is not recommended but might give
you a performance improvement on the
cost of cacheability.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code></p></td>
<td><p>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default)
jsonify responses will be pretty printed
if they are not requested by an
XMLHttpRequest object (controlled by
the <code class="docutils literal notranslate"><span class="pre">X-Requested-With</span></code> header)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">JSONIFY_MIMETYPE</span></code></p></td>
<td><p>MIME type used for jsonify responses.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TEMPLATES_AUTO_RELOAD</span></code></p></td>
<td><p>Whether to check for modifications of
the template source and reload it
automatically. By default the value is
<code class="docutils literal notranslate"><span class="pre">None</span></code> which means that Flask checks
original file only in debug mode.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">EXPLAIN_TEMPLATE_LOADING</span></code></p></td>
<td><p>If this is enabled then every attempt to
load a template will write an info
message to the logger explaining the
attempts to locate the template.  This
can be useful to figure out why
templates cannot be found or wrong
templates appear to be loaded.</p></td>
</tr>
</tbody>
</table>
<div class="admonition-more-on-server-name admonition">
<p class="admonition-title">More on <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> key is used for the subdomain support.  Because
Flask cannot guess the subdomain part without the knowledge of the
actual server name, this is required if you want to work with
subdomains.  This is also used for the session cookie.</p>
<p>Please keep in mind that not only Flask has the problem of not knowing
what subdomains are, your web browser does as well.  Most modern web
browsers will not allow cross-subdomain cookies to be set on a
server name without dots in it.  So if your server name is
<code class="docutils literal notranslate"><span class="pre">'localhost'</span></code> you will not be able to set a cookie for
<code class="docutils literal notranslate"><span class="pre">'localhost'</span></code> and every subdomain of it.  Please choose a different
server name in that case, like <code class="docutils literal notranslate"><span class="pre">'myapplication.local'</span></code> and add
this name + the subdomains you want to use into your host config
or setup a local <a class="reference external" href="https://www.isc.org/downloads/bind/">bind</a>.</p>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11: </span><code class="docutils literal notranslate"><span class="pre">SESSION_REFRESH_EACH_REQUEST</span></code>, <code class="docutils literal notranslate"><span class="pre">TEMPLATES_AUTO_RELOAD</span></code>,
<code class="docutils literal notranslate"><span class="pre">LOGGER_HANDLER_POLICY</span></code>, <code class="docutils literal notranslate"><span class="pre">EXPLAIN_TEMPLATE_LOADING</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.10: </span><code class="docutils literal notranslate"><span class="pre">JSON_AS_ASCII</span></code>, <code class="docutils literal notranslate"><span class="pre">JSON_SORT_KEYS</span></code>, <code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9: </span><code class="docutils literal notranslate"><span class="pre">PREFERRED_URL_SCHEME</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.8: </span><code class="docutils literal notranslate"><span class="pre">TRAP_BAD_REQUEST_ERRORS</span></code>, <code class="docutils literal notranslate"><span class="pre">TRAP_HTTP_EXCEPTIONS</span></code>,
<code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code>, <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_DOMAIN</span></code>,
<code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_HTTPONLY</span></code>,
<code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_SECURE</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7: </span><code class="docutils literal notranslate"><span class="pre">PROPAGATE_EXCEPTIONS</span></code>, <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6: </span><code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5: </span><code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.4: </span><code class="docutils literal notranslate"><span class="pre">LOGGER_NAME</span></code></p>
</div>
</details></div>
<div class="section" id="configuring-from-files">
<h4>Configuring from Files<a class="headerlink" href="#configuring-from-files" title="Permalink to this headline">¶</a></h4>
<p>Configuration becomes more useful if you can store it in a separate file,
ideally located outside the actual application package. This makes
packaging and distributing your application possible via various package
handling tools (<a class="reference internal" href="index.html#distribute-deployment"><span class="std std-ref">Deploying with Setuptools</span></a>) and finally modifying the
configuration file afterwards.</p>
<p>So a common pattern is this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_settings&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This first loads the configuration from the
<cite>yourapplication.default_settings</cite> module and then overrides the values
with the contents of the file the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">YOURAPPLICATION_SETTINGS</span></code>
environment variable points to.  This environment variable can be set on
Linux or OS X with the export command in the shell before starting the
server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export YOURAPPLICATION_SETTINGS=/path/to/settings.cfg
$ python run-app.py
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader...
</pre></div>
</div>
<p>On Windows systems use the <cite>set</cite> builtin instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="nb">set</span> <span class="n">YOURAPPLICATION_SETTINGS</span><span class="o">=</span>\<span class="n">path</span>\<span class="n">to</span>\<span class="n">settings</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>The configuration files themselves are actual Python files.  Only values
in uppercase are actually stored in the config object later on.  So make
sure to use uppercase letters for your config keys.</p>
<p>Here is an example of a configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;?</span><span class="se">\xbf</span><span class="s1">,</span><span class="se">\xb4\x8d\xa3</span><span class="s1">&quot;&lt;</span><span class="se">\x9c\xb0</span><span class="s1">@</span><span class="se">\x0f</span><span class="s1">5</span><span class="se">\xab</span><span class="s1">,w</span><span class="se">\xee\x8d</span><span class="s1">$0</span><span class="se">\x13\x8b</span><span class="s1">83&#39;</span>
</pre></div>
</div>
<p>Make sure to load the configuration very early on, so that extensions have
the ability to access the configuration when starting up.  There are other
methods on the config object as well to load from individual files.  For a
complete reference, read the <a class="reference internal" href="index.html#flask.Config" title="flask.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> object’s
documentation.</p>
</div>
<div class="section" id="configuration-best-practices">
<h4>Configuration Best Practices<a class="headerlink" href="#configuration-best-practices" title="Permalink to this headline">¶</a></h4>
<p>The downside with the approach mentioned earlier is that it makes testing
a little harder.  There is no single 100% solution for this problem in
general, but there are a couple of things you can keep in mind to improve
that experience:</p>
<ol class="arabic simple">
<li><p>Create your application in a function and register blueprints on it.
That way you can create multiple instances of your application with
different configurations attached which makes unittesting a lot
easier.  You can use this to pass in configuration as needed.</p></li>
<li><p>Do not write code that needs the configuration at import time.  If you
limit yourself to request-only accesses to the configuration you can
reconfigure the object later on as needed.</p></li>
</ol>
</div>
<div class="section" id="development-production">
<span id="config-dev-prod"></span><h4>Development / Production<a class="headerlink" href="#development-production" title="Permalink to this headline">¶</a></h4>
<p>Most applications need more than one configuration.  There should be at
least separate configurations for the production server and the one used
during development.  The easiest way to handle this is to use a default
configuration that is always loaded and part of the version control, and a
separate configuration that overrides the values as necessary as mentioned
in the example above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_settings&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you just have to add a separate <code class="file docutils literal notranslate"><span class="pre">config.py</span></code> file and export
<code class="docutils literal notranslate"><span class="pre">YOURAPPLICATION_SETTINGS=/path/to/config.py</span></code> and you are done.  However
there are alternative ways as well.  For example you could use imports or
subclassing.</p>
<p>What is very popular in the Django world is to make the import explicit in
the config file by adding <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">yourapplication.default_settings</span>
<span class="pre">import</span> <span class="pre">*</span></code> to the top of the file and then overriding the changes by hand.
You could also inspect an environment variable like
<code class="docutils literal notranslate"><span class="pre">YOURAPPLICATION_MODE</span></code> and set that to <cite>production</cite>, <cite>development</cite> etc
and import different hardcoded files based on that.</p>
<p>An interesting pattern is also to use classes and inheritance for
configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">TESTING</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;sqlite://:memory:&#39;</span>

<span class="k">class</span> <span class="nc">ProductionConfig</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="n">DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;mysql://user@localhost/foo&#39;</span>

<span class="k">class</span> <span class="nc">DevelopmentConfig</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">TestingConfig</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="n">TESTING</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>To enable such a config you just have to call into
<a class="reference internal" href="index.html#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;configmodule.ProductionConfig&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are many different ways and it’s up to you how you want to manage
your configuration files.  However here a list of good recommendations:</p>
<ul class="simple">
<li><p>Keep a default configuration in version control.  Either populate the
config with this default configuration or import it in your own
configuration files before overriding values.</p></li>
<li><p>Use an environment variable to switch between the configurations.
This can be done from outside the Python interpreter and makes
development and deployment much easier because you can quickly and
easily switch between different configs without having to touch the
code at all.  If you are working often on different projects you can
even create your own script for sourcing that activates a virtualenv
and exports the development configuration for you.</p></li>
<li><p>Use a tool like <a class="reference external" href="http://www.fabfile.org/">fabric</a> in production to push code and
configurations separately to the production server(s).  For some
details about how to do that, head over to the
<a class="reference internal" href="index.html#fabric-deployment"><span class="std std-ref">Deploying with Fabric</span></a> pattern.</p></li>
</ul>
</div>
<div class="section" id="instance-folders">
<span id="id1"></span><h4>Instance Folders<a class="headerlink" href="#instance-folders" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details><p>Flask 0.8 introduces instance folders.  Flask for a long time made it
possible to refer to paths relative to the application’s folder directly
(via <code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.root_path</span></code>).  This was also how many developers loaded
configurations stored next to the application.  Unfortunately however this
only works well if applications are not packages in which case the root
path refers to the contents of the package.</p>
<p>With Flask 0.8 a new attribute was introduced:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.instance_path</span></code>.  It refers to a new concept called the
“instance folder”.  The instance folder is designed to not be under
version control and be deployment specific.  It’s the perfect place to
drop things that either change at runtime or configuration files.</p>
<p>You can either explicitly provide the path of the instance folder when
creating the Flask application or you can let Flask autodetect the
instance folder.  For explicit configuration use the <cite>instance_path</cite>
parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance_path</span><span class="o">=</span><span class="s1">&#39;/path/to/instance/folder&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Please keep in mind that this path <em>must</em> be absolute when provided.</p>
<p>If the <cite>instance_path</cite> parameter is not provided the following default
locations are used:</p>
<ul>
<li><p>Uninstalled module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapp</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">instance</span>
</pre></div>
</div>
</li>
<li><p>Uninstalled package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapp</span>
    <span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">instance</span>
</pre></div>
</div>
</li>
<li><p>Installed module or package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$PREFIX/lib/python2.X/site-packages/myapp
$PREFIX/var/myapp-instance
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$PREFIX</span></code> is the prefix of your Python installation.  This can be
<code class="docutils literal notranslate"><span class="pre">/usr</span></code> or the path to your virtualenv.  You can print the value of
<code class="docutils literal notranslate"><span class="pre">sys.prefix</span></code> to see what the prefix is set to.</p>
</li>
</ul>
<p>Since the config object provided loading of configuration files from
relative filenames we made it possible to change the loading via filenames
to be relative to the instance path if wanted.  The behavior of relative
paths in config files can be flipped between “relative to the application
root” (the default) to “relative to instance folder” via the
<cite>instance_relative_config</cite> switch to the application constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance_relative_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is a full example of how to configure Flask to preload the config
from a module and then override the config from a file in the config
folder if it exists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance_relative_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_settings&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="s1">&#39;application.cfg&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The path to the instance folder can be found via the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.instance_path</span></code>.  Flask also provides a shortcut to open a
file from the instance folder with <code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.open_instance_resource()</span></code>.</p>
<p>Example usage for both:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">instance_path</span><span class="p">,</span> <span class="s1">&#39;application.cfg&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># or via open_instance_resource:</span>
<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_instance_resource</span><span class="p">(</span><span class="s1">&#39;application.cfg&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-signals"></span><div class="section" id="signals">
<span id="id1"></span><h3>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details><p>Starting with Flask 0.6, there is integrated support for signalling in
Flask.  This support is provided by the excellent <a class="reference external" href="https://pypi.org/project/blinker/">blinker</a> library and
will gracefully fall back if it is not available.</p>
<p>What are signals?  Signals help you decouple applications by sending
notifications when actions occur elsewhere in the core framework or
another Flask extensions.  In short, signals allow certain senders to
notify subscribers that something happened.</p>
<p>Flask comes with a couple of signals and other extensions might provide
more.  Also keep in mind that signals are intended to notify subscribers
and should not encourage subscribers to modify data.  You will notice that
there are signals that appear to do the same thing like some of the
builtin decorators do (eg: <a class="reference internal" href="index.html#flask.request_started" title="flask.request_started"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_started</span></code></a> is very similar
to <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a>).  However, there are differences in
how they work.  The core <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> handler, for
example, is executed in a specific order and is able to abort the request
early by returning a response.  In contrast all signal handlers are
executed in undefined order and do not modify any data.</p>
<p>The big advantage of signals over handlers is that you can safely
subscribe to them for just a split second.  These temporary
subscriptions are helpful for unittesting for example.  Say you want to
know what templates were rendered as part of a request: signals allow you
to do exactly that.</p>
<div class="section" id="subscribing-to-signals">
<h4>Subscribing to Signals<a class="headerlink" href="#subscribing-to-signals" title="Permalink to this headline">¶</a></h4>
<p>To subscribe to a signal, you can use the
<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.connect" title="(in Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connect()</span></code></a> method of a signal.  The first
argument is the function that should be called when the signal is emitted,
the optional second argument specifies a sender.  To unsubscribe from a
signal, you can use the <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.disconnect" title="(in Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">disconnect()</span></code></a> method.</p>
<p>For all core Flask signals, the sender is the application that issued the
signal.  When you subscribe to a signal, be sure to also provide a sender
unless you really want to listen for signals from all applications.  This is
especially true if you are developing an extension.</p>
<p>For example, here is a helper context manager that can be used in a unittest
to determine which templates were rendered and what variables were passed
to the template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">recorded</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
        <span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
    <span class="n">template_rendered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">recorded</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">template_rendered</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>This can now easily be paired with a test client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">)</span> <span class="k">as</span> <span class="n">templates</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">rv</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">template</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;index.html&#39;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Make sure to subscribe with an extra <code class="docutils literal notranslate"><span class="pre">**extra</span></code> argument so that your
calls don’t fail if Flask introduces new arguments to the signals.</p>
<p>All the template rendering in the code issued by the application <cite>app</cite>
in the body of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block will now be recorded in the <cite>templates</cite>
variable.  Whenever a template is rendered, the template object as well as
context are appended to it.</p>
<p>Additionally there is a convenient helper method
(<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.connected_to" title="(in Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connected_to()</span></code></a>)  that allows you to
temporarily subscribe a function to a signal with a context manager on
its own.  Because the return value of the context manager cannot be
specified that way, you have to pass the list in as an argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>

<span class="k">def</span> <span class="nf">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">recorded</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">template_rendered</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>The example above would then look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">template</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition-blinker-api-changes admonition">
<p class="admonition-title">Blinker API Changes</p>
<p>The <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.connected_to" title="(in Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connected_to()</span></code></a> method arrived in Blinker
with version 1.1.</p>
</div>
</div>
<div class="section" id="creating-signals">
<h4>Creating Signals<a class="headerlink" href="#creating-signals" title="Permalink to this headline">¶</a></h4>
<p>If you want to use signals in your own application, you can use the
blinker library directly.  The most common use case are named signals in a
custom <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Namespace" title="(in Blinker v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Namespace</span></code></a>..  This is what is recommended
most of the time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blinker</span> <span class="k">import</span> <span class="n">Namespace</span>
<span class="n">my_signals</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>
</pre></div>
</div>
<p>Now you can create new signals like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_saved</span> <span class="o">=</span> <span class="n">my_signals</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;model-saved&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The name for the signal here makes it unique and also simplifies
debugging.  You can access the name of the signal with the
<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.NamedSignal.name" title="(in Blinker v1.4)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a> attribute.</p>
<div class="admonition-for-extension-developers admonition">
<p class="admonition-title">For Extension Developers</p>
<p>If you are writing a Flask extension and you want to gracefully degrade for
missing blinker installations, you can do so by using the
<a class="reference internal" href="index.html#flask.signals.Namespace" title="flask.signals.Namespace"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.signals.Namespace</span></code></a> class.</p>
</div>
</div>
<div class="section" id="sending-signals">
<span id="signals-sending"></span><h4>Sending Signals<a class="headerlink" href="#sending-signals" title="Permalink to this headline">¶</a></h4>
<p>If you want to emit a signal, you can do so by calling the
<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.send" title="(in Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a> method.  It accepts a sender as first
argument and optionally some keyword arguments that are forwarded to the
signal subscribers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">model_saved</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Try to always pick a good sender.  If you have a class that is emitting a
signal, pass <code class="docutils literal notranslate"><span class="pre">self</span></code> as sender.  If you are emitting a signal from a random
function, you can pass <code class="docutils literal notranslate"><span class="pre">current_app._get_current_object()</span></code> as sender.</p>
<div class="admonition-passing-proxies-as-senders admonition">
<p class="admonition-title">Passing Proxies as Senders</p>
<p>Never pass <a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> as sender to a signal.  Use
<code class="docutils literal notranslate"><span class="pre">current_app._get_current_object()</span></code> instead.  The reason for this is
that <a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> is a proxy and not the real application
object.</p>
</div>
</div>
<div class="section" id="signals-and-flask-s-request-context">
<h4>Signals and Flask’s Request Context<a class="headerlink" href="#signals-and-flask-s-request-context" title="Permalink to this headline">¶</a></h4>
<p>Signals fully support <a class="reference internal" href="index.html#request-context"><span class="std std-ref">The Request Context</span></a> when receiving signals.
Context-local variables are consistently available between
<a class="reference internal" href="index.html#flask.request_started" title="flask.request_started"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_started</span></code></a> and <a class="reference internal" href="index.html#flask.request_finished" title="flask.request_finished"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_finished</span></code></a>, so you can
rely on <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.g</span></code></a> and others as needed.  Note the limitations described
in <a class="reference internal" href="#signals-sending"><span class="std std-ref">Sending Signals</span></a> and the <a class="reference internal" href="index.html#flask.request_tearing_down" title="flask.request_tearing_down"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_tearing_down</span></code></a> signal.</p>
</div>
<div class="section" id="decorator-based-signal-subscriptions">
<h4>Decorator Based Signal Subscriptions<a class="headerlink" href="#decorator-based-signal-subscriptions" title="Permalink to this headline">¶</a></h4>
<p>With Blinker 1.1 you can also easily subscribe to signals by using the new
<code class="xref py py-meth docutils literal notranslate"><span class="pre">connect_via()</span></code> decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>

<span class="nd">@template_rendered</span><span class="o">.</span><span class="n">connect_via</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">when_template_rendered</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;Template </span><span class="si">%s</span><span class="s1"> is rendered with </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="core-signals">
<h4>Core Signals<a class="headerlink" href="#core-signals" title="Permalink to this headline">¶</a></h4>
<p>Take a look at <a class="reference internal" href="index.html#core-signals-list"><span class="std std-ref">Signals</span></a> for a list of all builtin signals.</p>
</div>
</div>
<span id="document-views"></span><div class="section" id="pluggable-views">
<span id="views"></span><h3>Pluggable Views<a class="headerlink" href="#pluggable-views" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details><p>Flask 0.7 introduces pluggable views inspired by the generic views from
Django which are based on classes instead of functions.  The main
intention is that you can replace parts of the implementations and this
way have customizable pluggable views.</p>
<div class="section" id="basic-principle">
<h4>Basic Principle<a class="headerlink" href="#basic-principle" title="Permalink to this headline">¶</a></h4>
<p>Consider you have a function that loads a list of objects from the
database and renders into a template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_users</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;users.html&#39;</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>
</pre></div>
</div>
<p>This is simple and flexible, but if you want to provide this view in a
generic fashion that can be adapted to other models and templates as well
you might want more flexibility.  This is where pluggable class-based
views come into place.  As the first step to convert this into a class
based view you would do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="k">import</span> <span class="n">View</span>

<span class="k">class</span> <span class="nc">ShowUsers</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;users.html&#39;</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">ShowUsers</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;show_users&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>As you can see what you have to do is to create a subclass of
<a class="reference internal" href="index.html#flask.views.View" title="flask.views.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.views.View</span></code></a> and implement
<a class="reference internal" href="index.html#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a>.  Then we have to convert that
class into an actual view function by using the
<a class="reference internal" href="index.html#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a> class method.  The string you pass to
that function is the name of the endpoint that view will then have.  But
this by itself is not helpful, so let’s refactor the code a bit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="k">import</span> <span class="n">View</span>

<span class="k">class</span> <span class="nc">ListView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_template_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">render_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_name</span><span class="p">(),</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;objects&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_objects</span><span class="p">()}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_template_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;users.html&#39;</span>

    <span class="k">def</span> <span class="nf">get_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>This of course is not that helpful for such a small example, but it’s good
enough to explain the basic principle.  When you have a class-based view
the question comes up what <code class="docutils literal notranslate"><span class="pre">self</span></code> points to.  The way this works is that
whenever the request is dispatched a new instance of the class is created
and the <a class="reference internal" href="index.html#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> method is called with
the parameters from the URL rule.  The class itself is instantiated with
the parameters passed to the <a class="reference internal" href="index.html#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a> function.
For instance you can write a class like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RenderTemplateView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span> <span class="o">=</span> <span class="n">template_name</span>
    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">)</span>
</pre></div>
</div>
<p>And then you can register it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">RenderTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
    <span class="s1">&#39;about_page&#39;</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;about.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="method-hints">
<h4>Method Hints<a class="headerlink" href="#method-hints" title="Permalink to this headline">¶</a></h4>
<p>Pluggable views are attached to the application like a regular function by
either using <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-func docutils literal notranslate"><span class="pre">route()</span></code></a> or better
<a class="reference internal" href="index.html#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a>.  That however also means that you would
have to provide the names of the HTTP methods the view supports when you
attach this.  In order to move that information to the class you can
provide a <a class="reference internal" href="index.html#flask.views.View.methods" title="flask.views.View.methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">methods</span></code></a> attribute that has this
information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/myview&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">MyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;myview&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="method-based-dispatching">
<h4>Method Based Dispatching<a class="headerlink" href="#method-based-dispatching" title="Permalink to this headline">¶</a></h4>
<p>For RESTful APIs it’s especially helpful to execute a different function
for each HTTP method.  With the <a class="reference internal" href="index.html#flask.views.MethodView" title="flask.views.MethodView"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.views.MethodView</span></code></a> you can
easily do that.  Each HTTP method maps to a function with the same name
(just in lowercase):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="k">import</span> <span class="n">MethodView</span>

<span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">from_form_data</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>That way you also don’t have to provide the
<a class="reference internal" href="index.html#flask.views.View.methods" title="flask.views.View.methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">methods</span></code></a> attribute.  It’s automatically set based
on the methods defined in the class.</p>
</div>
<div class="section" id="decorating-views">
<h4>Decorating Views<a class="headerlink" href="#decorating-views" title="Permalink to this headline">¶</a></h4>
<p>Since the view class itself is not the view function that is added to the
routing system it does not make much sense to decorate the class itself.
Instead you either have to decorate the return value of
<a class="reference internal" href="index.html#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a> by hand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">user_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether user is logged in or raises error 401.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorator</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">user_required</span><span class="p">(</span><span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<p>Starting with Flask 0.8 there is also an alternative way where you can
specify a list of decorators to apply in the class declaration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>
    <span class="n">decorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_required</span><span class="p">]</span>
</pre></div>
</div>
<p>Due to the implicit self from the caller’s perspective you cannot use
regular view decorators on the individual methods of the view however,
keep this in mind.</p>
</div>
<div class="section" id="method-views-for-apis">
<h4>Method Views for APIs<a class="headerlink" href="#method-views-for-apis" title="Permalink to this headline">¶</a></h4>
<p>Web APIs are often working very closely with HTTP verbs so it makes a lot
of sense to implement such an API based on the
<a class="reference internal" href="index.html#flask.views.MethodView" title="flask.views.MethodView"><code class="xref py py-class docutils literal notranslate"><span class="pre">MethodView</span></code></a>.  That said, you will notice that the API
will require different URL rules that go to the same method view most of
the time.  For instance consider that you are exposing a user object on
the web:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 56%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>URL</p></td>
<td><p>Method</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/users/</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p>Gives a list of all users</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/users/</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p>Creates a new user</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/users/&lt;id&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p>Shows a single user</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/users/&lt;id&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PUT</span></code></p></td>
<td><p>Updates a single user</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/users/&lt;id&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p>Deletes a single user</p></td>
</tr>
</tbody>
</table>
<p>So how would you go about doing that with the
<a class="reference internal" href="index.html#flask.views.MethodView" title="flask.views.MethodView"><code class="xref py py-class docutils literal notranslate"><span class="pre">MethodView</span></code></a>?  The trick is to take advantage of the
fact that you can provide multiple rules to the same view.</p>
<p>Let’s assume for the moment the view would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># return a list of users</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># expose a single user</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create a new user</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># delete a single user</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># update a single user</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>So how do we hook this up with the routing system?  By adding two rules
and explicitly mentioning the methods for each:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_view</span> <span class="o">=</span> <span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;user_api&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                 <span class="n">view_func</span><span class="o">=</span><span class="n">user_view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,])</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">user_view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,])</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&lt;int:user_id&gt;&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">user_view</span><span class="p">,</span>
                 <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>If you have a lot of APIs that look similar you can refactor that
registration code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_api</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">pk_type</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">):</span>
    <span class="n">view_func</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="n">pk</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                     <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="n">pk</span><span class="p">),</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span>
                     <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>

<span class="n">register_api</span><span class="p">(</span><span class="n">UserAPI</span><span class="p">,</span> <span class="s1">&#39;user_api&#39;</span><span class="p">,</span> <span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-appcontext"></span><div class="section" id="the-application-context">
<span id="app-context"></span><h3>The Application Context<a class="headerlink" href="#the-application-context" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details><p>One of the design ideas behind Flask is that there are two different
“states” in which code is executed.  The application setup state in which
the application implicitly is on the module level.  It starts when the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code> object is instantiated, and it implicitly ends when the
first request comes in.  While the application is in this state a few
assumptions are true:</p>
<ul class="simple">
<li><p>the programmer can modify the application object safely.</p></li>
<li><p>no request handling happened so far</p></li>
<li><p>you have to have a reference to the application object in order to
modify it, there is no magic proxy that can give you a reference to
the application object you’re currently creating or modifying.</p></li>
</ul>
<p>In contrast, during request handling, a couple of other rules exist:</p>
<ul class="simple">
<li><p>while a request is active, the context local objects
(<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.request</span></code></a> and others) point to the current request.</p></li>
<li><p>any code can get hold of these objects at any time.</p></li>
</ul>
<p>There is a third state which is sitting in between a little bit.
Sometimes you are dealing with an application in a way that is similar to
how you interact with applications during request handling; just that there
is no request active.  Consider, for instance, that you’re sitting in an
interactive Python shell and interacting with the application, or a
command line application.</p>
<p>The application context is what powers the <a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>
context local.</p>
<div class="section" id="purpose-of-the-application-context">
<h4>Purpose of the Application Context<a class="headerlink" href="#purpose-of-the-application-context" title="Permalink to this headline">¶</a></h4>
<p>The main reason for the application’s context existence is that in the
past a bunch of functionality was attached to the request context for lack
of a better solution.  Since one of the pillars of Flask’s design is that
you can have more than one application in the same Python process.</p>
<p>So how does the code find the “right” application?  In the past we
recommended passing applications around explicitly, but that caused issues
with libraries that were not designed with that in mind.</p>
<p>A common workaround for that problem was to use the
<a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> proxy later on, which was bound to the current
request’s application reference.  Since creating such a request context is
an unnecessarily expensive operation in case there is no request around,
the application context was introduced.</p>
</div>
<div class="section" id="creating-an-application-context">
<h4>Creating an Application Context<a class="headerlink" href="#creating-an-application-context" title="Permalink to this headline">¶</a></h4>
<p>There are two ways to make an application context.  The first one is
implicit: whenever a request context is pushed, an application context
will be created alongside if this is necessary.  As a result, you can
ignore the existence of the application context unless you need it.</p>
<p>The second way is the explicit way using the
<a class="reference internal" href="index.html#flask.Flask.app_context" title="flask.Flask.app_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_context()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">current_app</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="c1"># within this block, current_app points to app.</span>
    <span class="nb">print</span> <span class="n">current_app</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>The application context is also used by the <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a>
function in case a <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> was configured.  This allows you to
generate URLs even in the absence of a request.</p>
<p>If no request context has been pushed and an application context has
not been explicitly set, a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> will be raised.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Working</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">application</span> <span class="n">context</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="locality-of-the-context">
<h4>Locality of the Context<a class="headerlink" href="#locality-of-the-context" title="Permalink to this headline">¶</a></h4>
<p>The application context is created and destroyed as necessary.  It never
moves between threads and it will not be shared between requests.  As such
it is the perfect place to store database connection information and other
things.  The internal stack object is called <a class="reference internal" href="index.html#flask._app_ctx_stack" title="flask._app_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask._app_ctx_stack</span></code></a>.
Extensions are free to store additional information on the topmost level,
assuming they pick a sufficiently unique name and should put their
information there, instead of on the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a> object which is reserved
for user code.</p>
<p>For more information about that, see <a class="reference internal" href="index.html#extension-dev"><span class="std std-ref">Flask Extension Development</span></a>.</p>
</div>
<div class="section" id="context-usage">
<h4>Context Usage<a class="headerlink" href="#context-usage" title="Permalink to this headline">¶</a></h4>
<p>The context is typically used to cache resources that need to be created
on a per-request or usage case.  For instance, database connections are
destined to go there.  When storing things on the application context
unique names should be chosen as this is a place that is shared between
Flask applications and extensions.</p>
<p>The most common usage is to split resource management into two parts:</p>
<ol class="arabic simple">
<li><p>an implicit resource caching on the context.</p></li>
<li><p>a context teardown based resource deallocation.</p></li>
</ol>
<p>Generally there would be a <code class="docutils literal notranslate"><span class="pre">get_X()</span></code> function that creates resource
<code class="docutils literal notranslate"><span class="pre">X</span></code> if it does not exist yet and otherwise returns the same resource,
and a <code class="docutils literal notranslate"><span class="pre">teardown_X()</span></code> function that is registered as teardown handler.</p>
<p>This is an example that connects to a database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">g</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">connect_to_database</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">db</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">teardown_db</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The first time <code class="docutils literal notranslate"><span class="pre">get_db()</span></code> is called the connection will be established.
To make this implicit a <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/local/#werkzeug.local.LocalProxy" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalProxy</span></code></a> can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.local</span> <span class="k">import</span> <span class="n">LocalProxy</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">LocalProxy</span><span class="p">(</span><span class="n">get_db</span><span class="p">)</span>
</pre></div>
</div>
<p>That way a user can directly access <code class="docutils literal notranslate"><span class="pre">db</span></code> which internally calls
<code class="docutils literal notranslate"><span class="pre">get_db()</span></code>.</p>
</div>
</div>
<span id="document-reqcontext"></span><div class="section" id="the-request-context">
<span id="request-context"></span><h3>The Request Context<a class="headerlink" href="#the-request-context" title="Permalink to this headline">¶</a></h3>
<p>This document describes the behavior in Flask 0.7 which is mostly in line
with the old behavior but has some small, subtle differences.</p>
<p>It is recommended that you read the <a class="reference internal" href="index.html#app-context"><span class="std std-ref">The Application Context</span></a> chapter first.</p>
<div class="section" id="diving-into-context-locals">
<h4>Diving into Context Locals<a class="headerlink" href="#diving-into-context-locals" title="Permalink to this headline">¶</a></h4>
<p>Say you have a utility function that returns the URL the user should be
redirected to.  Imagine it would always redirect to the URL’s <code class="docutils literal notranslate"><span class="pre">next</span></code>
parameter or the HTTP referrer or the index page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span>

<span class="k">def</span> <span class="nf">redirect_url</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="ow">or</span> \
           <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, it accesses the request object.  If you try to run this
from a plain Python shell, this is the exception you will see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">redirect_url</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">&#39;NoneType&#39; object has no attribute &#39;request&#39;</span>
</pre></div>
</div>
<p>That makes a lot of sense because we currently do not have a request we
could access.  So we have to make a request and bind it to the current
context.  The <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_request_context</span></code></a> method can create
us a <a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?next=http://example.com/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This context can be used in two ways.  Either with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement
or by calling the <a class="reference internal" href="index.html#flask.ctx.RequestContext.push" title="flask.ctx.RequestContext.push"><code class="xref py py-meth docutils literal notranslate"><span class="pre">push()</span></code></a> and
<a class="reference internal" href="index.html#flask.ctx.RequestContext.pop" title="flask.ctx.RequestContext.pop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a> methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
</pre></div>
</div>
<p>From that point onwards you can work with the request object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">redirect_url</span><span class="p">()</span>
<span class="go">u&#39;http://example.com/&#39;</span>
</pre></div>
</div>
<p>Until you call <cite>pop</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>Because the request context is internally maintained as a stack you can
push and pop multiple times.  This is very handy to implement things like
internal redirects.</p>
<p>For more information of how to utilize the request context from the
interactive Python shell, head over to the <a class="reference internal" href="index.html#shell"><span class="std std-ref">Working with the Shell</span></a> chapter.</p>
</div>
<div class="section" id="how-the-context-works">
<h4>How the Context Works<a class="headerlink" href="#how-the-context-works" title="Permalink to this headline">¶</a></h4>
<p>If you look into how the Flask WSGI application internally works, you will
find a piece of code that looks very much like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wsgi_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dispatch_request</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>The method <code class="xref py py-meth docutils literal notranslate"><span class="pre">request_context()</span></code> returns a new
<a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> object and uses it in combination with
the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement to bind the context.  Everything that is called from
the same thread from this point onwards until the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code>
statement will have access to the request globals (<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.request</span></code></a>
and others).</p>
<p>The request context internally works like a stack: The topmost level on
the stack is the current active request.
<a class="reference internal" href="index.html#flask.ctx.RequestContext.push" title="flask.ctx.RequestContext.push"><code class="xref py py-meth docutils literal notranslate"><span class="pre">push()</span></code></a> adds the context to the stack on
the very top, <a class="reference internal" href="index.html#flask.ctx.RequestContext.pop" title="flask.ctx.RequestContext.pop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a> removes it from the
stack again.  On popping the application’s
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> functions are also executed.</p>
<p>Another thing of note is that the request context will automatically also
create an <a class="reference internal" href="index.html#app-context"><span class="std std-ref">application context</span></a> when it’s pushed and
there is no application context for that application so far.</p>
</div>
<div class="section" id="callbacks-and-errors">
<span id="id1"></span><h4>Callbacks and Errors<a class="headerlink" href="#callbacks-and-errors" title="Permalink to this headline">¶</a></h4>
<p>What happens if an error occurs in Flask during request processing?  This
particular behavior changed in 0.7 because we wanted to make it easier to
understand what is actually happening.  The new behavior is quite simple:</p>
<ol class="arabic simple">
<li><p>Before each request, <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> functions are
executed.  If one of these functions return a response, the other
functions are no longer called.  In any case however the return value
is treated as a replacement for the view’s return value.</p></li>
<li><p>If the <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> functions did not return a
response, the regular request handling kicks in and the view function
that was matched has the chance to return a response.</p></li>
<li><p>The return value of the view is then converted into an actual response
object and handed over to the <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>
functions which have the chance to replace it or modify it in place.</p></li>
<li><p>At the end of the request the <a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>
functions are executed.  This always happens, even in case of an
unhandled exception down the road or if a before-request handler was
not executed yet or at all (for example in test environments sometimes
you might want to not execute before-request callbacks).</p></li>
</ol>
<p>Now what happens on errors?  In production mode if an exception is not
caught, the 500 internal server handler is called.  In development mode
however the exception is not further processed and bubbles up to the WSGI
server.  That way things like the interactive debugger can provide helpful
debug information.</p>
<p>An important change in 0.7 is that the internal server error is now no
longer post processed by the after request callbacks and after request
callbacks are no longer guaranteed to be executed.  This way the internal
dispatching code looks cleaner and is easier to customize and understand.</p>
<p>The new teardown functions are supposed to be used as a replacement for
things that absolutely need to happen at the end of request.</p>
</div>
<div class="section" id="teardown-callbacks">
<h4>Teardown Callbacks<a class="headerlink" href="#teardown-callbacks" title="Permalink to this headline">¶</a></h4>
<p>The teardown callbacks are special callbacks in that they are executed at
a different point.  Strictly speaking they are independent of the actual
request handling as they are bound to the lifecycle of the
<a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> object.  When the request context is
popped, the <a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> functions are called.</p>
<p>This is important to know if the life of the request context is prolonged
by using the test client in a with statement or when using the request
context from the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span>
    <span class="c1"># the teardown functions are still not called at that point</span>
    <span class="c1"># even though the response ended and you have the response</span>
    <span class="c1"># object in your hand</span>

<span class="c1"># only when the code reaches this point the teardown functions</span>
<span class="c1"># are called.  Alternatively the same thing happens if another</span>
<span class="c1"># request was triggered from the test client</span>
</pre></div>
</div>
<p>It’s easy to see the behavior from the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_request</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">teardown_request</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="s1">&#39;this runs after request&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">this runs after request</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Keep in mind that teardown callbacks are always executed, even if
before-request callbacks were not executed yet but an exception happened.
Certain parts of the test system might also temporarily create a request
context without calling the before-request handlers.  Make sure to write
your teardown-request handlers in a way that they will never fail.</p>
</div>
<div class="section" id="notes-on-proxies">
<span id="id2"></span><h4>Notes On Proxies<a class="headerlink" href="#notes-on-proxies" title="Permalink to this headline">¶</a></h4>
<p>Some of the objects provided by Flask are proxies to other objects.  The
reason behind this is that these proxies are shared between threads and
they have to dispatch to the actual object bound to a thread behind the
scenes as necessary.</p>
<p>Most of the time you don’t have to care about that, but there are some
exceptions where it is good to know that this object is an actual proxy:</p>
<ul class="simple">
<li><p>The proxy objects do not fake their inherited types, so if you want to
perform actual instance checks, you have to do that on the instance
that is being proxied (see <cite>_get_current_object</cite> below).</p></li>
<li><p>if the object reference is important (so for example for sending
<a class="reference internal" href="index.html#signals"><span class="std std-ref">Signals</span></a>)</p></li>
</ul>
<p>If you need to get access to the underlying object that is proxied, you
can use the <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/local/#werkzeug.local.LocalProxy._get_current_object" title="(in Werkzeug v1.0.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_get_current_object()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">_get_current_object</span><span class="p">()</span>
<span class="n">my_signal</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="context-preservation-on-error">
<h4>Context Preservation on Error<a class="headerlink" href="#context-preservation-on-error" title="Permalink to this headline">¶</a></h4>
<p>If an error occurs or not, at the end of the request the request context
is popped and all data associated with it is destroyed.  During
development however that can be problematic as you might want to have the
information around for a longer time in case an exception occurred.  In
Flask 0.6 and earlier in debug mode, if an exception occurred, the
request context was not popped so that the interactive debugger can still
provide you with important information.</p>
<p>Starting with Flask 0.7 you have finer control over that behavior by
setting the <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code> configuration variable.  By
default it’s linked to the setting of <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>.  If the application is in
debug mode the context is preserved, in production mode it’s not.</p>
<p>Do not force activate <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code> in production mode
as it will cause your application to leak memory on exceptions.  However
it can be useful during development to get the same error preserving
behavior as in development mode when attempting to debug an error that
only occurs under production settings.</p>
</div>
</div>
<span id="document-blueprints"></span><div class="section" id="modular-applications-with-blueprints">
<span id="blueprints"></span><h3>Modular Applications with Blueprints<a class="headerlink" href="#modular-applications-with-blueprints" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details><p>Flask uses a concept of <em>blueprints</em> for making application components and
supporting common patterns within an application or across applications.
Blueprints can greatly simplify how large applications work and provide a
central means for Flask extensions to register operations on applications.
A <a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a> object works similarly to a <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>
application object, but it is not actually an application.  Rather it is a
<em>blueprint</em> of how to construct or extend an application.</p>
<div class="section" id="why-blueprints">
<h4>Why Blueprints?<a class="headerlink" href="#why-blueprints" title="Permalink to this headline">¶</a></h4>
<p>Blueprints in Flask are intended for these cases:</p>
<ul class="simple">
<li><p>Factor an application into a set of blueprints.  This is ideal for
larger applications; a project could instantiate an application object,
initialize several extensions, and register a collection of blueprints.</p></li>
<li><p>Register a blueprint on an application at a URL prefix and/or subdomain.
Parameters in the URL prefix/subdomain become common view arguments
(with defaults) across all view functions in the blueprint.</p></li>
<li><p>Register a blueprint multiple times on an application with different URL
rules.</p></li>
<li><p>Provide template filters, static files, templates, and other utilities
through blueprints.  A blueprint does not have to implement applications
or view functions.</p></li>
<li><p>Register a blueprint on an application for any of these cases when
initializing a Flask extension.</p></li>
</ul>
<p>A blueprint in Flask is not a pluggable app because it is not actually an
application – it’s a set of operations which can be registered on an
application, even multiple times.  Why not have multiple application
objects?  You can do that (see <a class="reference internal" href="index.html#app-dispatch"><span class="std std-ref">Application Dispatching</span></a>), but your applications
will have separate configs and will be managed at the WSGI layer.</p>
<p>Blueprints instead provide separation at the Flask level, share
application config, and can change an application object as necessary with
being registered. The downside is that you cannot unregister a blueprint
once an application was created without having to destroy the whole
application object.</p>
</div>
<div class="section" id="the-concept-of-blueprints">
<h4>The Concept of Blueprints<a class="headerlink" href="#the-concept-of-blueprints" title="Permalink to this headline">¶</a></h4>
<p>The basic concept of blueprints is that they record operations to execute
when registered on an application.  Flask associates view functions with
blueprints when dispatching requests and generating URLs from one endpoint
to another.</p>
</div>
<div class="section" id="my-first-blueprint">
<h4>My First Blueprint<a class="headerlink" href="#my-first-blueprint" title="Permalink to this headline">¶</a></h4>
<p>This is what a very basic blueprint looks like.  In this case we want to
implement a blueprint that does simple rendering of static templates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">abort</span>
<span class="kn">from</span> <span class="nn">jinja2</span> <span class="k">import</span> <span class="n">TemplateNotFound</span>

<span class="n">simple_page</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;simple_page&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span>
                        <span class="n">template_folder</span><span class="o">=</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>

<span class="nd">@simple_page</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="s1">&#39;index&#39;</span><span class="p">})</span>
<span class="nd">@simple_page</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;page&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;pages/</span><span class="si">%s</span><span class="s1">.html&#39;</span> <span class="o">%</span> <span class="n">page</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TemplateNotFound</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</pre></div>
</div>
<p>When you bind a function with the help of the <code class="docutils literal notranslate"><span class="pre">&#64;simple_page.route</span></code>
decorator the blueprint will record the intention of registering the
function <cite>show</cite> on the application when it’s later registered.
Additionally it will prefix the endpoint of the function with the
name of the blueprint which was given to the <a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a>
constructor (in this case also <code class="docutils literal notranslate"><span class="pre">simple_page</span></code>).</p>
</div>
<div class="section" id="registering-blueprints">
<h4>Registering Blueprints<a class="headerlink" href="#registering-blueprints" title="Permalink to this headline">¶</a></h4>
<p>So how do you register that blueprint?  Like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">yourapplication.simple_page</span> <span class="k">import</span> <span class="n">simple_page</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">simple_page</span><span class="p">)</span>
</pre></div>
</div>
<p>If you check the rules registered on the application, you will find
these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/static/&lt;filename&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">static</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/&lt;page&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>The first one is obviously from the application itself for the static
files.  The other two are for the <cite>show</cite> function of the <code class="docutils literal notranslate"><span class="pre">simple_page</span></code>
blueprint.  As you can see, they are also prefixed with the name of the
blueprint and separated by a dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>).</p>
<p>Blueprints however can also be mounted at different locations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">simple_page</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/pages&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And sure enough, these are the generated rules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/static/&lt;filename&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">static</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/pages/&lt;page&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/pages/&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>On top of that you can register blueprints multiple times though not every
blueprint might respond properly to that.  In fact it depends on how the
blueprint is implemented if it can be mounted more than once.</p>
</div>
<div class="section" id="blueprint-resources">
<h4>Blueprint Resources<a class="headerlink" href="#blueprint-resources" title="Permalink to this headline">¶</a></h4>
<p>Blueprints can provide resources as well.  Sometimes you might want to
introduce a blueprint only for the resources it provides.</p>
<div class="section" id="blueprint-resource-folder">
<h5>Blueprint Resource Folder<a class="headerlink" href="#blueprint-resource-folder" title="Permalink to this headline">¶</a></h5>
<p>Like for regular applications, blueprints are considered to be contained
in a folder.  While multiple blueprints can originate from the same folder,
it does not have to be the case and it’s usually not recommended.</p>
<p>The folder is inferred from the second argument to <a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a> which
is usually <cite>__name__</cite>.  This argument specifies what logical Python
module or package corresponds to the blueprint.  If it points to an actual
Python package that package (which is a folder on the filesystem) is the
resource folder.  If it’s a module, the package the module is contained in
will be the resource folder.  You can access the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Blueprint.root_path</span></code> property to see what the resource folder is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_page</span><span class="o">.</span><span class="n">root_path</span>
<span class="go">&#39;/Users/username/TestProject/yourapplication&#39;</span>
</pre></div>
</div>
<p>To quickly open sources from this folder you can use the
<a class="reference internal" href="index.html#flask.Blueprint.open_resource" title="flask.Blueprint.open_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_resource()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;static/style.css&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="static-files">
<h5>Static Files<a class="headerlink" href="#static-files" title="Permalink to this headline">¶</a></h5>
<p>A blueprint can expose a folder with static files by providing a path to a
folder on the filesystem via the <cite>static_folder</cite> keyword argument.  It can
either be an absolute path or one relative to the folder of the
blueprint:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default the rightmost part of the path is where it is exposed on the
web.  Because the folder is called <code class="file docutils literal notranslate"><span class="pre">static</span></code> here it will be available at
the location of the blueprint + <code class="docutils literal notranslate"><span class="pre">/static</span></code>.  Say the blueprint is
registered for <code class="docutils literal notranslate"><span class="pre">/admin</span></code> the static folder will be at <code class="docutils literal notranslate"><span class="pre">/admin/static</span></code>.</p>
<p>The endpoint is named <cite>blueprint_name.static</cite> so you can generate URLs to
it like you would do to the static folder of the application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;admin.static&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="templates">
<h5>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h5>
<p>If you want the blueprint to expose templates you can do that by providing
the <cite>template_folder</cite> parameter to the <a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a> constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For static files, the path can be absolute or relative to the blueprint
resource folder.</p>
<p>The template folder is added to the search path of templates but with a lower
priority than the actual application’s template folder. That way you can
easily override templates that a blueprint provides in the actual application.
This also means that if you don’t want a blueprint template to be accidentally
overridden, make sure that no other blueprint or actual application template
has the same relative path. When multiple blueprints provide the same relative
template path the first blueprint registered takes precedence over the others.</p>
<p>So if you have a blueprint in the folder <code class="docutils literal notranslate"><span class="pre">yourapplication/admin</span></code> and you
want to render the template <code class="docutils literal notranslate"><span class="pre">'admin/index.html'</span></code> and you have provided
<code class="docutils literal notranslate"><span class="pre">templates</span></code> as a <cite>template_folder</cite> you will have to create a file like
this: <code class="file docutils literal notranslate"><span class="pre">yourapplication/admin/templates/admin/index.html</span></code>. The reason
for the extra <code class="docutils literal notranslate"><span class="pre">admin</span></code> folder is to avoid getting our template overridden
by a template named <code class="docutils literal notranslate"><span class="pre">index.html</span></code> in the actual application template
folder.</p>
<p>To further reiterate this: if you have a blueprint named <code class="docutils literal notranslate"><span class="pre">admin</span></code> and you
want to render a template called <code class="file docutils literal notranslate"><span class="pre">index.html</span></code> which is specific to this
blueprint, the best idea is to lay out your templates like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yourpackage</span><span class="o">/</span>
    <span class="n">blueprints</span><span class="o">/</span>
        <span class="n">admin</span><span class="o">/</span>
            <span class="n">templates</span><span class="o">/</span>
                <span class="n">admin</span><span class="o">/</span>
                    <span class="n">index</span><span class="o">.</span><span class="n">html</span>
            <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>And then when you want to render the template, use <code class="file docutils literal notranslate"><span class="pre">admin/index.html</span></code> as
the name to look up the template by.  If you encounter problems loading
the correct templates enable the <code class="docutils literal notranslate"><span class="pre">EXPLAIN_TEMPLATE_LOADING</span></code> config
variable which will instruct Flask to print out the steps it goes through
to locate templates on every <code class="docutils literal notranslate"><span class="pre">render_template</span></code> call.</p>
</div>
</div>
<div class="section" id="building-urls">
<h4>Building URLs<a class="headerlink" href="#building-urls" title="Permalink to this headline">¶</a></h4>
<p>If you want to link from one page to another you can use the
<a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> function just like you normally would do just that you
prefix the URL endpoint with the name of the blueprint and a dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;admin.index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally if you are in a view function of a blueprint or a rendered
template and you want to link to another endpoint of the same blueprint,
you can use relative redirects by prefixing the endpoint with a dot only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;.index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will link to <code class="docutils literal notranslate"><span class="pre">admin.index</span></code> for instance in case the current request
was dispatched to any other admin blueprint endpoint.</p>
</div>
<div class="section" id="error-handlers">
<h4>Error Handlers<a class="headerlink" href="#error-handlers" title="Permalink to this headline">¶</a></h4>
<p>Blueprints support the errorhandler decorator just like the <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>
application object, so it is easy to make Blueprint-specific custom error
pages.</p>
<p>Here is an example for a “404 Page Not Found” exception:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@simple_page</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;pages/404.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>More information on error handling see <a class="reference internal" href="index.html#errorpages"><span class="std std-ref">Custom Error Pages</span></a>.</p>
</div>
</div>
<span id="document-extensions"></span><div class="section" id="flask-extensions">
<span id="extensions"></span><h3>Flask Extensions<a class="headerlink" href="#flask-extensions" title="Permalink to this headline">¶</a></h3>
<p>Flask extensions extend the functionality of Flask in various different
ways.  For instance they add support for databases and other common tasks.</p>
<div class="section" id="finding-extensions">
<h4>Finding Extensions<a class="headerlink" href="#finding-extensions" title="Permalink to this headline">¶</a></h4>
<p>Flask extensions are listed on the <a class="reference external" href="http://flask.pocoo.org/extensions/">Flask Extension Registry</a> and can be
downloaded with <strong class="command">easy_install</strong> or <strong class="command">pip</strong>.  If you add a Flask extension
as dependency to your <code class="file docutils literal notranslate"><span class="pre">requirements.txt</span></code> or <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file they are
usually installed with a simple command or when your application installs.</p>
</div>
<div class="section" id="using-extensions">
<h4>Using Extensions<a class="headerlink" href="#using-extensions" title="Permalink to this headline">¶</a></h4>
<p>Extensions typically have documentation that goes along that shows how to
use it.  There are no general rules in how extensions are supposed to
behave but they are imported from common locations.  If you have an
extension called <code class="docutils literal notranslate"><span class="pre">Flask-Foo</span></code> or <code class="docutils literal notranslate"><span class="pre">Foo-Flask</span></code> it should be always
importable from <code class="docutils literal notranslate"><span class="pre">flask_foo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flask_foo</span>
</pre></div>
</div>
</div>
<div class="section" id="building-extensions">
<h4>Building Extensions<a class="headerlink" href="#building-extensions" title="Permalink to this headline">¶</a></h4>
<p>While <a class="reference external" href="http://flask.pocoo.org/extensions/">Flask Extension Registry</a> contains many Flask extensions, you may not find
an extension that fits your need. If this is the case, you can always create your own.
Consider reading <a class="reference internal" href="index.html#extension-dev"><span class="std std-ref">Flask Extension Development</span></a> to develop your own Flask extension.</p>
</div>
</div>
<span id="document-cli"></span><div class="section" id="command-line-interface">
<span id="cli"></span><h3>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details><p>One of the nice new features in Flask 0.11 is the built-in integration of
the <a class="reference external" href="http://click.pocoo.org/">click</a> command line interface.  This
enables a wide range of new features for the Flask ecosystem and your own
applications.</p>
<div class="section" id="basic-usage">
<h4>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h4>
<p>After installation of Flask you will now find a <strong class="command">flask</strong> script
installed into your virtualenv.  If you don’t want to install Flask or you
have a special use-case you can also use <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">flask</span></code> to accomplish
exactly the same.</p>
<p>The way this script works is by providing access to all the commands on
your Flask application’s <a class="reference internal" href="index.html#flask.Flask.cli" title="flask.Flask.cli"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.cli</span></code></a> instance as well as some
built-in commands that are always there.  Flask extensions can also
register more commands there if they desire so.</p>
<p>For the <strong class="command">flask</strong> script to work, an application needs to be
discovered.  This is achieved by exporting the <code class="docutils literal notranslate"><span class="pre">FLASK_APP</span></code> environment
variable.  It can be either set to an import path or to a filename of a
Python module that contains a Flask application.</p>
<p>In that imported file the name of the app needs to be called <code class="docutils literal notranslate"><span class="pre">app</span></code> or
optionally be specified after a colon.  For instance
<code class="docutils literal notranslate"><span class="pre">mymodule:application</span></code> would tell it to use the <cite>application</cite> object in
the <code class="file docutils literal notranslate"><span class="pre">mymodule.py</span></code> file.</p>
<p>Given a <code class="file docutils literal notranslate"><span class="pre">hello.py</span></code> file with the application in it named <code class="docutils literal notranslate"><span class="pre">app</span></code>
this is how it can be run.</p>
<p>Environment variables (On Windows use <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of <code class="docutils literal notranslate"><span class="pre">export</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">hello</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
<p>Or with a filename:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">py</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
</div>
<div class="section" id="virtualenv-integration">
<h4>Virtualenv Integration<a class="headerlink" href="#virtualenv-integration" title="Permalink to this headline">¶</a></h4>
<p>If you are constantly working with a virtualenv you can also put the
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">FLASK_APP</span></code> into your <code class="docutils literal notranslate"><span class="pre">activate</span></code> script by adding it to the
bottom of the file.  That way every time you activate your virtualenv you
automatically also activate the correct application name.</p>
</div>
<div class="section" id="debug-flag">
<h4>Debug Flag<a class="headerlink" href="#debug-flag" title="Permalink to this headline">¶</a></h4>
<p>The <strong class="command">flask</strong> script can also be instructed to enable the debug
mode of the application automatically by exporting <code class="docutils literal notranslate"><span class="pre">FLASK_DEBUG</span></code>.  If
set to <code class="docutils literal notranslate"><span class="pre">1</span></code> debug is enabled or <code class="docutils literal notranslate"><span class="pre">0</span></code> disables it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_DEBUG</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-shell">
<h4>Running a Shell<a class="headerlink" href="#running-a-shell" title="Permalink to this headline">¶</a></h4>
<p>To run an interactive Python shell you can use the <code class="docutils literal notranslate"><span class="pre">shell</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flask</span> <span class="n">shell</span>
</pre></div>
</div>
<p>This will start up an interactive Python shell, setup the correct
application context and setup the local variables in the shell.  This is
done by invoking the <a class="reference internal" href="index.html#flask.Flask.make_shell_context" title="flask.Flask.make_shell_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.make_shell_context()</span></code></a> method of the
application.  By default you have access to your <code class="docutils literal notranslate"><span class="pre">app</span></code> and <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a>.</p>
</div>
<div class="section" id="custom-commands">
<h4>Custom Commands<a class="headerlink" href="#custom-commands" title="Permalink to this headline">¶</a></h4>
<p>If you want to add more commands to the shell script you can do this
easily.  Flask uses <a class="reference external" href="http://click.pocoo.org/">click</a> for the command interface which makes
creating custom commands very easy.  For instance if you want a shell
command to initialize the database you can do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">initdb</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Initialize the database.&quot;&quot;&quot;</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">&#39;Init the db&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The command will then show up on the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ flask initdb
Init the db
</pre></div>
</div>
</div>
<div class="section" id="application-context">
<h4>Application Context<a class="headerlink" href="#application-context" title="Permalink to this headline">¶</a></h4>
<p>Most commands operate on the application so it makes a lot of sense if
they have the application context setup.  Because of this, if you register
a callback on <code class="docutils literal notranslate"><span class="pre">app.cli</span></code> with the <a class="reference internal" href="index.html#flask.cli.AppGroup.command" title="flask.cli.AppGroup.command"><code class="xref py py-meth docutils literal notranslate"><span class="pre">command()</span></code></a> the
callback will automatically be wrapped through <a class="reference internal" href="index.html#flask.cli.with_appcontext" title="flask.cli.with_appcontext"><code class="xref py py-func docutils literal notranslate"><span class="pre">cli.with_appcontext()</span></code></a>
which informs the cli system to ensure that an application context is set
up.  This behavior is not available if a command is added later with
<code class="xref py py-func docutils literal notranslate"><span class="pre">add_command()</span></code> or through other means.</p>
<p>It can also be disabled by passing <code class="docutils literal notranslate"><span class="pre">with_appcontext=False</span></code> to the
decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">with_appcontext</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="factory-functions">
<h4>Factory Functions<a class="headerlink" href="#factory-functions" title="Permalink to this headline">¶</a></h4>
<p>In case you are using factory functions to create your application (see
<a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a>) you will discover that the <strong class="command">flask</strong> command
cannot work with them directly.  Flask won’t be able to figure out how to
instantiate your application properly by itself.  Because of this reason
the recommendation is to create a separate file that instantiates
applications.  This is not the only way to make this work.  Another is the
<a class="reference internal" href="#custom-scripts"><span class="std std-ref">Custom Scripts</span></a> support.</p>
<p>For instance if you have a factory function that creates an application
from a filename you could make a separate file that creates such an
application from an environment variable.</p>
<p>This could be a file named <code class="file docutils literal notranslate"><span class="pre">autoapp.py</span></code> with these contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">create_app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;YOURAPPLICATION_CONFIG&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Once this has happened you can make the <strong class="command">flask</strong> command automatically
pick it up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">YOURAPPLICATION_CONFIG</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">cfg</span>
<span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">autoapp</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>From this point onwards <strong class="command">flask</strong> will find your application.</p>
</div>
<div class="section" id="custom-scripts">
<span id="id1"></span><h4>Custom Scripts<a class="headerlink" href="#custom-scripts" title="Permalink to this headline">¶</a></h4>
<p>While the most common way is to use the <strong class="command">flask</strong> command, you can
also make your own “driver scripts”.  Since Flask uses click for the
scripts there is no reason you cannot hook these scripts into any click
application.  There is one big caveat and that is, that commands
registered to <a class="reference internal" href="index.html#flask.Flask.cli" title="flask.Flask.cli"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.cli</span></code></a> will expect to be (indirectly at least)
launched from a <a class="reference internal" href="index.html#flask.cli.FlaskGroup" title="flask.cli.FlaskGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.cli.FlaskGroup</span></code></a> click group.  This is
necessary so that the commands know which Flask application they have to
work with.</p>
<p>To understand why you might want custom scripts you need to understand how
click finds and executes the Flask application.  If you use the
<strong class="command">flask</strong> script you specify the application to work with on the
command line or environment variable as an import name.  This is simple
but it has some limitations.  Primarily it does not work with application
factory functions (see <a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a>).</p>
<p>With a custom script you don’t have this problem as you can fully
customize how the application will be created.  This is very useful if you
write reusable applications that you want to ship to users and they should
be presented with a custom management script.</p>
<p>To explain all of this, here is an example <code class="file docutils literal notranslate"><span class="pre">manage.py</span></code> script that
manages a hypothetical wiki application.  We will go through the details
afterwards:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">from</span> <span class="nn">flask.cli</span> <span class="k">import</span> <span class="n">FlaskGroup</span>

<span class="k">def</span> <span class="nf">create_wiki_app</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">yourwiki</span> <span class="k">import</span> <span class="n">create_app</span>
    <span class="k">return</span> <span class="n">create_app</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WIKI_CONFIG&#39;</span><span class="p">,</span> <span class="s1">&#39;wikiconfig.py&#39;</span><span class="p">))</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">FlaskGroup</span><span class="p">,</span> <span class="n">create_app</span><span class="o">=</span><span class="n">create_wiki_app</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cli</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This is a management script for the wiki application.&quot;&quot;&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">cli</span><span class="p">()</span>
</pre></div>
</div>
<p>That’s a lot of code for not much, so let’s go through all parts step by
step.</p>
<ol class="arabic">
<li><p>First we import the <code class="docutils literal notranslate"><span class="pre">click</span></code> library as well as the click extensions
from the <code class="docutils literal notranslate"><span class="pre">flask.cli</span></code> package.  Primarily we are here interested
in the <a class="reference internal" href="index.html#flask.cli.FlaskGroup" title="flask.cli.FlaskGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlaskGroup</span></code></a> click group.</p></li>
<li><p>The next thing we do is defining a function that is invoked with the
script info object (<a class="reference internal" href="index.html#flask.cli.ScriptInfo" title="flask.cli.ScriptInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScriptInfo</span></code></a>) from Flask and its
purpose is to fully import and create the application.  This can
either directly import an application object or create it (see
<a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a>).  In this case we load the config from an
environment variable.</p></li>
<li><p>Next step is to create a <code class="xref py py-class docutils literal notranslate"><span class="pre">FlaskGroup</span></code>.  In this case we just
make an empty function with a help doc string that just does nothing
and then pass the <code class="docutils literal notranslate"><span class="pre">create_wiki_app</span></code> function as a factory function.</p>
<p>Whenever click now needs to operate on a Flask application it will
call that function with the script info and ask for it to be created.</p>
</li>
<li><p>All is rounded up by invoking the script.</p></li>
</ol>
</div>
<div class="section" id="cli-plugins">
<h4>CLI Plugins<a class="headerlink" href="#cli-plugins" title="Permalink to this headline">¶</a></h4>
<p>Flask extensions can always patch the <a class="reference internal" href="index.html#flask.Flask.cli" title="flask.Flask.cli"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.cli</span></code></a> instance with more
commands if they want.  However there is a second way to add CLI plugins
to Flask which is through <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>.  If you make a Python package that
should export a Flask command line plugin you can ship a <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file
that declares an entrypoint that points to a click command:</p>
<p>Example <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;flask-my-extension&#39;</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        [flask.commands]</span>
<span class="s1">        my-command=mypackage.commands:cli</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Inside <code class="file docutils literal notranslate"><span class="pre">mypackage/commands.py</span></code> you can then export a Click object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cli</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This is an example command.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Once that package is installed in the same virtualenv as Flask itself you
can run <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">my-command</span></code> to invoke your command.  This is useful to
provide extra functionality that Flask itself cannot ship.</p>
</div>
</div>
<span id="document-server"></span><div class="section" id="development-server">
<span id="server"></span><h3>Development Server<a class="headerlink" href="#development-server" title="Permalink to this headline">¶</a></h3>
<p>Starting with Flask 0.11 there are multiple built-in ways to run a
development server.  The best one is the <strong class="command">flask</strong> command line utility
but you can also continue using the <a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.run()</span></code></a> method.</p>
<div class="section" id="command-line">
<h4>Command Line<a class="headerlink" href="#command-line" title="Permalink to this headline">¶</a></h4>
<p>The <strong class="command">flask</strong> command line script (<a class="reference internal" href="index.html#cli"><span class="std std-ref">Command Line Interface</span></a>) is strongly recommended for
development because it provides a superior reload experience due to how it
loads the application.  The basic usage is like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export FLASK_APP=my_application
$ export FLASK_DEBUG=1
$ flask run
</pre></div>
</div>
<p>This will enable the debugger, the reloader and then start the server on
<em>http://localhost:5000/</em>.</p>
<p>The individual features of the server can be controlled by passing more
arguments to the <code class="docutils literal notranslate"><span class="pre">run</span></code> option.  For instance the reloader can be
disabled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ flask run --no-reload
</pre></div>
</div>
</div>
<div class="section" id="in-code">
<h4>In Code<a class="headerlink" href="#in-code" title="Permalink to this headline">¶</a></h4>
<p>The alternative way to start the application is through the
<a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.run()</span></code></a> method.  This will immediately launch a local server
exactly the same way the <strong class="command">flask</strong> script does.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This works well for the common case but it does not work well for
development which is why from Flask 0.11 onwards the <strong class="command">flask</strong>
method is recommended.  The reason for this is that due to how the reload
mechanism works there are some bizarre side-effects (like executing
certain code twice, sometimes crashing without message or dying when a
syntax or import error happens).</p>
<p>It is however still a perfectly valid method for invoking a non automatic
reloading application.</p>
</div>
</div>
<span id="document-shell"></span><div class="section" id="working-with-the-shell">
<span id="shell"></span><h3>Working with the Shell<a class="headerlink" href="#working-with-the-shell" title="Permalink to this headline">¶</a></h3>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details><p>One of the reasons everybody loves Python is the interactive shell.  It
basically allows you to execute Python commands in real time and
immediately get results back.  Flask itself does not come with an
interactive shell, because it does not require any specific setup upfront,
just import your application and start playing around.</p>
<p>There are however some handy helpers to make playing around in the shell a
more pleasant experience.  The main issue with interactive console
sessions is that you’re not triggering a request like a browser does which
means that <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a>, <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">request</span></code></a> and others are not
available.  But the code you want to test might depend on them, so what
can you do?</p>
<p>This is where some helper functions come in handy.  Keep in mind however
that these functions are not only there for interactive shell usage, but
also for unittesting and other situations that require a faked request
context.</p>
<p>Generally it’s recommended that you read the <a class="reference internal" href="index.html#request-context"><span class="std std-ref">The Request Context</span></a>
chapter of the documentation first.</p>
<div class="section" id="command-line-interface">
<h4>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h4>
<p>Starting with Flask 0.11 the recommended way to work with the shell is the
<code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">shell</span></code> command which does a lot of this automatically for you.
For instance the shell is automatically initialized with a loaded
application context.</p>
<p>For more information see <a class="reference internal" href="index.html#cli"><span class="std std-ref">Command Line Interface</span></a>.</p>
</div>
<div class="section" id="creating-a-request-context">
<h4>Creating a Request Context<a class="headerlink" href="#creating-a-request-context" title="Permalink to this headline">¶</a></h4>
<p>The easiest way to create a proper request context from the shell is by
using the <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_request_context</span></code></a> method which creates
us a <a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
</pre></div>
</div>
<p>Normally you would use the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement to make this request object
active, but in the shell it’s easier to use the
<a class="reference internal" href="index.html#flask.ctx.RequestContext.push" title="flask.ctx.RequestContext.push"><code class="xref py py-meth docutils literal notranslate"><span class="pre">push()</span></code></a> and
<a class="reference internal" href="index.html#flask.ctx.RequestContext.pop" title="flask.ctx.RequestContext.pop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a> methods by hand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
</pre></div>
</div>
<p>From that point onwards you can work with the request object until you
call <cite>pop</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="firing-before-after-request">
<h4>Firing Before/After Request<a class="headerlink" href="#firing-before-after-request" title="Permalink to this headline">¶</a></h4>
<p>By just creating a request context, you still don’t have run the code that
is normally run before a request.  This might result in your database
being unavailable if you are connecting to the database in a
before-request callback or the current user not being stored on the
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> object etc.</p>
<p>This however can easily be done yourself.  Just call
<a class="reference internal" href="index.html#flask.Flask.preprocess_request" title="flask.Flask.preprocess_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">preprocess_request()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">preprocess_request</span><span class="p">()</span>
</pre></div>
</div>
<p>Keep in mind that the <a class="reference internal" href="index.html#flask.Flask.preprocess_request" title="flask.Flask.preprocess_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">preprocess_request()</span></code></a> function
might return a response object, in that case just ignore it.</p>
<p>To shutdown a request, you need to trick a bit before the after request
functions (triggered by <a class="reference internal" href="index.html#flask.Flask.process_response" title="flask.Flask.process_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_response()</span></code></a>) operate on
a response object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">response_class</span><span class="p">())</span>
<span class="go">&lt;Response 0 bytes [200 OK]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>The functions registered as <a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> are
automatically called when the context is popped.  So this is the perfect
place to automatically tear down resources that were needed by the request
context (such as database connections).</p>
</div>
<div class="section" id="further-improving-the-shell-experience">
<h4>Further Improving the Shell Experience<a class="headerlink" href="#further-improving-the-shell-experience" title="Permalink to this headline">¶</a></h4>
<p>If you like the idea of experimenting in a shell, create yourself a module
with stuff you want to star import into your interactive session.  There
you could also define some more helper methods for common things such as
initializing the database, dropping tables etc.</p>
<p>Just put them into a module (like <cite>shelltools</cite>) and import from there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">shelltools</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/index"></span><div class="section" id="patterns-for-flask">
<span id="patterns"></span><h3>Patterns for Flask<a class="headerlink" href="#patterns-for-flask" title="Permalink to this headline">¶</a></h3>
<p>Certain things are common enough that the chances are high you will find
them in most web applications.  For example quite a lot of applications
are using relational databases and user authentication.  In that case,
chances are they will open a database connection at the beginning of the
request and get the information of the currently logged in user.  At the
end of the request, the database connection is closed again.</p>
<p>There are more user contributed snippets and patterns in the <a class="reference external" href="http://flask.pocoo.org/snippets/">Flask
Snippet Archives</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-patterns/packages"></span><div class="section" id="larger-applications">
<span id="id1"></span><h4>Larger Applications<a class="headerlink" href="#larger-applications" title="Permalink to this headline">¶</a></h4>
<p>For larger applications it’s a good idea to use a package instead of a
module.  That is quite simple.  Imagine a small application looks like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">yourapplication</span>
    <span class="n">yourapplication</span><span class="o">.</span><span class="n">py</span>
    <span class="o">/</span><span class="n">static</span>
        <span class="n">style</span><span class="o">.</span><span class="n">css</span>
    <span class="o">/</span><span class="n">templates</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">html</span>
        <span class="n">index</span><span class="o">.</span><span class="n">html</span>
        <span class="n">login</span><span class="o">.</span><span class="n">html</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="simple-packages">
<h5>Simple Packages<a class="headerlink" href="#simple-packages" title="Permalink to this headline">¶</a></h5>
<p>To convert that into a larger one, just create a new folder
<code class="file docutils literal notranslate"><span class="pre">yourapplication</span></code> inside the existing one and move everything below it.
Then rename <code class="file docutils literal notranslate"><span class="pre">yourapplication.py</span></code> to <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code>.  (Make sure to delete
all <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files first, otherwise things would most likely break)</p>
<p>You should then end up with something like that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">yourapplication</span>
    <span class="o">/</span><span class="n">yourapplication</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="o">/</span><span class="n">static</span>
            <span class="n">style</span><span class="o">.</span><span class="n">css</span>
        <span class="o">/</span><span class="n">templates</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">html</span>
            <span class="n">index</span><span class="o">.</span><span class="n">html</span>
            <span class="n">login</span><span class="o">.</span><span class="n">html</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>But how do you run your application now?  The naive <code class="docutils literal notranslate"><span class="pre">python</span>
<span class="pre">yourapplication/__init__.py</span></code> will not work.  Let’s just say that Python
does not want modules in packages to be the startup file.  But that is not
a big problem, just add a new file called <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> next to the inner
<code class="file docutils literal notranslate"><span class="pre">yourapplication</span></code> folder with the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;yourapplication&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yourapplication&#39;</span><span class="p">],</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;flask&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In order to run the application you need to export an environment variable
that tells Flask where to find the application instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">yourapplication</span>
</pre></div>
</div>
<p>If you are outside of the project directory make sure to provide the exact
path to your application directory. Similiarly you can turn on “debug
mode” with this environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_DEBUG</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>In order to install and run the application you need to issue the following
commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
<p>What did we gain from this?  Now we can restructure the application a bit
into multiple modules.  The only thing you have to remember is the
following quick checklist:</p>
<ol class="arabic simple">
<li><p>the <cite>Flask</cite> application object creation has to be in the
<code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code> file.  That way each module can import it safely and the
<cite>__name__</cite> variable will resolve to the correct package.</p></li>
<li><p>all the view functions (the ones with a <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a>
decorator on top) have to be imported in the <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code> file.
Not the object itself, but the module it is in. Import the view module
<strong>after the application object is created</strong>.</p></li>
</ol>
<p>Here’s an example <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">yourapplication.views</span>
</pre></div>
</div>
<p>And this is what <code class="file docutils literal notranslate"><span class="pre">views.py</span></code> would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>You should then end up with something like that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">yourapplication</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
    <span class="o">/</span><span class="n">yourapplication</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">views</span><span class="o">.</span><span class="n">py</span>
        <span class="o">/</span><span class="n">static</span>
            <span class="n">style</span><span class="o">.</span><span class="n">css</span>
        <span class="o">/</span><span class="n">templates</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">html</span>
            <span class="n">index</span><span class="o">.</span><span class="n">html</span>
            <span class="n">login</span><span class="o">.</span><span class="n">html</span>
            <span class="o">...</span>
</pre></div>
</div>
<div class="admonition-circular-imports admonition">
<p class="admonition-title">Circular Imports</p>
<p>Every Python programmer hates them, and yet we just added some:
circular imports (That’s when two modules depend on each other.  In this
case <code class="file docutils literal notranslate"><span class="pre">views.py</span></code> depends on <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code>).  Be advised that this is a
bad idea in general but here it is actually fine.  The reason for this is
that we are not actually using the views in <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code> and just
ensuring the module is imported and we are doing that at the bottom of
the file.</p>
<p>There are still some problems with that approach but if you want to use
decorators there is no way around that.  Check out the
<a class="reference internal" href="index.html#becomingbig"><span class="std std-ref">Becoming Big</span></a> section for some inspiration how to deal with that.</p>
</div>
</div>
<div class="section" id="working-with-blueprints">
<span id="working-with-modules"></span><h5>Working with Blueprints<a class="headerlink" href="#working-with-blueprints" title="Permalink to this headline">¶</a></h5>
<p>If you have larger applications it’s recommended to divide them into
smaller groups where each group is implemented with the help of a
blueprint.  For a gentle introduction into this topic refer to the
<a class="reference internal" href="index.html#blueprints"><span class="std std-ref">Modular Applications with Blueprints</span></a> chapter of the documentation.</p>
</div>
</div>
<span id="document-patterns/appfactories"></span><div class="section" id="application-factories">
<span id="app-factories"></span><h4>Application Factories<a class="headerlink" href="#application-factories" title="Permalink to this headline">¶</a></h4>
<p>If you are already using packages and blueprints for your application
(<a class="reference internal" href="index.html#blueprints"><span class="std std-ref">Modular Applications with Blueprints</span></a>) there are a couple of really nice ways to further improve
the experience.  A common pattern is creating the application object when
the blueprint is imported.  But if you move the creation of this object
into a function, you can then create multiple instances of this app later.</p>
<p>So why would you want to do this?</p>
<ol class="arabic simple">
<li><p>Testing.  You can have instances of the application with different
settings to test every case.</p></li>
<li><p>Multiple instances.  Imagine you want to run different versions of the
same application.  Of course you could have multiple instances with
different configs set up in your webserver, but if you use factories,
you can have multiple instances of the same application running in the
same application process which can be handy.</p></li>
</ol>
<p>So how would you then actually implement that?</p>
<div class="section" id="basic-factories">
<h5>Basic Factories<a class="headerlink" href="#basic-factories" title="Permalink to this headline">¶</a></h5>
<p>The idea is to set up the application in a function.  Like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_filename</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="n">config_filename</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">yourapplication.model</span> <span class="k">import</span> <span class="n">db</span>
    <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">yourapplication.views.admin</span> <span class="k">import</span> <span class="n">admin</span>
    <span class="kn">from</span> <span class="nn">yourapplication.views.frontend</span> <span class="k">import</span> <span class="n">frontend</span>
    <span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">admin</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">frontend</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>The downside is that you cannot use the application object in the blueprints
at import time.  You can however use it from within a request.  How do you
get access to the application with the config?  Use
<a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">current_app</span><span class="p">,</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span>
<span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/admin&#39;</span><span class="p">)</span>

<span class="nd">@admin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;INDEX_TEMPLATE&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Here we look up the name of a template in the config.</p>
</div>
<div class="section" id="factories-extensions">
<h5>Factories &amp; Extensions<a class="headerlink" href="#factories-extensions" title="Permalink to this headline">¶</a></h5>
<p>It’s preferable to create your extensions and app factories so that the
extension object does not initially get bound to the application.</p>
<p>Using <a class="reference external" href="http://pythonhosted.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a>,
as an example, you should not do something along those lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_filename</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="n">config_filename</span><span class="p">)</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>But, rather, in model.py (or equivalent):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">()</span>
</pre></div>
</div>
<p>and in your application.py (or equivalent):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_filename</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="n">config_filename</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">yourapplication.model</span> <span class="k">import</span> <span class="n">db</span>
    <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Using this design pattern, no application-specific state is stored on the
extension object, so one extension object can be used for multiple apps.
For more information about the design of extensions refer to <a class="reference internal" href="index.html#document-extensiondev"><span class="doc">Flask Extension Development</span></a>.</p>
</div>
<div class="section" id="using-applications">
<h5>Using Applications<a class="headerlink" href="#using-applications" title="Permalink to this headline">¶</a></h5>
<p>So to use such an application you then have to create the application
first in a separate file otherwise the <strong class="command">flask</strong> command won’t be able
to find it.  Here an example <code class="file docutils literal notranslate"><span class="pre">exampleapp.py</span></code> file that creates such
an application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">create_app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="s1">&#39;/path/to/config.cfg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It can then be used with the <strong class="command">flask</strong> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FLASK_APP</span><span class="o">=</span><span class="n">exampleapp</span>
<span class="n">flask</span> <span class="n">run</span>
</pre></div>
</div>
</div>
<div class="section" id="factory-improvements">
<h5>Factory Improvements<a class="headerlink" href="#factory-improvements" title="Permalink to this headline">¶</a></h5>
<p>The factory function from above is not very clever so far, you can improve
it.  The following changes are straightforward and possible:</p>
<ol class="arabic simple">
<li><p>make it possible to pass in configuration values for unittests so that
you don’t have to create config files on the filesystem</p></li>
<li><p>call a function from a blueprint when the application is setting up so
that you have a place to modify attributes of the application (like
hooking in before / after request handlers etc.)</p></li>
<li><p>Add in WSGI middlewares when the application is creating if necessary.</p></li>
</ol>
</div>
</div>
<span id="document-patterns/appdispatch"></span><div class="section" id="application-dispatching">
<span id="app-dispatch"></span><h4>Application Dispatching<a class="headerlink" href="#application-dispatching" title="Permalink to this headline">¶</a></h4>
<p>Application dispatching is the process of combining multiple Flask
applications on the WSGI level.  You can combine not only Flask
applications but any WSGI application.  This would allow you to run a
Django and a Flask application in the same interpreter side by side if
you want.  The usefulness of this depends on how the applications work
internally.</p>
<p>The fundamental difference from the <a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">module approach</span></a> is that in this case you are running the same or
different Flask applications that are entirely isolated from each other.
They run different configurations and are dispatched on the WSGI level.</p>
<div class="section" id="working-with-this-document">
<h5>Working with this Document<a class="headerlink" href="#working-with-this-document" title="Permalink to this headline">¶</a></h5>
<p>Each of the techniques and examples below results in an <code class="docutils literal notranslate"><span class="pre">application</span></code> object
that can be run with any WSGI server.  For production, see <a class="reference internal" href="index.html#deployment"><span class="std std-ref">Deployment Options</span></a>.
For development, Werkzeug provides a builtin server for development available
at <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/serving/#werkzeug.serving.run_simple" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">werkzeug.serving.run_simple()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.serving</span> <span class="k">import</span> <span class="n">run_simple</span>
<span class="n">run_simple</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">application</span><span class="p">,</span> <span class="n">use_reloader</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/serving/#werkzeug.serving.run_simple" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_simple</span></code></a> is not intended for
use in production.  Use a <a class="reference internal" href="index.html#deployment"><span class="std std-ref">full-blown WSGI server</span></a>.</p>
<p>In order to use the interactive debugger, debugging must be enabled both on
the application and the simple server. Here is the “hello world” example with
debugging and <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/serving/#werkzeug.serving.run_simple" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_simple</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">werkzeug.serving</span> <span class="k">import</span> <span class="n">run_simple</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run_simple</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span>
               <span class="n">use_reloader</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_debugger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_evalex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="combining-applications">
<h5>Combining Applications<a class="headerlink" href="#combining-applications" title="Permalink to this headline">¶</a></h5>
<p>If you have entirely separated applications and you want them to work next
to each other in the same Python interpreter process you can take
advantage of the <code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.wsgi.DispatcherMiddleware</span></code>.  The idea
here is that each Flask application is a valid WSGI application and they
are combined by the dispatcher middleware into a larger one that is
dispatched based on prefix.</p>
<p>For example you could have your main application run on <code class="docutils literal notranslate"><span class="pre">/</span></code> and your
backend interface on <code class="docutils literal notranslate"><span class="pre">/backend</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.wsgi</span> <span class="k">import</span> <span class="n">DispatcherMiddleware</span>
<span class="kn">from</span> <span class="nn">frontend_app</span> <span class="k">import</span> <span class="n">application</span> <span class="k">as</span> <span class="n">frontend</span>
<span class="kn">from</span> <span class="nn">backend_app</span> <span class="k">import</span> <span class="n">application</span> <span class="k">as</span> <span class="n">backend</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">DispatcherMiddleware</span><span class="p">(</span><span class="n">frontend</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;/backend&#39;</span><span class="p">:</span>     <span class="n">backend</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="dispatch-by-subdomain">
<h5>Dispatch by Subdomain<a class="headerlink" href="#dispatch-by-subdomain" title="Permalink to this headline">¶</a></h5>
<p>Sometimes you might want to use multiple instances of the same application
with different configurations.  Assuming the application is created inside
a function and you can call that function to instantiate it, that is
really easy to implement.  In order to develop your application to support
creating new instances in functions have a look at the
<a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a> pattern.</p>
<p>A very common example would be creating applications per subdomain.  For
instance you configure your webserver to dispatch all requests for all
subdomains to your application and you then use the subdomain information
to create user-specific instances.  Once you have your server set up to
listen on all subdomains you can use a very simple WSGI application to do
the dynamic application creation.</p>
<p>The perfect level for abstraction in that regard is the WSGI layer.  You
write your own WSGI application that looks at the request that comes and
delegates it to your Flask application.  If that application does not
exist yet, it is dynamically created and remembered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Lock</span>

<span class="k">class</span> <span class="nc">SubdomainDispatcher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">create_app</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_app</span> <span class="o">=</span> <span class="n">create_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_application</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">host</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">),</span> <span class="s1">&#39;Configuration error&#39;</span>
        <span class="n">subdomain</span> <span class="o">=</span> <span class="n">host</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subdomain</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_app</span><span class="p">(</span><span class="n">subdomain</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">subdomain</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span>
            <span class="k">return</span> <span class="n">app</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_application</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>This dispatcher can then be used like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myapplication</span> <span class="k">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">get_user_for_subdomain</span>
<span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="k">import</span> <span class="n">NotFound</span>

<span class="k">def</span> <span class="nf">make_app</span><span class="p">(</span><span class="n">subdomain</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_for_subdomain</span><span class="p">(</span><span class="n">subdomain</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># if there is no user for that subdomain we still have</span>
        <span class="c1"># to return a WSGI application that handles that request.</span>
        <span class="c1"># We can then just return the NotFound() exception as</span>
        <span class="c1"># application which will render a default 404 page.</span>
        <span class="c1"># You might also redirect the user to the main page then</span>
        <span class="k">return</span> <span class="n">NotFound</span><span class="p">()</span>

    <span class="c1"># otherwise create the application for the specific user</span>
    <span class="k">return</span> <span class="n">create_app</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">SubdomainDispatcher</span><span class="p">(</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span> <span class="n">make_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dispatch-by-path">
<h5>Dispatch by Path<a class="headerlink" href="#dispatch-by-path" title="Permalink to this headline">¶</a></h5>
<p>Dispatching by a path on the URL is very similar.  Instead of looking at
the <code class="docutils literal notranslate"><span class="pre">Host</span></code> header to figure out the subdomain one simply looks at the
request path up to the first slash:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="k">import</span> <span class="n">Lock</span>
<span class="kn">from</span> <span class="nn">werkzeug.wsgi</span> <span class="k">import</span> <span class="n">pop_path_info</span><span class="p">,</span> <span class="n">peek_path_info</span>

<span class="k">class</span> <span class="nc">PathDispatcher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_app</span><span class="p">,</span> <span class="n">create_app</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_app</span> <span class="o">=</span> <span class="n">default_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_app</span> <span class="o">=</span> <span class="n">create_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_application</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_app</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span>
            <span class="k">return</span> <span class="n">app</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_application</span><span class="p">(</span><span class="n">peek_path_info</span><span class="p">(</span><span class="n">environ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pop_path_info</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_app</span>
        <span class="k">return</span> <span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>The big difference between this and the subdomain one is that this one
falls back to another application if the creator function returns <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myapplication</span> <span class="k">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">default_app</span><span class="p">,</span> <span class="n">get_user_for_prefix</span>

<span class="k">def</span> <span class="nf">make_app</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_user_for_prefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">create_app</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">PathDispatcher</span><span class="p">(</span><span class="n">default_app</span><span class="p">,</span> <span class="n">make_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/apierrors"></span><div class="section" id="implementing-api-exceptions">
<h4>Implementing API Exceptions<a class="headerlink" href="#implementing-api-exceptions" title="Permalink to this headline">¶</a></h4>
<p>It’s very common to implement RESTful APIs on top of Flask.  One of the
first things that developers run into is the realization that the builtin
exceptions are not expressive enough for APIs and that the content type of
<em class="mimetype">text/html</em> they are emitting is not very useful for API consumers.</p>
<p>The better solution than using <code class="docutils literal notranslate"><span class="pre">abort</span></code> to signal errors for invalid API
usage is to implement your own exception type and install an error handler
for it that produces the errors in the format the user is expecting.</p>
<div class="section" id="simple-exception-class">
<h5>Simple Exception Class<a class="headerlink" href="#simple-exception-class" title="Permalink to this headline">¶</a></h5>
<p>The basic idea is to introduce a new exception that can take a proper
human readable message, a status code for the error and some optional
payload to give more context for the error.</p>
<p>This is a simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">jsonify</span>

<span class="k">class</span> <span class="nc">InvalidUsage</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="n">status_code</span> <span class="o">=</span> <span class="mi">400</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="ow">or</span> <span class="p">())</span>
        <span class="n">rv</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="k">return</span> <span class="n">rv</span>
</pre></div>
</div>
<p>A view can now raise that exception with an error message.  Additionally
some extra payload can be provided as a dictionary through the <cite>payload</cite>
parameter.</p>
</div>
<div class="section" id="registering-an-error-handler">
<h5>Registering an Error Handler<a class="headerlink" href="#registering-an-error-handler" title="Permalink to this headline">¶</a></h5>
<p>At that point views can raise that error, but it would immediately result
in an internal server error.  The reason for this is that there is no
handler registered for this error class.  That however is easy to add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">InvalidUsage</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_invalid_usage</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
    <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">status_code</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
</div>
<div class="section" id="usage-in-views">
<h5>Usage in Views<a class="headerlink" href="#usage-in-views" title="Permalink to this headline">¶</a></h5>
<p>Here is how a view can use that functionality:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_foo</span><span class="p">():</span>
    <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="s1">&#39;This view is gone&#39;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">410</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/urlprocessors"></span><div class="section" id="using-url-processors">
<h4>Using URL Processors<a class="headerlink" href="#using-url-processors" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details><p>Flask 0.7 introduces the concept of URL processors.  The idea is that you
might have a bunch of resources with common parts in the URL that you
don’t always explicitly want to provide.  For instance you might have a
bunch of URLs that have the language code in it but you don’t want to have
to handle it in every single function yourself.</p>
<p>URL processors are especially helpful when combined with blueprints.  We
will handle both application specific URL processors here as well as
blueprint specifics.</p>
<div class="section" id="internationalized-application-urls">
<h5>Internationalized Application URLs<a class="headerlink" href="#internationalized-application-urls" title="Permalink to this headline">¶</a></h5>
<p>Consider an application like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">g</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;lang_code&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">lang_code</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span> <span class="o">=</span> <span class="n">lang_code</span>
    <span class="o">...</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;lang_code&gt;/about&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="n">lang_code</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span> <span class="o">=</span> <span class="n">lang_code</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This is an awful lot of repetition as you have to handle the language code
setting on the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> object yourself in every single function.
Sure, a decorator could be used to simplify this, but if you want to
generate URLs from one function to another you would have to still provide
the language code explicitly which can be annoying.</p>
<p>For the latter, this is where <a class="reference internal" href="index.html#flask.Flask.url_defaults" title="flask.Flask.url_defaults"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_defaults()</span></code></a> functions
come in.  They can automatically inject values into a call for
<a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> automatically.  The code below checks if the
language code is not yet in the dictionary of URL values and if the
endpoint wants a value named <code class="docutils literal notranslate"><span class="pre">'lang_code'</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">url_defaults</span>
<span class="k">def</span> <span class="nf">add_language_code</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;lang_code&#39;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">is_endpoint_expecting</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="s1">&#39;lang_code&#39;</span><span class="p">):</span>
        <span class="n">values</span><span class="p">[</span><span class="s1">&#39;lang_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span>
</pre></div>
</div>
<p>The method <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Map.is_endpoint_expecting" title="(in Werkzeug v1.0.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_endpoint_expecting()</span></code></a> of the URL
map can be used to figure out if it would make sense to provide a language
code for the given endpoint.</p>
<p>The reverse of that function are
<a class="reference internal" href="index.html#flask.Flask.url_value_preprocessor" title="flask.Flask.url_value_preprocessor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_value_preprocessor()</span></code></a>s.  They are executed right
after the request was matched and can execute code based on the URL
values.  The idea is that they pull information out of the values
dictionary and put it somewhere else:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">url_value_preprocessor</span>
<span class="k">def</span> <span class="nf">pull_lang_code</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lang_code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>That way you no longer have to do the <cite>lang_code</cite> assignment to
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> in every function.  You can further improve that by
writing your own decorator that prefixes URLs with the language code, but
the more beautiful solution is using a blueprint.  Once the
<code class="docutils literal notranslate"><span class="pre">'lang_code'</span></code> is popped from the values dictionary and it will no longer
be forwarded to the view function reducing the code to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">g</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">url_defaults</span>
<span class="k">def</span> <span class="nf">add_language_code</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;lang_code&#39;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">is_endpoint_expecting</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="s1">&#39;lang_code&#39;</span><span class="p">):</span>
        <span class="n">values</span><span class="p">[</span><span class="s1">&#39;lang_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">url_value_preprocessor</span>
<span class="k">def</span> <span class="nf">pull_lang_code</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lang_code&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;lang_code&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="o">...</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;lang_code&gt;/about&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="internationalized-blueprint-urls">
<h5>Internationalized Blueprint URLs<a class="headerlink" href="#internationalized-blueprint-urls" title="Permalink to this headline">¶</a></h5>
<p>Because blueprints can automatically prefix all URLs with a common string
it’s easy to automatically do that for every function.  Furthermore
blueprints can have per-blueprint URL processors which removes a whole lot
of logic from the <a class="reference internal" href="index.html#flask.Flask.url_defaults" title="flask.Flask.url_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_defaults()</span></code></a> function because it no
longer has to check if the URL is really interested in a <code class="docutils literal notranslate"><span class="pre">'lang_code'</span></code>
parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">g</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;frontend&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/&lt;lang_code&gt;&#39;</span><span class="p">)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">url_defaults</span>
<span class="k">def</span> <span class="nf">add_language_code</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">values</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;lang_code&#39;</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span><span class="p">)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">url_value_preprocessor</span>
<span class="k">def</span> <span class="nf">pull_lang_code</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">lang_code</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lang_code&#39;</span><span class="p">)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="o">...</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/distribute"></span><div class="section" id="deploying-with-setuptools">
<span id="distribute-deployment"></span><h4>Deploying with Setuptools<a class="headerlink" href="#deploying-with-setuptools" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://pythonhosted.org/setuptools">Setuptools</a>, is an extension library that is commonly used to
distribute Python libraries and extensions. It extends distutils, a basic
module installation system shipped with Python to also support various more
complex constructs that make larger applications easier to distribute:</p>
<ul class="simple">
<li><p><strong>support for dependencies</strong>: a library or application can declare a
list of other libraries it depends on which will be installed
automatically for you.</p></li>
<li><p><strong>package registry</strong>: setuptools registers your package with your
Python installation.  This makes it possible to query information
provided by one package from another package.  The best known feature of
this system is the entry point support which allows one package to
declare an “entry point” that another package can hook into to extend the
other package.</p></li>
<li><p><strong>installation manager</strong>: <strong class="command">pip</strong> can install other libraries for you.</p></li>
</ul>
<p>If you have Python 2 (&gt;=2.7.9) or Python 3 (&gt;=3.4) installed from python.org,
you will already have pip and setuptools on your system.  Otherwise, you
will need to install them yourself.</p>
<p>Flask itself, and all the libraries you can find on PyPI are distributed with
either setuptools or distutils.</p>
<p>In this case we assume your application is called
<code class="file docutils literal notranslate"><span class="pre">yourapplication.py</span></code> and you are not using a module, but a <a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">package</span></a>. If you have not yet converted your application into
a package, head over to the <a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">Larger Applications</span></a> pattern to see
how this can be done.</p>
<p>A working deployment with setuptools is the first step into more complex
and more automated deployment scenarios.  If you want to fully automate
the process, also read the <a class="reference internal" href="index.html#fabric-deployment"><span class="std std-ref">Deploying with Fabric</span></a> chapter.</p>
<div class="section" id="basic-setup-script">
<h5>Basic Setup Script<a class="headerlink" href="#basic-setup-script" title="Permalink to this headline">¶</a></h5>
<p>Because you have Flask installed, you have setuptools available on your system.
Flask already depends upon setuptools.</p>
<p>Standard disclaimer applies: <a class="reference internal" href="index.html#virtualenv"><span class="std std-ref">you better use a virtualenv</span></a>.</p>
<p>Your setup code always goes into a file named <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> next to your
application.  The name of the file is only convention, but because
everybody will look for a file with that name, you better not change it.</p>
<p>A basic <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file for a Flask application looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Your Application&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yourapplication&#39;</span><span class="p">],</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Flask&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Please keep in mind that you have to list subpackages explicitly.  If you
want setuptools to lookup the packages for you automatically, you can use
the <code class="docutils literal notranslate"><span class="pre">find_packages</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Most parameters to the <code class="docutils literal notranslate"><span class="pre">setup</span></code> function should be self explanatory,
<code class="docutils literal notranslate"><span class="pre">include_package_data</span></code> and <code class="docutils literal notranslate"><span class="pre">zip_safe</span></code> might not be.
<code class="docutils literal notranslate"><span class="pre">include_package_data</span></code> tells setuptools to look for a <code class="file docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> file
and install all the entries that match as package data.  We will use this
to distribute the static files and templates along with the Python module
(see <a class="reference internal" href="#distributing-resources"><span class="std std-ref">Distributing Resources</span></a>).  The <code class="docutils literal notranslate"><span class="pre">zip_safe</span></code> flag can be used to
force or prevent zip Archive creation.  In general you probably don’t want
your packages to be installed as zip files because some tools do not
support them and they make debugging a lot harder.</p>
</div>
<div class="section" id="tagging-builds">
<h5>Tagging Builds<a class="headerlink" href="#tagging-builds" title="Permalink to this headline">¶</a></h5>
<p>It is useful to distinguish between release and development builds.  Add a
<code class="file docutils literal notranslate"><span class="pre">setup.cfg</span></code> file to configure these options.</p>
<blockquote>
<div><p>[egg_info]
tag_build = .dev
tag_date = 1</p>
<p>[aliases]
release = egg_info -RDb ‘’</p>
</div></blockquote>
<p>Running <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">sdist</span></code> will create a development package
with “.dev” and the current date appended: <code class="docutils literal notranslate"><span class="pre">flaskr-1.0.dev20160314.tar.gz</span></code>.
Running <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">release</span> <span class="pre">sdist</span></code> will create a release package
with only the version: <code class="docutils literal notranslate"><span class="pre">flaskr-1.0.tar.gz</span></code>.</p>
</div>
<div class="section" id="distributing-resources">
<span id="id1"></span><h5>Distributing Resources<a class="headerlink" href="#distributing-resources" title="Permalink to this headline">¶</a></h5>
<p>If you try to install the package you just created, you will notice that
folders like <code class="file docutils literal notranslate"><span class="pre">static</span></code> or <code class="file docutils literal notranslate"><span class="pre">templates</span></code> are not installed for you.  The
reason for this is that setuptools does not know which files to add for
you.  What you should do, is to create a <code class="file docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> file next to your
<code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file.  This file lists all the files that should be added to
your tarball:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recursive</span><span class="o">-</span><span class="n">include</span> <span class="n">yourapplication</span><span class="o">/</span><span class="n">templates</span> <span class="o">*</span>
<span class="n">recursive</span><span class="o">-</span><span class="n">include</span> <span class="n">yourapplication</span><span class="o">/</span><span class="n">static</span> <span class="o">*</span>
</pre></div>
</div>
<p>Don’t forget that even if you enlist them in your <code class="file docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> file, they
won’t be installed for you unless you set the <cite>include_package_data</cite>
parameter of the <code class="docutils literal notranslate"><span class="pre">setup</span></code> function to <code class="docutils literal notranslate"><span class="pre">True</span></code>!</p>
</div>
<div class="section" id="declaring-dependencies">
<h5>Declaring Dependencies<a class="headerlink" href="#declaring-dependencies" title="Permalink to this headline">¶</a></h5>
<p>Dependencies are declared in the <code class="docutils literal notranslate"><span class="pre">install_requires</span></code> parameter as a list.
Each item in that list is the name of a package that should be pulled from
PyPI on installation.  By default it will always use the most recent
version, but you can also provide minimum and maximum version
requirements.  Here some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
    <span class="s1">&#39;Flask&gt;=0.2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SQLAlchemy&gt;=0.6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BrokenPackage&gt;=0.7,&lt;=1.0&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As mentioned earlier, dependencies are pulled from PyPI.  What if you
want to depend on a package that cannot be found on PyPI and won’t be
because it is an internal package you don’t want to share with anyone?
Just do it as if there was a PyPI entry and provide a list of
alternative locations where setuptools should look for tarballs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependency_links</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;http://example.com/yourfiles&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Make sure that page has a directory listing and the links on the page are
pointing to the actual tarballs with their correct filenames as this is
how setuptools will find the files.  If you have an internal company
server that contains the packages, provide the URL to that server.</p>
</div>
<div class="section" id="installing-developing">
<h5>Installing / Developing<a class="headerlink" href="#installing-developing" title="Permalink to this headline">¶</a></h5>
<p>To install your application (ideally into a virtualenv) just run the
<code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> script with the <code class="docutils literal notranslate"><span class="pre">install</span></code> parameter.  It will install your
application into the virtualenv’s site-packages folder and also download
and install all dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py install
</pre></div>
</div>
<p>If you are developing on the package and also want the requirements to be
installed, you can use the <code class="docutils literal notranslate"><span class="pre">develop</span></code> command instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py develop
</pre></div>
</div>
<p>This has the advantage of just installing a link to the site-packages
folder instead of copying the data over.  You can then continue to work on
the code without having to run <code class="docutils literal notranslate"><span class="pre">install</span></code> again after each change.</p>
</div>
</div>
<span id="document-patterns/fabric"></span><div class="section" id="deploying-with-fabric">
<span id="fabric-deployment"></span><h4>Deploying with Fabric<a class="headerlink" href="#deploying-with-fabric" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.fabfile.org/">Fabric</a> is a tool for Python similar to Makefiles but with the ability
to execute commands on a remote server.  In combination with a properly
set up Python package (<a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">Larger Applications</span></a>) and a good concept for
configurations (<a class="reference internal" href="index.html#config"><span class="std std-ref">Configuration Handling</span></a>) it is very easy to deploy Flask
applications to external servers.</p>
<p>Before we get started, here a quick checklist of things we have to ensure
upfront:</p>
<ul class="simple">
<li><p>Fabric 1.0 has to be installed locally.  This tutorial assumes the
latest version of Fabric.</p></li>
<li><p>The application already has to be a package and requires a working
<code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file (<a class="reference internal" href="index.html#distribute-deployment"><span class="std std-ref">Deploying with Setuptools</span></a>).</p></li>
<li><p>In the following example we are using <cite>mod_wsgi</cite> for the remote
servers.  You can of course use your own favourite server there, but
for this example we chose Apache + <cite>mod_wsgi</cite> because it’s very easy
to setup and has a simple way to reload applications without root
access.</p></li>
</ul>
<div class="section" id="creating-the-first-fabfile">
<h5>Creating the first Fabfile<a class="headerlink" href="#creating-the-first-fabfile" title="Permalink to this headline">¶</a></h5>
<p>A fabfile is what controls what Fabric executes.  It is named <code class="file docutils literal notranslate"><span class="pre">fabfile.py</span></code>
and executed by the <cite>fab</cite> command.  All the functions defined in that file
will show up as <cite>fab</cite> subcommands.  They are executed on one or more
hosts.  These hosts can be defined either in the fabfile or on the command
line.  In this case we will add them to the fabfile.</p>
<p>This is a basic first example that has the ability to upload the current
source code to the server and install it into a pre-existing
virtual environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="k">import</span> <span class="o">*</span>

<span class="c1"># the user to use for the remote commands</span>
<span class="n">env</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;appuser&#39;</span>
<span class="c1"># the servers where the commands are executed</span>
<span class="n">env</span><span class="o">.</span><span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;server1.example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;server2.example.com&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">pack</span><span class="p">():</span>
    <span class="c1"># build the package</span>
    <span class="n">local</span><span class="p">(</span><span class="s1">&#39;python setup.py sdist --formats=gztar&#39;</span><span class="p">,</span> <span class="n">capture</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">deploy</span><span class="p">():</span>
    <span class="c1"># figure out the package name and version</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">local</span><span class="p">(</span><span class="s1">&#39;python setup.py --fullname&#39;</span><span class="p">,</span> <span class="n">capture</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.tar.gz&#39;</span> <span class="o">%</span> <span class="n">dist</span>

    <span class="c1"># upload the package to the temporary folder on the server</span>
    <span class="n">put</span><span class="p">(</span><span class="s1">&#39;dist/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;/tmp/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># install the package in the application&#39;s virtualenv with pip</span>
    <span class="n">run</span><span class="p">(</span><span class="s1">&#39;/var/www/yourapplication/env/bin/pip install /tmp/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># remove the uploaded package</span>
    <span class="n">run</span><span class="p">(</span><span class="s1">&#39;rm -r /tmp/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># touch the .wsgi file to trigger a reload in mod_wsgi</span>
    <span class="n">run</span><span class="p">(</span><span class="s1">&#39;touch /var/www/yourapplication.wsgi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="running-fabfiles">
<h5>Running Fabfiles<a class="headerlink" href="#running-fabfiles" title="Permalink to this headline">¶</a></h5>
<p>Now how do you execute that fabfile?  You use the <cite>fab</cite> command.  To
deploy the current version of the code on the remote server you would use
this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fab pack deploy
</pre></div>
</div>
<p>However this requires that our server already has the
<code class="file docutils literal notranslate"><span class="pre">/var/www/yourapplication</span></code> folder created and
<code class="file docutils literal notranslate"><span class="pre">/var/www/yourapplication/env</span></code> to be a virtual environment.  Furthermore
are we not creating the configuration or <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file on the server.  So
how do we bootstrap a new server into our infrastructure?</p>
<p>This now depends on the number of servers we want to set up.  If we just
have one application server (which the majority of applications will
have), creating a command in the fabfile for this is overkill.  But
obviously you can do that.  In that case you would probably call it
<cite>setup</cite> or <cite>bootstrap</cite> and then pass the servername explicitly on the
command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fab -H newserver.example.com bootstrap
</pre></div>
</div>
<p>To setup a new server you would roughly do these steps:</p>
<ol class="arabic">
<li><p>Create the directory structure in <code class="file docutils literal notranslate"><span class="pre">/var/www</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir /var/www/yourapplication
$ cd /var/www/yourapplication
$ virtualenv --distribute env
</pre></div>
</div>
</li>
<li><p>Upload a new <code class="file docutils literal notranslate"><span class="pre">application.wsgi</span></code> file to the server and the
configuration file for the application (eg: <code class="file docutils literal notranslate"><span class="pre">application.cfg</span></code>)</p></li>
<li><p>Create a new Apache config for <code class="docutils literal notranslate"><span class="pre">yourapplication</span></code> and activate it.
Make sure to activate watching for changes of the <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file so
that we can automatically reload the application by touching it.
(See <a class="reference internal" href="index.html#mod-wsgi-deployment"><span class="std std-ref">mod_wsgi (Apache)</span></a> for more information)</p></li>
</ol>
<p>So now the question is, where do the <code class="file docutils literal notranslate"><span class="pre">application.wsgi</span></code> and
<code class="file docutils literal notranslate"><span class="pre">application.cfg</span></code> files come from?</p>
</div>
<div class="section" id="the-wsgi-file">
<h5>The WSGI File<a class="headerlink" href="#the-wsgi-file" title="Permalink to this headline">¶</a></h5>
<p>The WSGI file has to import the application and also to set an environment
variable so that the application knows where to look for the config.  This
is a short example that does exactly that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;YOURAPPLICATION_CONFIG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/var/www/yourapplication/application.cfg&#39;</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>
</pre></div>
</div>
<p>The application itself then has to initialize itself like this to look for
the config at that environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_config&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_CONFIG&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This approach is explained in detail in the <a class="reference internal" href="index.html#config"><span class="std std-ref">Configuration Handling</span></a> section of the
documentation.</p>
</div>
<div class="section" id="the-configuration-file">
<h5>The Configuration File<a class="headerlink" href="#the-configuration-file" title="Permalink to this headline">¶</a></h5>
<p>Now as mentioned above, the application will find the correct
configuration file by looking up the <code class="docutils literal notranslate"><span class="pre">YOURAPPLICATION_CONFIG</span></code> environment
variable.  So we have to put the configuration in a place where the
application will able to find it.  Configuration files have the unfriendly
quality of being different on all computers, so you do not version them
usually.</p>
<p>A popular approach is to store configuration files for different servers
in a separate version control repository and check them out on all
servers.  Then symlink the file that is active for the server into the
location where it’s expected (eg: <code class="file docutils literal notranslate"><span class="pre">/var/www/yourapplication</span></code>).</p>
<p>Either way, in our case here we only expect one or two servers and we can
upload them ahead of time by hand.</p>
</div>
<div class="section" id="first-deployment">
<h5>First Deployment<a class="headerlink" href="#first-deployment" title="Permalink to this headline">¶</a></h5>
<p>Now we can do our first deployment.  We have set up the servers so that
they have their virtual environments and activated apache configs.  Now we
can pack up the application and deploy it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ fab pack deploy
</pre></div>
</div>
<p>Fabric will now connect to all servers and run the commands as written
down in the fabfile.  First it will execute pack so that we have our
tarball ready and then it will execute deploy and upload the source code
to all servers and install it there.  Thanks to the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file we
will automatically pull in the required libraries into our virtual
environment.</p>
</div>
<div class="section" id="next-steps">
<h5>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h5>
<p>From that point onwards there is so much that can be done to make
deployment actually fun:</p>
<ul class="simple">
<li><p>Create a <cite>bootstrap</cite> command that initializes new servers.  It could
initialize a new virtual environment, setup apache appropriately etc.</p></li>
<li><p>Put configuration files into a separate version control repository
and symlink the active configs into place.</p></li>
<li><p>You could also put your application code into a repository and check
out the latest version on the server and then install.  That way you
can also easily go back to older versions.</p></li>
<li><p>hook in testing functionality so that you can deploy to an external
server and run the test suite.</p></li>
</ul>
<p>Working with Fabric is fun and you will notice that it’s quite magical to
type <code class="docutils literal notranslate"><span class="pre">fab</span> <span class="pre">deploy</span></code> and see your application being deployed automatically
to one or more remote servers.</p>
</div>
</div>
<span id="document-patterns/sqlite3"></span><div class="section" id="using-sqlite-3-with-flask">
<span id="sqlite3"></span><h4>Using SQLite 3 with Flask<a class="headerlink" href="#using-sqlite-3-with-flask" title="Permalink to this headline">¶</a></h4>
<p>In Flask you can easily implement the opening of database connections on
demand and closing them when the context dies (usually at the end of the
request).</p>
<p>Here is a simple example of how you can use SQLite 3 with Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">g</span>

<span class="n">DATABASE</span> <span class="o">=</span> <span class="s1">&#39;/path/to/database.db&#39;</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DATABASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, to use the database, the application must either have an active
application context (which is always true if there is a request in flight)
or create an application context itself.  At that point the <code class="docutils literal notranslate"><span class="pre">get_db</span></code>
function can be used to get the current database connection.  Whenever the
context is destroyed the database connection will be terminated.</p>
<p>Note: if you use Flask 0.9 or older you need to use
<code class="docutils literal notranslate"><span class="pre">flask._app_ctx_stack.top</span></code> instead of <code class="docutils literal notranslate"><span class="pre">g</span></code> as the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a>
object was bound to the request and not application context.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please keep in mind that the teardown request and appcontext functions
are always executed, even if a before-request handler failed or was
never executed.  Because of this we have to make sure here that the
database is there before we close it.</p>
</div>
<div class="section" id="connect-on-demand">
<h5>Connect on Demand<a class="headerlink" href="#connect-on-demand" title="Permalink to this headline">¶</a></h5>
<p>The upside of this approach (connecting on first use) is that this will
only open the connection if truly necessary.  If you want to use this
code outside a request context you can use it in a Python shell by opening
the application context by hand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="c1"># now you can use get_db()</span>
</pre></div>
</div>
</div>
<div class="section" id="easy-querying">
<span id="id1"></span><h5>Easy Querying<a class="headerlink" href="#easy-querying" title="Permalink to this headline">¶</a></h5>
<p>Now in each request handling function you can access <cite>g.db</cite> to get the
current open database connection.  To simplify working with SQLite, a
row factory function is useful.  It is executed for every result returned
from the database to convert the result.  For instance, in order to get
dictionaries instead of tuples, this could be inserted into the <code class="docutils literal notranslate"><span class="pre">get_db</span></code>
function we created above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_dicts</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>

<span class="n">db</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">make_dicts</span>
</pre></div>
</div>
<p>This will make the sqlite3 module return dicts for this database connection, which are much nicer to deal with. Even more simply, we could place this in <code class="docutils literal notranslate"><span class="pre">get_db</span></code> instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
</pre></div>
</div>
<p>This would use Row objects rather than dicts to return the results of queries. These are <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> s, so we can access them either by index or by key. For example, assuming we have a <code class="docutils literal notranslate"><span class="pre">sqlite3.Row</span></code> called <code class="docutils literal notranslate"><span class="pre">r</span></code> for the rows <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">FirstName</span></code>, <code class="docutils literal notranslate"><span class="pre">LastName</span></code>, and <code class="docutils literal notranslate"><span class="pre">MiddleInitial</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># You can get values based on the row&#39;s name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;FirstName&#39;</span><span class="p">]</span>
<span class="go">John</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Or, you can get them based on index</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">John</span>
<span class="go"># Row objects are also iterable:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="go">1</span>
<span class="go">John</span>
<span class="go">Doe</span>
<span class="go">M</span>
</pre></div>
</div>
<p>Additionally, it is a good idea to provide a query function that combines
getting the cursor, executing and fetching the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">one</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">rv</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">one</span> <span class="k">else</span> <span class="n">rv</span>
</pre></div>
</div>
<p>This handy little function, in combination with a row factory, makes
working with the database much more pleasant than it is by just using the
raw cursor and connection objects.</p>
<p>Here is how you can use it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">query_db</span><span class="p">(</span><span class="s1">&#39;select * from users&#39;</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="s1">&#39;has the id&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Or if you just want a single result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="s1">&#39;select * from users where username = ?&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">the_username</span><span class="p">],</span> <span class="n">one</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;No such user&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">the_username</span><span class="p">,</span> <span class="s1">&#39;has the id&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>To pass variable parts to the SQL statement, use a question mark in the
statement and pass in the arguments as a list.  Never directly add them to
the SQL statement with string formatting because this makes it possible
to attack the application using <a class="reference external" href="http://en.wikipedia.org/wiki/SQL_injection">SQL Injections</a>.</p>
</div>
<div class="section" id="initial-schemas">
<h5>Initial Schemas<a class="headerlink" href="#initial-schemas" title="Permalink to this headline">¶</a></h5>
<p>Relational databases need schemas, so applications often ship a
<cite>schema.sql</cite> file that creates the database.  It’s a good idea to provide
a function that creates the database based on that schema.  This function
can do that for you:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>You can then create such a database from the Python shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">init_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init_db</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/sqlalchemy"></span><div class="section" id="sqlalchemy-in-flask">
<span id="sqlalchemy-pattern"></span><h4>SQLAlchemy in Flask<a class="headerlink" href="#sqlalchemy-in-flask" title="Permalink to this headline">¶</a></h4>
<p>Many people prefer <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a> for database access.  In this case it’s
encouraged to use a package instead of a module for your flask application
and drop the models into a separate module (<a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">Larger Applications</span></a>).
While that is not necessary, it makes a lot of sense.</p>
<p>There are four very common ways to use SQLAlchemy.  I will outline each
of them here:</p>
<div class="section" id="flask-sqlalchemy-extension">
<h5>Flask-SQLAlchemy Extension<a class="headerlink" href="#flask-sqlalchemy-extension" title="Permalink to this headline">¶</a></h5>
<p>Because SQLAlchemy is a common database abstraction layer and object
relational mapper that requires a little bit of configuration effort,
there is a Flask extension that handles that for you.  This is recommended
if you want to get started quickly.</p>
<p>You can download <a class="reference external" href="http://pythonhosted.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a> from <a class="reference external" href="https://pypi.org/project/Flask-SQLAlchemy/">PyPI</a>.</p>
</div>
<div class="section" id="declarative">
<h5>Declarative<a class="headerlink" href="#declarative" title="Permalink to this headline">¶</a></h5>
<p>The declarative extension in SQLAlchemy is the most recent method of using
SQLAlchemy.  It allows you to define tables and models in one go, similar
to how Django works.  In addition to the following text I recommend the
official documentation on the <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/">declarative</a> extension.</p>
<p>Here’s the example <code class="file docutils literal notranslate"><span class="pre">database.py</span></code> module for your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////tmp/test.db&#39;</span><span class="p">,</span> <span class="n">convert_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">db_session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">))</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">Base</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query_property</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="c1"># import all modules here that might define models so that</span>
    <span class="c1"># they will be registered properly on the metadata.  Otherwise</span>
    <span class="c1"># you will have to import them first before calling init_db()</span>
    <span class="kn">import</span> <span class="nn">yourapplication.models</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>To define your models, just subclass the <cite>Base</cite> class that was created by
the code above.  If you are wondering why we don’t have to care about
threads here (like we did in the SQLite3 example above with the
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> object): that’s because SQLAlchemy does that for us
already with the <code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code>.</p>
<p>To use SQLAlchemy in a declarative way with your application, you just
have to put the following code into your application module.  Flask will
automatically remove database sessions at the end of the request or
when the application shuts down:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">db_session</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">shutdown_session</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">db_session</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is an example model (put this into <code class="file docutils literal notranslate"><span class="pre">models.py</span></code>, e.g.):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">Base</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;User </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>To create the database you can use the <cite>init_db</cite> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">init_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init_db</span><span class="p">()</span>
</pre></div>
</div>
<p>You can insert entries into the database like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">db_session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.models</span> <span class="k">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin@localhost&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Querying is simple as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;User u&#39;admin&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="go">&lt;User u&#39;admin&#39;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="manual-object-relational-mapping">
<h5>Manual Object Relational Mapping<a class="headerlink" href="#manual-object-relational-mapping" title="Permalink to this headline">¶</a></h5>
<p>Manual object relational mapping has a few upsides and a few downsides
versus the declarative approach from above.  The main difference is that
you define tables and classes separately and map them together.  It’s more
flexible but a little more to type.  In general it works like the
declarative approach, so make sure to also split up your application into
multiple modules in a package.</p>
<p>Here is an example <code class="file docutils literal notranslate"><span class="pre">database.py</span></code> module for your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">MetaData</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">sessionmaker</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////tmp/test.db&#39;</span><span class="p">,</span> <span class="n">convert_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">db_session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>As in the declarative approach, you need to close the session after
each request or application context shutdown.  Put this into your
application module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">db_session</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">shutdown_session</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">db_session</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is an example table and model (put this into <code class="file docutils literal notranslate"><span class="pre">models.py</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">mapper</span>
<span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">db_session</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query_property</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;User </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
</pre></div>
</div>
<p>Querying and inserting works exactly the same as in the example above.</p>
</div>
<div class="section" id="sql-abstraction-layer">
<h5>SQL Abstraction Layer<a class="headerlink" href="#sql-abstraction-layer" title="Permalink to this headline">¶</a></h5>
<p>If you just want to use the database system (and SQL) abstraction layer
you basically only need the engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Table</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////tmp/test.db&#39;</span><span class="p">,</span> <span class="n">convert_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you can either declare the tables in your code like in the examples
above, or automatically load them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Table</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To insert data you can use the <cite>insert</cite> method.  We have to get a
connection first so that we can use a transaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;admin@localhost&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>SQLAlchemy will automatically commit for us.</p>
<p>To query your database, you use the engine directly or use a connection:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="go">(1, u&#39;admin&#39;, u&#39;admin@localhost&#39;)</span>
</pre></div>
</div>
<p>These results are also dict-like tuples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="go">u&#39;admin&#39;</span>
</pre></div>
</div>
<p>You can also pass strings of SQL statements to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from users where id = :1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="go">(1, u&#39;admin&#39;, u&#39;admin@localhost&#39;)</span>
</pre></div>
</div>
<p>For more information about SQLAlchemy, head over to the
<a class="reference external" href="http://www.sqlalchemy.org/">website</a>.</p>
</div>
</div>
<span id="document-patterns/fileuploads"></span><div class="section" id="uploading-files">
<span id="id1"></span><h4>Uploading Files<a class="headerlink" href="#uploading-files" title="Permalink to this headline">¶</a></h4>
<p>Ah yes, the good old problem of file uploads.  The basic idea of file
uploads is actually quite simple.  It basically works like this:</p>
<ol class="arabic simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> tag is marked with <code class="docutils literal notranslate"><span class="pre">enctype=multipart/form-data</span></code>
and an <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=file&gt;</span></code> is placed in that form.</p></li>
<li><p>The application accesses the file from the <code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code>
dictionary on the request object.</p></li>
<li><p>use the <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage.save" title="(in Werkzeug v1.0.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> method of the file to save
the file permanently somewhere on the filesystem.</p></li>
</ol>
<div class="section" id="a-gentle-introduction">
<h5>A Gentle Introduction<a class="headerlink" href="#a-gentle-introduction" title="Permalink to this headline">¶</a></h5>
<p>Let’s start with a very basic application that uploads a file to a
specific upload folder and displays a file to the user.  Let’s look at the
bootstrapping code for our application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="k">import</span> <span class="n">secure_filename</span>

<span class="n">UPLOAD_FOLDER</span> <span class="o">=</span> <span class="s1">&#39;/path/to/the/uploads&#39;</span>
<span class="n">ALLOWED_EXTENSIONS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;gif&#39;</span><span class="p">])</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UPLOAD_FOLDER</span>
</pre></div>
</div>
<p>So first we need a couple of imports.  Most should be straightforward, the
<code class="xref py py-func docutils literal notranslate"><span class="pre">werkzeug.secure_filename()</span></code> is explained a little bit later.  The
<code class="docutils literal notranslate"><span class="pre">UPLOAD_FOLDER</span></code> is where we will store the uploaded files and the
<code class="docutils literal notranslate"><span class="pre">ALLOWED_EXTENSIONS</span></code> is the set of allowed file extensions.</p>
<p>Why do we limit the extensions that are allowed?  You probably don’t want
your users to be able to upload everything there if the server is directly
sending out the data to the client.  That way you can make sure that users
are not able to upload HTML files that would cause XSS problems (see
<a class="reference internal" href="index.html#xss"><span class="std std-ref">Cross-Site Scripting (XSS)</span></a>).  Also make sure to disallow <code class="docutils literal notranslate"><span class="pre">.php</span></code> files if the server
executes them, but who has PHP installed on their server, right?  :)</p>
<p>Next the functions that check if an extension is valid and that uploads
the file and redirects the user to the URL for the uploaded file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">allowed_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">and</span> \
           <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ALLOWED_EXTENSIONS</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># check if the post request has the file part</span>
        <span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No file part&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
        <span class="c1"># if user does not select file, browser also</span>
        <span class="c1"># submit a empty part without filename</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No selected file&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">allowed_file</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;uploaded_file&#39;</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    &lt;!doctype html&gt;</span>
<span class="s1">    &lt;title&gt;Upload new File&lt;/title&gt;</span>
<span class="s1">    &lt;h1&gt;Upload new File&lt;/h1&gt;</span>
<span class="s1">    &lt;form method=post enctype=multipart/form-data&gt;</span>
<span class="s1">      &lt;p&gt;&lt;input type=file name=file&gt;</span>
<span class="s1">         &lt;input type=submit value=Upload&gt;</span>
<span class="s1">    &lt;/form&gt;</span>
<span class="s1">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>So what does that <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/utils/#werkzeug.utils.secure_filename" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">secure_filename()</span></code></a> function actually do?
Now the problem is that there is that principle called “never trust user
input”.  This is also true for the filename of an uploaded file.  All
submitted form data can be forged, and filenames can be dangerous.  For
the moment just remember: always use that function to secure a filename
before storing it directly on the filesystem.</p>
<div class="admonition-information-for-the-pros admonition">
<p class="admonition-title">Information for the Pros</p>
<p>So you’re interested in what that <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/utils/#werkzeug.utils.secure_filename" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">secure_filename()</span></code></a>
function does and what the problem is if you’re not using it?  So just
imagine someone would send the following information as <cite>filename</cite> to
your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;../../../../home/username/.bashrc&quot;</span>
</pre></div>
</div>
<p>Assuming the number of <code class="docutils literal notranslate"><span class="pre">../</span></code> is correct and you would join this with
the <code class="docutils literal notranslate"><span class="pre">UPLOAD_FOLDER</span></code> the user might have the ability to modify a file on
the server’s filesystem he or she should not modify.  This does require some
knowledge about how the application looks like, but trust me, hackers
are patient :)</p>
<p>Now let’s look how that function works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">secure_filename</span><span class="p">(</span><span class="s1">&#39;../../../../home/username/.bashrc&#39;</span><span class="p">)</span>
<span class="go">&#39;home_username_.bashrc&#39;</span>
</pre></div>
</div>
</div>
<p>Now one last thing is missing: the serving of the uploaded files. In the
<code class="xref py py-func docutils literal notranslate"><span class="pre">upload_file()</span></code> we redirect the user to
<code class="docutils literal notranslate"><span class="pre">url_for('uploaded_file',</span> <span class="pre">filename=filename)</span></code>, that is, <code class="docutils literal notranslate"><span class="pre">/uploads/filename</span></code>.
So we write the <code class="xref py py-func docutils literal notranslate"><span class="pre">uploaded_file()</span></code> function to return the file of that name. As
of Flask 0.5 we can use a function that does that for us:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">send_from_directory</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploads/&lt;filename&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">uploaded_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span>
                               <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively you can register <cite>uploaded_file</cite> as <cite>build_only</cite> rule and
use the <code class="xref py py-class docutils literal notranslate"><span class="pre">SharedDataMiddleware</span></code>.  This also works with
older versions of Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="k">import</span> <span class="n">SharedDataMiddleware</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/uploads/&lt;filename&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;uploaded_file&#39;</span><span class="p">,</span>
                 <span class="n">build_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">SharedDataMiddleware</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;/uploads&#39;</span><span class="p">:</span>  <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
<p>If you now run the application everything should work as expected.</p>
</div>
<div class="section" id="improving-uploads">
<h5>Improving Uploads<a class="headerlink" href="#improving-uploads" title="Permalink to this headline">¶</a></h5>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details><p>So how exactly does Flask handle uploads?  Well it will store them in the
webserver’s memory if the files are reasonable small otherwise in a
temporary location (as returned by <a class="reference external" href="https://docs.python.org/3/library/tempfile.html#tempfile.gettempdir" title="(in Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.gettempdir()</span></code></a>).  But how
do you specify the maximum file size after which an upload is aborted?  By
default Flask will happily accept file uploads to an unlimited amount of
memory, but you can limit that by setting the <code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code>
config key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MAX_CONTENT_LENGTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
</pre></div>
</div>
<p>The code above will limited the maximum allowed payload to 16 megabytes.
If a larger file is transmitted, Flask will raise an
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.RequestEntityTooLarge" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RequestEntityTooLarge</span></code></a> exception.</p>
<p>This feature was added in Flask 0.6 but can be achieved in older versions
as well by subclassing the request object.  For more information on that
consult the Werkzeug documentation on file handling.</p>
</div>
<div class="section" id="upload-progress-bars">
<h5>Upload Progress Bars<a class="headerlink" href="#upload-progress-bars" title="Permalink to this headline">¶</a></h5>
<p>A while ago many developers had the idea to read the incoming file in
small chunks and store the upload progress in the database to be able to
poll the progress with JavaScript from the client.  Long story short: the
client asks the server every 5 seconds how much it has transmitted
already.  Do you realize the irony?  The client is asking for something it
should already know.</p>
</div>
<div class="section" id="an-easier-solution">
<h5>An Easier Solution<a class="headerlink" href="#an-easier-solution" title="Permalink to this headline">¶</a></h5>
<p>Now there are better solutions that work faster and are more reliable. There
are JavaScript libraries like <a class="reference external" href="https://jquery.com/">jQuery</a> that have form plugins to ease the
construction of progress bar.</p>
<p>Because the common pattern for file uploads exists almost unchanged in all
applications dealing with uploads, there is also a Flask extension called
<a class="reference external" href="http://pythonhosted.org/Flask-Uploads/">Flask-Uploads</a> that implements a full fledged upload mechanism with white and
blacklisting of extensions and more.</p>
</div>
</div>
<span id="document-patterns/caching"></span><div class="section" id="caching">
<span id="caching-pattern"></span><h4>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h4>
<p>When your application runs slow, throw some caches in.  Well, at least
it’s the easiest way to speed up things.  What does a cache do?  Say you
have a function that takes some time to complete but the results would
still be good enough if they were 5 minutes old.  So then the idea is that
you actually put the result of that calculation into a cache for some
time.</p>
<p>Flask itself does not provide caching for you, but Werkzeug, one of the
libraries it is based on, has some very basic cache support.  It supports
multiple cache backends, normally you want to use a memcached server.</p>
<div class="section" id="setting-up-a-cache">
<h5>Setting up a Cache<a class="headerlink" href="#setting-up-a-cache" title="Permalink to this headline">¶</a></h5>
<p>You create a cache object once and keep it around, similar to how
<a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> objects are created.  If you are using the
development server you can create a
<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleCache</span></code> object, that one is a simple
cache that keeps the item stored in the memory of the Python interpreter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.cache</span> <span class="k">import</span> <span class="n">SimpleCache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">SimpleCache</span><span class="p">()</span>
</pre></div>
</div>
<p>If you want to use memcached, make sure to have one of the memcache modules
supported (you get them from <a class="reference external" href="https://pypi.python.org/pypi">PyPI</a>) and a
memcached server running somewhere.  This is how you connect to such an
memcached server then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.cache</span> <span class="k">import</span> <span class="n">MemcachedCache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">MemcachedCache</span><span class="p">([</span><span class="s1">&#39;127.0.0.1:11211&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>If you are using App Engine, you can connect to the App Engine memcache
server easily:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.cache</span> <span class="k">import</span> <span class="n">GAEMemcachedCache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">GAEMemcachedCache</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-cache">
<h5>Using a Cache<a class="headerlink" href="#using-a-cache" title="Permalink to this headline">¶</a></h5>
<p>Now how can one use such a cache?  There are two very important
operations: <code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code>.  This is how to use them:</p>
<p>To get an item from the cache call
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> with a string as key name.
If something is in the cache, it is returned.  Otherwise that function
will return <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rv</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;my-item&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To add items to the cache, use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code>
method instead.  The first argument is the key and the second the value
that should be set.  Also a timeout can be provided after which the cache
will automatically remove item.</p>
<p>Here a full example how this looks like normally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_my_item</span><span class="p">():</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;my-item&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">calculate_value</span><span class="p">()</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;my-item&#39;</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rv</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/viewdecorators"></span><div class="section" id="view-decorators">
<h4>View Decorators<a class="headerlink" href="#view-decorators" title="Permalink to this headline">¶</a></h4>
<p>Python has a really interesting feature called function decorators.  This
allows some really neat things for web applications.  Because each view in
Flask is a function, decorators can be used to inject additional
functionality to one or more functions.  The <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a>
decorator is the one you probably used already.  But there are use cases
for implementing your own decorator.  For instance, imagine you have a
view that should only be used by people that are logged in.  If a user
goes to the site and is not logged in, they should be redirected to the
login page.  This is a good example of a use case where a decorator is an
excellent solution.</p>
<div class="section" id="login-required-decorator">
<h5>Login Required Decorator<a class="headerlink" href="#login-required-decorator" title="Permalink to this headline">¶</a></h5>
<p>So let’s implement such a decorator.  A decorator is a function that
wraps and replaces another function.  Since the original function is
replaced, you need to remember to copy the original function’s information
to the new function.  Use <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.wraps" title="(in Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.wraps()</span></code></a> to handle this for you.</p>
<p>This example assumes that the login page is called <code class="docutils literal notranslate"><span class="pre">'login'</span></code> and that
the current user is stored in <code class="docutils literal notranslate"><span class="pre">g.user</span></code> and is <code class="docutils literal notranslate"><span class="pre">None</span></code> if there is no-one
logged in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>

<span class="k">def</span> <span class="nf">login_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated_function</span>
</pre></div>
</div>
<p>To use the decorator, apply it as innermost decorator to a view function.
When applying further decorators, always remember
that the <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> decorator is the outermost.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/secret_page&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">secret_page</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">next</span></code> value will exist in <code class="docutils literal notranslate"><span class="pre">request.args</span></code> after a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request for
the login page.  You’ll have to pass it along when sending the <code class="docutils literal notranslate"><span class="pre">POST</span></code> request
from the login form.  You can do this with a hidden input tag, then retrieve it
from <code class="docutils literal notranslate"><span class="pre">request.form</span></code> when logging the user in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;{{ request.args.get(&#39;next&#39;, &#39;&#39;) }}&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="caching-decorator">
<h5>Caching Decorator<a class="headerlink" href="#caching-decorator" title="Permalink to this headline">¶</a></h5>
<p>Imagine you have a view function that does an expensive calculation and
because of that you would like to cache the generated results for a
certain amount of time.  A decorator would be nice for that.  We’re
assuming you have set up a cache like mentioned in <a class="reference internal" href="index.html#caching-pattern"><span class="std std-ref">Caching</span></a>.</p>
<p>Here is an example cache function.  It generates the cache key from a
specific prefix (actually a format string) and the current path of the
request.  Notice that we are using a function that first creates the
decorator that then decorates the function.  Sounds awful? Unfortunately
it is a little bit more complex, but the code should still be
straightforward to read.</p>
<p>The decorated function will then work as follows</p>
<ol class="arabic simple">
<li><p>get the unique cache key for the current request base on the current
path.</p></li>
<li><p>get the value for that key from the cache. If the cache returned
something we will return that value.</p></li>
<li><p>otherwise the original function is called and the return value is
stored in the cache for the timeout provided (by default 5 minutes).</p></li>
</ol>
<p>Here the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">def</span> <span class="nf">cached</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;view/</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rv</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rv</span>
        <span class="k">return</span> <span class="n">decorated_function</span>
    <span class="k">return</span> <span class="n">decorator</span>
</pre></div>
</div>
<p>Notice that this assumes an instantiated <cite>cache</cite> object is available, see
<a class="reference internal" href="index.html#caching-pattern"><span class="std std-ref">Caching</span></a> for more information.</p>
</div>
<div class="section" id="templating-decorator">
<h5>Templating Decorator<a class="headerlink" href="#templating-decorator" title="Permalink to this headline">¶</a></h5>
<p>A common pattern invented by the TurboGears guys a while back is a
templating decorator.  The idea of that decorator is that you return a
dictionary with the values passed to the template from the view function
and the template is automatically rendered.  With that, the following
three examples do exactly the same:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@templated</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@templated</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, if no template name is provided it will use the endpoint
of the URL map with dots converted to slashes + <code class="docutils literal notranslate"><span class="pre">'.html'</span></code>.  Otherwise
the provided template name is used.  When the decorated function returns,
the dictionary returned is passed to the template rendering function.  If
<code class="docutils literal notranslate"><span class="pre">None</span></code> is returned, an empty dictionary is assumed, if something else than
a dictionary is returned we return it from the function unchanged.  That
way you can still use the redirect function or return simple strings.</p>
<p>Here is the code for that decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template</span>

<span class="k">def</span> <span class="nf">templated</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="n">template</span>
            <span class="k">if</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">template_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">endpoint</span> \
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ctx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ctx</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">decorated_function</span>
    <span class="k">return</span> <span class="n">decorator</span>
</pre></div>
</div>
</div>
<div class="section" id="endpoint-decorator">
<h5>Endpoint Decorator<a class="headerlink" href="#endpoint-decorator" title="Permalink to this headline">¶</a></h5>
<p>When you want to use the werkzeug routing system for more flexibility you
need to map the endpoint as defined in the <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Rule" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a>
to a view function. This is possible with this decorator. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">werkzeug.routing</span> <span class="k">import</span> <span class="n">Rule</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">endpoint</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello world&quot;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/wtforms"></span><div class="section" id="form-validation-with-wtforms">
<h4>Form Validation with WTForms<a class="headerlink" href="#form-validation-with-wtforms" title="Permalink to this headline">¶</a></h4>
<p>When you have to work with form data submitted by a browser view, code
quickly becomes very hard to read.  There are libraries out there designed
to make this process easier to manage.  One of them is <a class="reference external" href="https://wtforms.readthedocs.io/">WTForms</a> which we
will handle here.  If you find yourself in the situation of having many
forms, you might want to give it a try.</p>
<p>When you are working with WTForms you have to define your forms as classes
first.  I recommend breaking up the application into multiple modules
(<a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">Larger Applications</span></a>) for that and adding a separate module for the
forms.</p>
<div class="admonition-getting-the-most-out-of-wtforms-with-an-extension admonition">
<p class="admonition-title">Getting the most out of WTForms with an Extension</p>
<p>The <a class="reference external" href="http://pythonhosted.org/Flask-WTF/">Flask-WTF</a> extension expands on this pattern and adds a
few little helpers that make working with forms and Flask more
fun.  You can get it from <a class="reference external" href="https://pypi.org/project/Flask-WTF/">PyPI</a>.</p>
</div>
<div class="section" id="the-forms">
<h5>The Forms<a class="headerlink" href="#the-forms" title="Permalink to this headline">¶</a></h5>
<p>This is an example form for a typical registration page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wtforms</span> <span class="k">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">BooleanField</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">PasswordField</span><span class="p">,</span> <span class="n">validators</span>

<span class="k">class</span> <span class="nc">RegistrationForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">25</span><span class="p">)])</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Email Address&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">35</span><span class="p">)])</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">PasswordField</span><span class="p">(</span><span class="s1">&#39;New Password&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">DataRequired</span><span class="p">(),</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s1">&#39;confirm&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Passwords must match&#39;</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">confirm</span> <span class="o">=</span> <span class="n">PasswordField</span><span class="p">(</span><span class="s1">&#39;Repeat Password&#39;</span><span class="p">)</span>
    <span class="n">accept_tos</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="s1">&#39;I accept the TOS&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">DataRequired</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="section" id="in-the-view">
<h5>In the View<a class="headerlink" href="#in-the-view" title="Permalink to this headline">¶</a></h5>
<p>In the view function, the usage of this form looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">RegistrationForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">validate</span><span class="p">():</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                    <span class="n">form</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">db_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Thanks for registering&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;register.html&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice we’re implying that the view is using SQLAlchemy here
(<a class="reference internal" href="index.html#sqlalchemy-pattern"><span class="std std-ref">SQLAlchemy in Flask</span></a>), but that’s not a requirement, of course.  Adapt
the code as necessary.</p>
<p>Things to remember:</p>
<ol class="arabic simple">
<li><p>create the form from the request <code class="xref py py-attr docutils literal notranslate"><span class="pre">form</span></code> value if
the data is submitted via the HTTP <code class="docutils literal notranslate"><span class="pre">POST</span></code> method and
<code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code> if the data is submitted as <code class="docutils literal notranslate"><span class="pre">GET</span></code>.</p></li>
<li><p>to validate the data, call the <code class="xref py py-func docutils literal notranslate"><span class="pre">validate()</span></code>
method, which will return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the data validates, <code class="docutils literal notranslate"><span class="pre">False</span></code>
otherwise.</p></li>
<li><p>to access individual values from the form, access <cite>form.&lt;NAME&gt;.data</cite>.</p></li>
</ol>
</div>
<div class="section" id="forms-in-templates">
<h5>Forms in Templates<a class="headerlink" href="#forms-in-templates" title="Permalink to this headline">¶</a></h5>
<p>Now to the template side.  When you pass the form to the templates, you can
easily render them there.  Look at the following example template to see
how easy this is.  WTForms does half the form generation for us already.
To make it even nicer, we can write a macro that renders a field with
label and a list of errors if there are any.</p>
<p>Here’s an example <code class="file docutils literal notranslate"><span class="pre">_formhelpers.html</span></code> template with such a macro:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">render_field</span><span class="o">(</span><span class="nv">field</span><span class="o">)</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span>
  <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">field</span><span class="o">(**</span><span class="nv">kwargs</span><span class="o">)|</span><span class="nf">safe</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">errors</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This macro accepts a couple of keyword arguments that are forwarded to
WTForm’s field function, which renders the field for us.  The keyword
arguments will be inserted as HTML attributes.  So, for example, you can
call <code class="docutils literal notranslate"><span class="pre">render_field(form.username,</span> <span class="pre">class='username')</span></code> to add a class to
the input element.  Note that WTForms returns standard Python unicode
strings, so we have to tell Jinja2 that this data is already HTML-escaped
with the <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter.</p>
<p>Here is the <code class="file docutils literal notranslate"><span class="pre">register.html</span></code> template for the function we used above, which
takes advantage of the <code class="file docutils literal notranslate"><span class="pre">_formhelpers.html</span></code> template:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">from</span> <span class="s2">&quot;_formhelpers.html&quot;</span> <span class="k">import</span> <span class="nv">render_field</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">render_field</span><span class="o">(</span><span class="nv">form.username</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">render_field</span><span class="o">(</span><span class="nv">form.email</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">render_field</span><span class="o">(</span><span class="nv">form.password</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">render_field</span><span class="o">(</span><span class="nv">form.confirm</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">render_field</span><span class="o">(</span><span class="nv">form.accept_tos</span><span class="o">)</span> <span class="cp">}}</span>
  <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Register</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>For more information about WTForms, head over to the <a class="reference external" href="https://wtforms.readthedocs.io/">WTForms
website</a>.</p>
</div>
</div>
<span id="document-patterns/templateinheritance"></span><div class="section" id="template-inheritance">
<span id="id1"></span><h4>Template Inheritance<a class="headerlink" href="#template-inheritance" title="Permalink to this headline">¶</a></h4>
<p>The most powerful part of Jinja is template inheritance. Template inheritance
allows you to build a base “skeleton” template that contains all the common
elements of your site and defines <strong>blocks</strong> that child templates can override.</p>
<p>Sounds complicated but is very basic. It’s easiest to understand it by starting
with an example.</p>
<div class="section" id="base-template">
<h5>Base Template<a class="headerlink" href="#base-template" title="Permalink to this headline">¶</a></h5>
<p>This template, which we’ll call <code class="file docutils literal notranslate"><span class="pre">layout.html</span></code>, defines a simple HTML skeleton
document that you might use for a simple two-column page. It’s the job of
“child” templates to fill the empty blocks with content:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">head</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;static&#39;</span><span class="o">,</span> <span class="nv">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span> - My Webpage<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;footer&quot;</span><span class="p">&gt;</span>
      <span class="cp">{%</span> <span class="k">block</span> <span class="nv">footer</span> <span class="cp">%}</span>
      <span class="ni">&amp;copy;</span> Copyright 2010 by <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://domain.invalid/&quot;</span><span class="p">&gt;</span>you<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
      <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">%}</span></code> tags define four blocks that child templates
can fill in. All the <cite>block</cite> tag does is tell the template engine that a
child template may override those portions of the template.</p>
</div>
<div class="section" id="child-template">
<h5>Child Template<a class="headerlink" href="#child-template" title="Permalink to this headline">¶</a></h5>
<p>A child template might look like this:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Index<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">head</span> <span class="cp">%}</span>
  <span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span>
  <span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
    <span class="p">.</span><span class="nc">important</span> <span class="p">{</span> <span class="k">color</span><span class="p">:</span> <span class="mh">#336699</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Index<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;important&quot;</span><span class="p">&gt;</span>
    Welcome on my awesome homepage.
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">%}</span></code> tag is the key here. It tells the template engine that
this template “extends” another template.  When the template system evaluates
this template, first it locates the parent.  The extends tag must be the
first tag in the template.  To render the contents of a block defined in
the parent template, use <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">super()</span> <span class="pre">}}</span></code>.</p>
</div>
</div>
<span id="document-patterns/flashing"></span><div class="section" id="message-flashing">
<span id="message-flashing-pattern"></span><h4>Message Flashing<a class="headerlink" href="#message-flashing" title="Permalink to this headline">¶</a></h4>
<p>Good applications and user interfaces are all about feedback.  If the user
does not get enough feedback they will probably end up hating the
application.  Flask provides a really simple way to give feedback to a
user with the flashing system.  The flashing system basically makes it
possible to record a message at the end of a request and access it next
request and only next request.  This is usually combined with a layout
template that does this. Note that browsers and sometimes web servers enforce
a limit on cookie sizes. This means that flashing messages that are too
large for session cookies causes message flashing to fail silently.</p>
<div class="section" id="simple-flashing">
<h5>Simple Flashing<a class="headerlink" href="#simple-flashing" title="Permalink to this headline">¶</a></h5>
<p>So here is a full example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> \
     <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;some_secret&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span> <span class="ow">or</span> \
                <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;secret&#39;</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid credentials&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You were successfully logged in&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>And here is the <code class="file docutils literal notranslate"><span class="pre">layout.html</span></code> template which does the magic:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My Application<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">with</span> <span class="nv">messages</span> <span class="o">=</span> <span class="nv">get_flashed_messages</span><span class="o">()</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">flashes</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Here is the <code class="file docutils literal notranslate"><span class="pre">index.html</span></code> template which inherits from <code class="file docutils literal notranslate"><span class="pre">layout.html</span></code>:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Overview<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Do you want to <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;login&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>log in?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>And here is the <code class="file docutils literal notranslate"><span class="pre">login.html</span></code> template which also inherits from
<code class="file docutils literal notranslate"><span class="pre">layout.html</span></code>:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">error</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">error</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Error:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> <span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Username:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">name</span><span class="o">=</span><span class="s">username</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span>
          <span class="nv">request.form.username</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Password:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">password</span> <span class="na">name</span><span class="o">=</span><span class="s">password</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Login</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="flashing-with-categories">
<h5>Flashing With Categories<a class="headerlink" href="#flashing-with-categories" title="Permalink to this headline">¶</a></h5>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details><p>It is also possible to provide categories when flashing a message.  The
default category if nothing is provided is <code class="docutils literal notranslate"><span class="pre">'message'</span></code>.  Alternative
categories can be used to give the user better feedback.  For example
error messages could be displayed with a red background.</p>
<p>To flash a message with a different category, just use the second argument
to the <a class="reference internal" href="index.html#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flash</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Invalid password provided&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Inside the template you then have to tell the
<a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a> function to also return the
categories.  The loop looks slightly different in that situation then:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">with</span> <span class="nv">messages</span> <span class="o">=</span> <span class="nv">get_flashed_messages</span><span class="o">(</span><span class="nv">with_categories</span><span class="o">=</span><span class="kp">true</span><span class="o">)</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">flashes</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">category</span><span class="o">,</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">category</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This is just one example of how to render these flashed messages.  One
might also use the category to add a prefix such as
<code class="docutils literal notranslate"><span class="pre">&lt;strong&gt;Error:&lt;/strong&gt;</span></code> to the message.</p>
</div>
<div class="section" id="filtering-flash-messages">
<h5>Filtering Flash Messages<a class="headerlink" href="#filtering-flash-messages" title="Permalink to this headline">¶</a></h5>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details><p>Optionally you can pass a list of categories which filters the results of
<a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a>.  This is useful if you wish to
render each category in a separate block.</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">with</span> <span class="nv">errors</span> <span class="o">=</span> <span class="nv">get_flashed_messages</span><span class="o">(</span><span class="nv">category_filter</span><span class="o">=[</span><span class="s2">&quot;error&quot;</span><span class="o">])</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">errors</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert-message block-message error&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;close&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">&gt;</span>×<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span>- <span class="k">for</span> <span class="nv">msg</span> <span class="k">in</span> <span class="nv">errors</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">msg</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> -<span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/jquery"></span><div class="section" id="ajax-with-jquery">
<h4>AJAX with jQuery<a class="headerlink" href="#ajax-with-jquery" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://jquery.com/">jQuery</a> is a small JavaScript library commonly used to simplify working
with the DOM and JavaScript in general.  It is the perfect tool to make
web applications more dynamic by exchanging JSON between server and
client.</p>
<p>JSON itself is a very lightweight transport format, very similar to how
Python primitives (numbers, strings, dicts and lists) look like which is
widely supported and very easy to parse.  It became popular a few years
ago and quickly replaced XML as transport format in web applications.</p>
<div class="section" id="loading-jquery">
<h5>Loading jQuery<a class="headerlink" href="#loading-jquery" title="Permalink to this headline">¶</a></h5>
<p>In order to use jQuery, you have to download it first and place it in the
static folder of your application and then ensure it’s loaded.  Ideally
you have a layout template that is used for all pages where you just have
to add a script statement to the bottom of your <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code> to load jQuery:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{</span>
<span class="s">  url_for(&#39;static&#39;, filename=&#39;jquery.js&#39;) }}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Another method is using Google’s <a class="reference external" href="https://developers.google.com/speed/libraries/devguide">AJAX Libraries API</a> to load jQuery:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&quot;{{</span>
<span class="s1">  url_for(&#39;</span><span class="kr">static</span><span class="s1">&#39;, filename=&#39;</span><span class="nx">jquery</span><span class="p">.</span><span class="nx">js</span><span class="s1">&#39;) }}&quot;&gt;\x3C/script&gt;&#39;</span><span class="p">)&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>In this case you have to put jQuery into your static folder as a fallback, but it will
first try to load it directly from Google. This has the advantage that your
website will probably load faster for users if they went to at least one
other website before using the same jQuery version from Google because it
will already be in the browser cache.</p>
</div>
<div class="section" id="where-is-my-site">
<h5>Where is My Site?<a class="headerlink" href="#where-is-my-site" title="Permalink to this headline">¶</a></h5>
<p>Do you know where your application is?  If you are developing the answer
is quite simple: it’s on localhost port something and directly on the root
of that server.  But what if you later decide to move your application to
a different location?  For example to <code class="docutils literal notranslate"><span class="pre">http://example.com/myapp</span></code>?  On
the server side this never was a problem because we were using the handy
<a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> function that could answer that question for
us, but if we are using jQuery we should not hardcode the path to
the application but make that dynamic, so how can we do that?</p>
<p>A simple method would be to add a script tag to our page that sets a
global variable to the prefix to the root of the application.  Something
like this:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span><span class="p">&gt;</span>
  <span class="nx">$SCRIPT_ROOT</span> <span class="o">=</span> <span class="cp">{{</span> <span class="nv">request.script_root</span><span class="o">|</span><span class="nf">tojson</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span><span class="p">;</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">|safe</span></code> is necessary in Flask before 0.10 so that Jinja does not
escape the JSON encoded string with HTML rules.  Usually this would be
necessary, but we are inside a <code class="docutils literal notranslate"><span class="pre">script</span></code> block here where different rules
apply.</p>
<div class="admonition-information-for-pros admonition">
<p class="admonition-title">Information for Pros</p>
<p>In HTML the <code class="docutils literal notranslate"><span class="pre">script</span></code> tag is declared <code class="docutils literal notranslate"><span class="pre">CDATA</span></code> which means that entities
will not be parsed.  Everything until <code class="docutils literal notranslate"><span class="pre">&lt;/script&gt;</span></code> is handled as script.
This also means that there must never be any <code class="docutils literal notranslate"><span class="pre">&lt;/</span></code> between the script
tags.  <code class="docutils literal notranslate"><span class="pre">|tojson</span></code> is kind enough to do the right thing here and
escape slashes for you (<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">&quot;&lt;/script&gt;&quot;|tojson|safe</span> <span class="pre">}}</span></code> is rendered as
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;\/script&gt;&quot;</span></code>).</p>
<p>In Flask 0.10 it goes a step further and escapes all HTML tags with
unicode escapes.  This makes it possible for Flask to automatically
mark the result as HTML safe.</p>
</div>
</div>
<div class="section" id="json-view-functions">
<h5>JSON View Functions<a class="headerlink" href="#json-view-functions" title="Permalink to this headline">¶</a></h5>
<p>Now let’s create a server side function that accepts two URL arguments of
numbers which should be added together and then sent back to the
application in a JSON object.  This is a really ridiculous example and is
something you usually would do on the client side alone, but a simple
example that shows how you would use jQuery and Flask nonetheless:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/_add_numbers&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_numbers</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see I also added an <cite>index</cite> method here that renders a
template.  This template will load jQuery as above and have a little form
we can add two numbers and a link to trigger the function on the server
side.</p>
<p>Note that we are using the <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.MultiDict.get" title="(in Werkzeug v1.0.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> method here
which will never fail.  If the key is missing a default value (here <code class="docutils literal notranslate"><span class="pre">0</span></code>)
is returned.  Furthermore it can convert values to a specific type (like
in our case <cite>int</cite>).  This is especially handy for code that is
triggered by a script (APIs, JavaScript etc.) because you don’t need
special error reporting in that case.</p>
</div>
<div class="section" id="the-html">
<h5>The HTML<a class="headerlink" href="#the-html" title="Permalink to this headline">¶</a></h5>
<p>Your index.html template either has to extend a <code class="file docutils literal notranslate"><span class="pre">layout.html</span></code> template with
jQuery loaded and the <cite>$SCRIPT_ROOT</cite> variable set, or do that on the top.
Here’s the HTML code needed for our little application (<code class="file docutils literal notranslate"><span class="pre">index.html</span></code>).
Notice that we also drop the script directly into the HTML here.  It is
usually a better idea to have that in a separate script file:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span><span class="p">&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a#calculate&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">$SCRIPT_ROOT</span> <span class="o">+</span> <span class="s1">&#39;/_add_numbers&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">a</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;a&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
        <span class="nx">b</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;b&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#result&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>jQuery Example<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">size</span><span class="o">=</span><span class="s">5</span> <span class="na">name</span><span class="o">=</span><span class="s">a</span><span class="p">&gt;</span> +
   <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">size</span><span class="o">=</span><span class="s">5</span> <span class="na">name</span><span class="o">=</span><span class="s">b</span><span class="p">&gt;</span> =
   <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">result</span><span class="p">&gt;</span>?<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">#</span> <span class="na">id</span><span class="o">=</span><span class="s">calculate</span><span class="p">&gt;</span>calculate server side<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>I won’t go into detail here about how jQuery works, just a very quick
explanation of the little bit of code above:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$(function()</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">})</span></code> specifies code that should run once the
browser is done loading the basic parts of the page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$('selector')</span></code> selects an element and lets you operate on it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">element.bind('event',</span> <span class="pre">func)</span></code> specifies a function that should run
when the user clicked on the element.  If that function returns
<cite>false</cite>, the default behavior will not kick in (in this case, navigate
to the <cite>#</cite> URL).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$.getJSON(url,</span> <span class="pre">data,</span> <span class="pre">func)</span></code> sends a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request to <cite>url</cite> and will
send the contents of the <cite>data</cite> object as query parameters.  Once the
data arrived, it will call the given function with the return value as
argument.  Note that we can use the <cite>$SCRIPT_ROOT</cite> variable here that
we set earlier.</p></li>
</ol>
<p>If you don’t get the whole picture, download the <a class="reference external" href="https://github.com/pallets/flask/tree/master/examples/jqueryexample">sourcecode for
this example</a> from GitHub.</p>
</div>
</div>
<span id="document-patterns/errorpages"></span><div class="section" id="custom-error-pages">
<span id="errorpages"></span><h4>Custom Error Pages<a class="headerlink" href="#custom-error-pages" title="Permalink to this headline">¶</a></h4>
<p>Flask comes with a handy <a class="reference internal" href="index.html#flask.abort" title="flask.abort"><code class="xref py py-func docutils literal notranslate"><span class="pre">abort()</span></code></a> function that aborts a
request with an HTTP error code early.  It will also provide a plain black
and white error page for you with a basic description, but nothing fancy.</p>
<p>Depending on the error code it is less or more likely for the user to
actually see such an error.</p>
<div class="section" id="common-error-codes">
<h5>Common Error Codes<a class="headerlink" href="#common-error-codes" title="Permalink to this headline">¶</a></h5>
<p>The following error codes are some that are often displayed to the user,
even if the application behaves correctly:</p>
<dl class="simple">
<dt><em>404 Not Found</em></dt><dd><p>The good old “chap, you made a mistake typing that URL” message.  So
common that even novices to the internet know that 404 means: damn,
the thing I was looking for is not there.  It’s a very good idea to
make sure there is actually something useful on a 404 page, at least a
link back to the index.</p>
</dd>
<dt><em>403 Forbidden</em></dt><dd><p>If you have some kind of access control on your website, you will have
to send a 403 code for disallowed resources.  So make sure the user
is not lost when they try to access a forbidden resource.</p>
</dd>
<dt><em>410 Gone</em></dt><dd><p>Did you know that there the “404 Not Found” has a brother named “410
Gone”?  Few people actually implement that, but the idea is that
resources that previously existed and got deleted answer with 410
instead of 404.  If you are not deleting documents permanently from
the database but just mark them as deleted, do the user a favour and
use the 410 code instead and display a message that what they were
looking for was deleted for all eternity.</p>
</dd>
<dt><em>500 Internal Server Error</em></dt><dd><p>Usually happens on programming errors or if the server is overloaded.
A terribly good idea is to have a nice page there, because your
application <em>will</em> fail sooner or later (see also:
<a class="reference internal" href="index.html#application-errors"><span class="std std-ref">Application Errors</span></a>).</p>
</dd>
</dl>
</div>
<div class="section" id="error-handlers">
<h5>Error Handlers<a class="headerlink" href="#error-handlers" title="Permalink to this headline">¶</a></h5>
<p>An error handler is a function, just like a view function, but it is
called when an error happens and is passed that error.  The error is most
likely a <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.HTTPException" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a>, but in one case it
can be a different error: a handler for internal server errors will be
passed other exception instances as well if they are uncaught.</p>
<p>An error handler is registered with the <a class="reference internal" href="index.html#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a>
decorator and the error code of the exception.  Keep in mind that Flask
will <em>not</em> set the error code for you, so make sure to also provide the
HTTP status code when returning a response.</p>
<p>Please note that if you add an error handler for “500 Internal Server
Error”, Flask will not trigger it if it’s running in Debug mode.</p>
<p>Here an example implementation for a “404 Page Not Found” exception:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">render_template</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;404.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
</pre></div>
</div>
<p>An example template might be this:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Page Not Found<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Page Not Found<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>What you were looking for is just not there.
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;index&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>go somewhere nice<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/lazyloading"></span><div class="section" id="lazily-loading-views">
<h4>Lazily Loading Views<a class="headerlink" href="#lazily-loading-views" title="Permalink to this headline">¶</a></h4>
<p>Flask is usually used with the decorators.  Decorators are simple and you
have the URL right next to the function that is called for that specific
URL.  However there is a downside to this approach: it means all your code
that uses decorators has to be imported upfront or Flask will never
actually find your function.</p>
<p>This can be a problem if your application has to import quick.  It might
have to do that on systems like Google’s App Engine or other systems.  So
if you suddenly notice that your application outgrows this approach you
can fall back to a centralized URL mapping.</p>
<p>The system that enables having a central URL map is the
<a class="reference internal" href="index.html#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> function.  Instead of using decorators,
you have a file that sets up the application with all URLs.</p>
<div class="section" id="converting-to-centralized-url-map">
<h5>Converting to Centralized URL Map<a class="headerlink" href="#converting-to-centralized-url-map" title="Permalink to this headline">¶</a></h5>
<p>Imagine the current application looks somewhat like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Then, with the centralized approach you would have one file with the views
(<code class="file docutils literal notranslate"><span class="pre">views.py</span></code>) but without any decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>And then a file that sets up an application which maps the functions to
URLs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">views</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">views</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-late">
<h5>Loading Late<a class="headerlink" href="#loading-late" title="Permalink to this headline">¶</a></h5>
<p>So far we only split up the views and the routing, but the module is still
loaded upfront.  The trick is to actually load the view function as needed.
This can be accomplished with a helper class that behaves just like a
function but internally imports the real function on first use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="k">import</span> <span class="n">import_string</span><span class="p">,</span> <span class="n">cached_property</span>

<span class="k">class</span> <span class="nc">LazyView</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">import_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">import_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_name</span> <span class="o">=</span> <span class="n">import_name</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">import_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>What’s important here is is that <cite>__module__</cite> and <cite>__name__</cite> are properly
set.  This is used by Flask internally to figure out how to name the
URL rules in case you don’t provide a name for the rule yourself.</p>
<p>Then you can define your central place to combine the views like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">yourapplication.helpers</span> <span class="k">import</span> <span class="n">LazyView</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
                 <span class="n">view_func</span><span class="o">=</span><span class="n">LazyView</span><span class="p">(</span><span class="s1">&#39;yourapplication.views.index&#39;</span><span class="p">))</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">,</span>
                 <span class="n">view_func</span><span class="o">=</span><span class="n">LazyView</span><span class="p">(</span><span class="s1">&#39;yourapplication.views.user&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>You can further optimize this in terms of amount of keystrokes needed to
write this by having a function that calls into
<a class="reference internal" href="index.html#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> by prefixing a string with the project
name and a dot, and by wrapping <cite>view_func</cite> in a <cite>LazyView</cite> as needed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="n">import_name</span><span class="p">,</span> <span class="n">url_rules</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">LazyView</span><span class="p">(</span><span class="s1">&#39;yourapplication.&#39;</span> <span class="o">+</span> <span class="n">import_name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">url_rule</span> <span class="ow">in</span> <span class="n">url_rules</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">url_rule</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

<span class="c1"># add a single route to the index view</span>
<span class="n">url</span><span class="p">(</span><span class="s1">&#39;views.index&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">])</span>

<span class="c1"># add two routes to a single function endpoint</span>
<span class="n">url_rules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/user/&#39;</span><span class="p">,</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">]</span>
<span class="n">url</span><span class="p">(</span><span class="s1">&#39;views.user&#39;</span><span class="p">,</span> <span class="n">url_rules</span><span class="p">)</span>
</pre></div>
</div>
<p>One thing to keep in mind is that before and after request handlers have
to be in a file that is imported upfront to work properly on the first
request.  The same goes for any kind of remaining decorator.</p>
</div>
</div>
<span id="document-patterns/mongokit"></span><div class="section" id="mongokit-in-flask">
<h4>MongoKit in Flask<a class="headerlink" href="#mongokit-in-flask" title="Permalink to this headline">¶</a></h4>
<p>Using a document database rather than a full DBMS gets more common these days.
This pattern shows how to use MongoKit, a document mapper library, to
integrate with MongoDB.</p>
<p>This pattern requires a running MongoDB server and the MongoKit library
installed.</p>
<p>There are two very common ways to use MongoKit.  I will outline each of them
here:</p>
<div class="section" id="declarative">
<h5>Declarative<a class="headerlink" href="#declarative" title="Permalink to this headline">¶</a></h5>
<p>The default behavior of MongoKit is the declarative one that is based on
common ideas from Django or the SQLAlchemy declarative extension.</p>
<p>Here an example <code class="file docutils literal notranslate"><span class="pre">app.py</span></code> module for your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">mongokit</span> <span class="k">import</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">Document</span>

<span class="c1"># configuration</span>
<span class="n">MONGODB_HOST</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="n">MONGODB_PORT</span> <span class="o">=</span> <span class="mi">27017</span>

<span class="c1"># create the little application object</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># connect to the database</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MONGODB_HOST&#39;</span><span class="p">],</span>
                        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MONGODB_PORT&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>To define your models, just subclass the <cite>Document</cite> class that is imported
from MongoKit.  If you’ve seen the SQLAlchemy pattern you may wonder why we do
not have a session and even do not define a <cite>init_db</cite> function here.  On the
one hand, MongoKit does not have something like a session.  This sometimes
makes it more to type but also makes it blazingly fast.  On the other hand,
MongoDB is schemaless.  This means you can modify the data structure from one
insert query to the next without any problem.  MongoKit is just schemaless
too, but implements some validation to ensure data integrity.</p>
<p>Here is an example document (put this also into <code class="file docutils literal notranslate"><span class="pre">app.py</span></code>, e.g.):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mongokit</span> <span class="k">import</span> <span class="n">ValidationError</span>

<span class="k">def</span> <span class="nf">max_length</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># must have %s in error format string to have mongokit place key in there</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> must be at most </span><span class="si">{}</span><span class="s1"> characters long&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">validate</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Document</span><span class="p">):</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">unicode</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">unicode</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">max_length</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">max_length</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">use_dot_notation</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;User </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># register the User document with our current connection</span>
<span class="n">connection</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">User</span><span class="p">])</span>
</pre></div>
</div>
<p>This example shows you how to define your schema (named structure), a
validator for the maximum character length and uses a special MongoKit feature
called <cite>use_dot_notation</cite>.  Per default MongoKit behaves like a python
dictionary but with <cite>use_dot_notation</cite> set to <code class="docutils literal notranslate"><span class="pre">True</span></code> you can use your
documents like you use models in nearly any other ORM by using dots to
separate between attributes.</p>
<p>You can insert entries into the database like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">connection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.models</span> <span class="k">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">users</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;admin&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;admin@localhost&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that MongoKit is kinda strict with used column types, you must not use a
common <cite>str</cite> type for either <cite>name</cite> or <cite>email</cite> but unicode.</p>
<p>Querying is simple as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
<span class="go">[&lt;User u&#39;admin&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;admin&#39;</span><span class="p">})</span>
<span class="go">&lt;User u&#39;admin&#39;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="pymongo-compatibility-layer">
<h5>PyMongo Compatibility Layer<a class="headerlink" href="#pymongo-compatibility-layer" title="Permalink to this headline">¶</a></h5>
<p>If you just want to use PyMongo, you can do that with MongoKit as well.  You
may use this process if you need the best performance to get.  Note that this
example does not show how to couple it with Flask, see the above MongoKit code
for examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MongoKit</span> <span class="k">import</span> <span class="n">Connection</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">()</span>
</pre></div>
</div>
<p>To insert data you can use the <cite>insert</cite> method.  We have to get a
collection first, this is somewhat the same as a table in the SQL world.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">users</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;admin@localhost&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p>MongoKit will automatically commit for us.</p>
<p>To query your database, you use the collection directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">())</span>
<span class="go">[{u&#39;_id&#39;: ObjectId(&#39;4c271729e13823182f000000&#39;), u&#39;name&#39;: u&#39;admin&#39;, u&#39;email&#39;: u&#39;admin@localhost&#39;}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;admin&#39;</span><span class="p">})</span>
<span class="go">{u&#39;_id&#39;: ObjectId(&#39;4c271729e13823182f000000&#39;), u&#39;name&#39;: u&#39;admin&#39;, u&#39;email&#39;: u&#39;admin@localhost&#39;}</span>
</pre></div>
</div>
<p>These results are also dict-like objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;admin&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
<span class="go">u&#39;admin@localhost&#39;</span>
</pre></div>
</div>
<p>For more information about MongoKit, head over to the
<a class="reference external" href="https://github.com/namlook/mongokit">website</a>.</p>
</div>
</div>
<span id="document-patterns/favicon"></span><div class="section" id="adding-a-favicon">
<h4>Adding a favicon<a class="headerlink" href="#adding-a-favicon" title="Permalink to this headline">¶</a></h4>
<p>A “favicon” is an icon used by browsers for tabs and bookmarks. This helps
to distinguish your website and to give it a unique brand.</p>
<p>A common question is how to add a favicon to a Flask application. First, of
course, you need an icon. It should be 16 × 16 pixels and in the ICO file
format. This is not a requirement but a de-facto standard supported by all
relevant browsers. Put the icon in your static directory as
<code class="file docutils literal notranslate"><span class="pre">favicon.ico</span></code>.</p>
<p>Now, to get browsers to find your icon, the correct way is to add a link
tag in your HTML. So, for example:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;static&#39;</span><span class="o">,</span> <span class="nv">filename</span><span class="o">=</span><span class="s1">&#39;favicon.ico&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>That’s all you need for most browsers, however some really old ones do not
support this standard. The old de-facto standard is to serve this file,
with this name, at the website root. If your application is not mounted at
the root path of the domain you either need to configure the web server to
serve the icon at the root or if you can’t do that you’re out of luck. If
however your application is the root you can simply route a redirect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/favicon.ico&#39;</span><span class="p">,</span>
                 <span class="n">redirect_to</span><span class="o">=</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;favicon.ico&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If you want to save the extra redirect request you can also write a view
using <a class="reference internal" href="index.html#flask.send_from_directory" title="flask.send_from_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_from_directory()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">send_from_directory</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/favicon.ico&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">favicon</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">),</span>
                               <span class="s1">&#39;favicon.ico&#39;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;image/vnd.microsoft.icon&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can leave out the explicit mimetype and it will be guessed, but we may
as well specify it to avoid the extra guessing, as it will always be the
same.</p>
<p>The above will serve the icon via your application and if possible it’s
better to configure your dedicated web server to serve it; refer to the
web server’s documentation.</p>
<div class="section" id="see-also">
<h5>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Favicon">Favicon</a> article on
Wikipedia</p></li>
</ul>
</div>
</div>
<span id="document-patterns/streaming"></span><div class="section" id="streaming-contents">
<h4>Streaming Contents<a class="headerlink" href="#streaming-contents" title="Permalink to this headline">¶</a></h4>
<p>Sometimes you want to send an enormous amount of data to the client, much
more than you want to keep in memory.  When you are generating the data on
the fly though, how do you send that back to the client without the
roundtrip to the filesystem?</p>
<p>The answer is by using generators and direct responses.</p>
<div class="section" id="basic-usage">
<h5>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h5>
<p>This is a basic view function that generates a lot of CSV data on the fly.
The trick is to have an inner function that uses a generator to generate
data and to then invoke that function and pass it to a response object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/large.csv&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">generate_large_csv</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iter_all_rows</span><span class="p">():</span>
            <span class="k">yield</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">generate</span><span class="p">(),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Each <code class="docutils literal notranslate"><span class="pre">yield</span></code> expression is directly sent to the browser.  Note though
that some WSGI middlewares might break streaming, so be careful there in
debug environments with profilers and other things you might have enabled.</p>
</div>
<div class="section" id="streaming-from-templates">
<h5>Streaming from Templates<a class="headerlink" href="#streaming-from-templates" title="Permalink to this headline">¶</a></h5>
<p>The Jinja2 template engine also supports rendering templates piece by
piece.  This functionality is not directly exposed by Flask because it is
quite uncommon, but you can easily do it yourself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Response</span>

<span class="k">def</span> <span class="nf">stream_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">update_template_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">)</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="n">rv</span><span class="o">.</span><span class="n">enable_buffering</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rv</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/my-large-page.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">render_large_template</span><span class="p">():</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">iter_all_rows</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">stream_template</span><span class="p">(</span><span class="s1">&#39;the_template.html&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">))</span>
</pre></div>
</div>
<p>The trick here is to get the template object from the Jinja2 environment
on the application and to call <a class="reference external" href="https://jinja.palletsprojects.com/en/2.11.x/api/#jinja2.Template.stream" title="(in Jinja v2.11.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stream()</span></code></a> instead of
<a class="reference external" href="https://jinja.palletsprojects.com/en/2.11.x/api/#jinja2.Template.render" title="(in Jinja v2.11.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">render()</span></code></a> which returns a stream object instead of a
string.  Since we’re bypassing the Flask template render functions and
using the template object itself we have to make sure to update the render
context ourselves by calling <a class="reference internal" href="index.html#flask.Flask.update_template_context" title="flask.Flask.update_template_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update_template_context()</span></code></a>.
The template is then evaluated as the stream is iterated over.  Since each
time you do a yield the server will flush the content to the client you
might want to buffer up a few items in the template which you can do with
<code class="docutils literal notranslate"><span class="pre">rv.enable_buffering(size)</span></code>.  <code class="docutils literal notranslate"><span class="pre">5</span></code> is a sane default.</p>
</div>
<div class="section" id="streaming-with-context">
<h5>Streaming with Context<a class="headerlink" href="#streaming-with-context" title="Permalink to this headline">¶</a></h5>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details><p>Note that when you stream data, the request context is already gone the
moment the function executes.  Flask 0.9 provides you with a helper that
can keep the request context around during the execution of the
generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">stream_with_context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/stream&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">streamed_response</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="k">yield</span> <span class="s1">&#39;Hello &#39;</span>
        <span class="k">yield</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s1">&#39;!&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">stream_with_context</span><span class="p">(</span><span class="n">generate</span><span class="p">()))</span>
</pre></div>
</div>
<p>Without the <a class="reference internal" href="index.html#flask.stream_with_context" title="flask.stream_with_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">stream_with_context()</span></code></a> function you would get a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> at that point.</p>
</div>
</div>
<span id="document-patterns/deferredcallbacks"></span><div class="section" id="deferred-request-callbacks">
<span id="deferred-callbacks"></span><h4>Deferred Request Callbacks<a class="headerlink" href="#deferred-request-callbacks" title="Permalink to this headline">¶</a></h4>
<p>One of the design principles of Flask is that response objects are created
and passed down a chain of potential callbacks that can modify them or
replace them.  When the request handling starts, there is no response
object yet.  It is created as necessary either by a view function or by
some other component in the system.</p>
<p>But what happens if you want to modify the response at a point where the
response does not exist yet?  A common example for that would be a
before-request function that wants to set a cookie on the response object.</p>
<p>One way is to avoid the situation.  Very often that is possible.  For
instance you can try to move that logic into an after-request callback
instead.  Sometimes however moving that code there is just not a very
pleasant experience or makes code look very awkward.</p>
<p>As an alternative possibility you can attach a bunch of callback functions
to the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> object and call them at the end of the request.
This way you can defer code execution from anywhere in the application.</p>
<div class="section" id="the-decorator">
<h5>The Decorator<a class="headerlink" href="#the-decorator" title="Permalink to this headline">¶</a></h5>
<p>The following decorator is the key.  It registers a function on a list on
the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">g</span>

<span class="k">def</span> <span class="nf">after_this_request</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;after_request_callbacks&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">after_request_callbacks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">g</span><span class="o">.</span><span class="n">after_request_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
<div class="section" id="calling-the-deferred">
<h5>Calling the Deferred<a class="headerlink" href="#calling-the-deferred" title="Permalink to this headline">¶</a></h5>
<p>Now you can use the <cite>after_this_request</cite> decorator to mark a function to
be called at the end of the request.  But we still need to call them.  For
this the following function needs to be registered as
<a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> callback:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span> <span class="nf">call_after_request_callbacks</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;after_request_callbacks&#39;</span><span class="p">,</span> <span class="p">()):</span>
        <span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
</div>
<div class="section" id="a-practical-example">
<h5>A Practical Example<a class="headerlink" href="#a-practical-example" title="Permalink to this headline">¶</a></h5>
<p>At any time during a request, we can register a function to be called at the
end of the request.  For example you can remember the current language of the
user in a cookie in the before-request function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span> <span class="nf">detect_user_language</span><span class="p">():</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_lang&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">language</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">guess_language_from_request</span><span class="p">()</span>
        <span class="nd">@after_this_request</span>
        <span class="k">def</span> <span class="nf">remember_language</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
            <span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">&#39;user_lang&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
</pre></div>
</div>
</div>
</div>
<span id="document-patterns/methodoverrides"></span><div class="section" id="adding-http-method-overrides">
<h4>Adding HTTP Method Overrides<a class="headerlink" href="#adding-http-method-overrides" title="Permalink to this headline">¶</a></h4>
<p>Some HTTP proxies do not support arbitrary HTTP methods or newer HTTP
methods (such as PATCH).  In that case it’s possible to “proxy” HTTP
methods through another HTTP method in total violation of the protocol.</p>
<p>The way this works is by letting the client do an HTTP POST request and
set the <code class="docutils literal notranslate"><span class="pre">X-HTTP-Method-Override</span></code> header and set the value to the
intended HTTP method (such as <code class="docutils literal notranslate"><span class="pre">PATCH</span></code>).</p>
<p>This can easily be accomplished with an HTTP middleware:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HTTPMethodOverrideMiddleware</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">allowed_methods</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span>
        <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HEAD&#39;</span><span class="p">,</span>
        <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PATCH&#39;</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span>
    <span class="p">])</span>
    <span class="n">bodyless_methods</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_HTTP_METHOD_OVERRIDE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_methods</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyless_methods</span><span class="p">:</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CONTENT_LENGTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>To use this with Flask this is all that is necessary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">HTTPMethodOverrideMiddleware</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-patterns/requestchecksum"></span><div class="section" id="request-content-checksums">
<h4>Request Content Checksums<a class="headerlink" href="#request-content-checksums" title="Permalink to this headline">¶</a></h4>
<p>Various pieces of code can consume the request data and preprocess it.
For instance JSON data ends up on the request object already read and
processed, form data ends up there as well but goes through a different
code path.  This seems inconvenient when you want to calculate the
checksum of the incoming request data.  This is necessary sometimes for
some APIs.</p>
<p>Fortunately this is however very simple to change by wrapping the input
stream.</p>
<p>The following example calculates the SHA1 checksum of the incoming data as
it gets read and stores it in the WSGI environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>

<span class="k">class</span> <span class="nc">ChecksumCalcStream</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>

    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_hint</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">size_hint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>

<span class="k">def</span> <span class="nf">generate_checksum</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">ChecksumCalcStream</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">])</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;wsgi.input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span>
    <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="n">_hash</span>
</pre></div>
</div>
<p>To use this, all you need to do is to hook the calculating stream in
before the request starts consuming data.  (Eg: be careful accessing
<code class="docutils literal notranslate"><span class="pre">request.form</span></code> or anything of that nature.  <code class="docutils literal notranslate"><span class="pre">before_request_handlers</span></code>
for instance should be careful not to access it).</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/special-api&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">special_api</span><span class="p">():</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">generate_checksum</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c1"># Accessing this parses the input stream</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span>
    <span class="c1"># At this point the hash is fully constructed.</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;Hash was: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">checksum</span>
</pre></div>
</div>
</div>
<span id="document-patterns/celery"></span><div class="section" id="celery-based-background-tasks">
<h4>Celery Based Background Tasks<a class="headerlink" href="#celery-based-background-tasks" title="Permalink to this headline">¶</a></h4>
<p>Celery is a task queue for Python with batteries included.  It used to
have a Flask integration but it became unnecessary after some
restructuring of the internals of Celery with Version 3.  This guide fills
in the blanks in how to properly use Celery with Flask but assumes that
you generally already read the <a class="reference external" href="http://docs.celeryproject.org/en/latest/getting-started/first-steps-with-celery.html">First Steps with Celery</a>
guide in the official Celery documentation.</p>
<div class="section" id="installing-celery">
<h5>Installing Celery<a class="headerlink" href="#installing-celery" title="Permalink to this headline">¶</a></h5>
<p>Celery is on the Python Package Index (PyPI), so it can be installed with
standard Python tools like <strong class="command">pip</strong> or <strong class="command">easy_install</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install celery
</pre></div>
</div>
</div>
<div class="section" id="configuring-celery">
<h5>Configuring Celery<a class="headerlink" href="#configuring-celery" title="Permalink to this headline">¶</a></h5>
<p>The first thing you need is a Celery instance, this is called the celery
application.  It serves the same purpose as the <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>
object in Flask, just for Celery.  Since this instance is used as the
entry-point for everything you want to do in Celery, like creating tasks
and managing workers, it must be possible for other modules to import it.</p>
<p>For instance you can place this in a <code class="docutils literal notranslate"><span class="pre">tasks</span></code> module.  While you can use
Celery without any reconfiguration with Flask, it becomes a bit nicer by
subclassing tasks and adding support for Flask’s application contexts and
hooking it up with the Flask configuration.</p>
<p>This is all that is necessary to properly integrate Celery with Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">celery</span> <span class="k">import</span> <span class="n">Celery</span>

<span class="k">def</span> <span class="nf">make_celery</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">import_name</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CELERY_RESULT_BACKEND&#39;</span><span class="p">],</span>
                    <span class="n">broker</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CELERY_BROKER_URL&#39;</span><span class="p">])</span>
    <span class="n">celery</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="n">TaskBase</span> <span class="o">=</span> <span class="n">celery</span><span class="o">.</span><span class="n">Task</span>
    <span class="k">class</span> <span class="nc">ContextTask</span><span class="p">(</span><span class="n">TaskBase</span><span class="p">):</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">TaskBase</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">celery</span><span class="o">.</span><span class="n">Task</span> <span class="o">=</span> <span class="n">ContextTask</span>
    <span class="k">return</span> <span class="n">celery</span>
</pre></div>
</div>
<p>The function creates a new Celery object, configures it with the broker
from the application config, updates the rest of the Celery config from
the Flask config and then creates a subclass of the task that wraps the
task execution in an application context.</p>
</div>
<div class="section" id="minimal-example">
<h5>Minimal Example<a class="headerlink" href="#minimal-example" title="Permalink to this headline">¶</a></h5>
<p>With what we have above this is the minimal example of using Celery with
Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>

<span class="n">flask_app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">flask_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">CELERY_BROKER_URL</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379&#39;</span><span class="p">,</span>
    <span class="n">CELERY_RESULT_BACKEND</span><span class="o">=</span><span class="s1">&#39;redis://localhost:6379&#39;</span>
<span class="p">)</span>
<span class="n">celery</span> <span class="o">=</span> <span class="n">make_celery</span><span class="p">(</span><span class="n">flask_app</span><span class="p">)</span>


<span class="nd">@celery</span><span class="o">.</span><span class="n">task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add_together</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>This task can now be called in the background:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add_together</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="go">65</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-celery-worker">
<h5>Running the Celery Worker<a class="headerlink" href="#running-the-celery-worker" title="Permalink to this headline">¶</a></h5>
<p>Now if you jumped in and already executed the above code you will be
disappointed to learn that your <code class="docutils literal notranslate"><span class="pre">.wait()</span></code> will never actually return.
That’s because you also need to run celery.  You can do that by running
celery as a worker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ celery -A your_application.celery worker
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">your_application</span></code> string has to point to your application’s package
or module that creates the <cite>celery</cite> object.</p>
</div>
</div>
<span id="document-patterns/subclassing"></span><div class="section" id="subclassing-flask">
<h4>Subclassing Flask<a class="headerlink" href="#subclassing-flask" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> class is designed for subclassing.</p>
<p>For example, you may want to override how request parameters are handled to preserve their order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">werkzeug.datastructures</span> <span class="k">import</span> <span class="n">ImmutableOrderedMultiDict</span>
<span class="k">class</span> <span class="nc">MyRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Request subclass to override request parameter storage&quot;&quot;&quot;</span>
    <span class="n">parameter_storage_class</span> <span class="o">=</span> <span class="n">ImmutableOrderedMultiDict</span>
<span class="k">class</span> <span class="nc">MyFlask</span><span class="p">(</span><span class="n">Flask</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Flask subclass using the custom request class&quot;&quot;&quot;</span>
    <span class="n">request_class</span> <span class="o">=</span> <span class="n">MyRequest</span>
</pre></div>
</div>
<p>This is the recommended approach for overriding or augmenting Flask’s internal functionality.</p>
</div>
</div>
</div>
<span id="document-deploying/index"></span><div class="section" id="deployment-options">
<span id="deployment"></span><h3>Deployment Options<a class="headerlink" href="#deployment-options" title="Permalink to this headline">¶</a></h3>
<p>While lightweight and easy to use, <strong>Flask’s built-in server is not suitable
for production</strong> as it doesn’t scale well and by default serves only one
request at a time.  Some of the options available for properly running Flask in
production are documented here.</p>
<p>If you want to deploy your Flask application to a WSGI server not listed here,
look up the server documentation about how to use a WSGI app with it.  Just
remember that your <code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code> application object is the actual WSGI
application.</p>
<div class="section" id="hosted-options">
<h4>Hosted options<a class="headerlink" href="#hosted-options" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://devcenter.heroku.com/articles/getting-started-with-python">Deploying Flask on Heroku</a></p></li>
<li><p><a class="reference external" href="https://developers.openshift.com/en/python-flask.html">Deploying Flask on OpenShift</a></p></li>
<li><p><a class="reference external" href="http://flask.pocoo.org/snippets/65/">Deploying Flask on Webfaction</a></p></li>
<li><p><a class="reference external" href="https://github.com/kamalgill/flask-appengine-template">Deploying Flask on Google App Engine</a></p></li>
<li><p><a class="reference external" href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create-deploy-python-flask.html">Deploying Flask on AWS Elastic Beanstalk</a></p></li>
<li><p><a class="reference external" href="http://flask.pocoo.org/snippets/89/">Sharing your Localhost Server with Localtunnel</a></p></li>
<li><p><a class="reference external" href="https://azure.microsoft.com/documentation/articles/web-sites-python-configure/">Deploying on Azure (IIS)</a></p></li>
<li><p><a class="reference external" href="https://help.pythonanywhere.com/pages/Flask/">Deploying on PythonAnywhere</a></p></li>
</ul>
</div>
<div class="section" id="self-hosted-options">
<h4>Self-hosted options<a class="headerlink" href="#self-hosted-options" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-deploying/mod_wsgi"></span><div class="section" id="mod-wsgi-apache">
<span id="mod-wsgi-deployment"></span><h5>mod_wsgi (Apache)<a class="headerlink" href="#mod-wsgi-apache" title="Permalink to this headline">¶</a></h5>
<p>If you are using the <a class="reference external" href="http://httpd.apache.org/">Apache</a> webserver, consider using <a class="reference external" href="https://github.com/GrahamDumpleton/mod_wsgi">mod_wsgi</a>.</p>
<div class="admonition-watch-out admonition">
<p class="admonition-title">Watch Out</p>
<p>Please make sure in advance that any <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> calls you might
have in your application file are inside an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span>
<span class="pre">'__main__':</span></code> block or moved to a separate file.  Just make sure it’s
not called because this will always start a local WSGI server which
we do not want if we deploy that application to mod_wsgi.</p>
</div>
<div class="section" id="installing-mod-wsgi">
<h6>Installing <cite>mod_wsgi</cite><a class="headerlink" href="#installing-mod-wsgi" title="Permalink to this headline">¶</a></h6>
<p>If you don’t have <cite>mod_wsgi</cite> installed yet you have to either install it
using a package manager or compile it yourself.  The mod_wsgi
<a class="reference external" href="http://modwsgi.readthedocs.io/en/develop/installation.html">installation instructions</a> cover source installations on UNIX systems.</p>
<p>If you are using Ubuntu/Debian you can apt-get it and activate it as
follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># apt-get install libapache2-mod-wsgi
</pre></div>
</div>
<p>If you are using a yum based distribution (Fedora, OpenSUSE, etc..) you
can install it as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># yum install mod_wsgi
</pre></div>
</div>
<p>On FreeBSD install <cite>mod_wsgi</cite> by compiling the <cite>www/mod_wsgi</cite> port or by
using pkg_add:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># pkg install ap22-mod_wsgi2
</pre></div>
</div>
<p>If you are using pkgsrc you can install <cite>mod_wsgi</cite> by compiling the
<cite>www/ap2-wsgi</cite> package.</p>
<p>If you encounter segfaulting child processes after the first apache
reload you can safely ignore them.  Just restart the server.</p>
</div>
<div class="section" id="creating-a-wsgi-file">
<h6>Creating a <cite>.wsgi</cite> file<a class="headerlink" href="#creating-a-wsgi-file" title="Permalink to this headline">¶</a></h6>
<p>To run your application you need a <code class="file docutils literal notranslate"><span class="pre">yourapplication.wsgi</span></code> file.  This file
contains the code <cite>mod_wsgi</cite> is executing on startup to get the application
object.  The object called <cite>application</cite> in that file is then used as
application.</p>
<p>For most applications the following file should be sufficient:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">application</span>
</pre></div>
</div>
<p>If you don’t have a factory function for application creation but a singleton
instance you can directly import that one as <cite>application</cite>.</p>
<p>Store that file somewhere that you will find it again (e.g.:
<code class="file docutils literal notranslate"><span class="pre">/var/www/yourapplication</span></code>) and make sure that <cite>yourapplication</cite> and all
the libraries that are in use are on the python load path.  If you don’t
want to install it system wide consider using a <a class="reference external" href="https://pypi.org/project/virtualenv/">virtual python</a>
instance.  Keep in mind that you will have to actually install your
application into the virtualenv as well.  Alternatively there is the
option to just patch the path in the <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file before the import:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;/path/to/the/application&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-apache">
<h6>Configuring Apache<a class="headerlink" href="#configuring-apache" title="Permalink to this headline">¶</a></h6>
<p>The last thing you have to do is to create an Apache configuration file
for your application.  In this example we are telling <cite>mod_wsgi</cite> to
execute the application under a different user for security reasons:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> example.com

    <span class="nb">WSGIDaemonProcess</span> yourapplication <span class="k">user</span>=user1 <span class="k">group</span>=group1 threads=5
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/var/www/yourapplication/yourapplication.wsgi</span>

    <span class="nt">&lt;Directory</span> <span class="s">/var/www/yourapplication</span><span class="nt">&gt;</span>
        <span class="nb">WSGIProcessGroup</span> yourapplication
        <span class="nb">WSGIApplicationGroup</span> %{GLOBAL}
        <span class="nb">Order</span> deny,allow
        <span class="nb">Allow</span> from <span class="k">all</span>
    <span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Note: WSGIDaemonProcess isn’t implemented in Windows and Apache will
refuse to run with the above configuration. On a Windows system, eliminate those lines:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
        <span class="nb">ServerName</span> example.com
        <span class="nb">WSGIScriptAlias</span> / C:\yourdir\yourapp.wsgi
        <span class="nt">&lt;Directory</span> <span class="s">C:\yourdir</span><span class="nt">&gt;</span>
                <span class="nb">Order</span> deny,allow
                <span class="nb">Allow</span> from <span class="k">all</span>
        <span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Note: There have been some changes in access control configuration for <a class="reference external" href="http://httpd.apache.org/docs/trunk/upgrading.html">Apache 2.4</a>.</p>
<p>Most notably, the syntax for directory permissions has changed from httpd 2.2</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">Order</span> allow,deny
<span class="nb">Allow</span> from <span class="k">all</span>
</pre></div>
</div>
<p>to httpd 2.4 syntax</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">Require</span> <span class="k">all</span> granted
</pre></div>
</div>
<p>For more information consult the <a class="reference external" href="http://modwsgi.readthedocs.io/en/develop/index.html">mod_wsgi documentation</a>.</p>
</div>
<div class="section" id="troubleshooting">
<h6>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h6>
<p>If your application does not run, follow this guide to troubleshoot:</p>
<dl>
<dt><strong>Problem:</strong> application does not run, errorlog shows SystemExit ignored</dt><dd><p>You have an <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> call in your application file that is not
guarded by an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code> condition.  Either
remove that <a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> call from the file and move it
into a separate <code class="file docutils literal notranslate"><span class="pre">run.py</span></code> file or put it into such an if block.</p>
</dd>
<dt><strong>Problem:</strong> application gives permission errors</dt><dd><p>Probably caused by your application running as the wrong user.  Make
sure the folders the application needs access to have the proper
privileges set and the application runs as the correct user
(<code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code> parameter to the <cite>WSGIDaemonProcess</cite>
directive)</p>
</dd>
<dt><strong>Problem:</strong> application dies with an error on print</dt><dd><p>Keep in mind that mod_wsgi disallows doing anything with
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stdout" title="(in Python v3.8)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdout</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stderr" title="(in Python v3.8)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a>.  You can disable this
protection from the config by setting the <cite>WSGIRestrictStdout</cite> to
<code class="docutils literal notranslate"><span class="pre">off</span></code>:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">WSGIRestrictStdout</span> <span class="k">Off</span>
</pre></div>
</div>
<p>Alternatively you can also replace the standard out in the .wsgi file
with a different stream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
</pre></div>
</div>
</dd>
<dt><strong>Problem:</strong> accessing resources gives IO errors</dt><dd><p>Your application probably is a single .py file you symlinked into
the site-packages folder.  Please be aware that this does not work,
instead you either have to put the folder into the pythonpath the
file is stored in, or convert your application into a package.</p>
<p>The reason for this is that for non-installed packages, the module
filename is used to locate the resources and for symlinks the wrong
filename is picked up.</p>
</dd>
</dl>
</div>
<div class="section" id="support-for-automatic-reloading">
<h6>Support for Automatic Reloading<a class="headerlink" href="#support-for-automatic-reloading" title="Permalink to this headline">¶</a></h6>
<p>To help deployment tools you can activate support for automatic
reloading.  Whenever something changes the <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file, <cite>mod_wsgi</cite> will
reload all the daemon processes for us.</p>
<p>For that, just add the following directive to your <cite>Directory</cite> section:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">WSGIScriptReloading</span> <span class="k">On</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-virtual-environments">
<h6>Working with Virtual Environments<a class="headerlink" href="#working-with-virtual-environments" title="Permalink to this headline">¶</a></h6>
<p>Virtual environments have the advantage that they never install the
required dependencies system wide so you have a better control over what
is used where.  If you want to use a virtual environment with mod_wsgi
you have to modify your <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file slightly.</p>
<p>Add the following lines to the top of your <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activate_this</span> <span class="o">=</span> <span class="s1">&#39;/path/to/env/bin/activate_this.py&#39;</span>
<span class="n">execfile</span><span class="p">(</span><span class="n">activate_this</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="vm">__file__</span><span class="o">=</span><span class="n">activate_this</span><span class="p">))</span>
</pre></div>
</div>
<p>For Python 3 add the following lines to the top of your <code class="docutils literal notranslate"><span class="pre">.wsgi</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activate_this</span> <span class="o">=</span> <span class="s1">&#39;/path/to/env/bin/activate_this.py&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">activate_this</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">file_</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">(</span><span class="vm">__file__</span><span class="o">=</span><span class="n">activate_this</span><span class="p">))</span>
</pre></div>
</div>
<p>This sets up the load paths according to the settings of the virtual
environment.  Keep in mind that the path has to be absolute.</p>
</div>
</div>
<span id="document-deploying/wsgi-standalone"></span><div class="section" id="standalone-wsgi-containers">
<span id="deploying-wsgi-standalone"></span><h5>Standalone WSGI Containers<a class="headerlink" href="#standalone-wsgi-containers" title="Permalink to this headline">¶</a></h5>
<p>There are popular servers written in Python that contain WSGI applications and
serve HTTP.  These servers stand alone when they run; you can proxy to them
from your web server.  Note the section on <a class="reference internal" href="#deploying-proxy-setups"><span class="std std-ref">Proxy Setups</span></a> if you
run into issues.</p>
<div class="section" id="gunicorn">
<h6>Gunicorn<a class="headerlink" href="#gunicorn" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="http://gunicorn.org/">Gunicorn</a> ‘Green Unicorn’ is a WSGI HTTP Server for UNIX. It’s a pre-fork
worker model ported from Ruby’s Unicorn project. It supports both <a class="reference external" href="http://eventlet.net/">eventlet</a>
and <a class="reference external" href="https://greenlet.readthedocs.io/en/latest/">greenlet</a>. Running a Flask application on this server is quite simple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gunicorn</span> <span class="n">myproject</span><span class="p">:</span><span class="n">app</span>
</pre></div>
</div>
<p><a class="reference external" href="http://gunicorn.org/">Gunicorn</a> provides many command-line options – see <code class="docutils literal notranslate"><span class="pre">gunicorn</span> <span class="pre">-h</span></code>.
For example, to run a Flask application with 4 worker processes (<code class="docutils literal notranslate"><span class="pre">-w</span>
<span class="pre">4</span></code>) binding to localhost port 4000 (<code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">127.0.0.1:4000</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gunicorn</span> <span class="o">-</span><span class="n">w</span> <span class="mi">4</span> <span class="o">-</span><span class="n">b</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">4000</span> <span class="n">myproject</span><span class="p">:</span><span class="n">app</span>
</pre></div>
</div>
</div>
<div class="section" id="gevent">
<h6>Gevent<a class="headerlink" href="#gevent" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="http://www.gevent.org/">Gevent</a> is a coroutine-based Python networking library that uses
<a class="reference external" href="https://greenlet.readthedocs.io/en/latest/">greenlet</a> to provide a high-level synchronous API on top of <a class="reference external" href="http://software.schmorp.de/pkg/libev.html">libev</a>
event loop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gevent.wsgi</span> <span class="k">import</span> <span class="n">WSGIServer</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="n">http_server</span> <span class="o">=</span> <span class="n">WSGIServer</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span> <span class="n">app</span><span class="p">)</span>
<span class="n">http_server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="twisted-web">
<h6>Twisted Web<a class="headerlink" href="#twisted-web" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="https://twistedmatrix.com/trac/wiki/TwistedWeb">Twisted Web</a> is the web server shipped with <a class="reference external" href="https://twistedmatrix.com/">Twisted</a>, a mature,
non-blocking event-driven networking library. Twisted Web comes with a
standard WSGI container which can be controlled from the command line using
the <code class="docutils literal notranslate"><span class="pre">twistd</span></code> utility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twistd</span> <span class="n">web</span> <span class="o">--</span><span class="n">wsgi</span> <span class="n">myproject</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
<p>This example will run a Flask application called <code class="docutils literal notranslate"><span class="pre">app</span></code> from a module named
<code class="docutils literal notranslate"><span class="pre">myproject</span></code>.</p>
<p>Twisted Web supports many flags and options, and the <code class="docutils literal notranslate"><span class="pre">twistd</span></code> utility does
as well; see <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">-h</span></code> and <code class="docutils literal notranslate"><span class="pre">twistd</span> <span class="pre">web</span> <span class="pre">-h</span></code> for more information. For
example, to run a Twisted Web server in the foreground, on port 8080, with an
application from <code class="docutils literal notranslate"><span class="pre">myproject</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">twistd</span> <span class="o">-</span><span class="n">n</span> <span class="n">web</span> <span class="o">--</span><span class="n">port</span> <span class="mi">8080</span> <span class="o">--</span><span class="n">wsgi</span> <span class="n">myproject</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
</div>
<div class="section" id="proxy-setups">
<span id="deploying-proxy-setups"></span><h6>Proxy Setups<a class="headerlink" href="#proxy-setups" title="Permalink to this headline">¶</a></h6>
<p>If you deploy your application using one of these servers behind an HTTP proxy
you will need to rewrite a few headers in order for the application to work.
The two problematic values in the WSGI environment usually are <code class="docutils literal notranslate"><span class="pre">REMOTE_ADDR</span></code>
and <code class="docutils literal notranslate"><span class="pre">HTTP_HOST</span></code>.  You can configure your httpd to pass these headers, or you
can fix them in middleware.  Werkzeug ships a fixer that will solve some common
setups, but you might want to write your own WSGI middleware for specific
setups.</p>
<p>Here’s a simple nginx configuration which proxies to an application served on
localhost at port 8000, setting appropriate headers:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>

    <span class="kn">server_name</span> <span class="s">_</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span><span class="p">;</span>
    <span class="kn">error_log</span>  <span class="s">/var/log/nginx/error.log</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span>         <span class="s">http://127.0.0.1:8000/</span><span class="p">;</span>
        <span class="kn">proxy_redirect</span>     <span class="no">off</span><span class="p">;</span>

        <span class="kn">proxy_set_header</span>   <span class="s">Host</span>                 <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span>   <span class="s">X-Real-IP</span>            <span class="nv">$remote_addr</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span>   <span class="s">X-Forwarded-For</span>      <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span>   <span class="s">X-Forwarded-Proto</span>    <span class="nv">$scheme</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your httpd is not providing these headers, the most common setup invokes the
host being set from <code class="docutils literal notranslate"><span class="pre">X-Forwarded-Host</span></code> and the remote address from
<code class="docutils literal notranslate"><span class="pre">X-Forwarded-For</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.fixers</span> <span class="k">import</span> <span class="n">ProxyFix</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">ProxyFix</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-trusting-headers admonition">
<p class="admonition-title">Trusting Headers</p>
<p>Please keep in mind that it is a security issue to use such a middleware in
a non-proxy setup because it will blindly trust the incoming headers which
might be forged by malicious clients.</p>
</div>
<p>If you want to rewrite the headers from another header, you might want to
use a fixer like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomProxyFix</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_X_FHOST&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">host</span><span class="p">:</span>
            <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">CustomProxyFix</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-deploying/uwsgi"></span><div class="section" id="uwsgi">
<span id="deploying-uwsgi"></span><h5>uWSGI<a class="headerlink" href="#uwsgi" title="Permalink to this headline">¶</a></h5>
<p>uWSGI is a deployment option on servers like <a class="reference external" href="http://nginx.org/">nginx</a>, <a class="reference external" href="http://www.lighttpd.net/">lighttpd</a>, and
<a class="reference external" href="http://cherokee-project.com/">cherokee</a>; see <a class="reference internal" href="index.html#deploying-fastcgi"><span class="std std-ref">FastCGI</span></a> and <a class="reference internal" href="index.html#deploying-wsgi-standalone"><span class="std std-ref">Standalone WSGI Containers</span></a>
for other options.  To use your WSGI application with uWSGI protocol you will
need a uWSGI server first. uWSGI is both a protocol and an application server;
the application server can serve uWSGI, FastCGI, and HTTP protocols.</p>
<p>The most popular uWSGI server is <a class="reference external" href="http://projects.unbit.it/uwsgi/">uwsgi</a>, which we will use for this
guide.  Make sure to have it installed to follow along.</p>
<div class="admonition-watch-out admonition">
<p class="admonition-title">Watch Out</p>
<p>Please make sure in advance that any <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> calls you might
have in your application file are inside an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span>
<span class="pre">'__main__':</span></code> block or moved to a separate file.  Just make sure it’s
not called because this will always start a local WSGI server which
we do not want if we deploy that application to uWSGI.</p>
</div>
<div class="section" id="starting-your-app-with-uwsgi">
<h6>Starting your app with uwsgi<a class="headerlink" href="#starting-your-app-with-uwsgi" title="Permalink to this headline">¶</a></h6>
<p><cite>uwsgi</cite> is designed to operate on WSGI callables found in python modules.</p>
<p>Given a flask application in myapp.py, use the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ uwsgi -s /tmp/yourapplication.sock --manage-script-name --mount /yourapplication=myapp:app
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--manage-script-name</span></code> will move the handling of <code class="docutils literal notranslate"><span class="pre">SCRIPT_NAME</span></code> to uwsgi,
since its smarter about that. It is used together with the <code class="docutils literal notranslate"><span class="pre">--mount</span></code> directive
which will make requests to <code class="docutils literal notranslate"><span class="pre">/yourapplication</span></code> be directed to <code class="docutils literal notranslate"><span class="pre">myapp:app</span></code>.
If your application is accessible at root level, you can use a single <code class="docutils literal notranslate"><span class="pre">/</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">/yourapplication</span></code>. <code class="docutils literal notranslate"><span class="pre">myapp</span></code> refers to the name of the file of
your flask application (without extension) or the module which provides <code class="docutils literal notranslate"><span class="pre">app</span></code>.
<code class="docutils literal notranslate"><span class="pre">app</span></code> is the callable inside of your application (usually the line reads
<code class="docutils literal notranslate"><span class="pre">app</span> <span class="pre">=</span> <span class="pre">Flask(__name__)</span></code>.</p>
<p>If you want to deploy your flask application inside of a virtual environment,
you need to also add <code class="docutils literal notranslate"><span class="pre">--virtualenv</span> <span class="pre">/path/to/virtual/environment</span></code>. You might
also need to add <code class="docutils literal notranslate"><span class="pre">--plugin</span> <span class="pre">python</span></code> or <code class="docutils literal notranslate"><span class="pre">--plugin</span> <span class="pre">python3</span></code> depending on which
python version you use for your project.</p>
</div>
<div class="section" id="configuring-nginx">
<h6>Configuring nginx<a class="headerlink" href="#configuring-nginx" title="Permalink to this headline">¶</a></h6>
<p>A basic flask nginx configuration looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>location = /yourapplication { rewrite ^ /yourapplication/; }
location /yourapplication { try_files $uri @yourapplication; }
location @yourapplication {
  include uwsgi_params;
  uwsgi_pass unix:/tmp/yourapplication.sock;
}
</pre></div>
</div>
<p>This configuration binds the application to <code class="docutils literal notranslate"><span class="pre">/yourapplication</span></code>.  If you want
to have it in the URL root its a bit simpler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>location / { try_files $uri @yourapplication; }
location @yourapplication {
    include uwsgi_params;
    uwsgi_pass unix:/tmp/yourapplication.sock;
}
</pre></div>
</div>
</div>
</div>
<span id="document-deploying/fastcgi"></span><div class="section" id="fastcgi">
<span id="deploying-fastcgi"></span><h5>FastCGI<a class="headerlink" href="#fastcgi" title="Permalink to this headline">¶</a></h5>
<p>FastCGI is a deployment option on servers like <a class="reference external" href="http://nginx.org/">nginx</a>, <a class="reference external" href="http://www.lighttpd.net/">lighttpd</a>, and
<a class="reference external" href="http://cherokee-project.com/">cherokee</a>; see <a class="reference internal" href="index.html#deploying-uwsgi"><span class="std std-ref">uWSGI</span></a> and <a class="reference internal" href="index.html#deploying-wsgi-standalone"><span class="std std-ref">Standalone WSGI Containers</span></a>
for other options.  To use your WSGI application with any of them you will need
a FastCGI server first.  The most popular one is <a class="reference external" href="https://pypi.org/project/flup/">flup</a> which we will use for
this guide.  Make sure to have it installed to follow along.</p>
<div class="admonition-watch-out admonition">
<p class="admonition-title">Watch Out</p>
<p>Please make sure in advance that any <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> calls you might
have in your application file are inside an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span>
<span class="pre">'__main__':</span></code> block or moved to a separate file.  Just make sure it’s
not called because this will always start a local WSGI server which
we do not want if we deploy that application to FastCGI.</p>
</div>
<div class="section" id="creating-a-fcgi-file">
<h6>Creating a <cite>.fcgi</cite> file<a class="headerlink" href="#creating-a-fcgi-file" title="Permalink to this headline">¶</a></h6>
<p>First you need to create the FastCGI server file.  Let’s call it
<cite>yourapplication.fcgi</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">flup.server.fcgi</span> <span class="k">import</span> <span class="n">WSGIServer</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">WSGIServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This is enough for Apache to work, however nginx and older versions of
lighttpd need a socket to be explicitly passed to communicate with the
FastCGI server.  For that to work you need to pass the path to the
socket to the <code class="xref py py-class docutils literal notranslate"><span class="pre">WSGIServer</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WSGIServer</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">bindAddress</span><span class="o">=</span><span class="s1">&#39;/path/to/fcgi.sock&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The path has to be the exact same path you define in the server
config.</p>
<p>Save the <code class="file docutils literal notranslate"><span class="pre">yourapplication.fcgi</span></code> file somewhere you will find it again.
It makes sense to have that in <code class="file docutils literal notranslate"><span class="pre">/var/www/yourapplication</span></code> or something
similar.</p>
<p>Make sure to set the executable bit on that file so that the servers
can execute it:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># chmod +x /var/www/yourapplication/yourapplication.fcgi
</pre></div>
</div>
</div>
<div class="section" id="configuring-apache">
<h6>Configuring Apache<a class="headerlink" href="#configuring-apache" title="Permalink to this headline">¶</a></h6>
<p>The example above is good enough for a basic Apache deployment but your
<cite>.fcgi</cite> file will appear in your application URL e.g.
<code class="docutils literal notranslate"><span class="pre">example.com/yourapplication.fcgi/news/</span></code>. There are few ways to configure
your application so that yourapplication.fcgi does not appear in the URL.
A preferable way is to use the ScriptAlias and SetHandler configuration
directives to route requests to the FastCGI server. The following example
uses FastCgiServer to start 5 instances of the application which will
handle all incoming requests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadModule</span> <span class="n">fastcgi_module</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">mod_fastcgi</span><span class="o">.</span><span class="n">so</span>

<span class="n">FastCgiServer</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">fcgi</span> <span class="o">-</span><span class="n">idle</span><span class="o">-</span><span class="n">timeout</span> <span class="mi">300</span> <span class="o">-</span><span class="n">processes</span> <span class="mi">5</span>

<span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*&gt;</span>
    <span class="n">ServerName</span> <span class="n">webapp1</span><span class="o">.</span><span class="n">mydomain</span><span class="o">.</span><span class="n">com</span>
    <span class="n">DocumentRoot</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span>

    <span class="n">AddHandler</span> <span class="n">fastcgi</span><span class="o">-</span><span class="n">script</span> <span class="n">fcgi</span>
    <span class="n">ScriptAlias</span> <span class="o">/</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">fcgi</span><span class="o">/</span>

    <span class="o">&lt;</span><span class="n">Location</span> <span class="o">/&gt;</span>
        <span class="n">SetHandler</span> <span class="n">fastcgi</span><span class="o">-</span><span class="n">script</span>
    <span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>These processes will be managed by Apache. If you’re using a standalone
FastCGI server, you can use the FastCgiExternalServer directive instead.
Note that in the following the path is not real, it’s simply used as an
identifier to other
directives such as AliasMatch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FastCgiServer</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span> <span class="o">-</span><span class="n">host</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3000</span>
</pre></div>
</div>
<p>If you cannot set ScriptAlias, for example on a shared web host, you can use
WSGI middleware to remove yourapplication.fcgi from the URLs. Set .htaccess:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;IfModule mod_fcgid.c&gt;
   AddHandler fcgid-script .fcgi
   &lt;Files ~ (\.fcgi)&gt;
       SetHandler fcgid-script
       Options +FollowSymLinks +ExecCGI
   &lt;/Files&gt;
&lt;/IfModule&gt;

&lt;IfModule mod_rewrite.c&gt;
   Options +FollowSymlinks
   RewriteEngine On
   RewriteBase /
   RewriteCond %{REQUEST_FILENAME} !-f
   RewriteRule ^(.*)$ yourapplication.fcgi/$1 [QSA,L]
&lt;/IfModule&gt;
</pre></div>
</div>
<p>Set yourapplication.fcgi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1">#: optional path to your local python site-packages folder</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;your_local_path&gt;/lib/python2.6/site-packages&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flup.server.fcgi</span> <span class="k">import</span> <span class="n">WSGIServer</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="k">class</span> <span class="nc">ScriptNameStripper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>

   <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
       <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ScriptNameStripper</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">WSGIServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-lighttpd">
<h6>Configuring lighttpd<a class="headerlink" href="#configuring-lighttpd" title="Permalink to this headline">¶</a></h6>
<p>A basic FastCGI configuration for lighttpd looks like that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fastcgi</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;/yourapplication.fcgi&quot;</span> <span class="o">=&gt;</span>
    <span class="p">((</span>
        <span class="s2">&quot;socket&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/tmp/yourapplication-fcgi.sock&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bin-path&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/www/yourapplication/yourapplication.fcgi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;check-local&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;disable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max-procs&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">))</span>
<span class="p">)</span>

<span class="n">alias</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;/static/&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/path/to/your/static&quot;</span>
<span class="p">)</span>

<span class="n">url</span><span class="o">.</span><span class="n">rewrite</span><span class="o">-</span><span class="n">once</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;^(/static($|/.*))$&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;$1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;^(/.*)$&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/yourapplication.fcgi$1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Remember to enable the FastCGI, alias and rewrite modules. This configuration
binds the application to <code class="docutils literal notranslate"><span class="pre">/yourapplication</span></code>.  If you want the application to
work in the URL root you have to work around a lighttpd bug with the
<code class="xref py py-class docutils literal notranslate"><span class="pre">LighttpdCGIRootFix</span></code> middleware.</p>
<p>Make sure to apply it only if you are mounting the application the URL
root. Also, see the Lighty docs for more information on <a class="reference external" href="http://redmine.lighttpd.net/projects/lighttpd/wiki/Docs_ModFastCGI">FastCGI and Python</a> (note that
explicitly passing a socket to run() is no longer necessary).</p>
</div>
<div class="section" id="configuring-nginx">
<h6>Configuring nginx<a class="headerlink" href="#configuring-nginx" title="Permalink to this headline">¶</a></h6>
<p>Installing FastCGI applications on nginx is a bit different because by
default no FastCGI parameters are forwarded.</p>
<p>A basic Flask FastCGI configuration for nginx looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>location = /yourapplication { rewrite ^ /yourapplication/ last; }
location /yourapplication { try_files $uri @yourapplication; }
location @yourapplication {
    include fastcgi_params;
    fastcgi_split_path_info ^(/yourapplication)(.*)$;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param SCRIPT_NAME $fastcgi_script_name;
    fastcgi_pass unix:/tmp/yourapplication-fcgi.sock;
}
</pre></div>
</div>
<p>This configuration binds the application to <code class="docutils literal notranslate"><span class="pre">/yourapplication</span></code>.  If you
want to have it in the URL root it’s a bit simpler because you don’t
have to figure out how to calculate <code class="docutils literal notranslate"><span class="pre">PATH_INFO</span></code> and <code class="docutils literal notranslate"><span class="pre">SCRIPT_NAME</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>location / { try_files $uri @yourapplication; }
location @yourapplication {
    include fastcgi_params;
    fastcgi_param PATH_INFO $fastcgi_script_name;
    fastcgi_param SCRIPT_NAME &quot;&quot;;
    fastcgi_pass unix:/tmp/yourapplication-fcgi.sock;
}
</pre></div>
</div>
</div>
<div class="section" id="running-fastcgi-processes">
<h6>Running FastCGI Processes<a class="headerlink" href="#running-fastcgi-processes" title="Permalink to this headline">¶</a></h6>
<p>Since nginx and others do not load FastCGI apps, you have to do it by
yourself.  <a class="reference external" href="http://supervisord.org/configuration.html#fcgi-program-x-section-settings">Supervisor can manage FastCGI processes.</a>
You can look around for other FastCGI process managers or write a script
to run your <cite>.fcgi</cite> file at boot, e.g. using a SysV <code class="docutils literal notranslate"><span class="pre">init.d</span></code> script.
For a temporary solution, you can always run the <code class="docutils literal notranslate"><span class="pre">.fcgi</span></code> script inside
GNU screen.  See <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">screen</span></code> for details, and note that this is a
manual solution which does not persist across system restart:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ screen
$ /var/www/yourapplication/yourapplication.fcgi
</pre></div>
</div>
</div>
<div class="section" id="debugging">
<h6>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h6>
<p>FastCGI deployments tend to be hard to debug on most web servers.  Very
often the only thing the server log tells you is something along the
lines of “premature end of headers”.  In order to debug the application
the only thing that can really give you ideas why it breaks is switching
to the correct user and executing the application by hand.</p>
<p>This example assumes your application is called <cite>application.fcgi</cite> and
that your web server user is <cite>www-data</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ su www-data
$ cd /var/www/yourapplication
$ python application.fcgi
Traceback (most recent call last):
  File &quot;yourapplication.fcgi&quot;, line 4, in &lt;module&gt;
ImportError: No module named yourapplication
</pre></div>
</div>
<p>In this case the error seems to be “yourapplication” not being on the
python path.  Common problems are:</p>
<ul class="simple">
<li><p>Relative paths being used.  Don’t rely on the current working directory.</p></li>
<li><p>The code depending on environment variables that are not set by the
web server.</p></li>
<li><p>Different python interpreters being used.</p></li>
</ul>
</div>
</div>
<span id="document-deploying/cgi"></span><div class="section" id="cgi">
<h5>CGI<a class="headerlink" href="#cgi" title="Permalink to this headline">¶</a></h5>
<p>If all other deployment methods do not work, CGI will work for sure.
CGI is supported by all major servers but usually has a sub-optimal
performance.</p>
<p>This is also the way you can use a Flask application on Google’s <a class="reference external" href="https://developers.google.com/appengine/">App
Engine</a>, where execution happens in a CGI-like environment.</p>
<div class="admonition-watch-out admonition">
<p class="admonition-title">Watch Out</p>
<p>Please make sure in advance that any <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> calls you might
have in your application file are inside an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span>
<span class="pre">'__main__':</span></code> block or moved to a separate file.  Just make sure it’s
not called because this will always start a local WSGI server which
we do not want if we deploy that application to CGI / app engine.</p>
<p>With CGI, you will also have to make sure that your code does not contain
any <code class="docutils literal notranslate"><span class="pre">print</span></code> statements, or that <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> is overridden by something
that doesn’t write into the HTTP response.</p>
</div>
<div class="section" id="creating-a-cgi-file">
<h6>Creating a <cite>.cgi</cite> file<a class="headerlink" href="#creating-a-cgi-file" title="Permalink to this headline">¶</a></h6>
<p>First you need to create the CGI application file.  Let’s call it
<code class="file docutils literal notranslate"><span class="pre">yourapplication.cgi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">wsgiref.handlers</span> <span class="k">import</span> <span class="n">CGIHandler</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="n">CGIHandler</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="server-setup">
<h6>Server Setup<a class="headerlink" href="#server-setup" title="Permalink to this headline">¶</a></h6>
<p>Usually there are two ways to configure the server.  Either just copy the
<code class="docutils literal notranslate"><span class="pre">.cgi</span></code> into a <code class="file docutils literal notranslate"><span class="pre">cgi-bin</span></code> (and use <cite>mod_rewrite</cite> or something similar to
rewrite the URL) or let the server point to the file directly.</p>
<p>In Apache for example you can put something like this into the config:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">ScriptAlias</span> <span class="sx">/app</span> <span class="sx">/path/to/the/application.cgi</span>
</pre></div>
</div>
<p>On shared webhosting, though, you might not have access to your Apache config.
In this case, a file called <code class="docutils literal notranslate"><span class="pre">.htaccess</span></code>, sitting in the public directory you want
your app to be available, works too but the <code class="docutils literal notranslate"><span class="pre">ScriptAlias</span></code> directive won’t
work in that case:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">RewriteEngine</span> <span class="k">On</span>
<span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f # Don&#39;t interfere with static files
<span class="nb">RewriteRule</span> ^(.*)$ <span class="sx">/path/to/the/application.cgi/</span>$1 [L]
</pre></div>
</div>
<p>For more information consult the documentation of your webserver.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-becomingbig"></span><div class="section" id="becoming-big">
<span id="becomingbig"></span><h3>Becoming Big<a class="headerlink" href="#becoming-big" title="Permalink to this headline">¶</a></h3>
<p>Here are your options when growing your codebase or scaling your application.</p>
<div class="section" id="read-the-source">
<h4>Read the Source.<a class="headerlink" href="#read-the-source" title="Permalink to this headline">¶</a></h4>
<p>Flask started in part to demonstrate how to build your own framework on top of
existing well-used tools Werkzeug (WSGI) and Jinja (templating), and as it
developed, it became useful to a wide audience.  As you grow your codebase,
don’t just use Flask – understand it.  Read the source.  Flask’s code is
written to be read; its documentation is published so you can use its internal
APIs.  Flask sticks to documented APIs in upstream libraries, and documents its
internal utilities so that you can find the hook points needed for your
project.</p>
</div>
<div class="section" id="hook-extend">
<h4>Hook. Extend.<a class="headerlink" href="#hook-extend" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="index.html#api"><span class="std std-ref">API</span></a> docs are full of available overrides, hook points, and
<a class="reference internal" href="index.html#signals"><span class="std std-ref">Signals</span></a>. You can provide custom classes for things like the request and
response objects.  Dig deeper on the APIs you use, and look for the
customizations which are available out of the box in a Flask release.  Look for
ways in which your project can be refactored into a collection of utilities and
Flask extensions.  Explore the many <a class="reference external" href="http://flask.pocoo.org/extensions/">extensions</a> in the community, and look for patterns to
build your own extensions if you do not find the tools you need.</p>
</div>
<div class="section" id="subclass">
<h4>Subclass.<a class="headerlink" href="#subclass" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> class has many methods designed for subclassing. You
can quickly add or customize behavior by subclassing <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> (see
the linked method docs) and using that subclass wherever you instantiate an
application class. This works well with <a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a>. See <a class="reference internal" href="index.html#document-patterns/subclassing"><span class="doc">Subclassing Flask</span></a> for an example.</p>
</div>
<div class="section" id="wrap-with-middleware">
<h4>Wrap with middleware.<a class="headerlink" href="#wrap-with-middleware" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="index.html#app-dispatch"><span class="std std-ref">Application Dispatching</span></a> chapter shows in detail how to apply middleware. You
can introduce WSGI middleware to wrap your Flask instances and introduce fixes
and changes at the layer between your Flask application and your HTTP
server. Werkzeug includes several <a class="reference external" href="http://werkzeug.pocoo.org/docs/middlewares/">middlewares</a>.</p>
</div>
<div class="section" id="fork">
<h4>Fork.<a class="headerlink" href="#fork" title="Permalink to this headline">¶</a></h4>
<p>If none of the above options work, fork Flask.  The majority of code of Flask
is within Werkzeug and Jinja2.  These libraries do the majority of the work.
Flask is just the paste that glues those together.  For every project there is
the point where the underlying framework gets in the way (due to assumptions
the original developers had).  This is natural because if this would not be the
case, the framework would be a very complex system to begin with which causes a
steep learning curve and a lot of user frustration.</p>
<p>This is not unique to Flask.  Many people use patched and modified
versions of their framework to counter shortcomings.  This idea is also
reflected in the license of Flask.  You don’t have to contribute any
changes back if you decide to modify the framework.</p>
<p>The downside of forking is of course that Flask extensions will most
likely break because the new framework has a different import name.
Furthermore integrating upstream changes can be a complex process,
depending on the number of changes.  Because of that, forking should be
the very last resort.</p>
</div>
<div class="section" id="scale-like-a-pro">
<h4>Scale like a pro.<a class="headerlink" href="#scale-like-a-pro" title="Permalink to this headline">¶</a></h4>
<p>For many web applications the complexity of the code is less an issue than
the scaling for the number of users or data entries expected.  Flask by
itself is only limited in terms of scaling by your application code, the
data store you want to use and the Python implementation and webserver you
are running on.</p>
<p>Scaling well means for example that if you double the amount of servers
you get about twice the performance.  Scaling bad means that if you add a
new server the application won’t perform any better or would not even
support a second server.</p>
<p>There is only one limiting factor regarding scaling in Flask which are
the context local proxies.  They depend on context which in Flask is
defined as being either a thread, process or greenlet.  If your server
uses some kind of concurrency that is not based on threads or greenlets,
Flask will no longer be able to support these global proxies.  However the
majority of servers are using either threads, greenlets or separate
processes to achieve concurrency which are all methods well supported by
the underlying Werkzeug library.</p>
</div>
<div class="section" id="discuss-with-the-community">
<h4>Discuss with the community.<a class="headerlink" href="#discuss-with-the-community" title="Permalink to this headline">¶</a></h4>
<p>The Flask developers keep the framework accessible to users with codebases big
and small. If you find an obstacle in your way, caused by Flask, don’t hesitate
to contact the developers on the mailinglist or IRC channel.  The best way for
the Flask and Flask extension developers to improve the tools for larger
applications is getting feedback from users.</p>
</div>
</div>
</div>
</div>
<div class="section" id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<p>If you are looking for information on a specific function, class or
method, this part of the documentation is for you.</p>
<div class="toctree-wrapper compound">
<span id="document-api"></span><div class="section" id="api">
<span id="id1"></span><h3>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-flask"></span><p>This part of the documentation covers all the interfaces of Flask.  For
parts where Flask depends on external libraries, we document the most
important right here and provide links to the canonical documentation.</p>
<div class="section" id="application-object">
<h4>Application Object<a class="headerlink" href="#application-object" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.Flask">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">Flask</code><span class="sig-paren">(</span><em class="sig-param">import_name</em>, <em class="sig-param">static_path=None</em>, <em class="sig-param">static_url_path=None</em>, <em class="sig-param">static_folder='static'</em>, <em class="sig-param">template_folder='templates'</em>, <em class="sig-param">instance_path=None</em>, <em class="sig-param">instance_relative_config=False</em>, <em class="sig-param">root_path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask" title="Permalink to this definition">¶</a></dt>
<dd><p>The flask object implements a WSGI application and acts as the central
object.  It is passed the name of the module or package of the
application.  Once it is created it will act as a central registry for
the view functions, the URL rules, template configuration and much more.</p>
<p>The name of the package is used to resolve resources from inside the
package or the folder the module is contained in depending on if the
package parameter resolves to an actual python package (a folder with
an <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code> file inside) or a standard module (just a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file).</p>
<p>For more information about resource loading, see <a class="reference internal" href="#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">open_resource()</span></code></a>.</p>
<p>Usually you create a <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> instance in your main module or
in the <code class="file docutils literal notranslate"><span class="pre">__init__.py</span></code> file of your package like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-about-the-first-parameter admonition">
<p class="admonition-title">About the First Parameter</p>
<p>The idea of the first parameter is to give Flask an idea of what
belongs to your application.  This name is used to find resources
on the filesystem, can be used by extensions to improve debugging
information and a lot more.</p>
<p>So it’s important what you provide there.  If you are using a single
module, <cite>__name__</cite> is always the correct value.  If you however are
using a package, it’s usually recommended to hardcode the name of
your package there.</p>
<p>For example if your application is defined in <code class="file docutils literal notranslate"><span class="pre">yourapplication/app.py</span></code>
you should create it with one of the two versions below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s1">&#39;yourapplication&#39;</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>Why is that?  The application will work even with <cite>__name__</cite>, thanks
to how resources are looked up.  However it will make debugging more
painful.  Certain extensions can make assumptions based on the
import name of your application.  For example the Flask-SQLAlchemy
extension will look for the code in your application that triggered
an SQL query in debug mode.  If the import name is not properly set
up, that debugging information is lost.  (For example it would only
pick up SQL queries in <cite>yourapplication.app</cite> and not
<cite>yourapplication.views.frontend</cite>)</p>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11: </span>The <cite>root_path</cite> parameter was added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.8: </span>The <cite>instance_path</cite> and <cite>instance_relative_config</cite> parameters were
added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7: </span>The <cite>static_url_path</cite>, <cite>static_folder</cite>, and <cite>template_folder</cite>
parameters were added.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>import_name</strong> – the name of the application package</p></li>
<li><p><strong>static_url_path</strong> – can be used to specify a different path for the
static files on the web.  Defaults to the name
of the <cite>static_folder</cite> folder.</p></li>
<li><p><strong>static_folder</strong> – the folder with static files that should be served
at <cite>static_url_path</cite>.  Defaults to the <code class="docutils literal notranslate"><span class="pre">'static'</span></code>
folder in the root path of the application.</p></li>
<li><p><strong>template_folder</strong> – the folder that contains the templates that should
be used by the application.  Defaults to
<code class="docutils literal notranslate"><span class="pre">'templates'</span></code> folder in the root path of the
application.</p></li>
<li><p><strong>instance_path</strong> – An alternative instance path for the application.
By default the folder <code class="docutils literal notranslate"><span class="pre">'instance'</span></code> next to the
package or module is assumed to be the instance
path.</p></li>
<li><p><strong>instance_relative_config</strong> – if set to <code class="docutils literal notranslate"><span class="pre">True</span></code> relative filenames
for loading the config are assumed to
be relative to the instance path instead
of the application root.</p></li>
<li><p><strong>root_path</strong> – Flask by default will automatically calculate the path
to the root of the application.  In certain situations
this cannot be achieved (for instance if the package
is a Python 3 namespace package) and needs to be
manually defined.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="flask.Flask.add_template_filter">
<code class="sig-name descname">add_template_filter</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_template_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template filter.  Works exactly like the
<a class="reference internal" href="#flask.Flask.template_filter" title="flask.Flask.template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_filter()</span></code></a> decorator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.add_template_global">
<code class="sig-name descname">add_template_global</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_template_global" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template global function. Works exactly like the
<a class="reference internal" href="#flask.Flask.template_global" title="flask.Flask.template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_global()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the global function, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.add_template_test">
<code class="sig-name descname">add_template_test</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_template_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template test.  Works exactly like the
<a class="reference internal" href="#flask.Flask.template_test" title="flask.Flask.template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_test()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.add_url_rule">
<code class="sig-name descname">add_url_rule</code><span class="sig-paren">(</span><em class="sig-param">rule</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">view_func=None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_url_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects a URL rule.  Works exactly like the <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a>
decorator.  If a view_func is provided it will be registered with the
endpoint.</p>
<p>Basically this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Is equivalent to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<p>If the view_func is not provided you will need to connect the endpoint
to a view function like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">view_functions</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</pre></div>
</div>
<p>Internally <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> invokes <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> so if you want
to customize the behavior via subclassing you only need to change
this method.</p>
<p>For more information refer to <a class="reference internal" href="#url-route-registrations"><span class="std std-ref">URL Route Registrations</span></a>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.6: </span><code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> is added automatically as method.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.2: </span><cite>view_func</cite> parameter added.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rule</strong> – the URL rule as string</p></li>
<li><p><strong>endpoint</strong> – the endpoint for the registered URL rule.  Flask
itself assumes the name of the view function as
endpoint</p></li>
<li><p><strong>view_func</strong> – the function to call when serving a request to the
provided endpoint</p></li>
<li><p><strong>options</strong> – the options to be forwarded to the underlying
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Rule" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> object.  A change
to Werkzeug is handling of method options.  methods
is a list of methods this rule should be limited
to (<code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code> etc.).  By default a rule
just listens for <code class="docutils literal notranslate"><span class="pre">GET</span></code> (and implicitly <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>).
Starting with Flask 0.6, <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> is implicitly
added and handled by the standard request handling.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.after_request">
<code class="sig-name descname">after_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.after_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a function to be run after each request.</p>
<p>Your function must take one parameter, an instance of
<a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a> and return a new response object or the
same (see <a class="reference internal" href="#flask.Flask.process_response" title="flask.Flask.process_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_response()</span></code></a>).</p>
<p>As of Flask 0.7 this function might not be executed at the end of the
request in case an unhandled exception occurred.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.after_request_funcs">
<code class="sig-name descname">after_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.after_request_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with lists of functions that should be called after
each request.  The key of the dictionary is the name of the blueprint
this function is active for, <code class="docutils literal notranslate"><span class="pre">None</span></code> for all requests.  This can for
example be used to close database connections. To register a function
here, use the <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.app_context">
<code class="sig-name descname">app_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.app_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Binds the application only.  For as long as the application is bound
to the current context the <a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.current_app</span></code></a> points to that
application.  An application context is automatically created when a
request context is pushed if necessary.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.app_ctx_globals_class">
<code class="sig-name descname">app_ctx_globals_class</code><a class="headerlink" href="#flask.Flask.app_ctx_globals_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.ctx._AppCtxGlobals</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.auto_find_instance_path">
<code class="sig-name descname">auto_find_instance_path</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.auto_find_instance_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to locate the instance path if it was not provided to the
constructor of the application class.  It will basically calculate
the path to a folder named <code class="docutils literal notranslate"><span class="pre">instance</span></code> next to your main file or
the package.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.before_first_request">
<code class="sig-name descname">before_first_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.before_first_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a function to be run before the first request to this
instance of the application.</p>
<p>The function will be called without any arguments and its return
value is ignored.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.before_first_request_funcs">
<code class="sig-name descname">before_first_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.before_first_request_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>A lists of functions that should be called at the beginning of the
first request to this instance.  To register a function here, use
the <a class="reference internal" href="#flask.Flask.before_first_request" title="flask.Flask.before_first_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_first_request()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.before_request">
<code class="sig-name descname">before_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.before_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a function to run before each request.</p>
<p>The function will be called without any arguments.
If the function returns a non-None value, it’s handled as
if it was the return value from the view and further
request handling is stopped.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.before_request_funcs">
<code class="sig-name descname">before_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.before_request_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with lists of functions that should be called at the
beginning of the request.  The key of the dictionary is the name of
the blueprint this function is active for, <code class="docutils literal notranslate"><span class="pre">None</span></code> for all requests.
This can for example be used to open database connections or
getting hold of the currently logged in user.  To register a
function here, use the <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> decorator.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.blueprints">
<code class="sig-name descname">blueprints</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.blueprints" title="Permalink to this definition">¶</a></dt>
<dd><p>all the attached blueprints in a dictionary by name.  Blueprints
can be attached multiple times so this dictionary does not tell
you how often they got attached.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.cli">
<code class="sig-name descname">cli</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.cli" title="Permalink to this definition">¶</a></dt>
<dd><p>The click command line context for this application.  Commands
registered here show up in the <strong class="command">flask</strong> command once the
application has been discovered.  The default commands are
provided by Flask itself and can be overridden.</p>
<p>This is an instance of a <a class="reference external" href="https://click.palletsprojects.com/en/7.x/api/#click.Group" title="(in Click v7.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">click.Group</span></code></a> object.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.config">
<code class="sig-name descname">config</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.config" title="Permalink to this definition">¶</a></dt>
<dd><p>The configuration dictionary as <a class="reference internal" href="#flask.Config" title="flask.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a>.  This behaves
exactly like a regular dictionary but supports additional methods
to load a config from files.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.config_class">
<code class="sig-name descname">config_class</code><a class="headerlink" href="#flask.Flask.config_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.config.Config</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.context_processor">
<code class="sig-name descname">context_processor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.context_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a template context processor function.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.create_global_jinja_loader">
<code class="sig-name descname">create_global_jinja_loader</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.create_global_jinja_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the loader for the Jinja2 environment.  Can be used to
override just the loader and keeping the rest unchanged.  It’s
discouraged to override this function.  Instead one should override
the <a class="reference internal" href="#flask.Flask.jinja_loader" title="flask.Flask.jinja_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">jinja_loader()</span></code></a> function instead.</p>
<p>The global loader dispatches between the loaders of the application
and the individual blueprints.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.create_jinja_environment">
<code class="sig-name descname">create_jinja_environment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.create_jinja_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the Jinja2 environment based on <a class="reference internal" href="#flask.Flask.jinja_options" title="flask.Flask.jinja_options"><code class="xref py py-attr docutils literal notranslate"><span class="pre">jinja_options</span></code></a>
and <a class="reference internal" href="#flask.Flask.select_jinja_autoescape" title="flask.Flask.select_jinja_autoescape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_jinja_autoescape()</span></code></a>.  Since 0.7 this also adds
the Jinja2 globals and filters after initialization.  Override
this function to customize the behavior.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11: </span><code class="docutils literal notranslate"><span class="pre">Environment.auto_reload</span></code> set in accordance with
<code class="docutils literal notranslate"><span class="pre">TEMPLATES_AUTO_RELOAD</span></code> configuration option.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.create_url_adapter">
<code class="sig-name descname">create_url_adapter</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.create_url_adapter" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a URL adapter for the given request.  The URL adapter
is created at a point where the request context is not yet set up
so the request is passed explicitly.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9: </span>This can now also be called without a request object when the
URL adapter is created for the application context.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.debug">
<code class="sig-name descname">debug</code><a class="headerlink" href="#flask.Flask.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>The debug flag.  Set this to <code class="docutils literal notranslate"><span class="pre">True</span></code> to enable debugging of the
application.  In debug mode the debugger will kick in when an unhandled
exception occurs and the integrated server will automatically reload
the application if changes in the code are detected.</p>
<p>This attribute can also be configured from the config with the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>
configuration key.  Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.default_config">
<code class="sig-name descname">default_config</code><em class="property"> = {'APPLICATION_ROOT': None, 'DEBUG': False, 'EXPLAIN_TEMPLATE_LOADING': False, 'JSONIFY_MIMETYPE': 'application/json', 'JSONIFY_PRETTYPRINT_REGULAR': True, 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'LOGGER_HANDLER_POLICY': 'always', 'LOGGER_NAME': None, 'MAX_CONTENT_LENGTH': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'PREFERRED_URL_SCHEME': 'http', 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'PROPAGATE_EXCEPTIONS': None, 'SECRET_KEY': None, 'SEND_FILE_MAX_AGE_DEFAULT': datetime.timedelta(seconds=43200), 'SERVER_NAME': None, 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_SECURE': False, 'SESSION_REFRESH_EACH_REQUEST': True, 'TEMPLATES_AUTO_RELOAD': None, 'TESTING': False, 'TRAP_BAD_REQUEST_ERRORS': False, 'TRAP_HTTP_EXCEPTIONS': False, 'USE_X_SENDFILE': False}</em><a class="headerlink" href="#flask.Flask.default_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Default configuration parameters.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.dispatch_request">
<code class="sig-name descname">dispatch_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.dispatch_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Does the request dispatching.  Matches the URL and returns the
return value of the view or error handler.  This does not have to
be a response object.  In order to convert the return value to a
proper response object, call <a class="reference internal" href="#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_response()</span></code></a>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7: </span>This no longer does the exception handling, this code was
moved to the new <a class="reference internal" href="#flask.Flask.full_dispatch_request" title="flask.Flask.full_dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">full_dispatch_request()</span></code></a>.</p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.do_teardown_appcontext">
<code class="sig-name descname">do_teardown_appcontext</code><span class="sig-paren">(</span><em class="sig-param">exc=&lt;object object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.do_teardown_appcontext" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when an application context is popped.  This works pretty
much the same as <a class="reference internal" href="#flask.Flask.do_teardown_request" title="flask.Flask.do_teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">do_teardown_request()</span></code></a> but for the application
context.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.do_teardown_request">
<code class="sig-name descname">do_teardown_request</code><span class="sig-paren">(</span><em class="sig-param">exc=&lt;object object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.do_teardown_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Called after the actual request dispatching and will
call every as <a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorated function.  This is
not actually called by the <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> object itself but is always
triggered when the request context is popped.  That way we have a
tighter control over certain resources under testing environments.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9: </span>Added the <cite>exc</cite> argument.  Previously this was always using the
current exception information.</p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.endpoint">
<code class="sig-name descname">endpoint</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.endpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator to register a function as an endpoint.
Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">endpoint</span><span class="p">(</span><span class="s1">&#39;example.endpoint&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;example&quot;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>endpoint</strong> – the name of the endpoint</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.error_handler_spec">
<code class="sig-name descname">error_handler_spec</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.error_handler_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of all registered error handlers.  The key is <code class="docutils literal notranslate"><span class="pre">None</span></code>
for error handlers active on the application, otherwise the key is
the name of the blueprint.  Each key points to another dictionary
where the key is the status code of the http exception.  The
special key <code class="docutils literal notranslate"><span class="pre">None</span></code> points to a list of tuples where the first item
is the class for the instance check and the second the error handler
function.</p>
<p>To register a error handler, use the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a>
decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.errorhandler">
<code class="sig-name descname">errorhandler</code><span class="sig-paren">(</span><em class="sig-param">code_or_exception</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.errorhandler" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator that is used to register a function given an
error code.  Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;This page does not exist&#39;</span><span class="p">,</span> <span class="mi">404</span>
</pre></div>
</div>
<p>You can also register handlers for arbitrary exceptions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">DatabaseError</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">special_exception_handler</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;Database connection failed&#39;</span><span class="p">,</span> <span class="mi">500</span>
</pre></div>
</div>
<p>You can also register a function as error handler without using
the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> decorator.  The following example is
equivalent to the one above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;This page does not exist&#39;</span><span class="p">,</span> <span class="mi">404</span>
<span class="n">app</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="p">[</span><span class="kc">None</span><span class="p">][</span><span class="mi">404</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_not_found</span>
</pre></div>
</div>
<p>Setting error handlers via assignments to <a class="reference internal" href="#flask.Flask.error_handler_spec" title="flask.Flask.error_handler_spec"><code class="xref py py-attr docutils literal notranslate"><span class="pre">error_handler_spec</span></code></a>
however is discouraged as it requires fiddling with nested dictionaries
and the special case for arbitrary exception types.</p>
<p>The first <code class="docutils literal notranslate"><span class="pre">None</span></code> refers to the active blueprint.  If the error
handler should be application wide <code class="docutils literal notranslate"><span class="pre">None</span></code> shall be used.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7: </span>Use <a class="reference internal" href="#flask.Flask.register_error_handler" title="flask.Flask.register_error_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code></a> instead of modifying
<a class="reference internal" href="#flask.Flask.error_handler_spec" title="flask.Flask.error_handler_spec"><code class="xref py py-attr docutils literal notranslate"><span class="pre">error_handler_spec</span></code></a> directly, for application wide error
handlers.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7: </span>One can now additionally also register custom exception types
that do not necessarily have to be a subclass of the
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.HTTPException" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a> class.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>code_or_exception</strong> – the code as integer for the handler, or
an arbitrary exception</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.extensions">
<code class="sig-name descname">extensions</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.extensions" title="Permalink to this definition">¶</a></dt>
<dd><p>a place where extensions can store application specific state.  For
example this is where an extension could store database engines and
similar things.  For backwards compatibility extensions should register
themselves like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;extensions&#39;</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">extensions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">app</span><span class="o">.</span><span class="n">extensions</span><span class="p">[</span><span class="s1">&#39;extensionname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SomeObject</span><span class="p">()</span>
</pre></div>
</div>
<p>The key must match the name of the extension module. For example in
case of a “Flask-Foo” extension in <cite>flask_foo</cite>, the key would be
<code class="docutils literal notranslate"><span class="pre">'foo'</span></code>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.full_dispatch_request">
<code class="sig-name descname">full_dispatch_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.full_dispatch_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispatches the request and on top of that performs request
pre and postprocessing as well as HTTP exception catching and
error handling.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.get_send_file_max_age">
<code class="sig-name descname">get_send_file_max_age</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.get_send_file_max_age" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides default cache_timeout for the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> functions.</p>
<p>By default, this function returns <code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code> from
the configuration of <a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</p>
<p>Static file functions such as <a class="reference internal" href="#flask.send_from_directory" title="flask.send_from_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_from_directory()</span></code></a> use this
function, and <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> calls this function on
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> when the given cache_timeout is <code class="docutils literal notranslate"><span class="pre">None</span></code>. If a
cache_timeout is given in <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>, that timeout is used;
otherwise, this method is called.</p>
<p>This allows subclasses to change the behavior when sending files based
on the filename.  For example, to set the cache timeout for .js files
to 60 seconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFlask</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">60</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="o">.</span><span class="n">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.got_first_request">
<em class="property">property </em><code class="sig-name descname">got_first_request</code><a class="headerlink" href="#flask.Flask.got_first_request" title="Permalink to this definition">¶</a></dt>
<dd><p>This attribute is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if the application started
handling the first request.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_exception">
<code class="sig-name descname">handle_exception</code><span class="sig-paren">(</span><em class="sig-param">e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Default exception handling that kicks in when an exception
occurs that is not caught.  In debug mode the exception will
be re-raised immediately, otherwise it is logged and the handler
for a 500 internal server error is used.  If no such handler
exists, a default 500 internal server error message is displayed.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_http_exception">
<code class="sig-name descname">handle_http_exception</code><span class="sig-paren">(</span><em class="sig-param">e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_http_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Handles an HTTP exception.  By default this will invoke the
registered error handlers and fall back to returning the
exception as response.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_url_build_error">
<code class="sig-name descname">handle_url_build_error</code><span class="sig-paren">(</span><em class="sig-param">error</em>, <em class="sig-param">endpoint</em>, <em class="sig-param">values</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_url_build_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildError</span></code> on <a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_user_exception">
<code class="sig-name descname">handle_user_exception</code><span class="sig-paren">(</span><em class="sig-param">e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_user_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called whenever an exception occurs that should be
handled.  A special case are
<code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code>s which are forwarded by
this function to the <a class="reference internal" href="#flask.Flask.handle_http_exception" title="flask.Flask.handle_http_exception"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_http_exception()</span></code></a> method.  This
function will either return a response value or reraise the
exception with the same traceback.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.has_static_folder">
<em class="property">property </em><code class="sig-name descname">has_static_folder</code><a class="headerlink" href="#flask.Flask.has_static_folder" title="Permalink to this definition">¶</a></dt>
<dd><p>This is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the package bound object’s container has a
folder for static files.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.init_jinja_globals">
<code class="sig-name descname">init_jinja_globals</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.init_jinja_globals" title="Permalink to this definition">¶</a></dt>
<dd><p>Deprecated.  Used to initialize the Jinja2 globals.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7: </span>This method is deprecated with 0.7.  Override
<a class="reference internal" href="#flask.Flask.create_jinja_environment" title="flask.Flask.create_jinja_environment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_jinja_environment()</span></code></a> instead.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.inject_url_defaults">
<code class="sig-name descname">inject_url_defaults</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">values</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.inject_url_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Injects the URL defaults for the given endpoint directly into
the values dictionary passed.  This is used internally and
automatically called on URL building.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.instance_path">
<code class="sig-name descname">instance_path</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.instance_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Holds the path to the instance folder.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.iter_blueprints">
<code class="sig-name descname">iter_blueprints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.iter_blueprints" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over all blueprints by the order they were registered.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_env">
<code class="sig-name descname">jinja_env</code><a class="headerlink" href="#flask.Flask.jinja_env" title="Permalink to this definition">¶</a></dt>
<dd><p>The Jinja2 environment used to load templates.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_environment">
<code class="sig-name descname">jinja_environment</code><a class="headerlink" href="#flask.Flask.jinja_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.templating.Environment</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_loader">
<code class="sig-name descname">jinja_loader</code><a class="headerlink" href="#flask.Flask.jinja_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>The Jinja loader for this package bound object.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_options">
<code class="sig-name descname">jinja_options</code><em class="property"> = {'extensions': ['jinja2.ext.autoescape', 'jinja2.ext.with_']}</em><a class="headerlink" href="#flask.Flask.jinja_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Options that are passed directly to the Jinja2 environment.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.json_decoder">
<code class="sig-name descname">json_decoder</code><a class="headerlink" href="#flask.Flask.json_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#flask.json.JSONDecoder" title="flask.json.JSONDecoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.json.JSONDecoder</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.json_encoder">
<code class="sig-name descname">json_encoder</code><a class="headerlink" href="#flask.Flask.json_encoder" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#flask.json.JSONEncoder" title="flask.json.JSONEncoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.json.JSONEncoder</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.log_exception">
<code class="sig-name descname">log_exception</code><span class="sig-paren">(</span><em class="sig-param">exc_info</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.log_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs an exception.  This is called by <a class="reference internal" href="#flask.Flask.handle_exception" title="flask.Flask.handle_exception"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_exception()</span></code></a>
if debugging is disabled and right before the handler is called.
The default implementation logs the exception as error on the
<a class="reference internal" href="#flask.Flask.logger" title="flask.Flask.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">logger</span></code></a>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.logger">
<em class="property">property </em><code class="sig-name descname">logger</code><a class="headerlink" href="#flask.Flask.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> object for this application.  The
default configuration is to log to stderr if the application is
in debug mode.  This logger can be used to (surprise) log messages.
Here some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;A value for debugging&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;A warning occurred (</span><span class="si">%d</span><span class="s1"> apples)&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;An error occurred&#39;</span><span class="p">)</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.3.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.logger_name">
<code class="sig-name descname">logger_name</code><a class="headerlink" href="#flask.Flask.logger_name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the logger to use.  By default the logger name is the
package name passed to the constructor.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.4.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.make_config">
<code class="sig-name descname">make_config</code><span class="sig-paren">(</span><em class="sig-param">instance_relative=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to create the config attribute by the Flask constructor.
The <cite>instance_relative</cite> parameter is passed in from the constructor
of Flask (there named <cite>instance_relative_config</cite>) and indicates if
the config should be relative to the instance path or the root path
of the application.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.make_default_options_response">
<code class="sig-name descname">make_default_options_response</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_default_options_response" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called to create the default <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> response.
This can be changed through subclassing to change the default
behavior of <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> responses.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.make_null_session">
<code class="sig-name descname">make_null_session</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_null_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new instance of a missing session.  Instead of overriding
this method we recommend replacing the <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">session_interface</span></code></a>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.make_response">
<code class="sig-name descname">make_response</code><span class="sig-paren">(</span><em class="sig-param">rv</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_response" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts the return value from a view function to a real
response object that is an instance of <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a>.</p>
<p>The following types are allowed for <cite>rv</cite>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a></p></td>
<td><p>the object is returned unchanged</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p></td>
<td><p>a response object is created with the
string as body</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">unicode</span></code></p></td>
<td><p>a response object is created with the
string encoded to utf-8 as body</p></td>
</tr>
<tr class="row-even"><td><p>a WSGI function</p></td>
<td><p>the function is called as WSGI application
and buffered as response object</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p></td>
<td><p>A tuple in the form <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">status,</span>
<span class="pre">headers)</span></code> or <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">headers)</span></code>
where <cite>response</cite> is any of the
types defined here, <cite>status</cite> is a string
or an integer and <cite>headers</cite> is a list or
a dictionary with header values.</p></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>rv</strong> – the return value from the view function</p>
</dd>
</dl>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9: </span>Previously a tuple was interpreted as the arguments for the
response object.</p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.make_shell_context">
<code class="sig-name descname">make_shell_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_shell_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the shell context for an interactive shell for this
application.  This runs all the registered shell context
processors.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#flask.Flask.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the application.  This is usually the import name
with the difference that it’s guessed from the run file if the
import name is main.  This name is used as a display name when
Flask needs the name of the application.  It can be set and overridden
to change the value.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.open_instance_resource">
<code class="sig-name descname">open_instance_resource</code><span class="sig-paren">(</span><em class="sig-param">resource</em>, <em class="sig-param">mode='rb'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.open_instance_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Opens a resource from the application’s instance folder
(<a class="reference internal" href="#flask.Flask.instance_path" title="flask.Flask.instance_path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">instance_path</span></code></a>).  Otherwise works like
<a class="reference internal" href="#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_resource()</span></code></a>.  Instance resources can also be opened for
writing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> – the name of the resource.  To access resources within
subfolders use forward slashes as separator.</p></li>
<li><p><strong>mode</strong> – resource file opening mode, default is ‘rb’.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.open_resource">
<code class="sig-name descname">open_resource</code><span class="sig-paren">(</span><em class="sig-param">resource</em>, <em class="sig-param">mode='rb'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.open_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Opens a resource from the application’s resource folder.  To see
how this works, consider the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapplication</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
<span class="o">/</span><span class="n">static</span>
    <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
<span class="o">/</span><span class="n">templates</span>
    <span class="o">/</span><span class="n">layout</span><span class="o">.</span><span class="n">html</span>
    <span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>If you want to open the <code class="file docutils literal notranslate"><span class="pre">schema.sql</span></code> file you would do the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> – the name of the resource.  To access resources within
subfolders use forward slashes as separator.</p></li>
<li><p><strong>mode</strong> – resource file opening mode, default is ‘rb’.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.open_session">
<code class="sig-name descname">open_session</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.open_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates or opens a new session.  Default implementation stores all
session data in a signed cookie.  This requires that the
<a class="reference internal" href="#flask.Flask.secret_key" title="flask.Flask.secret_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">secret_key</span></code></a> is set.  Instead of overriding this method
we recommend replacing the <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">session_interface</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> – an instance of <a class="reference internal" href="#flask.Flask.request_class" title="flask.Flask.request_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request_class</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.permanent_session_lifetime">
<code class="sig-name descname">permanent_session_lifetime</code><a class="headerlink" href="#flask.Flask.permanent_session_lifetime" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> which is used to set the expiration
date of a permanent session.  The default is 31 days which makes a
permanent session survive for roughly one month.</p>
<p>This attribute can also be configured from the config with the
<code class="docutils literal notranslate"><span class="pre">PERMANENT_SESSION_LIFETIME</span></code> configuration key.  Defaults to
<code class="docutils literal notranslate"><span class="pre">timedelta(days=31)</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.preprocess_request">
<code class="sig-name descname">preprocess_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.preprocess_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Called before the actual request dispatching and will
call each <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> decorated function, passing no
arguments.
If any of these functions returns a value, it’s handled as
if it was the return value from the view and further
request handling is stopped.</p>
<p>This also triggers the <a class="reference internal" href="#flask.Flask.url_value_preprocessor" title="flask.Flask.url_value_preprocessor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_value_preprocessor()</span></code></a> functions before
the actual <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> functions are called.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.preserve_context_on_exception">
<em class="property">property </em><code class="sig-name descname">preserve_context_on_exception</code><a class="headerlink" href="#flask.Flask.preserve_context_on_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the value of the <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code>
configuration value in case it’s set, otherwise a sensible default
is returned.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.process_response">
<code class="sig-name descname">process_response</code><span class="sig-paren">(</span><em class="sig-param">response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.process_response" title="Permalink to this definition">¶</a></dt>
<dd><p>Can be overridden in order to modify the response object
before it’s sent to the WSGI server.  By default this will
call all the <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> decorated functions.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5: </span>As of Flask 0.5 the functions registered for after request
execution are called in reverse order of registration.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>response</strong> – a <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a> object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new response object or the same, has to be an
instance of <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.propagate_exceptions">
<em class="property">property </em><code class="sig-name descname">propagate_exceptions</code><a class="headerlink" href="#flask.Flask.propagate_exceptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the value of the <code class="docutils literal notranslate"><span class="pre">PROPAGATE_EXCEPTIONS</span></code> configuration
value in case it’s set, otherwise a sensible default is returned.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.register_blueprint">
<code class="sig-name descname">register_blueprint</code><span class="sig-paren">(</span><em class="sig-param">blueprint</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.register_blueprint" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a blueprint on the application.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.register_error_handler">
<code class="sig-name descname">register_error_handler</code><span class="sig-paren">(</span><em class="sig-param">code_or_exception</em>, <em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.register_error_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Alternative error attach function to the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a>
decorator that is more straightforward to use for non decorator
usage.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.request_class">
<code class="sig-name descname">request_class</code><a class="headerlink" href="#flask.Flask.request_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.wrappers.Request</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.request_context">
<code class="sig-name descname">request_context</code><span class="sig-paren">(</span><em class="sig-param">environ</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.request_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a <a class="reference internal" href="#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> from the given
environment and binds it to the current context.  This must be used in
combination with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement because the request is only bound
to the current context for the duration of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>The object returned can also be used without the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement
which is useful for working in the shell.  The example above is
doing exactly the same as this code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.3: </span>Added support for non-with statement usage and <code class="docutils literal notranslate"><span class="pre">with</span></code> statement
is now passed the ctx object.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>environ</strong> – a WSGI environment</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.response_class">
<code class="sig-name descname">response_class</code><a class="headerlink" href="#flask.Flask.response_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.wrappers.Response</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.route">
<code class="sig-name descname">route</code><span class="sig-paren">(</span><em class="sig-param">rule</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.route" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator that is used to register a view function for a
given URL rule.  This does the same thing as <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a>
but is intended for decorator usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span>
</pre></div>
</div>
<p>For more information refer to <a class="reference internal" href="#url-route-registrations"><span class="std std-ref">URL Route Registrations</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rule</strong> – the URL rule as string</p></li>
<li><p><strong>endpoint</strong> – the endpoint for the registered URL rule.  Flask
itself assumes the name of the view function as
endpoint</p></li>
<li><p><strong>options</strong> – the options to be forwarded to the underlying
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Rule" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> object.  A change
to Werkzeug is handling of method options.  methods
is a list of methods this rule should be limited
to (<code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code> etc.).  By default a rule
just listens for <code class="docutils literal notranslate"><span class="pre">GET</span></code> (and implicitly <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>).
Starting with Flask 0.6, <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> is implicitly
added and handled by the standard request handling.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param">host=None</em>, <em class="sig-param">port=None</em>, <em class="sig-param">debug=None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the application on a local development server.</p>
<p>Do not use <code class="docutils literal notranslate"><span class="pre">run()</span></code> in a production setting. It is not intended to
meet security and performance requirements for a production server.
Instead, see <a class="reference internal" href="index.html#deployment"><span class="std std-ref">Deployment Options</span></a> for WSGI server recommendations.</p>
<p>If the <a class="reference internal" href="#flask.Flask.debug" title="flask.Flask.debug"><code class="xref py py-attr docutils literal notranslate"><span class="pre">debug</span></code></a> flag is set the server will automatically reload
for code changes and show a debugger in case an exception happened.</p>
<p>If you want to run the application in debug mode, but disable the
code execution on the interactive debugger, you can pass
<code class="docutils literal notranslate"><span class="pre">use_evalex=False</span></code> as parameter.  This will keep the debugger’s
traceback screen active, but disable code execution.</p>
<p>It is not recommended to use this function for development with
automatic reloading as this is badly supported.  Instead you should
be using the <strong class="command">flask</strong> command line script’s <code class="docutils literal notranslate"><span class="pre">run</span></code> support.</p>
<div class="admonition-keep-in-mind admonition">
<p class="admonition-title">Keep in Mind</p>
<p>Flask will suppress any server error with a generic error page
unless it is in debug mode.  As such to enable just the
interactive debugger without the code reloading, you have to
invoke <a class="reference internal" href="#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">debug=True</span></code> and <code class="docutils literal notranslate"><span class="pre">use_reloader=False</span></code>.
Setting <code class="docutils literal notranslate"><span class="pre">use_debugger</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> without being in debug mode
won’t catch any exceptions because there won’t be any to
catch.</p>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.10: </span>The default port is now picked from the <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> variable.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>host</strong> – the hostname to listen on. Set this to <code class="docutils literal notranslate"><span class="pre">'0.0.0.0'</span></code> to
have the server available externally as well. Defaults to
<code class="docutils literal notranslate"><span class="pre">'127.0.0.1'</span></code>.</p></li>
<li><p><strong>port</strong> – the port of the webserver. Defaults to <code class="docutils literal notranslate"><span class="pre">5000</span></code> or the
port defined in the <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> config variable if
present.</p></li>
<li><p><strong>debug</strong> – if given, enable or disable debug mode.
See <a class="reference internal" href="#flask.Flask.debug" title="flask.Flask.debug"><code class="xref py py-attr docutils literal notranslate"><span class="pre">debug</span></code></a>.</p></li>
<li><p><strong>options</strong> – the options to be forwarded to the underlying
Werkzeug server.  See
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/serving/#werkzeug.serving.run_simple" title="(in Werkzeug v1.0.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">werkzeug.serving.run_simple()</span></code></a> for more
information.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.save_session">
<code class="sig-name descname">save_session</code><span class="sig-paren">(</span><em class="sig-param">session</em>, <em class="sig-param">response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.save_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves the session if it needs updates.  For the default
implementation, check <a class="reference internal" href="#flask.Flask.open_session" title="flask.Flask.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a>.  Instead of overriding this
method we recommend replacing the <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">session_interface</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – the session to be saved (a
<code class="xref py py-class docutils literal notranslate"><span class="pre">SecureCookie</span></code>
object)</p></li>
<li><p><strong>response</strong> – an instance of <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.secret_key">
<code class="sig-name descname">secret_key</code><a class="headerlink" href="#flask.Flask.secret_key" title="Permalink to this definition">¶</a></dt>
<dd><p>If a secret key is set, cryptographic components can use this to
sign cookies and other things.  Set this to a complex random value
when you want to use the secure cookie for instance.</p>
<p>This attribute can also be configured from the config with the
<code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code> configuration key.  Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.select_jinja_autoescape">
<code class="sig-name descname">select_jinja_autoescape</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.select_jinja_autoescape" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if autoescaping should be active for the given
template name. If no template name is given, returns <cite>True</cite>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.send_file_max_age_default">
<code class="sig-name descname">send_file_max_age_default</code><a class="headerlink" href="#flask.Flask.send_file_max_age_default" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> which is used as default cache_timeout
for the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> functions. The default is 12 hours.</p>
<p>This attribute can also be configured from the config with the
<code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code> configuration key. This configuration
variable can also be set with an integer value used as seconds.
Defaults to <code class="docutils literal notranslate"><span class="pre">timedelta(hours=12)</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.send_static_file">
<code class="sig-name descname">send_static_file</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.send_static_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Function used internally to send static files from the static
folder to the browser.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.session_cookie_name">
<code class="sig-name descname">session_cookie_name</code><a class="headerlink" href="#flask.Flask.session_cookie_name" title="Permalink to this definition">¶</a></dt>
<dd><p>The secure cookie uses this for the name of the session cookie.</p>
<p>This attribute can also be configured from the config with the
<code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_NAME</span></code> configuration key.  Defaults to <code class="docutils literal notranslate"><span class="pre">'session'</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.session_interface">
<code class="sig-name descname">session_interface</code><em class="property"> = &lt;flask.sessions.SecureCookieSessionInterface object&gt;</em><a class="headerlink" href="#flask.Flask.session_interface" title="Permalink to this definition">¶</a></dt>
<dd><p>the session interface to use.  By default an instance of
<a class="reference internal" href="#flask.sessions.SecureCookieSessionInterface" title="flask.sessions.SecureCookieSessionInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureCookieSessionInterface</span></code></a> is used here.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.shell_context_processor">
<code class="sig-name descname">shell_context_processor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.shell_context_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a shell context processor function.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.shell_context_processors">
<code class="sig-name descname">shell_context_processors</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.shell_context_processors" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of shell context processor functions that should be run
when a shell context is created.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.should_ignore_error">
<code class="sig-name descname">should_ignore_error</code><span class="sig-paren">(</span><em class="sig-param">error</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.should_ignore_error" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called to figure out if an error should be ignored
or not as far as the teardown system is concerned.  If this
function returns <code class="docutils literal notranslate"><span class="pre">True</span></code> then the teardown handlers will not be
passed the error.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.static_folder">
<em class="property">property </em><code class="sig-name descname">static_folder</code><a class="headerlink" href="#flask.Flask.static_folder" title="Permalink to this definition">¶</a></dt>
<dd><p>The absolute path to the configured static folder.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.teardown_appcontext">
<code class="sig-name descname">teardown_appcontext</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.teardown_appcontext" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a function to be called when the application context
ends.  These functions are typically also called when the request
context is popped.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">ctx.pop()</span></code> is executed in the above example, the teardown
functions are called just before the app context moves from the
stack of active contexts.  This becomes relevant if you are using
such constructs in tests.</p>
<p>Since a request context typically also manages an application
context it would also be called when you pop a request context.</p>
<p>When a teardown function was called because of an exception it will
be passed an error object.</p>
<p>The return values of teardown functions are ignored.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.teardown_appcontext_funcs">
<code class="sig-name descname">teardown_appcontext_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.teardown_appcontext_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of functions that are called when the application context
is destroyed.  Since the application context is also torn down
if the request ends this is the place to store code that disconnects
from databases.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.teardown_request">
<code class="sig-name descname">teardown_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.teardown_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a function to be run at the end of each request,
regardless of whether there was an exception or not.  These functions
are executed when the request context is popped, even if not an
actual request was performed.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">ctx.pop()</span></code> is executed in the above example, the teardown
functions are called just before the request context moves from the
stack of active contexts.  This becomes relevant if you are using
such constructs in tests.</p>
<p>Generally teardown functions must take every necessary step to avoid
that they will fail.  If they do execute code that might fail they
will have to surround the execution of these code by try/except
statements and log occurring errors.</p>
<p>When a teardown function was called because of a exception it will
be passed an error object.</p>
<p>The return values of teardown functions are ignored.</p>
<div class="admonition-debug-note admonition">
<p class="admonition-title">Debug Note</p>
<p>In debug mode Flask will not tear down a request on an exception
immediately.  Instead it will keep it alive so that the interactive
debugger can still access it.  This behavior can be controlled
by the <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code> configuration variable.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.teardown_request_funcs">
<code class="sig-name descname">teardown_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.teardown_request_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with lists of functions that are called after
each request, even if an exception has occurred. The key of the
dictionary is the name of the blueprint this function is active for,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for all requests. These functions are not allowed to modify
the request, and their return values are ignored. If an exception
occurred while processing the request, it gets passed to each
teardown_request function. To register a function here, use the
<a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.template_context_processors">
<code class="sig-name descname">template_context_processors</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.template_context_processors" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with list of functions that are called without argument
to populate the template context.  The key of the dictionary is the
name of the blueprint this function is active for, <code class="docutils literal notranslate"><span class="pre">None</span></code> for all
requests.  Each returns a dictionary that the template context is
updated with.  To register a function here, use the
<a class="reference internal" href="#flask.Flask.context_processor" title="flask.Flask.context_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">context_processor()</span></code></a> decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.template_filter">
<code class="sig-name descname">template_filter</code><span class="sig-paren">(</span><em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.template_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator that is used to register custom template filter.
You can specify a name for the filter, otherwise the function
name will be used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_filter</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.template_global">
<code class="sig-name descname">template_global</code><span class="sig-paren">(</span><em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.template_global" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator that is used to register a custom template global function.
You can specify a name for the global function, otherwise the function
name will be used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_global</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the global function, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.template_test">
<code class="sig-name descname">template_test</code><span class="sig-paren">(</span><em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.template_test" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator that is used to register custom template test.
You can specify a name for the test, otherwise the function
name will be used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_test</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.test_client">
<code class="sig-name descname">test_client</code><span class="sig-paren">(</span><em class="sig-param">use_cookies=True</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.test_client" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a test client for this application.  For information
about unit testing head over to <a class="reference internal" href="index.html#testing"><span class="std std-ref">Testing Flask Applications</span></a>.</p>
<p>Note that if you are testing for assertions or exceptions in your
application code, you must set <code class="docutils literal notranslate"><span class="pre">app.testing</span> <span class="pre">=</span> <span class="pre">True</span></code> in order for the
exceptions to propagate to the test client.  Otherwise, the exception
will be handled by the application (not visible to the test client) and
the only indication of an AssertionError or other exception will be a
500 status code response to the test client.  See the <a class="reference internal" href="#flask.Flask.testing" title="flask.Flask.testing"><code class="xref py py-attr docutils literal notranslate"><span class="pre">testing</span></code></a>
attribute.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">testing</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</pre></div>
</div>
<p>The test client can be used in a <code class="docutils literal notranslate"><span class="pre">with</span></code> block to defer the closing down
of the context until the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block.  This is useful if
you want to access the context locals for testing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/?vodka=42&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;vodka&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;42&#39;</span>
</pre></div>
</div>
<p>Additionally, you may pass optional keyword arguments that will then
be passed to the application’s <a class="reference internal" href="#flask.Flask.test_client_class" title="flask.Flask.test_client_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_client_class</span></code></a> constructor.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.testing</span> <span class="k">import</span> <span class="n">FlaskClient</span>

<span class="k">class</span> <span class="nc">CustomClient</span><span class="p">(</span><span class="n">FlaskClient</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_authentication</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;authentication&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CustomClient</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">test_client_class</span> <span class="o">=</span> <span class="n">CustomClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">(</span><span class="n">authentication</span><span class="o">=</span><span class="s1">&#39;Basic ....&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#flask.testing.FlaskClient" title="flask.testing.FlaskClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlaskClient</span></code></a> for more information.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11: </span>Added <cite>**kwargs</cite> to support passing additional keyword arguments to
the constructor of <a class="reference internal" href="#flask.Flask.test_client_class" title="flask.Flask.test_client_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_client_class</span></code></a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.7: </span>The <cite>use_cookies</cite> parameter was added as well as the ability
to override the client to be used by setting the
<a class="reference internal" href="#flask.Flask.test_client_class" title="flask.Flask.test_client_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_client_class</span></code></a> attribute.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.4: </span>added support for <code class="docutils literal notranslate"><span class="pre">with</span></code> block usage for the client.</p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.test_client_class">
<code class="sig-name descname">test_client_class</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.test_client_class" title="Permalink to this definition">¶</a></dt>
<dd><p>the test client that is used with when <cite>test_client</cite> is used.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.test_request_context">
<code class="sig-name descname">test_request_context</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.test_request_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a WSGI environment from the given values (see
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/test/#werkzeug.test.EnvironBuilder" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.test.EnvironBuilder</span></code></a> for more information, this
function accepts the same arguments).</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.testing">
<code class="sig-name descname">testing</code><a class="headerlink" href="#flask.Flask.testing" title="Permalink to this definition">¶</a></dt>
<dd><p>The testing flag.  Set this to <code class="docutils literal notranslate"><span class="pre">True</span></code> to enable the test mode of
Flask extensions (and in the future probably also Flask itself).
For example this might activate unittest helpers that have an
additional runtime cost which should not be enabled by default.</p>
<p>If this is enabled and PROPAGATE_EXCEPTIONS is not changed from the
default it’s implicitly enabled.</p>
<p>This attribute can also be configured from the config with the
<code class="docutils literal notranslate"><span class="pre">TESTING</span></code> configuration key.  Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.trap_http_exception">
<code class="sig-name descname">trap_http_exception</code><span class="sig-paren">(</span><em class="sig-param">e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.trap_http_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if an HTTP exception should be trapped or not.  By default
this will return <code class="docutils literal notranslate"><span class="pre">False</span></code> for all exceptions except for a bad request
key error if <code class="docutils literal notranslate"><span class="pre">TRAP_BAD_REQUEST_ERRORS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  It
also returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">TRAP_HTTP_EXCEPTIONS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>This is called for all HTTP exceptions raised by a view function.
If it returns <code class="docutils literal notranslate"><span class="pre">True</span></code> for any exception the error handler for this
exception is not called and it shows up as regular exception in the
traceback.  This is helpful for debugging implicitly raised HTTP
exceptions.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.update_template_context">
<code class="sig-name descname">update_template_context</code><span class="sig-paren">(</span><em class="sig-param">context</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.update_template_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the template context with some commonly used variables.
This injects request, session, config and g into the template
context as well as everything template context processors want
to inject.  Note that the as of Flask 0.6, the original values
in the context will not be overridden if a context processor
decides to return a value with the same key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>context</strong> – the context as a dictionary that is updated in place
to add extra variables.</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_build_error_handlers">
<code class="sig-name descname">url_build_error_handlers</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_build_error_handlers" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of functions that are called when <a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code></a> raises a
<code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code>.  Each function registered here
is called with <cite>error</cite>, <cite>endpoint</cite> and <cite>values</cite>.  If a function
returns <code class="docutils literal notranslate"><span class="pre">None</span></code> or raises a <code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code> the next function is
tried.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_default_functions">
<code class="sig-name descname">url_default_functions</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_default_functions" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with lists of functions that can be used as URL value
preprocessors.  The key <code class="docutils literal notranslate"><span class="pre">None</span></code> here is used for application wide
callbacks, otherwise the key is the name of the blueprint.
Each of these functions has the chance to modify the dictionary
of URL values before they are used as the keyword arguments of the
view function.  For each function registered this one should also
provide a <a class="reference internal" href="#flask.Flask.url_defaults" title="flask.Flask.url_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_defaults()</span></code></a> function that adds the parameters
automatically again that were removed that way.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Flask.url_defaults">
<code class="sig-name descname">url_defaults</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.url_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Callback function for URL defaults for all view functions of the
application.  It’s called with the endpoint and values and should
update the values passed in place.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_map">
<code class="sig-name descname">url_map</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_map" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Map" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Map</span></code></a> for this instance.  You can use
this to change the routing converters after the class was created
but before any routes are connected.  Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.routing</span> <span class="k">import</span> <span class="n">BaseConverter</span>

<span class="k">class</span> <span class="nc">ListConverter</span><span class="p">(</span><span class="n">BaseConverter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">ListConverter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_url</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">converters</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ListConverter</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_rule_class">
<code class="sig-name descname">url_rule_class</code><a class="headerlink" href="#flask.Flask.url_rule_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Rule" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.routing.Rule</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.url_value_preprocessor">
<code class="sig-name descname">url_value_preprocessor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.url_value_preprocessor" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a function as URL value preprocessor for all view
functions of the application.  It’s called before the view functions
are called and can modify the url values provided.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_value_preprocessors">
<code class="sig-name descname">url_value_preprocessors</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_value_preprocessors" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with lists of functions that can be used as URL
value processor functions.  Whenever a URL is built these functions
are called to modify the dictionary of values in place.  The key
<code class="docutils literal notranslate"><span class="pre">None</span></code> here is used for application wide
callbacks, otherwise the key is the name of the blueprint.
Each of these functions has the chance to modify the dictionary</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Flask.use_x_sendfile">
<code class="sig-name descname">use_x_sendfile</code><a class="headerlink" href="#flask.Flask.use_x_sendfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable this if you want to use the X-Sendfile feature.  Keep in
mind that the server has to support this.  This only affects files
sent with the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> method.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.2.</span></p>
</div>
</details><p>This attribute can also be configured from the config with the
<code class="docutils literal notranslate"><span class="pre">USE_X_SENDFILE</span></code> configuration key.  Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.view_functions">
<code class="sig-name descname">view_functions</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.view_functions" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of all view functions registered.  The keys will
be function names which are also used to generate URLs and
the values are the function objects themselves.
To register a view function, use the <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.wsgi_app">
<code class="sig-name descname">wsgi_app</code><span class="sig-paren">(</span><em class="sig-param">environ</em>, <em class="sig-param">start_response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.wsgi_app" title="Permalink to this definition">¶</a></dt>
<dd><p>The actual WSGI application.  This is not implemented in
<cite>__call__</cite> so that middlewares can be applied without losing a
reference to the class.  So instead of doing this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">MyMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>It’s a better idea to do this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">MyMiddleware</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you still have the original application object around and
can continue to call methods on it.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7: </span>The behavior of the before and after request callbacks was changed
under error conditions and a new callback was added that will
always execute at the end of the request, independent on if an
error occurred or not.  See <a class="reference internal" href="index.html#callbacks-and-errors"><span class="std std-ref">Callbacks and Errors</span></a>.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>environ</strong> – a WSGI environment</p></li>
<li><p><strong>start_response</strong> – a callable accepting a status code,
a list of headers and an optional
exception context to start the response</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="blueprint-objects">
<h4>Blueprint Objects<a class="headerlink" href="#blueprint-objects" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.Blueprint">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">Blueprint</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">import_name</em>, <em class="sig-param">static_folder=None</em>, <em class="sig-param">static_url_path=None</em>, <em class="sig-param">template_folder=None</em>, <em class="sig-param">url_prefix=None</em>, <em class="sig-param">subdomain=None</em>, <em class="sig-param">url_defaults=None</em>, <em class="sig-param">root_path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a blueprint.  A blueprint is an object that records
functions that will be called with the
<a class="reference internal" href="#flask.blueprints.BlueprintSetupState" title="flask.blueprints.BlueprintSetupState"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlueprintSetupState</span></code></a> later to register functions
or other things on the main application.  See <a class="reference internal" href="index.html#blueprints"><span class="std std-ref">Modular Applications with Blueprints</span></a> for more
information.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details><dl class="method">
<dt id="flask.Blueprint.add_app_template_filter">
<code class="sig-name descname">add_app_template_filter</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_app_template_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template filter, available application wide.  Like
<a class="reference internal" href="#flask.Flask.add_template_filter" title="flask.Flask.add_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_template_filter()</span></code></a> but for a blueprint.  Works exactly
like the <a class="reference internal" href="#flask.Blueprint.app_template_filter" title="flask.Blueprint.app_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_template_filter()</span></code></a> decorator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.add_app_template_global">
<code class="sig-name descname">add_app_template_global</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_app_template_global" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template global, available application wide.  Like
<a class="reference internal" href="#flask.Flask.add_template_global" title="flask.Flask.add_template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_template_global()</span></code></a> but for a blueprint.  Works exactly
like the <a class="reference internal" href="#flask.Blueprint.app_template_global" title="flask.Blueprint.app_template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_template_global()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the global, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.add_app_template_test">
<code class="sig-name descname">add_app_template_test</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_app_template_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template test, available application wide.  Like
<a class="reference internal" href="#flask.Flask.add_template_test" title="flask.Flask.add_template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_template_test()</span></code></a> but for a blueprint.  Works exactly
like the <a class="reference internal" href="#flask.Blueprint.app_template_test" title="flask.Blueprint.app_template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_template_test()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.add_url_rule">
<code class="sig-name descname">add_url_rule</code><span class="sig-paren">(</span><em class="sig-param">rule</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">view_func=None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_url_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_url_rule()</span></code></a> but for a blueprint.  The endpoint for
the <a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> function is prefixed with the name of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.after_app_request">
<code class="sig-name descname">after_app_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.after_app_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.after_request()</span></code></a> but for a blueprint.  Such a function
is executed after each request, even if outside of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.after_request">
<code class="sig-name descname">after_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.after_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.after_request()</span></code></a> but for a blueprint.  This function
is only executed after each request that is handled by a function of
that blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_context_processor">
<code class="sig-name descname">app_context_processor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_context_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.context_processor" title="flask.Flask.context_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.context_processor()</span></code></a> but for a blueprint.  Such a
function is executed each request, even if outside of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_errorhandler">
<code class="sig-name descname">app_errorhandler</code><span class="sig-paren">(</span><em class="sig-param">code</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_errorhandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.errorhandler()</span></code></a> but for a blueprint.  This
handler is used for all requests, even if outside of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_template_filter">
<code class="sig-name descname">app_template_filter</code><span class="sig-paren">(</span><em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_template_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template filter, available application wide.  Like
<a class="reference internal" href="#flask.Flask.template_filter" title="flask.Flask.template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.template_filter()</span></code></a> but for a blueprint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_template_global">
<code class="sig-name descname">app_template_global</code><span class="sig-paren">(</span><em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_template_global" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template global, available application wide.  Like
<a class="reference internal" href="#flask.Flask.template_global" title="flask.Flask.template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.template_global()</span></code></a> but for a blueprint.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the global, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_template_test">
<code class="sig-name descname">app_template_test</code><span class="sig-paren">(</span><em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_template_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a custom template test, available application wide.  Like
<a class="reference internal" href="#flask.Flask.template_test" title="flask.Flask.template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.template_test()</span></code></a> but for a blueprint.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_url_defaults">
<code class="sig-name descname">app_url_defaults</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_url_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#flask.Blueprint.url_defaults" title="flask.Blueprint.url_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_defaults()</span></code></a> but application wide.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_url_value_preprocessor">
<code class="sig-name descname">app_url_value_preprocessor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_url_value_preprocessor" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#flask.Blueprint.url_value_preprocessor" title="flask.Blueprint.url_value_preprocessor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_value_preprocessor()</span></code></a> but application wide.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.before_app_first_request">
<code class="sig-name descname">before_app_first_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.before_app_first_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.before_first_request" title="flask.Flask.before_first_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_first_request()</span></code></a>.  Such a function is
executed before the first request to the application.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.before_app_request">
<code class="sig-name descname">before_app_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.before_app_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_request()</span></code></a>.  Such a function is executed
before each request, even if outside of a blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.before_request">
<code class="sig-name descname">before_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.before_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_request()</span></code></a> but for a blueprint.  This function
is only executed before each request that is handled by a function of
that blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.context_processor">
<code class="sig-name descname">context_processor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.context_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.context_processor" title="flask.Flask.context_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.context_processor()</span></code></a> but for a blueprint.  This
function is only executed for requests handled by a blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.endpoint">
<code class="sig-name descname">endpoint</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.endpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.endpoint" title="flask.Flask.endpoint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.endpoint()</span></code></a> but for a blueprint.  This does not
prefix the endpoint with the blueprint name, this has to be done
explicitly by the user of this method.  If the endpoint is prefixed
with a <cite>.</cite> it will be registered to the current blueprint, otherwise
it’s an application independent endpoint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.errorhandler">
<code class="sig-name descname">errorhandler</code><span class="sig-paren">(</span><em class="sig-param">code_or_exception</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.errorhandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers an error handler that becomes active for this blueprint
only.  Please be aware that routing does not happen local to a
blueprint so an error handler for 404 usually is not handled by
a blueprint unless it is caused inside a view function.  Another
special case is the 500 internal server error which is always looked
up from the application.</p>
<p>Otherwise works as the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> decorator
of the <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> object.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.get_send_file_max_age">
<code class="sig-name descname">get_send_file_max_age</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.get_send_file_max_age" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides default cache_timeout for the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> functions.</p>
<p>By default, this function returns <code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code> from
the configuration of <a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</p>
<p>Static file functions such as <a class="reference internal" href="#flask.send_from_directory" title="flask.send_from_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_from_directory()</span></code></a> use this
function, and <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> calls this function on
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> when the given cache_timeout is <code class="docutils literal notranslate"><span class="pre">None</span></code>. If a
cache_timeout is given in <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>, that timeout is used;
otherwise, this method is called.</p>
<p>This allows subclasses to change the behavior when sending files based
on the filename.  For example, to set the cache timeout for .js files
to 60 seconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFlask</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">60</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="o">.</span><span class="n">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Blueprint.has_static_folder">
<em class="property">property </em><code class="sig-name descname">has_static_folder</code><a class="headerlink" href="#flask.Blueprint.has_static_folder" title="Permalink to this definition">¶</a></dt>
<dd><p>This is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the package bound object’s container has a
folder for static files.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Blueprint.jinja_loader">
<code class="sig-name descname">jinja_loader</code><a class="headerlink" href="#flask.Blueprint.jinja_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>The Jinja loader for this package bound object.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Blueprint.make_setup_state">
<code class="sig-name descname">make_setup_state</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">options</em>, <em class="sig-param">first_registration=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.make_setup_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an instance of <a class="reference internal" href="#flask.blueprints.BlueprintSetupState" title="flask.blueprints.BlueprintSetupState"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BlueprintSetupState()</span></code></a>
object that is later passed to the register callback functions.
Subclasses can override this to return a subclass of the setup state.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.open_resource">
<code class="sig-name descname">open_resource</code><span class="sig-paren">(</span><em class="sig-param">resource</em>, <em class="sig-param">mode='rb'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.open_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Opens a resource from the application’s resource folder.  To see
how this works, consider the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapplication</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
<span class="o">/</span><span class="n">static</span>
    <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
<span class="o">/</span><span class="n">templates</span>
    <span class="o">/</span><span class="n">layout</span><span class="o">.</span><span class="n">html</span>
    <span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>If you want to open the <code class="file docutils literal notranslate"><span class="pre">schema.sql</span></code> file you would do the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>resource</strong> – the name of the resource.  To access resources within
subfolders use forward slashes as separator.</p></li>
<li><p><strong>mode</strong> – resource file opening mode, default is ‘rb’.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.record">
<code class="sig-name descname">record</code><span class="sig-paren">(</span><em class="sig-param">func</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.record" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a function that is called when the blueprint is
registered on the application.  This function is called with the
state as argument as returned by the <a class="reference internal" href="#flask.Blueprint.make_setup_state" title="flask.Blueprint.make_setup_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_setup_state()</span></code></a>
method.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.record_once">
<code class="sig-name descname">record_once</code><span class="sig-paren">(</span><em class="sig-param">func</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.record_once" title="Permalink to this definition">¶</a></dt>
<dd><p>Works like <a class="reference internal" href="#flask.Blueprint.record" title="flask.Blueprint.record"><code class="xref py py-meth docutils literal notranslate"><span class="pre">record()</span></code></a> but wraps the function in another
function that will ensure the function is only called once.  If the
blueprint is registered a second time on the application, the
function passed is not called.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.register">
<code class="sig-name descname">register</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">options</em>, <em class="sig-param">first_registration=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Called by <a class="reference internal" href="#flask.Flask.register_blueprint" title="flask.Flask.register_blueprint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.register_blueprint()</span></code></a> to register a blueprint
on the application.  This can be overridden to customize the register
behavior.  Keyword arguments from
<a class="reference internal" href="#flask.Flask.register_blueprint" title="flask.Flask.register_blueprint"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_blueprint()</span></code></a> are directly forwarded to this
method in the <cite>options</cite> dictionary.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.register_error_handler">
<code class="sig-name descname">register_error_handler</code><span class="sig-paren">(</span><em class="sig-param">code_or_exception</em>, <em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.register_error_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Non-decorator version of the <a class="reference internal" href="#flask.Blueprint.errorhandler" title="flask.Blueprint.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> error attach
function, akin to the <a class="reference internal" href="#flask.Flask.register_error_handler" title="flask.Flask.register_error_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code></a>
application-wide function of the <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> object but
for error handlers limited to this blueprint.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Blueprint.route">
<code class="sig-name descname">route</code><span class="sig-paren">(</span><em class="sig-param">rule</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.route" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.route()</span></code></a> but for a blueprint.  The endpoint for the
<a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> function is prefixed with the name of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.send_static_file">
<code class="sig-name descname">send_static_file</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.send_static_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Function used internally to send static files from the static
folder to the browser.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Blueprint.static_folder">
<em class="property">property </em><code class="sig-name descname">static_folder</code><a class="headerlink" href="#flask.Blueprint.static_folder" title="Permalink to this definition">¶</a></dt>
<dd><p>The absolute path to the configured static folder.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.teardown_app_request">
<code class="sig-name descname">teardown_app_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.teardown_app_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.teardown_request()</span></code></a> but for a blueprint.  Such a
function is executed when tearing down each request, even if outside of
the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.teardown_request">
<code class="sig-name descname">teardown_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.teardown_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.teardown_request()</span></code></a> but for a blueprint.  This
function is only executed when tearing down requests handled by a
function of that blueprint.  Teardown request functions are executed
when the request context is popped, even when no actual request was
performed.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.url_defaults">
<code class="sig-name descname">url_defaults</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.url_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>Callback function for URL defaults for this blueprint.  It’s called
with the endpoint and values and should update the values passed
in place.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.url_value_preprocessor">
<code class="sig-name descname">url_value_preprocessor</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.url_value_preprocessor" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a function as URL value preprocessor for this
blueprint.  It’s called before the view functions are called and
can modify the url values provided.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="incoming-request-data">
<h4>Incoming Request Data<a class="headerlink" href="#incoming-request-data" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.Request">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">Request</code><span class="sig-paren">(</span><em class="sig-param">environ</em>, <em class="sig-param">populate_request=True</em>, <em class="sig-param">shallow=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Request" title="Permalink to this definition">¶</a></dt>
<dd><p>The request object used by default in Flask.  Remembers the
matched endpoint and view arguments.</p>
<p>It is what ends up as <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.  If you want to replace
the request object used you can subclass this and set
<a class="reference internal" href="#flask.Flask.request_class" title="flask.Flask.request_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request_class</span></code></a> to your subclass.</p>
<p>The request object is a <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/wrappers/#werkzeug.wrappers.Request" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> subclass and
provides all of the attributes Werkzeug defines plus a few Flask
specific ones.</p>
<dl class="attribute">
<dt id="flask.Request.form">
<code class="sig-name descname">form</code><a class="headerlink" href="#flask.Request.form" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.MultiDict" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code></a> with the parsed form data from <code class="docutils literal notranslate"><span class="pre">POST</span></code>
or <code class="docutils literal notranslate"><span class="pre">PUT</span></code> requests.  Please keep in mind that file uploads will not
end up here,  but instead in the <a class="reference internal" href="#flask.Request.files" title="flask.Request.files"><code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code></a> attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.args">
<code class="sig-name descname">args</code><a class="headerlink" href="#flask.Request.args" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.MultiDict" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code></a> with the parsed contents of the query
string.  (The part in the URL after the question mark).</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.values">
<code class="sig-name descname">values</code><a class="headerlink" href="#flask.Request.values" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.CombinedMultiDict" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinedMultiDict</span></code></a> with the contents of both
<a class="reference internal" href="#flask.Request.form" title="flask.Request.form"><code class="xref py py-attr docutils literal notranslate"><span class="pre">form</span></code></a> and <a class="reference internal" href="#flask.Request.args" title="flask.Request.args"><code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.cookies">
<code class="sig-name descname">cookies</code><a class="headerlink" href="#flask.Request.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> with the contents of all cookies transmitted with
the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.stream">
<code class="sig-name descname">stream</code><a class="headerlink" href="#flask.Request.stream" title="Permalink to this definition">¶</a></dt>
<dd><p>If the incoming form data was not encoded with a known mimetype
the data is stored unmodified in this stream for consumption.  Most
of the time it is a better idea to use <a class="reference internal" href="#flask.Request.data" title="flask.Request.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a> which will give
you that data as a string.  The stream only returns the data once.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#flask.Request.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>The incoming request headers as a dictionary like object.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.data">
<code class="sig-name descname">data</code><a class="headerlink" href="#flask.Request.data" title="Permalink to this definition">¶</a></dt>
<dd><p>Contains the incoming request data as string in case it came with
a mimetype Flask does not handle.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.files">
<code class="sig-name descname">files</code><a class="headerlink" href="#flask.Request.files" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.MultiDict" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code></a> with files uploaded as part of a
<code class="docutils literal notranslate"><span class="pre">POST</span></code> or <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request.  Each file is stored as
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileStorage</span></code></a> object.  It basically behaves like a
standard file object you know from Python, with the difference that
it also has a <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.FileStorage.save" title="(in Werkzeug v1.0.x)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> function that can
store the file on the filesystem.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.environ">
<code class="sig-name descname">environ</code><a class="headerlink" href="#flask.Request.environ" title="Permalink to this definition">¶</a></dt>
<dd><p>The underlying WSGI environment.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#flask.Request.method" title="Permalink to this definition">¶</a></dt>
<dd><p>The current request method (<code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">GET</span></code> etc.)</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.path">
<code class="sig-name descname">path</code><a class="headerlink" href="#flask.Request.path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.full_path">
<code class="sig-name descname">full_path</code><a class="headerlink" href="#flask.Request.full_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.script_root">
<code class="sig-name descname">script_root</code><a class="headerlink" href="#flask.Request.script_root" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#flask.Request.url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.base_url">
<code class="sig-name descname">base_url</code><a class="headerlink" href="#flask.Request.base_url" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.url_root">
<code class="sig-name descname">url_root</code><a class="headerlink" href="#flask.Request.url_root" title="Permalink to this definition">¶</a></dt>
<dd><p>Provides different ways to look at the current <a class="reference external" href="http://tools.ietf.org/html/rfc3987">IRI</a>.  Imagine your application is
listening on the following application root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">myapplication</span>
</pre></div>
</div>
<p>And a user requests the following URI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://www.example.com/myapplication/%CF%80/page.html?x=y
</pre></div>
</div>
<p>In this case the values of the above mentioned attributes would be
the following:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 82%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><cite>path</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u'/π/page.html'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><cite>full_path</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u'/π/page.html?x=y'</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><cite>script_root</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u'/myapplication'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><cite>base_url</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u'http://www.example.com/myapplication/π/page.html'</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><cite>url</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u'http://www.example.com/myapplication/π/page.html?x=y'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><cite>url_root</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">u'http://www.example.com/myapplication/'</span></code></p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.is_xhr">
<code class="sig-name descname">is_xhr</code><a class="headerlink" href="#flask.Request.is_xhr" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the request was triggered via a JavaScript
<cite>XMLHttpRequest</cite>. This only works with libraries that support the
<code class="docutils literal notranslate"><span class="pre">X-Requested-With</span></code> header and set it to <cite>XMLHttpRequest</cite>.
Libraries that do that are prototype, jQuery and Mochikit and
probably some more.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.blueprint">
<em class="property">property </em><code class="sig-name descname">blueprint</code><a class="headerlink" href="#flask.Request.blueprint" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the current blueprint</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.endpoint">
<em class="property">property </em><code class="sig-name descname">endpoint</code><a class="headerlink" href="#flask.Request.endpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>The endpoint that matched the request.  This in combination with
<a class="reference internal" href="#flask.Request.view_args" title="flask.Request.view_args"><code class="xref py py-attr docutils literal notranslate"><span class="pre">view_args</span></code></a> can be used to reconstruct the same or a
modified URL.  If an exception happened when matching, this will
be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.get_json">
<code class="sig-name descname">get_json</code><span class="sig-paren">(</span><em class="sig-param">force=False</em>, <em class="sig-param">silent=False</em>, <em class="sig-param">cache=True</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Request.get_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the incoming JSON request data and returns it.  By default
this function will return <code class="docutils literal notranslate"><span class="pre">None</span></code> if the mimetype is not
<em class="mimetype">application/json</em> but this can be overridden by the
<code class="docutils literal notranslate"><span class="pre">force</span></code> parameter. If parsing fails the
<a class="reference internal" href="#flask.Request.on_json_loading_failed" title="flask.Request.on_json_loading_failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_json_loading_failed()</span></code></a> method on the request object will be
invoked.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>force</strong> – if set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the mimetype is ignored.</p></li>
<li><p><strong>silent</strong> – if set to <code class="docutils literal notranslate"><span class="pre">True</span></code> this method will fail silently
and return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>cache</strong> – if set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the parsed JSON data is remembered
on the request.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Request.is_json">
<em class="property">property </em><code class="sig-name descname">is_json</code><a class="headerlink" href="#flask.Request.is_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicates if this request is JSON or not.  By default a request
is considered to include JSON data if the mimetype is
<em class="mimetype">application/json</em> or <em class="mimetype">application/*+json</em>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Request.json">
<em class="property">property </em><code class="sig-name descname">json</code><a class="headerlink" href="#flask.Request.json" title="Permalink to this definition">¶</a></dt>
<dd><p>If the mimetype is <em class="mimetype">application/json</em> this will contain the
parsed JSON data.  Otherwise this will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>The <a class="reference internal" href="#flask.Request.get_json" title="flask.Request.get_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_json()</span></code></a> method should be used instead.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.max_content_length">
<em class="property">property </em><code class="sig-name descname">max_content_length</code><a class="headerlink" href="#flask.Request.max_content_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only view of the <code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code> config key.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.module">
<em class="property">property </em><code class="sig-name descname">module</code><a class="headerlink" href="#flask.Request.module" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the current module if the request was dispatched
to an actual module.  This is deprecated functionality, use blueprints
instead.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.on_json_loading_failed">
<code class="sig-name descname">on_json_loading_failed</code><span class="sig-paren">(</span><em class="sig-param">e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Request.on_json_loading_failed" title="Permalink to this definition">¶</a></dt>
<dd><p>Called if decoding of the JSON data failed.  The return value of
this method is used by <a class="reference internal" href="#flask.Request.get_json" title="flask.Request.get_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_json()</span></code></a> when an error occurred.  The
default implementation just raises a <code class="xref py py-class docutils literal notranslate"><span class="pre">BadRequest</span></code> exception.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.10: </span>Removed buggy previous behavior of generating a random JSON
response.  If you want that behavior back you can trivially
add it by subclassing.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Request.routing_exception">
<code class="sig-name descname">routing_exception</code><em class="property"> = None</em><a class="headerlink" href="#flask.Request.routing_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>If matching the URL failed, this is the exception that will be
raised / was raised as part of the request handling.  This is
usually a <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.NotFound" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotFound</span></code></a> exception or
something similar.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.url_rule">
<code class="sig-name descname">url_rule</code><em class="property"> = None</em><a class="headerlink" href="#flask.Request.url_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>The internal URL rule that matched the request.  This can be
useful to inspect which methods are allowed for the URL from
a before/after handler (<code class="docutils literal notranslate"><span class="pre">request.url_rule.methods</span></code>) etc.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details></dd></dl>

<dl class="attribute">
<dt id="flask.Request.view_args">
<code class="sig-name descname">view_args</code><em class="property"> = None</em><a class="headerlink" href="#flask.Request.view_args" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict of view arguments that matched the request.  If an exception
happened when matching, this will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.request">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">request</code><a class="headerlink" href="#flask.request" title="Permalink to this definition">¶</a></dt>
<dd><p>To access incoming request data, you can use the global <cite>request</cite>
object.  Flask parses incoming request data for you and gives you
access to it through that global object.  Internally Flask makes
sure that you always get the correct data for the active thread if you
are in a multithreaded environment.</p>
<p>This is a proxy.  See <a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Notes On Proxies</span></a> for more information.</p>
<p>The request object is an instance of a <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/wrappers/#werkzeug.wrappers.Request" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a>
subclass and provides all of the attributes Werkzeug defines.  This
just shows a quick overview of the most important ones.</p>
</dd></dl>

</div>
<div class="section" id="response-objects">
<h4>Response Objects<a class="headerlink" href="#response-objects" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.Response">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">Response</code><span class="sig-paren">(</span><em class="sig-param">response=None</em>, <em class="sig-param">status=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">mimetype=None</em>, <em class="sig-param">content_type=None</em>, <em class="sig-param">direct_passthrough=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Response" title="Permalink to this definition">¶</a></dt>
<dd><p>The response object that is used by default in Flask.  Works like the
response object from Werkzeug but is set to have an HTML mimetype by
default.  Quite often you don’t have to create this object yourself because
<a class="reference internal" href="#flask.Flask.make_response" title="flask.Flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_response()</span></code></a> will take care of that for you.</p>
<p>If you want to replace the response object used you can subclass this and
set <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a> to your subclass.</p>
<dl class="attribute">
<dt id="flask.Response.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#flask.Response.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/datastructures/#werkzeug.datastructures.Headers" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Headers</span></code></a> object representing the response headers.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Response.status">
<code class="sig-name descname">status</code><a class="headerlink" href="#flask.Response.status" title="Permalink to this definition">¶</a></dt>
<dd><p>A string with a response status.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Response.status_code">
<code class="sig-name descname">status_code</code><a class="headerlink" href="#flask.Response.status_code" title="Permalink to this definition">¶</a></dt>
<dd><p>The response status as integer.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Response.data">
<em class="property">property </em><code class="sig-name descname">data</code><a class="headerlink" href="#flask.Response.data" title="Permalink to this definition">¶</a></dt>
<dd><p>A descriptor that calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_data()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">set_data()</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Response.mimetype">
<em class="property">property </em><code class="sig-name descname">mimetype</code><a class="headerlink" href="#flask.Response.mimetype" title="Permalink to this definition">¶</a></dt>
<dd><p>The mimetype (content type without charset etc.)</p>
</dd></dl>

<dl class="method">
<dt id="flask.Response.set_cookie">
<code class="sig-name descname">set_cookie</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">value=''</em>, <em class="sig-param">max_age=None</em>, <em class="sig-param">expires=None</em>, <em class="sig-param">path='/'</em>, <em class="sig-param">domain=None</em>, <em class="sig-param">secure=False</em>, <em class="sig-param">httponly=False</em>, <em class="sig-param">samesite=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Response.set_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets a cookie. The parameters are the same as in the cookie <cite>Morsel</cite>
object in the Python standard library but it accepts unicode data, too.</p>
<p>A warning is raised if the size of the cookie header exceeds
<code class="xref py py-attr docutils literal notranslate"><span class="pre">max_cookie_size</span></code>, but the header will still be set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – the key (name) of the cookie to be set.</p></li>
<li><p><strong>value</strong> – the value of the cookie.</p></li>
<li><p><strong>max_age</strong> – should be a number of seconds, or <cite>None</cite> (default) if
the cookie should last only as long as the client’s
browser session.</p></li>
<li><p><strong>expires</strong> – should be a <cite>datetime</cite> object or UNIX timestamp.</p></li>
<li><p><strong>path</strong> – limits the cookie to a given path, per default it will
span the whole domain.</p></li>
<li><p><strong>domain</strong> – if you want to set a cross-domain cookie.  For example,
<code class="docutils literal notranslate"><span class="pre">domain=&quot;.example.com&quot;</span></code> will set a cookie that is
readable by the domain <code class="docutils literal notranslate"><span class="pre">www.example.com</span></code>,
<code class="docutils literal notranslate"><span class="pre">foo.example.com</span></code> etc.  Otherwise, a cookie will only
be readable by the domain that set it.</p></li>
<li><p><strong>secure</strong> – If <cite>True</cite>, the cookie will only be available via HTTPS</p></li>
<li><p><strong>httponly</strong> – disallow JavaScript to access the cookie.  This is an
extension to the cookie standard and probably not
supported by all browsers.</p></li>
<li><p><strong>samesite</strong> – Limits the scope of the cookie such that it will only
be attached to requests if those requests are
“same-site”.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="sessions">
<h4>Sessions<a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a></h4>
<p>If you have the <a class="reference internal" href="#flask.Flask.secret_key" title="flask.Flask.secret_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.secret_key</span></code></a> set you can use sessions in Flask
applications.  A session basically makes it possible to remember
information from one request to another.  The way Flask does this is by
using a signed cookie.  So the user can look at the session contents, but
not modify it unless they know the secret key, so make sure to set that
to something complex and unguessable.</p>
<p>To access the current session you can use the <a class="reference internal" href="#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a> object:</p>
<dl class="class">
<dt id="flask.session">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">session</code><a class="headerlink" href="#flask.session" title="Permalink to this definition">¶</a></dt>
<dd><p>The session object works pretty much like an ordinary dict, with the
difference that it keeps track on modifications.</p>
<p>This is a proxy.  See <a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Notes On Proxies</span></a> for more information.</p>
<p>The following attributes are interesting:</p>
<dl class="attribute">
<dt id="flask.session.new">
<code class="sig-name descname">new</code><a class="headerlink" href="#flask.session.new" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the session is new, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.session.modified">
<code class="sig-name descname">modified</code><a class="headerlink" href="#flask.session.modified" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the session object detected a modification.  Be advised
that modifications on mutable structures are not picked up
automatically, in that situation you have to explicitly set the
attribute to <code class="docutils literal notranslate"><span class="pre">True</span></code> yourself.  Here an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this change is not picked up because a mutable object (here</span>
<span class="c1"># a list) is changed.</span>
<span class="n">session</span><span class="p">[</span><span class="s1">&#39;objects&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># so mark it as modified yourself</span>
<span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.session.permanent">
<code class="sig-name descname">permanent</code><a class="headerlink" href="#flask.session.permanent" title="Permalink to this definition">¶</a></dt>
<dd><p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the session lives for
<a class="reference internal" href="#flask.Flask.permanent_session_lifetime" title="flask.Flask.permanent_session_lifetime"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permanent_session_lifetime</span></code></a> seconds.  The
default is 31 days.  If set to <code class="docutils literal notranslate"><span class="pre">False</span></code> (which is the default) the
session will be deleted when the user closes the browser.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="session-interface">
<h4>Session Interface<a class="headerlink" href="#session-interface" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details><p>The session interface provides a simple way to replace the session
implementation that Flask is using.</p>
<dl class="class">
<dt id="flask.sessions.SessionInterface">
<em class="property">class </em><code class="sig-prename descclassname">flask.sessions.</code><code class="sig-name descname">SessionInterface</code><a class="headerlink" href="#flask.sessions.SessionInterface" title="Permalink to this definition">¶</a></dt>
<dd><p>The basic interface you have to implement in order to replace the
default session interface which uses werkzeug’s securecookie
implementation.  The only methods you have to implement are
<a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a> and <a class="reference internal" href="#flask.sessions.SessionInterface.save_session" title="flask.sessions.SessionInterface.save_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_session()</span></code></a>, the others have
useful defaults which you don’t need to change.</p>
<p>The session object returned by the <a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a> method has to
provide a dictionary like interface plus the properties and methods
from the <a class="reference internal" href="#flask.sessions.SessionMixin" title="flask.sessions.SessionMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMixin</span></code></a>.  We recommend just subclassing a dict
and adding that mixin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">SessionMixin</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>If <a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a> returns <code class="docutils literal notranslate"><span class="pre">None</span></code> Flask will call into
<a class="reference internal" href="#flask.sessions.SessionInterface.make_null_session" title="flask.sessions.SessionInterface.make_null_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_null_session()</span></code></a> to create a session that acts as replacement
if the session support cannot work because some requirement is not
fulfilled.  The default <a class="reference internal" href="#flask.sessions.NullSession" title="flask.sessions.NullSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullSession</span></code></a> class that is created
will complain that the secret key was not set.</p>
<p>To replace the session interface on an application all you have to do
is to assign <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.session_interface</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">session_interface</span> <span class="o">=</span> <span class="n">MySessionInterface</span><span class="p">()</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details><dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_domain">
<code class="sig-name descname">get_cookie_domain</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>Helpful helper method that returns the cookie domain that should
be used for the session cookie if session cookies are used.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_httponly">
<code class="sig-name descname">get_cookie_httponly</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_httponly" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the session cookie should be httponly.  This
currently just returns the value of the <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_HTTPONLY</span></code>
config var.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_path">
<code class="sig-name descname">get_cookie_path</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the path for which the cookie should be valid.  The
default implementation uses the value from the <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_PATH</span></code>
config var if it’s set, and falls back to <code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code> or
uses <code class="docutils literal notranslate"><span class="pre">/</span></code> if it’s <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_secure">
<code class="sig-name descname">get_cookie_secure</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_secure" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the cookie should be secure.  This currently
just returns the value of the <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_SECURE</span></code> setting.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_expiration_time">
<code class="sig-name descname">get_expiration_time</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">session</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_expiration_time" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper method that returns an expiration date for the session
or <code class="docutils literal notranslate"><span class="pre">None</span></code> if the session is linked to the browser session.  The
default implementation returns now + the permanent session
lifetime configured on the application.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.is_null_session">
<code class="sig-name descname">is_null_session</code><span class="sig-paren">(</span><em class="sig-param">obj</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.is_null_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if a given object is a null session.  Null sessions are
not asked to be saved.</p>
<p>This checks if the object is an instance of <a class="reference internal" href="#flask.sessions.SessionInterface.null_session_class" title="flask.sessions.SessionInterface.null_session_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">null_session_class</span></code></a>
by default.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.make_null_session">
<code class="sig-name descname">make_null_session</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.make_null_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a null session which acts as a replacement object if the
real session support could not be loaded due to a configuration
error.  This mainly aids the user experience because the job of the
null session is to still support lookup without complaining but
modifications are answered with a helpful error message of what
failed.</p>
<p>This creates an instance of <a class="reference internal" href="#flask.sessions.SessionInterface.null_session_class" title="flask.sessions.SessionInterface.null_session_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">null_session_class</span></code></a> by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionInterface.null_session_class">
<code class="sig-name descname">null_session_class</code><a class="headerlink" href="#flask.sessions.SessionInterface.null_session_class" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#flask.sessions.SessionInterface.make_null_session" title="flask.sessions.SessionInterface.make_null_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_null_session()</span></code></a> will look here for the class that should
be created when a null session is requested.  Likewise the
<a class="reference internal" href="#flask.sessions.SessionInterface.is_null_session" title="flask.sessions.SessionInterface.is_null_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_null_session()</span></code></a> method will perform a typecheck against
this type.</p>
<p>alias of <a class="reference internal" href="#flask.sessions.NullSession" title="flask.sessions.NullSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullSession</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.open_session">
<code class="sig-name descname">open_session</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.open_session" title="Permalink to this definition">¶</a></dt>
<dd><p>This method has to be implemented and must either return <code class="docutils literal notranslate"><span class="pre">None</span></code>
in case the loading failed because of a configuration error or an
instance of a session object which implements a dictionary like
interface + the methods and attributes on <a class="reference internal" href="#flask.sessions.SessionMixin" title="flask.sessions.SessionMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMixin</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionInterface.pickle_based">
<code class="sig-name descname">pickle_based</code><em class="property"> = False</em><a class="headerlink" href="#flask.sessions.SessionInterface.pickle_based" title="Permalink to this definition">¶</a></dt>
<dd><p>A flag that indicates if the session interface is pickle based.
This can be used by Flask extensions to make a decision in regards
to how to deal with the session object.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.save_session">
<code class="sig-name descname">save_session</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">session</em>, <em class="sig-param">response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.save_session" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called for actual sessions returned by <a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a>
at the end of the request.  This is still called during a request
context so if you absolutely need access to the request you can do
that.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.should_set_cookie">
<code class="sig-name descname">should_set_cookie</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">session</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.should_set_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Indicates whether a cookie should be set now or not.  This is
used by session backends to figure out if they should emit a
set-cookie header or not.  The default behavior is controlled by
the <code class="docutils literal notranslate"><span class="pre">SESSION_REFRESH_EACH_REQUEST</span></code> config variable.  If
it’s set to <code class="docutils literal notranslate"><span class="pre">False</span></code> then a cookie is only set if the session is
modified, if set to <code class="docutils literal notranslate"><span class="pre">True</span></code> it’s always set if the session is
permanent.</p>
<p>This check is usually skipped if sessions get deleted.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.sessions.SecureCookieSessionInterface">
<em class="property">class </em><code class="sig-prename descclassname">flask.sessions.</code><code class="sig-name descname">SecureCookieSessionInterface</code><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface" title="Permalink to this definition">¶</a></dt>
<dd><p>The default session interface that stores sessions in signed cookies
through the <code class="xref py py-mod docutils literal notranslate"><span class="pre">itsdangerous</span></code> module.</p>
<dl class="method">
<dt id="flask.sessions.SecureCookieSessionInterface.digest_method">
<em class="property">static </em><code class="sig-name descname">digest_method</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.digest_method" title="Permalink to this definition">¶</a></dt>
<dd><p>the hash function to use for the signature.  The default is sha1</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.key_derivation">
<code class="sig-name descname">key_derivation</code><em class="property"> = 'hmac'</em><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.key_derivation" title="Permalink to this definition">¶</a></dt>
<dd><p>the name of the itsdangerous supported key derivation.  The default
is hmac.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SecureCookieSessionInterface.open_session">
<code class="sig-name descname">open_session</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.open_session" title="Permalink to this definition">¶</a></dt>
<dd><p>This method has to be implemented and must either return <code class="docutils literal notranslate"><span class="pre">None</span></code>
in case the loading failed because of a configuration error or an
instance of a session object which implements a dictionary like
interface + the methods and attributes on <a class="reference internal" href="#flask.sessions.SessionMixin" title="flask.sessions.SessionMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMixin</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.salt">
<code class="sig-name descname">salt</code><em class="property"> = 'cookie-session'</em><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.salt" title="Permalink to this definition">¶</a></dt>
<dd><p>the salt that should be applied on top of the secret key for the
signing of cookie based sessions.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SecureCookieSessionInterface.save_session">
<code class="sig-name descname">save_session</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">session</em>, <em class="sig-param">response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.save_session" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called for actual sessions returned by <a class="reference internal" href="#flask.sessions.SecureCookieSessionInterface.open_session" title="flask.sessions.SecureCookieSessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a>
at the end of the request.  This is still called during a request
context so if you absolutely need access to the request you can do
that.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.serializer">
<code class="sig-name descname">serializer</code><em class="property"> = &lt;flask.sessions.TaggedJSONSerializer object&gt;</em><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.serializer" title="Permalink to this definition">¶</a></dt>
<dd><p>A python serializer for the payload.  The default is a compact
JSON derived serializer with support for some extra Python types
such as datetime objects or tuples.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.session_class">
<code class="sig-name descname">session_class</code><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.session_class" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#flask.sessions.SecureCookieSession" title="flask.sessions.SecureCookieSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureCookieSession</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.sessions.SecureCookieSession">
<em class="property">class </em><code class="sig-prename descclassname">flask.sessions.</code><code class="sig-name descname">SecureCookieSession</code><span class="sig-paren">(</span><em class="sig-param">initial=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for sessions based on signed cookies.</p>
</dd></dl>

<dl class="class">
<dt id="flask.sessions.NullSession">
<em class="property">class </em><code class="sig-prename descclassname">flask.sessions.</code><code class="sig-name descname">NullSession</code><span class="sig-paren">(</span><em class="sig-param">initial=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.NullSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Class used to generate nicer error messages if sessions are not
available.  Will still allow read-only access to the empty session
but fail on setting.</p>
</dd></dl>

<dl class="class">
<dt id="flask.sessions.SessionMixin">
<em class="property">class </em><code class="sig-prename descclassname">flask.sessions.</code><code class="sig-name descname">SessionMixin</code><a class="headerlink" href="#flask.sessions.SessionMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Expands a basic dictionary with an accessors that are expected
by Flask extensions and users for the session.</p>
<dl class="attribute">
<dt id="flask.sessions.SessionMixin.modified">
<code class="sig-name descname">modified</code><em class="property"> = True</em><a class="headerlink" href="#flask.sessions.SessionMixin.modified" title="Permalink to this definition">¶</a></dt>
<dd><p>for some backends this will always be <code class="docutils literal notranslate"><span class="pre">True</span></code>, but some backends will
default this to false and detect changes in the dictionary for as
long as changes do not happen on mutable structures in the session.
The default mixin implementation just hardcodes <code class="docutils literal notranslate"><span class="pre">True</span></code> in.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionMixin.new">
<code class="sig-name descname">new</code><em class="property"> = False</em><a class="headerlink" href="#flask.sessions.SessionMixin.new" title="Permalink to this definition">¶</a></dt>
<dd><p>some session backends can tell you if a session is new, but that is
not necessarily guaranteed.  Use with caution.  The default mixin
implementation just hardcodes <code class="docutils literal notranslate"><span class="pre">False</span></code> in.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionMixin.permanent">
<em class="property">property </em><code class="sig-name descname">permanent</code><a class="headerlink" href="#flask.sessions.SessionMixin.permanent" title="Permalink to this definition">¶</a></dt>
<dd><p>this reflects the <code class="docutils literal notranslate"><span class="pre">'_permanent'</span></code> key in the dict.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="flask.sessions.session_json_serializer">
<code class="sig-prename descclassname">flask.sessions.</code><code class="sig-name descname">session_json_serializer</code><em class="property"> = &lt;flask.sessions.TaggedJSONSerializer object&gt;</em><a class="headerlink" href="#flask.sessions.session_json_serializer" title="Permalink to this definition">¶</a></dt>
<dd><p>A customized JSON serializer that supports a few extra types that
we take for granted when serializing (tuples, markup objects, datetime).</p>
<p>This object provides dumping and loading methods similar to simplejson
but it also tags certain builtin Python objects that commonly appear in
sessions.  Currently the following extended values are supported in
the JSON it dumps:</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code> objects</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/uuid.html#uuid.UUID" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> objects</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> objects</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>s</p></li>
</ul>
</dd></dl>

<div class="admonition-notice admonition">
<p class="admonition-title">Notice</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PERMANENT_SESSION_LIFETIME</span></code> config key can also be an integer
starting with Flask 0.8.  Either catch this down yourself or use
the <a class="reference internal" href="#flask.Flask.permanent_session_lifetime" title="flask.Flask.permanent_session_lifetime"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permanent_session_lifetime</span></code></a> attribute on the
app which converts the result to an integer automatically.</p>
</div>
</div>
<div class="section" id="test-client">
<h4>Test Client<a class="headerlink" href="#test-client" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.testing.FlaskClient">
<em class="property">class </em><code class="sig-prename descclassname">flask.testing.</code><code class="sig-name descname">FlaskClient</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.testing.FlaskClient" title="Permalink to this definition">¶</a></dt>
<dd><p>Works like a regular Werkzeug test client but has some knowledge about
how Flask works to defer the cleanup of the request context stack to the
end of a <code class="docutils literal notranslate"><span class="pre">with</span></code> body when used in a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement.  For general
information about how to use this class refer to
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/test/#werkzeug.test.Client" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.test.Client</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.12: </span><cite>app.test_client()</cite> includes preset default environment, which can be
set after instantiation of the <cite>app.test_client()</cite> object in
<cite>client.environ_base</cite>.</p>
</div>
<p>Basic usage is outlined in the <a class="reference internal" href="index.html#testing"><span class="std std-ref">Testing Flask Applications</span></a> chapter.</p>
<dl class="method">
<dt id="flask.testing.FlaskClient.open">
<code class="sig-name descname">open</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.testing.FlaskClient.open" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes the same arguments as the <code class="xref py py-class docutils literal notranslate"><span class="pre">EnvironBuilder</span></code> class with
some additions:  You can provide a <code class="xref py py-class docutils literal notranslate"><span class="pre">EnvironBuilder</span></code> or a WSGI
environment as only argument instead of the <code class="xref py py-class docutils literal notranslate"><span class="pre">EnvironBuilder</span></code>
arguments and two optional keyword arguments (<cite>as_tuple</cite>, <cite>buffered</cite>)
that change the type of the return value or the way the application is
executed.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5: </span>If a dict is provided as file in the dict for the <cite>data</cite> parameter
the content type has to be called <cite>content_type</cite> now instead of
<cite>mimetype</cite>.  This change was made for consistency with
<code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.FileWrapper</span></code>.</p>
<blockquote>
<div><p>The <cite>follow_redirects</cite> parameter was added to <a class="reference internal" href="#flask.testing.FlaskClient.open" title="flask.testing.FlaskClient.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a>.</p>
</div></blockquote>
</div>
</details><p>Additional parameters:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>as_tuple</strong> – Returns a tuple in the form <code class="docutils literal notranslate"><span class="pre">(environ,</span> <span class="pre">result)</span></code></p></li>
<li><p><strong>buffered</strong> – Set this to True to buffer the application run.
This will automatically close the application for
you as well.</p></li>
<li><p><strong>follow_redirects</strong> – Set this to True if the <cite>Client</cite> should
follow HTTP redirects.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.testing.FlaskClient.session_transaction">
<code class="sig-name descname">session_transaction</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.testing.FlaskClient.session_transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>When used in combination with a <code class="docutils literal notranslate"><span class="pre">with</span></code> statement this opens a
session transaction.  This can be used to modify the session that
the test client uses.  Once the <code class="docutils literal notranslate"><span class="pre">with</span></code> block is left the session is
stored back.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">session_transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
<p>Internally this is implemented by going through a temporary test
request context and since session handling could depend on
request variables this function accepts the same arguments as
<a class="reference internal" href="#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a> which are directly
passed through.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="application-globals">
<h4>Application Globals<a class="headerlink" href="#application-globals" title="Permalink to this headline">¶</a></h4>
<p>To share data that is valid for one request only from one function to
another, a global variable is not good enough because it would break in
threaded environments.  Flask provides you with a special object that
ensures it is only valid for the active request and that will return
different values for each request.  In a nutshell: it does the right
thing, like it does for <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> and <a class="reference internal" href="#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a>.</p>
<dl class="data">
<dt id="flask.g">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">g</code><a class="headerlink" href="#flask.g" title="Permalink to this definition">¶</a></dt>
<dd><p>Just store on this whatever you want.  For example a database
connection or the user that is currently logged in.</p>
<p>Starting with Flask 0.10 this is stored on the application context and
no longer on the request context which means it becomes available if
only the application context is bound and not yet a request.  This
is especially useful when combined with the <a class="reference internal" href="index.html#faking-resources"><span class="std std-ref">Faking Resources and Context</span></a>
pattern for testing.</p>
<p>Additionally as of 0.10 you can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> method to
get an attribute or <code class="docutils literal notranslate"><span class="pre">None</span></code> (or the second argument) if it’s not set.
These two usages are now equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>It’s now also possible to use the <code class="docutils literal notranslate"><span class="pre">in</span></code> operator on it to see if an
attribute is defined and it yields all keys on iteration.</p>
<p>As of 0.11 you can use <code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">setdefault()</span></code> in the same
way you would use them on a dictionary.</p>
<p>This is a proxy.  See <a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Notes On Proxies</span></a> for more information.</p>
</dd></dl>

</div>
<div class="section" id="useful-functions-and-classes">
<h4>Useful Functions and Classes<a class="headerlink" href="#useful-functions-and-classes" title="Permalink to this headline">¶</a></h4>
<dl class="data">
<dt id="flask.current_app">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">current_app</code><a class="headerlink" href="#flask.current_app" title="Permalink to this definition">¶</a></dt>
<dd><p>Points to the application handling the request.  This is useful for
extensions that want to support multiple applications running side
by side.  This is powered by the application context and not by the
request context, so you can change the value of this proxy by
using the <a class="reference internal" href="#flask.Flask.app_context" title="flask.Flask.app_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_context()</span></code></a> method.</p>
<p>This is a proxy.  See <a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Notes On Proxies</span></a> for more information.</p>
</dd></dl>

<dl class="function">
<dt id="flask.has_request_context">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">has_request_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.has_request_context" title="Permalink to this definition">¶</a></dt>
<dd><p>If you have code that wants to test if a request context is there or
not this function can be used.  For instance, you may want to take advantage
of request information if the request object is available, but fail
silently if it is unavailable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">remote_addr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="k">if</span> <span class="n">remote_addr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">has_request_context</span><span class="p">():</span>
            <span class="n">remote_addr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_addr</span> <span class="o">=</span> <span class="n">remote_addr</span>
</pre></div>
</div>
<p>Alternatively you can also just test any of the context bound objects
(such as <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> or <a class="reference internal" href="#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> for truthness):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">remote_addr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="k">if</span> <span class="n">remote_addr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">request</span><span class="p">:</span>
            <span class="n">remote_addr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_addr</span> <span class="o">=</span> <span class="n">remote_addr</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details></dd></dl>

<dl class="function">
<dt id="flask.copy_current_request_context">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">copy_current_request_context</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.copy_current_request_context" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper function that decorates a function to retain the current
request context.  This is useful when working with greenlets.  The moment
the function is decorated a copy of the request context is created and
then pushed when the function is called.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gevent</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">copy_current_request_context</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nd">@copy_current_request_context</span>
    <span class="k">def</span> <span class="nf">do_some_work</span><span class="p">():</span>
        <span class="c1"># do some work here, it can access flask.request like you</span>
        <span class="c1"># would otherwise in the view function.</span>
        <span class="o">...</span>
    <span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">do_some_work</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Regular response&#39;</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="function">
<dt id="flask.has_app_context">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">has_app_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.has_app_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Works like <a class="reference internal" href="#flask.has_request_context" title="flask.has_request_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">has_request_context()</span></code></a> but for the application
context.  You can also just do a boolean check on the
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> object instead.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="function">
<dt id="flask.url_for">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">url_for</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">**values</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a URL to the given endpoint with the method provided.</p>
<p>Variable arguments that are unknown to the target endpoint are appended
to the generated URL as query arguments.  If the value of a query argument
is <code class="docutils literal notranslate"><span class="pre">None</span></code>, the whole pair is skipped.  In case blueprints are active
you can shortcut references to the same blueprint by prefixing the
local endpoint with a dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>).</p>
<p>This will reference the index function local to the current blueprint:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;.index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, head over to the <a class="reference internal" href="index.html#url-building"><span class="std std-ref">Quickstart</span></a>.</p>
<p>To integrate applications, <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> has a hook to intercept URL build
errors through <a class="reference internal" href="#flask.Flask.url_build_error_handlers" title="flask.Flask.url_build_error_handlers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.url_build_error_handlers</span></code></a>.  The <cite>url_for</cite>
function results in a <code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code> when the current
app does not have a URL for the given endpoint and values.  When it does, the
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> calls its <a class="reference internal" href="#flask.Flask.url_build_error_handlers" title="flask.Flask.url_build_error_handlers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">url_build_error_handlers</span></code></a> if
it is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, which can return a string to use as the result of
<cite>url_for</cite> (instead of <cite>url_for</cite>’s default to raise the
<code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code> exception) or re-raise the exception.
An example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">external_url_handler</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="s2">&quot;Looks up an external URL when `url_for` cannot build a URL.&quot;</span>
    <span class="c1"># This is an example of hooking the build_error_handler.</span>
    <span class="c1"># Here, lookup_url is some utility function you&#39;ve built</span>
    <span class="c1"># which looks up the endpoint in some external URL registry.</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">lookup_url</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># External lookup did not have a URL.</span>
        <span class="c1"># Re-raise the BuildError, in context of original traceback.</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span>
    <span class="c1"># url_for will use this result, instead of raising BuildError.</span>
    <span class="k">return</span> <span class="n">url</span>

<span class="n">app</span><span class="o">.</span><span class="n">url_build_error_handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">external_url_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, <cite>error</cite> is the instance of <code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code>, and
<cite>endpoint</cite> and <cite>values</cite> are the arguments passed into <cite>url_for</cite>.  Note
that this is for building URLs outside the current application, and not for
handling 404 NotFound errors.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10: </span>The <cite>_scheme</cite> parameter was added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9: </span>The <cite>_anchor</cite> and <cite>_method</cite> parameters were added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9: </span>Calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.handle_build_error()</span></code> on
<code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code>.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>endpoint</strong> – the endpoint of the URL (name of the function)</p></li>
<li><p><strong>values</strong> – the variable arguments of the URL rule</p></li>
<li><p><strong>_external</strong> – if set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, an absolute URL is generated. Server
address can be changed via <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> configuration variable which
defaults to <cite>localhost</cite>.</p></li>
<li><p><strong>_scheme</strong> – a string specifying the desired URL scheme. The <cite>_external</cite>
parameter must be set to <code class="docutils literal notranslate"><span class="pre">True</span></code> or a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> is raised. The default
behavior uses the same scheme as the current request, or
<code class="docutils literal notranslate"><span class="pre">PREFERRED_URL_SCHEME</span></code> from the <a class="reference internal" href="index.html#config"><span class="std std-ref">app configuration</span></a> if no
request context is available. As of Werkzeug 0.10, this also can be set
to an empty string to build protocol-relative URLs.</p></li>
<li><p><strong>_anchor</strong> – if provided this is added as anchor to the URL.</p></li>
<li><p><strong>_method</strong> – if provided this explicitly specifies an HTTP method.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.abort">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">abort</code><span class="sig-paren">(</span><em class="sig-param">status</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.abort" title="Permalink to this definition">¶</a></dt>
<dd><p>Raises an <code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code> for the given status code or WSGI
application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>  <span class="c1"># 404 Not Found</span>
<span class="n">abort</span><span class="p">(</span><span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Can be passed a WSGI application or a status code.  If a status code is
given it’s looked up in the list of exceptions and will raise that
exception, if passed a WSGI application it will wrap it in a proxy WSGI
exception and raise that:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="n">abort</span><span class="p">(</span><span class="n">Response</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.redirect">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">redirect</code><span class="sig-paren">(</span><em class="sig-param">location</em>, <em class="sig-param">code=302</em>, <em class="sig-param">Response=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.redirect" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a response object (a WSGI application) that, if called,
redirects the client to the target location. Supported codes are
301, 302, 303, 305, 307, and 308. 300 is not supported because
it’s not a real redirect and 304 because it’s the answer for a
request with a request with defined If-Modified-Since headers.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10: </span>The class used for the Response object can now be passed in.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.6: </span>The location can now be a unicode string that is encoded using
the <code class="xref py py-func docutils literal notranslate"><span class="pre">iri_to_uri()</span></code> function.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>location</strong> – the location the response should redirect to.</p></li>
<li><p><strong>code</strong> – the redirect status code. defaults to 302.</p></li>
<li><p><strong>Response</strong> (<em>class</em>) – a Response class to use when instantiating a
response. The default is <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/wrappers/#werkzeug.wrappers.Response" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.wrappers.Response</span></code></a> if
unspecified.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.make_response">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">make_response</code><span class="sig-paren">(</span><em class="sig-param">*args</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.make_response" title="Permalink to this definition">¶</a></dt>
<dd><p>Sometimes it is necessary to set additional headers in a view.  Because
views do not have to return response objects but can return a value that
is converted into a response object by Flask itself, it becomes tricky to
add headers to it.  This function can be called instead of using a return
and you will get a response object which you can use to attach headers.</p>
<p>If view looked like this and you want to add a new header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Parachutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;parachutes are cool&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>This function accepts the very same arguments you can return from a
view function.  This for example creates a response with a 404 error
code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;not_found.html&#39;</span><span class="p">),</span> <span class="mi">404</span><span class="p">)</span>
</pre></div>
</div>
<p>The other use case of this function is to force the return value of a
view function into a response which is helpful with view
decorators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">view_function</span><span class="p">())</span>
<span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Parachutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;parachutes are cool&#39;</span>
</pre></div>
</div>
<p>Internally this function does the following things:</p>
<ul class="simple">
<li><p>if no arguments are passed, it creates a new response argument</p></li>
<li><p>if one argument is passed, <a class="reference internal" href="#flask.Flask.make_response" title="flask.Flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.make_response()</span></code></a>
is invoked with it.</p></li>
<li><p>if more than one argument is passed, the arguments are passed
to the <a class="reference internal" href="#flask.Flask.make_response" title="flask.Flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.make_response()</span></code></a> function as tuple.</p></li>
</ul>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details></dd></dl>

<dl class="function">
<dt id="flask.after_this_request">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">after_this_request</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.after_this_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes a function after this request.  This is useful to modify
response objects.  The function is passed the response object and has
to return the same or a new one.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nd">@after_this_request</span>
    <span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Parachute&#39;</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>This is more useful if a function other than the view function wants to
modify a response.  For instance think of a decorator that wants to add
some headers without converting the return value into a response object.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="function">
<dt id="flask.send_file">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">send_file</code><span class="sig-paren">(</span><em class="sig-param">filename_or_fp</em>, <em class="sig-param">mimetype=None</em>, <em class="sig-param">as_attachment=False</em>, <em class="sig-param">attachment_filename=None</em>, <em class="sig-param">add_etags=True</em>, <em class="sig-param">cache_timeout=None</em>, <em class="sig-param">conditional=False</em>, <em class="sig-param">last_modified=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.send_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends the contents of a file to the client.  This will use the
most efficient method available and configured.  By default it will
try to use the WSGI server’s file_wrapper support.  Alternatively
you can set the application’s <a class="reference internal" href="#flask.Flask.use_x_sendfile" title="flask.Flask.use_x_sendfile"><code class="xref py py-attr docutils literal notranslate"><span class="pre">use_x_sendfile</span></code></a> attribute
to <code class="docutils literal notranslate"><span class="pre">True</span></code> to directly emit an <code class="docutils literal notranslate"><span class="pre">X-Sendfile</span></code> header.  This however
requires support of the underlying webserver for <code class="docutils literal notranslate"><span class="pre">X-Sendfile</span></code>.</p>
<p>By default it will try to guess the mimetype for you, but you can
also explicitly provide one.  For extra security you probably want
to send certain files as attachment (HTML for instance).  The mimetype
guessing requires a <cite>filename</cite> or an <cite>attachment_filename</cite> to be
provided.</p>
<p>ETags will also be attached automatically if a <cite>filename</cite> is provided. You
can turn this off by setting <cite>add_etags=False</cite>.</p>
<p>If <cite>conditional=True</cite> and <cite>filename</cite> is provided, this method will try to
upgrade the response stream to support range requests.  This will allow
the request to be answered with partial content response.</p>
<p>Please never pass filenames to this function from user sources;
you should use <a class="reference internal" href="#flask.send_from_directory" title="flask.send_from_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_from_directory()</span></code></a> instead.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.12: </span>The filename is no longer automatically inferred from file objects. If
you want to use automatic mimetype and etag support, pass a filepath via
<cite>filename_or_fp</cite> or <cite>attachment_filename</cite>.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.12: </span>The <cite>attachment_filename</cite> is preferred over <cite>filename</cite> for MIME-type
detection.</p>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9: </span>cache_timeout pulls its default from application config, when None.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.7: </span>mimetype guessing and etag support for file objects was
deprecated because it was unreliable.  Pass a filename if you are
able to, otherwise attach an etag yourself.  This functionality
will be removed in Flask 1.0</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.5: </span>The <cite>add_etags</cite>, <cite>cache_timeout</cite> and <cite>conditional</cite> parameters were
added.  The default behavior is now to attach etags.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.2.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename_or_fp</strong> – the filename of the file to send in <cite>latin-1</cite>.
This is relative to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">root_path</span></code>
if a relative path is specified.
Alternatively a file object might be provided in
which case <code class="docutils literal notranslate"><span class="pre">X-Sendfile</span></code> might not work and fall
back to the traditional method.  Make sure that the
file pointer is positioned at the start of data to
send before calling <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>.</p></li>
<li><p><strong>mimetype</strong> – the mimetype of the file if provided. If a file path is
given, auto detection happens as fallback, otherwise an
error will be raised.</p></li>
<li><p><strong>as_attachment</strong> – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want to send this file with
a <code class="docutils literal notranslate"><span class="pre">Content-Disposition:</span> <span class="pre">attachment</span></code> header.</p></li>
<li><p><strong>attachment_filename</strong> – the filename for the attachment if it
differs from the file’s filename.</p></li>
<li><p><strong>add_etags</strong> – set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to disable attaching of etags.</p></li>
<li><p><strong>conditional</strong> – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to enable conditional responses.</p></li>
<li><p><strong>cache_timeout</strong> – the timeout in seconds for the headers. When <code class="docutils literal notranslate"><span class="pre">None</span></code>
(default), this value is set by
<a class="reference internal" href="#flask.Flask.get_send_file_max_age" title="flask.Flask.get_send_file_max_age"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_send_file_max_age()</span></code></a> of
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</p></li>
<li><p><strong>last_modified</strong> – set the <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> header to this value,
a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> or timestamp.
If a file was passed, this overrides its mtime.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.send_from_directory">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">send_from_directory</code><span class="sig-paren">(</span><em class="sig-param">directory</em>, <em class="sig-param">filename</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.send_from_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a file from a given directory with <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>.  This
is a secure way to quickly expose static files from an upload folder
or something similar.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploads/&lt;path:filename&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span>
                               <span class="n">filename</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-sending-files-and-performance admonition">
<p class="admonition-title">Sending files and Performance</p>
<p>It is strongly recommended to activate either <code class="docutils literal notranslate"><span class="pre">X-Sendfile</span></code> support in
your webserver or (if no authentication happens) to tell the webserver
to serve files for the given path on its own without calling into the
web application for improved performance.</p>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.5.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>directory</strong> – the directory where all the files are stored.</p></li>
<li><p><strong>filename</strong> – the filename relative to that directory to
download.</p></li>
<li><p><strong>options</strong> – optional keyword arguments that are directly
forwarded to <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.safe_join">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">safe_join</code><span class="sig-paren">(</span><em class="sig-param">directory</em>, <em class="sig-param">*pathnames</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.safe_join" title="Permalink to this definition">¶</a></dt>
<dd><p>Safely join <cite>directory</cite> and zero or more untrusted <cite>pathnames</cite>
components.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/wiki/&lt;path:filename&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wiki_page</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">safe_join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WIKI_FOLDER&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># Read and process the file content...</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>directory</strong> – the trusted base directory.</p></li>
<li><p><strong>pathnames</strong> – the untrusted pathnames relative to that directory.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.NotFound" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NotFound</span></code></a> if one or more passed
paths fall out of its boundaries.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.escape">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">escape</code><span class="sig-paren">(</span><em class="sig-param">s</em><span class="sig-paren">)</span> &#x2192; markup<a class="headerlink" href="#flask.escape" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the characters &amp;, &lt;, &gt;, ‘, and ” in string s to HTML-safe
sequences.  Use this if you need to display text that might contain
such characters in HTML.  Marks return value as markup string.</p>
</dd></dl>

<dl class="class">
<dt id="flask.Markup">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">Markup</code><a class="headerlink" href="#flask.Markup" title="Permalink to this definition">¶</a></dt>
<dd><p>A string that is ready to be safely inserted into an HTML or XML
document, either because it was escaped or because it was marked
safe.</p>
<p>Passing an object to the constructor converts it to text and wraps
it to mark it safe without escaping. To escape the text, use the
<a class="reference internal" href="#flask.escape" title="flask.escape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">escape()</span></code></a> class method instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Hello, &lt;em&gt;World&lt;/em&gt;!&#39;</span><span class="p">)</span>
<span class="go">Markup(&#39;Hello, &lt;em&gt;World&lt;/em&gt;!&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="go">Markup(&#39;42&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;Hello, &lt;em&gt;World&lt;/em&gt;!&#39;</span><span class="p">)</span>
<span class="go">Markup(&#39;Hello &amp;lt;em&amp;gt;World&amp;lt;/em&amp;gt;!&#39;)</span>
</pre></div>
</div>
<p>This implements the <code class="docutils literal notranslate"><span class="pre">__html__()</span></code> interface that some frameworks
use. Passing an object that implements <code class="docutils literal notranslate"><span class="pre">__html__()</span></code> will wrap the
output of that method, marking it safe.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;/foo&quot;&gt;foo&lt;/a&gt;&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="n">Foo</span><span class="p">())</span>
<span class="go">Markup(&#39;&lt;a href=&quot;/foo&quot;&gt;foo&lt;/a&gt;&#39;)</span>
</pre></div>
</div>
<p>This is a subclass of the text type (<code class="docutils literal notranslate"><span class="pre">str</span></code> in Python 3,
<code class="docutils literal notranslate"><span class="pre">unicode</span></code> in Python 2). It has the same methods as that type, but
all methods escape their arguments and return a <code class="docutils literal notranslate"><span class="pre">Markup</span></code> instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;em&gt;</span><span class="si">%s</span><span class="s1">&lt;/em&gt;&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="s1">&#39;foo &amp; bar&#39;</span>
<span class="go">Markup(&#39;&lt;em&gt;foo &amp;amp; bar&lt;/em&gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;em&gt;Hello&lt;/em&gt; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;foo&gt;&#39;</span>
<span class="go">Markup(&#39;&lt;em&gt;Hello&lt;/em&gt; &amp;lt;foo&amp;gt;&#39;)</span>
</pre></div>
</div>
<dl class="method">
<dt id="flask.Markup.escape">
<em class="property">classmethod </em><code class="sig-name descname">escape</code><span class="sig-paren">(</span><em class="sig-param">s</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Markup.escape" title="Permalink to this definition">¶</a></dt>
<dd><p>Escape a string. Calls <a class="reference internal" href="#flask.escape" title="flask.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a> and ensures that for
subclasses the correct type is returned.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Markup.striptags">
<code class="sig-name descname">striptags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Markup.striptags" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#flask.Markup.unescape" title="flask.Markup.unescape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unescape()</span></code></a> the markup, remove tags, and normalize
whitespace to single spaces.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Main &amp;raquo;        &lt;em&gt;About&lt;/em&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">striptags</span><span class="p">()</span>
<span class="go">&#39;Main » About&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Markup.unescape">
<code class="sig-name descname">unescape</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Markup.unescape" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert escaped markup back into a text string. This replaces
HTML entities with the characters they represent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Main &amp;raquo; &lt;em&gt;About&lt;/em&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unescape</span><span class="p">()</span>
<span class="go">&#39;Main » &lt;em&gt;About&lt;/em&gt;&#39;</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="message-flashing">
<h4>Message Flashing<a class="headerlink" href="#message-flashing" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="flask.flash">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">flash</code><span class="sig-paren">(</span><em class="sig-param">message</em>, <em class="sig-param">category='message'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.flash" title="Permalink to this definition">¶</a></dt>
<dd><p>Flashes a message to the next request.  In order to remove the
flashed message from the session and to display it to the user,
the template has to call <a class="reference internal" href="#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a>.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.3: </span><cite>category</cite> parameter added.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> – the message to be flashed.</p></li>
<li><p><strong>category</strong> – the category for the message.  The following values
are recommended: <code class="docutils literal notranslate"><span class="pre">'message'</span></code> for any kind of message,
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> for errors, <code class="docutils literal notranslate"><span class="pre">'info'</span></code> for information
messages and <code class="docutils literal notranslate"><span class="pre">'warning'</span></code> for warnings.  However any
kind of string can be used as category.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.get_flashed_messages">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">get_flashed_messages</code><span class="sig-paren">(</span><em class="sig-param">with_categories=False</em>, <em class="sig-param">category_filter=[]</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.get_flashed_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Pulls all flashed messages from the session and returns them.
Further calls in the same request to the function will return
the same messages.  By default just the messages are returned,
but when <cite>with_categories</cite> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the return value will
be a list of tuples in the form <code class="docutils literal notranslate"><span class="pre">(category,</span> <span class="pre">message)</span></code> instead.</p>
<p>Filter the flashed messages to one or more categories by providing those
categories in <cite>category_filter</cite>.  This allows rendering categories in
separate html blocks.  The <cite>with_categories</cite> and <cite>category_filter</cite>
arguments are distinct:</p>
<ul class="simple">
<li><p><cite>with_categories</cite> controls whether categories are returned with message
text (<code class="docutils literal notranslate"><span class="pre">True</span></code> gives a tuple, where <code class="docutils literal notranslate"><span class="pre">False</span></code> gives just the message text).</p></li>
<li><p><cite>category_filter</cite> filters the messages down to only those matching the
provided categories.</p></li>
</ul>
<p>See <a class="reference internal" href="index.html#message-flashing-pattern"><span class="std std-ref">Message Flashing</span></a> for examples.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9: </span><cite>category_filter</cite> parameter added.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.3: </span><cite>with_categories</cite> parameter added.</p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>with_categories</strong> – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to also receive categories.</p></li>
<li><p><strong>category_filter</strong> – whitelist of categories to limit return values</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-flask.json">
<span id="json-support"></span><h4>JSON Support<a class="headerlink" href="#module-flask.json" title="Permalink to this headline">¶</a></h4>
<p>Flask uses <code class="docutils literal notranslate"><span class="pre">simplejson</span></code> for the JSON implementation.  Since simplejson
is provided by both the standard library as well as extension, Flask will
try simplejson first and then fall back to the stdlib json module.  On top
of that it will delegate access to the current application’s JSON encoders
and decoders for easier customization.</p>
<p>So for starters instead of doing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simplejson</span> <span class="k">as</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
<p>You can instead just do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">json</span>
</pre></div>
</div>
<p>For usage examples, read the <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> documentation in the standard
library.  The following extensions are by default applied to the stdlib’s
JSON module:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects are serialized as <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc822.html"><strong>RFC 822</strong></a> strings.</p></li>
<li><p>Any object with an <code class="docutils literal notranslate"><span class="pre">__html__</span></code> method (like <a class="reference internal" href="#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a>)
will have that method called and then the return value is serialized
as string.</p></li>
</ol>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">htmlsafe_dumps()</span></code> function of this json module is also available
as filter called <code class="docutils literal notranslate"><span class="pre">|tojson</span></code> in Jinja2.  Note that inside <code class="docutils literal notranslate"><span class="pre">script</span></code>
tags no escaping must take place, so make sure to disable escaping
with <code class="docutils literal notranslate"><span class="pre">|safe</span></code> if you intend to use it inside <code class="docutils literal notranslate"><span class="pre">script</span></code> tags unless
you are using Flask 0.10 which implies that:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span><span class="p">&gt;</span>
    <span class="nx">doSomethingWith</span><span class="p">(</span><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">tojson</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="admonition-auto-sort-json-keys admonition">
<p class="admonition-title">Auto-Sort JSON Keys</p>
<p>The configuration variable <code class="docutils literal notranslate"><span class="pre">JSON_SORT_KEYS</span></code> (<a class="reference internal" href="index.html#config"><span class="std std-ref">Configuration Handling</span></a>) can be
set to false to stop Flask from auto-sorting keys.  By default sorting
is enabled and outside of the app context sorting is turned on.</p>
<p>Notice that disabling key sorting can cause issues when using content
based HTTP caches and Python’s hash randomization feature.</p>
</div>
<dl class="function">
<dt id="flask.json.jsonify">
<code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">jsonify</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.jsonify" title="Permalink to this definition">¶</a></dt>
<dd><p>This function wraps <a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a> to add a few enhancements that make
life easier.  It turns the JSON output into a <a class="reference internal" href="#flask.Response" title="flask.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>
object with the <em class="mimetype">application/json</em> mimetype.  For convenience, it
also converts multiple arguments into an array or multiple keyword arguments
into a dict.  This means that both <code class="docutils literal notranslate"><span class="pre">jsonify(1,2,3)</span></code> and
<code class="docutils literal notranslate"><span class="pre">jsonify([1,2,3])</span></code> serialize to <code class="docutils literal notranslate"><span class="pre">[1,2,3]</span></code>.</p>
<p>For clarity, the JSON serialization behavior has the following differences
from <a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a>:</p>
<ol class="arabic simple">
<li><p>Single argument: Passed straight through to <a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a>.</p></li>
<li><p>Multiple arguments: Converted to an array before being passed to
<a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a>.</p></li>
<li><p>Multiple keyword arguments: Converted to a dict before being passed to
<a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a>.</p></li>
<li><p>Both args and kwargs: Behavior undefined and will throw an exception.</p></li>
</ol>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">jsonify</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/_get_current_user&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_current_user</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                   <span class="n">email</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                   <span class="nb">id</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>This will send a JSON response like this to the browser:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;admin@localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">42</span>
<span class="p">}</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.11: </span>Added support for serializing top-level arrays. This introduces a
security risk in ancient browsers. See <a class="reference internal" href="index.html#json-security"><span class="std std-ref">JSON Security</span></a> for details.</p>
</div>
</details><p>This function’s response will be pretty printed if it was not requested
with <code class="docutils literal notranslate"><span class="pre">X-Requested-With:</span> <span class="pre">XMLHttpRequest</span></code> to simplify debugging unless
the <code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code> config parameter is set to false.
Compressed (not pretty) formatting currently means no indents and no
spaces after separators.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.2.</span></p>
</div>
</details></dd></dl>

<dl class="function">
<dt id="flask.json.dumps">
<code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">dumps</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize <code class="docutils literal notranslate"><span class="pre">obj</span></code> to a JSON formatted <code class="docutils literal notranslate"><span class="pre">str</span></code> by using the application’s
configured encoder (<a class="reference internal" href="#flask.Flask.json_encoder" title="flask.Flask.json_encoder"><code class="xref py py-attr docutils literal notranslate"><span class="pre">json_encoder</span></code></a>) if there is an
application on the stack.</p>
<p>This function can return <code class="docutils literal notranslate"><span class="pre">unicode</span></code> strings or ascii-only bytestrings by
default which coerce into unicode strings automatically.  That behavior by
default is controlled by the <code class="docutils literal notranslate"><span class="pre">JSON_AS_ASCII</span></code> configuration variable
and can be overridden by the simplejson <code class="docutils literal notranslate"><span class="pre">ensure_ascii</span></code> parameter.</p>
</dd></dl>

<dl class="function">
<dt id="flask.json.dump">
<code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">dump</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">fp</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a> but writes into a file object.</p>
</dd></dl>

<dl class="function">
<dt id="flask.json.loads">
<code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">loads</code><span class="sig-paren">(</span><em class="sig-param">s</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>Unserialize a JSON object from a string <code class="docutils literal notranslate"><span class="pre">s</span></code> by using the application’s
configured decoder (<a class="reference internal" href="#flask.Flask.json_decoder" title="flask.Flask.json_decoder"><code class="xref py py-attr docutils literal notranslate"><span class="pre">json_decoder</span></code></a>) if there is an
application on the stack.</p>
</dd></dl>

<dl class="function">
<dt id="flask.json.load">
<code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param">fp</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.json.loads" title="flask.json.loads"><code class="xref py py-func docutils literal notranslate"><span class="pre">loads()</span></code></a> but reads from a file object.</p>
</dd></dl>

<dl class="class">
<dt id="flask.json.JSONEncoder">
<em class="property">class </em><code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">JSONEncoder</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">skipkeys=False</em>, <em class="sig-param">ensure_ascii=True</em>, <em class="sig-param">check_circular=True</em>, <em class="sig-param">allow_nan=True</em>, <em class="sig-param">sort_keys=False</em>, <em class="sig-param">indent=None</em>, <em class="sig-param">separators=None</em>, <em class="sig-param">default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.JSONEncoder" title="Permalink to this definition">¶</a></dt>
<dd><p>The default Flask JSON encoder.  This one extends the default simplejson
encoder by also supporting <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects, <code class="docutils literal notranslate"><span class="pre">UUID</span></code> as well as
<code class="docutils literal notranslate"><span class="pre">Markup</span></code> objects which are serialized as RFC 822 datetime strings (same
as the HTTP date format).  In order to support more data types override the
<a class="reference internal" href="#flask.json.JSONEncoder.default" title="flask.json.JSONEncoder.default"><code class="xref py py-meth docutils literal notranslate"><span class="pre">default()</span></code></a> method.</p>
<dl class="method">
<dt id="flask.json.JSONEncoder.default">
<code class="sig-name descname">default</code><span class="sig-paren">(</span><em class="sig-param">o</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.JSONEncoder.default" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement this method in a subclass such that it returns a
serializable object for <code class="docutils literal notranslate"><span class="pre">o</span></code>, or calls the base implementation (to
raise a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>).</p>
<p>For example, to support arbitrary iterators, you could implement
default like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">iterable</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.json.JSONDecoder">
<em class="property">class </em><code class="sig-prename descclassname">flask.json.</code><code class="sig-name descname">JSONDecoder</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">object_hook=None</em>, <em class="sig-param">parse_float=None</em>, <em class="sig-param">parse_int=None</em>, <em class="sig-param">parse_constant=None</em>, <em class="sig-param">strict=True</em>, <em class="sig-param">object_pairs_hook=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.JSONDecoder" title="Permalink to this definition">¶</a></dt>
<dd><p>The default JSON decoder.  This one does not change the behavior from
the default simplejson decoder.  Consult the <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> documentation
for more information.  This decoder is not only used for the load
functions of this module but also <a class="reference internal" href="#flask.Request" title="flask.Request"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="template-rendering">
<h4>Template Rendering<a class="headerlink" href="#template-rendering" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="flask.render_template">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">render_template</code><span class="sig-paren">(</span><em class="sig-param">template_name_or_list</em>, <em class="sig-param">**context</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.render_template" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders a template from the template folder with the given
context.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>template_name_or_list</strong> – the name of the template to be
rendered, or an iterable with template names
the first one existing will be rendered</p></li>
<li><p><strong>context</strong> – the variables that should be available in the
context of the template.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.render_template_string">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">render_template_string</code><span class="sig-paren">(</span><em class="sig-param">source</em>, <em class="sig-param">**context</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.render_template_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders a template from the given template source string
with the given context. Template variables will be autoescaped.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>source</strong> – the source code of the template to be
rendered</p></li>
<li><p><strong>context</strong> – the variables that should be available in the
context of the template.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="flask.get_template_attribute">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">get_template_attribute</code><span class="sig-paren">(</span><em class="sig-param">template_name</em>, <em class="sig-param">attribute</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.get_template_attribute" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a macro (or variable) a template exports.  This can be used to
invoke a macro from within Python code.  If you for example have a
template named <code class="file docutils literal notranslate"><span class="pre">_cider.html</span></code> with the following contents:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">hello</span><span class="o">(</span><span class="nv">name</span><span class="o">)</span> <span class="cp">%}</span>Hello <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span>!<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>You can access this from Python code like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hello</span> <span class="o">=</span> <span class="n">get_template_attribute</span><span class="p">(</span><span class="s1">&#39;_cider.html&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">hello</span><span class="p">(</span><span class="s1">&#39;World&#39;</span><span class="p">)</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.2.</span></p>
</div>
</details><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>template_name</strong> – the name of the template</p></li>
<li><p><strong>attribute</strong> – the name of the variable of macro to access</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.Config">
<em class="property">class </em><code class="sig-prename descclassname">flask.</code><code class="sig-name descname">Config</code><span class="sig-paren">(</span><em class="sig-param">root_path</em>, <em class="sig-param">defaults=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config" title="Permalink to this definition">¶</a></dt>
<dd><p>Works exactly like a dict but provides ways to fill it from files
or special dictionaries.  There are two common patterns to populate the
config.</p>
<p>Either you can fill the config from a config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="s1">&#39;yourconfig.cfg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or alternatively you can define the configuration options in the
module that calls <a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a> or provide an import path to
a module that should be loaded.  It is also possible to tell it to
use the same module and with that provide the configuration values
just before the call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;development key&#39;</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>In both cases (loading from any Python file or loading from modules),
only uppercase keys are added to the config.  This makes it possible to use
lowercase values in the config file for temporary values that are not added
to the config or to define the config keys in the same file that implements
the application.</p>
<p>Probably the most interesting way to load configurations is from an
environment variable pointing to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case before launching the application you have to set this
environment variable to the file you want to use.  On Linux and OS X
use the export statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">YOURAPPLICATION_SETTINGS</span><span class="o">=</span><span class="s1">&#39;/path/to/config/file&#39;</span>
</pre></div>
</div>
<p>On windows use <cite>set</cite> instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>root_path</strong> – path to which files are read relative from.  When the
config object is created by the application, this is
the application’s <code class="xref py py-attr docutils literal notranslate"><span class="pre">root_path</span></code>.</p></li>
<li><p><strong>defaults</strong> – an optional dictionary of default values</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="flask.Config.from_envvar">
<code class="sig-name descname">from_envvar</code><span class="sig-paren">(</span><em class="sig-param">variable_name</em>, <em class="sig-param">silent=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_envvar" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a configuration from an environment variable pointing to
a configuration file.  This is basically just a shortcut with nicer
error messages for this line of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">])</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>variable_name</strong> – name of the environment variable</p></li>
<li><p><strong>silent</strong> – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want silent failure for missing
files.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>bool. <code class="docutils literal notranslate"><span class="pre">True</span></code> if able to load config, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Config.from_json">
<code class="sig-name descname">from_json</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">silent=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the values in the config from a JSON file. This function
behaves as if the JSON object was a dictionary and passed to the
<a class="reference internal" href="#flask.Config.from_mapping" title="flask.Config.from_mapping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_mapping()</span></code></a> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – the filename of the JSON file.  This can either be an
absolute filename or a filename relative to the
root path.</p></li>
<li><p><strong>silent</strong> – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want silent failure for missing
files.</p></li>
</ul>
</dd>
</dl>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Config.from_mapping">
<code class="sig-name descname">from_mapping</code><span class="sig-paren">(</span><em class="sig-param">*mapping</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the config like <code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code> ignoring items with non-upper
keys.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Config.from_object">
<code class="sig-name descname">from_object</code><span class="sig-paren">(</span><em class="sig-param">obj</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the values from the given object.  An object can be of one
of the following two types:</p>
<ul class="simple">
<li><p>a string: in this case the object with that name will be imported</p></li>
<li><p>an actual object reference: that object is used directly</p></li>
</ul>
<p>Objects are usually either modules or classes. <a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a>
loads only the uppercase attributes of the module/class. A <code class="docutils literal notranslate"><span class="pre">dict</span></code>
object will not work with <a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a> because the keys of a
<code class="docutils literal notranslate"><span class="pre">dict</span></code> are not attributes of the <code class="docutils literal notranslate"><span class="pre">dict</span></code> class.</p>
<p>Example of module-based configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_config&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">default_config</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">default_config</span><span class="p">)</span>
</pre></div>
</div>
<p>You should not use this function to load the actual configuration but
rather configuration defaults.  The actual config should be loaded
with <a class="reference internal" href="#flask.Config.from_pyfile" title="flask.Config.from_pyfile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pyfile()</span></code></a> and ideally from a location not within the
package because the package might be installed system wide.</p>
<p>See <a class="reference internal" href="index.html#config-dev-prod"><span class="std std-ref">Development / Production</span></a> for an example of class-based configuration
using <a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>obj</strong> – an import name or object</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="flask.Config.from_pyfile">
<code class="sig-name descname">from_pyfile</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">silent=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_pyfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the values in the config from a Python file.  This function
behaves as if the file was imported as module with the
<a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – the filename of the config.  This can either be an
absolute filename or a filename relative to the
root path.</p></li>
<li><p><strong>silent</strong> – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want silent failure for missing
files.</p></li>
</ul>
</dd>
</dl>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7: </span><cite>silent</cite> parameter.</p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.Config.get_namespace">
<code class="sig-name descname">get_namespace</code><span class="sig-paren">(</span><em class="sig-param">namespace</em>, <em class="sig-param">lowercase=True</em>, <em class="sig-param">trim_namespace=True</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.get_namespace" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary containing a subset of configuration options
that match the specified namespace/prefix. Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;IMAGE_STORE_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fs&#39;</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;IMAGE_STORE_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/var/app/images&#39;</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;IMAGE_STORE_BASE_URL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;http://img.website.com&#39;</span>
<span class="n">image_store_config</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_namespace</span><span class="p">(</span><span class="s1">&#39;IMAGE_STORE_&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting dictionary <cite>image_store_config</cite> would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span>
    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/app/images&#39;</span><span class="p">,</span>
    <span class="s1">&#39;base_url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://img.website.com&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is often useful when configuration options map directly to
keyword arguments in functions or class constructors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>namespace</strong> – a configuration namespace</p></li>
<li><p><strong>lowercase</strong> – a flag indicating if the keys of the resulting
dictionary should be lowercase</p></li>
<li><p><strong>trim_namespace</strong> – a flag indicating if the keys of the resulting
dictionary should not include the namespace</p></li>
</ul>
</dd>
</dl>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.11.</span></p>
</div>
</details></dd></dl>

</dd></dl>

</div>
<div class="section" id="extensions">
<h4>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h4>
<dl class="data">
<dt id="flask.flask.ext">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">ext</code><a class="headerlink" href="#flask.flask.ext" title="Permalink to this definition">¶</a></dt>
<dd><p>This module acts as redirect import module to Flask extensions.  It was
added in 0.8 as the canonical way to import Flask extensions and makes
it possible for us to have more flexibility in how we distribute
extensions.</p>
<p>If you want to use an extension named “Flask-Foo” you would import it
from <a class="reference internal" href="#flask.flask.ext" title="flask.flask.ext"><code class="xref py py-data docutils literal notranslate"><span class="pre">ext</span></code></a> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.ext</span> <span class="k">import</span> <span class="n">foo</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

</div>
<div class="section" id="stream-helpers">
<h4>Stream Helpers<a class="headerlink" href="#stream-helpers" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="flask.stream_with_context">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">stream_with_context</code><span class="sig-paren">(</span><em class="sig-param">generator_or_function</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.stream_with_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Request contexts disappear when the response is started on the server.
This is done for efficiency reasons and to make it less likely to encounter
memory leaks with badly written WSGI middlewares.  The downside is that if
you are using streamed responses, the generator cannot access request bound
information any more.</p>
<p>This function however can help you keep the context around for longer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">stream_with_context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/stream&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">streamed_response</span><span class="p">():</span>
    <span class="nd">@stream_with_context</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="k">yield</span> <span class="s1">&#39;Hello &#39;</span>
        <span class="k">yield</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s1">&#39;!&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">generate</span><span class="p">())</span>
</pre></div>
</div>
<p>Alternatively it can also be used around a specific generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">stream_with_context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/stream&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">streamed_response</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="k">yield</span> <span class="s1">&#39;Hello &#39;</span>
        <span class="k">yield</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s1">&#39;!&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">stream_with_context</span><span class="p">(</span><span class="n">generate</span><span class="p">()))</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

</div>
<div class="section" id="useful-internals">
<h4>Useful Internals<a class="headerlink" href="#useful-internals" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.ctx.RequestContext">
<em class="property">class </em><code class="sig-prename descclassname">flask.ctx.</code><code class="sig-name descname">RequestContext</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">environ</em>, <em class="sig-param">request=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext" title="Permalink to this definition">¶</a></dt>
<dd><p>The request context contains all request relevant information.  It is
created at the beginning of the request and pushed to the
<cite>_request_ctx_stack</cite> and removed at the end of it.  It will create the
URL adapter and request object for the WSGI environment provided.</p>
<p>Do not attempt to use this class directly, instead use
<a class="reference internal" href="#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a> and
<a class="reference internal" href="#flask.Flask.request_context" title="flask.Flask.request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_context()</span></code></a> to create this object.</p>
<p>When the request context is popped, it will evaluate all the
functions registered on the application for teardown execution
(<a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>).</p>
<p>The request context is automatically popped at the end of the request
for you.  In debug mode the request context is kept around if
exceptions happen so that interactive debuggers have a chance to
introspect the data.  With 0.4 this can also be forced for requests
that did not fail and outside of <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> mode.  By setting
<code class="docutils literal notranslate"><span class="pre">'flask._preserve_context'</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> on the WSGI environment the
context will not pop itself at the end of the request.  This is used by
the <a class="reference internal" href="#flask.Flask.test_client" title="flask.Flask.test_client"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_client()</span></code></a> for example to implement the
deferred cleanup functionality.</p>
<p>You might find this helpful for unittests where you need the
information from the context local around for a little longer.  Make
sure to properly <code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code> the stack yourself in
that situation, otherwise your unittests will leak memory.</p>
<dl class="method">
<dt id="flask.ctx.RequestContext.copy">
<code class="sig-name descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a copy of this request context with the same request object.
This can be used to move a request context to a different greenlet.
Because the actual request object is the same this cannot be used to
move a request context to a different thread unless access to the
request object is locked.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.ctx.RequestContext.match_request">
<code class="sig-name descname">match_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.match_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Can be overridden by a subclass to hook into the matching
of the request.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ctx.RequestContext.pop">
<code class="sig-name descname">pop</code><span class="sig-paren">(</span><em class="sig-param">exc=&lt;object object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.pop" title="Permalink to this definition">¶</a></dt>
<dd><p>Pops the request context and unbinds it by doing that.  This will
also trigger the execution of functions registered by the
<a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorator.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9: </span>Added the <cite>exc</cite> argument.</p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.ctx.RequestContext.push">
<code class="sig-name descname">push</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.push" title="Permalink to this definition">¶</a></dt>
<dd><p>Binds the request context to the current context.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="flask._request_ctx_stack">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">_request_ctx_stack</code><a class="headerlink" href="#flask._request_ctx_stack" title="Permalink to this definition">¶</a></dt>
<dd><p>The internal <a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/local/#werkzeug.local.LocalStack" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalStack</span></code></a> that is used to implement
all the context local objects used in Flask.  This is a documented
instance and can be used by extensions and application code but the
use is discouraged in general.</p>
<p>The following attributes are always present on each layer of the
stack:</p>
<dl class="simple">
<dt><cite>app</cite></dt><dd><p>the active Flask application.</p>
</dd>
<dt><cite>url_adapter</cite></dt><dd><p>the URL adapter that was used to match the request.</p>
</dd>
<dt><cite>request</cite></dt><dd><p>the current request object.</p>
</dd>
<dt><cite>session</cite></dt><dd><p>the active session object.</p>
</dd>
<dt><cite>g</cite></dt><dd><p>an object with all the attributes of the <a class="reference internal" href="#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a> object.</p>
</dd>
<dt><cite>flashes</cite></dt><dd><p>an internal cache for the flashed messages.</p>
</dd>
</dl>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">_request_ctx_stack</span>

<span class="k">def</span> <span class="nf">get_session</span><span class="p">():</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span>
    <span class="k">if</span> <span class="n">ctx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">session</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="flask.ctx.AppContext">
<em class="property">class </em><code class="sig-prename descclassname">flask.ctx.</code><code class="sig-name descname">AppContext</code><span class="sig-paren">(</span><em class="sig-param">app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.AppContext" title="Permalink to this definition">¶</a></dt>
<dd><p>The application context binds an application object implicitly
to the current thread or greenlet, similar to how the
<a class="reference internal" href="#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> binds request information.  The application
context is also implicitly created if a request context is created
but the application is not on top of the individual application
context.</p>
<dl class="method">
<dt id="flask.ctx.AppContext.pop">
<code class="sig-name descname">pop</code><span class="sig-paren">(</span><em class="sig-param">exc=&lt;object object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.AppContext.pop" title="Permalink to this definition">¶</a></dt>
<dd><p>Pops the app context.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ctx.AppContext.push">
<code class="sig-name descname">push</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.AppContext.push" title="Permalink to this definition">¶</a></dt>
<dd><p>Binds the app context to the current context.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="flask._app_ctx_stack">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">_app_ctx_stack</code><a class="headerlink" href="#flask._app_ctx_stack" title="Permalink to this definition">¶</a></dt>
<dd><p>Works similar to the request context but only binds the application.
This is mainly there for extensions to store data.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.</span></p>
</div>
</details></dd></dl>

<dl class="class">
<dt id="flask.blueprints.BlueprintSetupState">
<em class="property">class </em><code class="sig-prename descclassname">flask.blueprints.</code><code class="sig-name descname">BlueprintSetupState</code><span class="sig-paren">(</span><em class="sig-param">blueprint</em>, <em class="sig-param">app</em>, <em class="sig-param">options</em>, <em class="sig-param">first_registration</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.blueprints.BlueprintSetupState" title="Permalink to this definition">¶</a></dt>
<dd><p>Temporary holder object for registering a blueprint with the
application.  An instance of this class is created by the
<a class="reference internal" href="#flask.Blueprint.make_setup_state" title="flask.Blueprint.make_setup_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_setup_state()</span></code></a> method and later passed
to all register callback functions.</p>
<dl class="method">
<dt id="flask.blueprints.BlueprintSetupState.add_url_rule">
<code class="sig-name descname">add_url_rule</code><span class="sig-paren">(</span><em class="sig-param">rule</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">view_func=None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.add_url_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper method to register a rule (and optionally a view function)
to the application.  The endpoint is automatically prefixed with the
blueprint’s name.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.app">
<code class="sig-name descname">app</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.app" title="Permalink to this definition">¶</a></dt>
<dd><p>a reference to the current application</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.blueprint">
<code class="sig-name descname">blueprint</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.blueprint" title="Permalink to this definition">¶</a></dt>
<dd><p>a reference to the blueprint that created this setup state.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.first_registration">
<code class="sig-name descname">first_registration</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.first_registration" title="Permalink to this definition">¶</a></dt>
<dd><p>as blueprints can be registered multiple times with the
application and not everything wants to be registered
multiple times on it, this attribute can be used to figure
out if the blueprint was registered in the past already.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.options">
<code class="sig-name descname">options</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.options" title="Permalink to this definition">¶</a></dt>
<dd><p>a dictionary with all options that were passed to the
<a class="reference internal" href="#flask.Flask.register_blueprint" title="flask.Flask.register_blueprint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_blueprint()</span></code></a> method.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.subdomain">
<code class="sig-name descname">subdomain</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.subdomain" title="Permalink to this definition">¶</a></dt>
<dd><p>The subdomain that the blueprint should be active for, <code class="docutils literal notranslate"><span class="pre">None</span></code>
otherwise.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.url_defaults">
<code class="sig-name descname">url_defaults</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.url_defaults" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with URL defaults that is added to each and every
URL that was defined with the blueprint.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.url_prefix">
<code class="sig-name descname">url_prefix</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.url_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>The prefix that should be used for all URLs defined on the
blueprint.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="signals">
<span id="core-signals-list"></span><h4>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.6.</span></p>
</div>
</details><dl class="data">
<dt id="flask.signals.signals_available">
<code class="sig-prename descclassname">signals.</code><code class="sig-name descname">signals_available</code><a class="headerlink" href="#flask.signals.signals_available" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the signaling system is available.  This is the case
when <a class="reference external" href="https://pypi.org/project/blinker/">blinker</a> is installed.</p>
</dd></dl>

<p>The following signals exist in Flask:</p>
<dl class="data">
<dt id="flask.template_rendered">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">template_rendered</code><a class="headerlink" href="#flask.template_rendered" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when a template was successfully rendered.  The
signal is invoked with the instance of the template as <cite>template</cite>
and the context as dictionary (named <cite>context</cite>).</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_template_renders</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Rendering template &quot;</span><span class="si">%s</span><span class="s1">&quot; with context </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;string template&#39;</span><span class="p">,</span>
                        <span class="n">context</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>
<span class="n">template_rendered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_template_renders</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">before_render_template</code></dt>
<dd><p>This signal is sent before template rendering process. The
signal is invoked with the instance of the template as <cite>template</cite>
and the context as dictionary (named <cite>context</cite>).</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_template_renders</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Rendering template &quot;</span><span class="si">%s</span><span class="s1">&quot; with context </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;string template&#39;</span><span class="p">,</span>
                        <span class="n">context</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">before_render_template</span>
<span class="n">before_render_template</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_template_renders</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.request_started">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">request_started</code><a class="headerlink" href="#flask.request_started" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when the request context is set up, before
any request processing happens.  Because the request context is already
bound, the subscriber can access the request with the standard global
proxies such as <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request context is set up&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request_started</span>
<span class="n">request_started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_request</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.request_finished">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">request_finished</code><a class="headerlink" href="#flask.request_finished" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent right before the response is sent to the client.
It is passed the response to be sent named <cite>response</cite>.</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_response</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request context is about to close down.  &#39;</span>
                        <span class="s1">&#39;Response: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request_finished</span>
<span class="n">request_finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_response</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.got_request_exception">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">got_request_exception</code><a class="headerlink" href="#flask.got_request_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when an exception happens during request processing.
It is sent <em>before</em> the standard exception handling kicks in and even
in debug mode, where no exception handling happens.  The exception
itself is passed to the subscriber as <cite>exception</cite>.</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_exception</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Got exception during processing: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">got_request_exception</span>
<span class="n">got_request_exception</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_exception</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.request_tearing_down">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">request_tearing_down</code><a class="headerlink" href="#flask.request_tearing_down" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when the request is tearing down.  This is always
called, even if an exception is caused.  Currently functions listening
to this signal are called after the regular teardown handlers, but this
is not something you can rely on.</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">close_db_connection</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request_tearing_down</span>
<span class="n">request_tearing_down</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">close_db_connection</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>As of Flask 0.9, this will also be passed an <cite>exc</cite> keyword argument
that has a reference to the exception that caused the teardown if
there was one.</p>
</dd></dl>

<dl class="data">
<dt id="flask.appcontext_tearing_down">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">appcontext_tearing_down</code><a class="headerlink" href="#flask.appcontext_tearing_down" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when the app context is tearing down.  This is always
called, even if an exception is caused.  Currently functions listening
to this signal are called after the regular teardown handlers, but this
is not something you can rely on.</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">close_db_connection</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">appcontext_tearing_down</span>
<span class="n">appcontext_tearing_down</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">close_db_connection</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>This will also be passed an <cite>exc</cite> keyword argument that has a reference
to the exception that caused the teardown if there was one.</p>
</dd></dl>

<dl class="data">
<dt id="flask.appcontext_pushed">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">appcontext_pushed</code><a class="headerlink" href="#flask.appcontext_pushed" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when an application context is pushed.  The sender
is the application.  This is usually useful for unittests in order to
temporarily hook in information.  For instance it can be used to
set a resource early onto the <cite>g</cite> object.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">appcontext_pushed</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">with</span> <span class="n">appcontext_pushed</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">yield</span>
</pre></div>
</div>
<p>And in the testcode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_user_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;john&#39;</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;username=john&#39;</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="data">
<dt id="flask.appcontext_popped">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">appcontext_popped</code><a class="headerlink" href="#flask.appcontext_popped" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when an application context is popped.  The sender
is the application.  This usually falls in line with the
<a class="reference internal" href="#flask.appcontext_tearing_down" title="flask.appcontext_tearing_down"><code class="xref py py-data docutils literal notranslate"><span class="pre">appcontext_tearing_down</span></code></a> signal.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="data">
<dt id="flask.message_flashed">
<code class="sig-prename descclassname">flask.</code><code class="sig-name descname">message_flashed</code><a class="headerlink" href="#flask.message_flashed" title="Permalink to this definition">¶</a></dt>
<dd><p>This signal is sent when the application is flashing a message.  The
messages is sent as <cite>message</cite> keyword argument and the category as
<cite>category</cite>.</p>
<p>Example subscriber:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recorded</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">message_flashed</span>
<span class="n">message_flashed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.10.</span></p>
</div>
</details></dd></dl>

<dl class="class">
<dt id="flask.signals.Namespace">
<em class="property">class </em><code class="sig-prename descclassname">signals.</code><code class="sig-name descname">Namespace</code><a class="headerlink" href="#flask.signals.Namespace" title="Permalink to this definition">¶</a></dt>
<dd><p>An alias for <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Namespace" title="(in Blinker v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">blinker.base.Namespace</span></code></a> if blinker is available,
otherwise a dummy class that creates fake signals.  This class is
available for Flask extensions that want to provide the same fallback
system as Flask itself.</p>
<dl class="method">
<dt id="flask.signals.Namespace.signal">
<code class="sig-name descname">signal</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">doc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.signals.Namespace.signal" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new signal for this namespace if blinker is available,
otherwise returns a fake signal that has a send method that will
do nothing but will fail with a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> for all other
operations, including connecting.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="class-based-views">
<h4>Class-Based Views<a class="headerlink" href="#class-based-views" title="Permalink to this headline">¶</a></h4>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.7.</span></p>
</div>
</details><dl class="class">
<dt id="flask.views.View">
<em class="property">class </em><code class="sig-prename descclassname">flask.views.</code><code class="sig-name descname">View</code><a class="headerlink" href="#flask.views.View" title="Permalink to this definition">¶</a></dt>
<dd><p>Alternative way to use view functions.  A subclass has to implement
<a class="reference internal" href="#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> which is called with the view arguments from
the URL routing system.  If <a class="reference internal" href="#flask.views.View.methods" title="flask.views.View.methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">methods</span></code></a> is provided the methods
do not have to be passed to the <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a>
method explicitly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Hello </span><span class="si">%s</span><span class="s1">!&#39;</span> <span class="o">%</span> <span class="n">name</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">MyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;myview&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>When you want to decorate a pluggable view you will have to either do that
when the view function is created (by wrapping the return value of
<a class="reference internal" href="#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a>) or you can use the <a class="reference internal" href="#flask.views.View.decorators" title="flask.views.View.decorators"><code class="xref py py-attr docutils literal notranslate"><span class="pre">decorators</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SecretView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span>
    <span class="n">decorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">superuser_required</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The decorators stored in the decorators list are applied one after another
when the view function is created.  Note that you can <em>not</em> use the class
based decorators since those would decorate the view class and not the
generated view function!</p>
<dl class="method">
<dt id="flask.views.View.as_view">
<em class="property">classmethod </em><code class="sig-name descname">as_view</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">*class_args</em>, <em class="sig-param">**class_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.views.View.as_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts the class into an actual view function that can be used
with the routing system.  Internally this generates a function on the
fly which will instantiate the <a class="reference internal" href="#flask.views.View" title="flask.views.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">View</span></code></a> on each request and call
the <a class="reference internal" href="#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> method on it.</p>
<p>The arguments passed to <a class="reference internal" href="#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a> are forwarded to the
constructor of the class.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.views.View.decorators">
<code class="sig-name descname">decorators</code><em class="property"> = ()</em><a class="headerlink" href="#flask.views.View.decorators" title="Permalink to this definition">¶</a></dt>
<dd><p>The canonical way to decorate class-based views is to decorate the
return value of as_view().  However since this moves parts of the
logic from the class declaration to the place where it’s hooked
into the routing system.</p>
<p>You can place one or more decorators in this list and whenever the
view function is created the result is automatically decorated.</p>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
</details></dd></dl>

<dl class="method">
<dt id="flask.views.View.dispatch_request">
<code class="sig-name descname">dispatch_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.views.View.dispatch_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclasses have to override this method to implement the
actual view function code.  This method is called with all
the arguments from the URL rule.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.views.View.methods">
<code class="sig-name descname">methods</code><em class="property"> = None</em><a class="headerlink" href="#flask.views.View.methods" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of methods this view can handle.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.views.MethodView">
<em class="property">class </em><code class="sig-prename descclassname">flask.views.</code><code class="sig-name descname">MethodView</code><a class="headerlink" href="#flask.views.MethodView" title="Permalink to this definition">¶</a></dt>
<dd><p>Like a regular class-based view but that dispatches requests to
particular methods.  For instance if you implement a method called
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> it means it will respond to <code class="docutils literal notranslate"><span class="pre">'GET'</span></code> requests and
the <a class="reference internal" href="#flask.views.MethodView.dispatch_request" title="flask.views.MethodView.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> implementation will automatically
forward your request to that.  Also <code class="xref py py-attr docutils literal notranslate"><span class="pre">options</span></code> is set for you
automatically:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CounterAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/counter&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">CounterAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl class="method">
<dt id="flask.views.MethodView.dispatch_request">
<code class="sig-name descname">dispatch_request</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.views.MethodView.dispatch_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclasses have to override this method to implement the
actual view function code.  This method is called with all
the arguments from the URL rule.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="url-route-registrations">
<span id="id2"></span><h4>URL Route Registrations<a class="headerlink" href="#url-route-registrations" title="Permalink to this headline">¶</a></h4>
<p>Generally there are three ways to define rules for the routing system:</p>
<ol class="arabic simple">
<li><p>You can use the <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.route()</span></code></a> decorator.</p></li>
<li><p>You can use the <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.add_url_rule()</span></code></a> function.</p></li>
<li><p>You can directly access the underlying Werkzeug routing system
which is exposed as <a class="reference internal" href="#flask.Flask.url_map" title="flask.Flask.url_map"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.url_map</span></code></a>.</p></li>
</ol>
<p>Variable parts in the route can be specified with angular brackets
(<code class="docutils literal notranslate"><span class="pre">/user/&lt;username&gt;</span></code>).  By default a variable part in the URL accepts any
string without a slash however a different converter can be specified as
well by using <code class="docutils literal notranslate"><span class="pre">&lt;converter:name&gt;</span></code>.</p>
<p>Variable parts are passed to the view function as keyword arguments.</p>
<p>The following converters are available:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><cite>string</cite></p></td>
<td><p>accepts any text without a slash (the default)</p></td>
</tr>
<tr class="row-even"><td><p><cite>int</cite></p></td>
<td><p>accepts integers</p></td>
</tr>
<tr class="row-odd"><td><p><cite>float</cite></p></td>
<td><p>like <cite>int</cite> but for floating point values</p></td>
</tr>
<tr class="row-even"><td><p><cite>path</cite></p></td>
<td><p>like the default but also accepts slashes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>any</cite></p></td>
<td><p>matches one of the items provided</p></td>
</tr>
<tr class="row-even"><td><p><cite>uuid</cite></p></td>
<td><p>accepts UUID strings</p></td>
</tr>
</tbody>
</table>
<p>Custom converters can be defined using <a class="reference internal" href="#flask.Flask.url_map" title="flask.Flask.url_map"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.url_map</span></code></a>.</p>
<p>Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post/&lt;int:post_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_post</span><span class="p">(</span><span class="n">post_id</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>An important detail to keep in mind is how Flask deals with trailing
slashes.  The idea is to keep each URL unique so the following rules
apply:</p>
<ol class="arabic simple">
<li><p>If a rule ends with a slash and is requested without a slash by the
user, the user is automatically redirected to the same page with a
trailing slash attached.</p></li>
<li><p>If a rule does not end with a trailing slash and the user requests the
page with a trailing slash, a 404 not found is raised.</p></li>
</ol>
<p>This is consistent with how web servers deal with static files.  This
also makes it possible to use relative link targets safely.</p>
<p>You can also define multiple rules for the same function.  They have to be
unique however.  Defaults can also be specified.  Here for example is a
definition for a URL that accepts an optional page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/page/&lt;int:page&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_users</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This specifies that <code class="docutils literal notranslate"><span class="pre">/users/</span></code> will be the URL for page one and
<code class="docutils literal notranslate"><span class="pre">/users/page/N</span></code> will be the URL for page <cite>N</cite>.</p>
<p>Here are the parameters that <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> and
<a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> accept.  The only difference is that
with the route parameter the view function is defined with the decorator
instead of the <cite>view_func</cite> parameter.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><cite>rule</cite></p></td>
<td><p>the URL rule as string</p></td>
</tr>
<tr class="row-even"><td><p><cite>endpoint</cite></p></td>
<td><p>the endpoint for the registered URL rule.  Flask itself
assumes that the name of the view function is the name
of the endpoint if not explicitly stated.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>view_func</cite></p></td>
<td><p>the function to call when serving a request to the
provided endpoint.  If this is not provided one can
specify the function later by storing it in the
<a class="reference internal" href="#flask.Flask.view_functions" title="flask.Flask.view_functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">view_functions</span></code></a> dictionary with the
endpoint as key.</p></td>
</tr>
<tr class="row-even"><td><p><cite>defaults</cite></p></td>
<td><p>A dictionary with defaults for this rule.  See the
example above for how defaults work.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>subdomain</cite></p></td>
<td><p>specifies the rule for the subdomain in case subdomain
matching is in use.  If not specified the default
subdomain is assumed.</p></td>
</tr>
<tr class="row-even"><td><p><cite>**options</cite></p></td>
<td><p>the options to be forwarded to the underlying
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/routing/#werkzeug.routing.Rule" title="(in Werkzeug v1.0.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> object.  A change to
Werkzeug is handling of method options.  methods is a list
of methods this rule should be limited to (<code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code>
etc.).  By default a rule just listens for <code class="docutils literal notranslate"><span class="pre">GET</span></code> (and
implicitly <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>).  Starting with Flask 0.6, <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> is
implicitly added and handled by the standard request
handling.  They have to be specified as keyword arguments.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="view-function-options">
<span id="view-func-options"></span><h4>View Function Options<a class="headerlink" href="#view-function-options" title="Permalink to this headline">¶</a></h4>
<p>For internal usage the view functions can have some attributes attached to
customize behavior the view function would normally not have control over.
The following attributes can be provided optionally to either override
some defaults to <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> or general behavior:</p>
<ul class="simple">
<li><p><cite>__name__</cite>: The name of a function is by default used as endpoint.  If
endpoint is provided explicitly this value is used.  Additionally this
will be prefixed with the name of the blueprint by default which
cannot be customized from the function itself.</p></li>
<li><p><cite>methods</cite>: If methods are not provided when the URL rule is added,
Flask will look on the view function object itself if a <cite>methods</cite>
attribute exists.  If it does, it will pull the information for the
methods from there.</p></li>
<li><p><cite>provide_automatic_options</cite>: if this attribute is set Flask will
either force enable or disable the automatic implementation of the
HTTP <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> response.  This can be useful when working with
decorators that want to customize the <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> response on a per-view
basis.</p></li>
<li><p><cite>required_methods</cite>: if this attribute is set, Flask will always add
these methods when registering a URL rule even if the methods were
explicitly overridden in the <code class="docutils literal notranslate"><span class="pre">route()</span></code> call.</p></li>
</ul>
<p>Full example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
        <span class="c1"># custom options handling here</span>
        <span class="o">...</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
<span class="n">index</span><span class="o">.</span><span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">index</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">]</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<details class="changelog">
<summary>Changelog</summary><div class="versionadded">
<p><span class="versionmodified added">New in version 0.8: </span>The <cite>provide_automatic_options</cite> functionality was added.</p>
</div>
</details></div>
<div class="section" id="command-line-interface">
<h4>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="flask.cli.FlaskGroup">
<em class="property">class </em><code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">FlaskGroup</code><span class="sig-paren">(</span><em class="sig-param">add_default_commands=True</em>, <em class="sig-param">create_app=None</em>, <em class="sig-param">add_version_option=True</em>, <em class="sig-param">**extra</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.FlaskGroup" title="Permalink to this definition">¶</a></dt>
<dd><p>Special subclass of the <a class="reference internal" href="#flask.cli.AppGroup" title="flask.cli.AppGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppGroup</span></code></a> group that supports
loading more commands from the configured Flask app.  Normally a
developer does not have to interface with this class but there are
some very advanced use cases for which it makes sense to create an
instance of this.</p>
<p>For information as of why this is useful see <a class="reference internal" href="index.html#custom-scripts"><span class="std std-ref">Custom Scripts</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>add_default_commands</strong> – if this is True then the default run and
shell commands wil be added.</p></li>
<li><p><strong>add_version_option</strong> – adds the <code class="docutils literal notranslate"><span class="pre">--version</span></code> option.</p></li>
<li><p><strong>create_app</strong> – an optional callback that is passed the script info
and returns the loaded app.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="flask.cli.FlaskGroup.get_command">
<code class="sig-name descname">get_command</code><span class="sig-paren">(</span><em class="sig-param">ctx</em>, <em class="sig-param">name</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.FlaskGroup.get_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a context and a command name, this returns a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Command</span></code> object if it exists or returns <cite>None</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.cli.FlaskGroup.list_commands">
<code class="sig-name descname">list_commands</code><span class="sig-paren">(</span><em class="sig-param">ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.FlaskGroup.list_commands" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list of subcommand names in the order they should
appear.</p>
</dd></dl>

<dl class="method">
<dt id="flask.cli.FlaskGroup.main">
<code class="sig-name descname">main</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.FlaskGroup.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the way to invoke a script with all the bells and
whistles as a command line application.  This will always terminate
the application after a call.  If this is not wanted, <code class="docutils literal notranslate"><span class="pre">SystemExit</span></code>
needs to be caught.</p>
<p>This method is also available by directly calling the instance of
a <code class="xref py py-class docutils literal notranslate"><span class="pre">Command</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0: </span>Added the <cite>standalone_mode</cite> flag to control the standalone mode.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – the arguments that should be used for parsing.  If not
provided, <code class="docutils literal notranslate"><span class="pre">sys.argv[1:]</span></code> is used.</p></li>
<li><p><strong>prog_name</strong> – the program name that should be used.  By default
the program name is constructed by taking the file
name from <code class="docutils literal notranslate"><span class="pre">sys.argv[0]</span></code>.</p></li>
<li><p><strong>complete_var</strong> – the environment variable that controls the
bash completion support.  The default is
<code class="docutils literal notranslate"><span class="pre">&quot;_&lt;prog_name&gt;_COMPLETE&quot;</span></code> with prog_name in
uppercase.</p></li>
<li><p><strong>standalone_mode</strong> – the default behavior is to invoke the script
in standalone mode.  Click will then
handle exceptions and convert them into
error messages and the function will never
return but shut down the interpreter.  If
this is set to <cite>False</cite> they will be
propagated to the caller and the return
value of this function is the return value
of <code class="xref py py-meth docutils literal notranslate"><span class="pre">invoke()</span></code>.</p></li>
<li><p><strong>extra</strong> – extra keyword arguments are forwarded to the context
constructor.  See <code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code> for more information.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.cli.AppGroup">
<em class="property">class </em><code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">AppGroup</code><span class="sig-paren">(</span><em class="sig-param">name=None</em>, <em class="sig-param">commands=None</em>, <em class="sig-param">**attrs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.AppGroup" title="Permalink to this definition">¶</a></dt>
<dd><p>This works similar to a regular click <a class="reference external" href="https://click.palletsprojects.com/en/7.x/api/#click.Group" title="(in Click v7.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Group</span></code></a> but it
changes the behavior of the <a class="reference internal" href="#flask.cli.AppGroup.command" title="flask.cli.AppGroup.command"><code class="xref py py-meth docutils literal notranslate"><span class="pre">command()</span></code></a> decorator so that it
automatically wraps the functions in <a class="reference internal" href="#flask.cli.with_appcontext" title="flask.cli.with_appcontext"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_appcontext()</span></code></a>.</p>
<p>Not to be confused with <a class="reference internal" href="#flask.cli.FlaskGroup" title="flask.cli.FlaskGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlaskGroup</span></code></a>.</p>
<dl class="method">
<dt id="flask.cli.AppGroup.command">
<code class="sig-name descname">command</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.AppGroup.command" title="Permalink to this definition">¶</a></dt>
<dd><p>This works exactly like the method of the same name on a regular
<a class="reference external" href="https://click.palletsprojects.com/en/7.x/api/#click.Group" title="(in Click v7.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">click.Group</span></code></a> but it wraps callbacks in <a class="reference internal" href="#flask.cli.with_appcontext" title="flask.cli.with_appcontext"><code class="xref py py-func docutils literal notranslate"><span class="pre">with_appcontext()</span></code></a>
unless it’s disabled by passing <code class="docutils literal notranslate"><span class="pre">with_appcontext=False</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.cli.AppGroup.group">
<code class="sig-name descname">group</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.AppGroup.group" title="Permalink to this definition">¶</a></dt>
<dd><p>This works exactly like the method of the same name on a regular
<a class="reference external" href="https://click.palletsprojects.com/en/7.x/api/#click.Group" title="(in Click v7.x)"><code class="xref py py-class docutils literal notranslate"><span class="pre">click.Group</span></code></a> but it defaults the group class to
<a class="reference internal" href="#flask.cli.AppGroup" title="flask.cli.AppGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppGroup</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.cli.ScriptInfo">
<em class="property">class </em><code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">ScriptInfo</code><span class="sig-paren">(</span><em class="sig-param">app_import_path=None</em>, <em class="sig-param">create_app=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.ScriptInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Help object to deal with Flask applications.  This is usually not
necessary to interface with as it’s used internally in the dispatching
to click.  In future versions of Flask this object will most likely play
a bigger role.  Typically it’s created automatically by the
<a class="reference internal" href="#flask.cli.FlaskGroup" title="flask.cli.FlaskGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlaskGroup</span></code></a> but you can also manually create it and pass it
onwards as click object.</p>
<dl class="attribute">
<dt id="flask.cli.ScriptInfo.app_import_path">
<code class="sig-name descname">app_import_path</code><em class="property"> = None</em><a class="headerlink" href="#flask.cli.ScriptInfo.app_import_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Optionally the import path for the Flask application.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.cli.ScriptInfo.create_app">
<code class="sig-name descname">create_app</code><em class="property"> = None</em><a class="headerlink" href="#flask.cli.ScriptInfo.create_app" title="Permalink to this definition">¶</a></dt>
<dd><p>Optionally a function that is passed the script info to create
the instance of the application.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.cli.ScriptInfo.data">
<code class="sig-name descname">data</code><em class="property"> = None</em><a class="headerlink" href="#flask.cli.ScriptInfo.data" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with arbitrary data that can be associated with
this script info.</p>
</dd></dl>

<dl class="method">
<dt id="flask.cli.ScriptInfo.load_app">
<code class="sig-name descname">load_app</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.ScriptInfo.load_app" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads the Flask app (if not yet loaded) and returns it.  Calling
this multiple times will just result in the already loaded app to
be returned.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="flask.cli.with_appcontext">
<code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">with_appcontext</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.with_appcontext" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps a callback so that it’s guaranteed to be executed with the
script’s application context.  If callbacks are registered directly
to the <code class="docutils literal notranslate"><span class="pre">app.cli</span></code> object then they are wrapped with this function
by default unless it’s disabled.</p>
</dd></dl>

<dl class="function">
<dt id="flask.cli.pass_script_info">
<code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">pass_script_info</code><span class="sig-paren">(</span><em class="sig-param">f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.cli.pass_script_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Marks a function so that an instance of <a class="reference internal" href="#flask.cli.ScriptInfo" title="flask.cli.ScriptInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScriptInfo</span></code></a> is passed
as first argument to the click callback.</p>
</dd></dl>

<dl class="data">
<dt id="flask.cli.run_command">
<code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">run_command</code><em class="property"> = &lt;Command run&gt;</em><a class="headerlink" href="#flask.cli.run_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs a local development server for the Flask application.</p>
<p>This local server is recommended for development purposes only but it
can also be used for simple intranet deployments.  By default it will
not support any sort of concurrency at all to simplify debugging.  This
can be changed with the –with-threads option which will enable basic
multithreading.</p>
<p>The reloader and debugger are by default enabled if the debug flag of
Flask is enabled and disabled otherwise.</p>
</dd></dl>

<dl class="data">
<dt id="flask.cli.shell_command">
<code class="sig-prename descclassname">flask.cli.</code><code class="sig-name descname">shell_command</code><em class="property"> = &lt;Command shell&gt;</em><a class="headerlink" href="#flask.cli.shell_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs an interactive Python shell in the context of a given
Flask application.  The application will populate the default
namespace of this shell according to it’s configuration.</p>
<p>This is useful for executing small snippets of management code
without having to manually configuring the application.</p>
</dd></dl>

</div>
</div>
</div>
</div>
<div class="section" id="additional-notes">
<h2>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this headline">¶</a></h2>
<p>Design notes, legal information and changelog are here for the interested.</p>
<div class="toctree-wrapper compound">
<span id="document-design"></span><div class="section" id="design-decisions-in-flask">
<span id="design"></span><h3>Design Decisions in Flask<a class="headerlink" href="#design-decisions-in-flask" title="Permalink to this headline">¶</a></h3>
<p>If you are curious why Flask does certain things the way it does and not
differently, this section is for you.  This should give you an idea about
some of the design decisions that may appear arbitrary and surprising at
first, especially in direct comparison with other frameworks.</p>
<div class="section" id="the-explicit-application-object">
<h4>The Explicit Application Object<a class="headerlink" href="#the-explicit-application-object" title="Permalink to this headline">¶</a></h4>
<p>A Python web application based on WSGI has to have one central callable
object that implements the actual application.  In Flask this is an
instance of the <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> class.  Each Flask application has
to create an instance of this class itself and pass it the name of the
module, but why can’t Flask do that itself?</p>
<p>Without such an explicit application object the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>Would look like this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hypothetical_flask</span> <span class="k">import</span> <span class="n">route</span>

<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>There are three major reasons for this.  The most important one is that
implicit application objects require that there may only be one instance at
the time.  There are ways to fake multiple applications with a single
application object, like maintaining a stack of applications, but this
causes some problems I won’t outline here in detail.  Now the question is:
when does a microframework need more than one application at the same
time?  A good example for this is unittesting.  When you want to test
something it can be very helpful to create a minimal application to test
specific behavior.  When the application object is deleted everything it
allocated will be freed again.</p>
<p>Another thing that becomes possible when you have an explicit object lying
around in your code is that you can subclass the base class
(<a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>) to alter specific behavior.  This would not be
possible without hacks if the object were created ahead of time for you
based on a class that is not exposed to you.</p>
<p>But there is another very important reason why Flask depends on an
explicit instantiation of that class: the package name.  Whenever you
create a Flask instance you usually pass it <cite>__name__</cite> as package name.
Flask depends on that information to properly load resources relative
to your module.  With Python’s outstanding support for reflection it can
then access the package to figure out where the templates and static files
are stored (see <a class="reference internal" href="index.html#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_resource()</span></code></a>).  Now obviously there
are frameworks around that do not need any configuration and will still be
able to load templates relative to your application module.  But they have
to use the current working directory for that, which is a very unreliable
way to determine where the application is.  The current working directory
is process-wide and if you are running multiple applications in one
process (which could happen in a webserver without you knowing) the paths
will be off.  Worse: many webservers do not set the working directory to
the directory of your application but to the document root which does not
have to be the same folder.</p>
<p>The third reason is “explicit is better than implicit”.  That object is
your WSGI application, you don’t have to remember anything else.  If you
want to apply a WSGI middleware, just wrap it and you’re done (though
there are better ways to do that so that you do not lose the reference
to the application object <a class="reference internal" href="index.html#flask.Flask.wsgi_app" title="flask.Flask.wsgi_app"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wsgi_app()</span></code></a>).</p>
<p>Furthermore this design makes it possible to use a factory function to
create the application which is very helpful for unittesting and similar
things (<a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a>).</p>
</div>
<div class="section" id="the-routing-system">
<h4>The Routing System<a class="headerlink" href="#the-routing-system" title="Permalink to this headline">¶</a></h4>
<p>Flask uses the Werkzeug routing system which was designed to
automatically order routes by complexity.  This means that you can declare
routes in arbitrary order and they will still work as expected.  This is a
requirement if you want to properly implement decorator based routing
since decorators could be fired in undefined order when the application is
split into multiple modules.</p>
<p>Another design decision with the Werkzeug routing system is that routes
in Werkzeug try to ensure that URLs are unique.  Werkzeug will go quite far
with that in that it will automatically redirect to a canonical URL if a route
is ambiguous.</p>
</div>
<div class="section" id="one-template-engine">
<h4>One Template Engine<a class="headerlink" href="#one-template-engine" title="Permalink to this headline">¶</a></h4>
<p>Flask decides on one template engine: Jinja2.  Why doesn’t Flask have a
pluggable template engine interface?  You can obviously use a different
template engine, but Flask will still configure Jinja2 for you.  While
that limitation that Jinja2 is <em>always</em> configured will probably go away,
the decision to bundle one template engine and use that will not.</p>
<p>Template engines are like programming languages and each of those engines
has a certain understanding about how things work.  On the surface they
all work the same: you tell the engine to evaluate a template with a set
of variables and take the return value as string.</p>
<p>But that’s about where similarities end.  Jinja2 for example has an
extensive filter system, a certain way to do template inheritance, support
for reusable blocks (macros) that can be used from inside templates and
also from Python code, uses Unicode for all operations, supports
iterative template rendering, configurable syntax and more.  On the other
hand an engine like Genshi is based on XML stream evaluation, template
inheritance by taking the availability of XPath into account and more.
Mako on the other hand treats templates similar to Python modules.</p>
<p>When it comes to connecting a template engine with an application or
framework there is more than just rendering templates.  For instance,
Flask uses Jinja2’s extensive autoescaping support.  Also it provides
ways to access macros from Jinja2 templates.</p>
<p>A template abstraction layer that would not take the unique features of
the template engines away is a science on its own and a too large
undertaking for a microframework like Flask.</p>
<p>Furthermore extensions can then easily depend on one template language
being present.  You can easily use your own templating language, but an
extension could still depend on Jinja itself.</p>
</div>
<div class="section" id="micro-with-dependencies">
<h4>Micro with Dependencies<a class="headerlink" href="#micro-with-dependencies" title="Permalink to this headline">¶</a></h4>
<p>Why does Flask call itself a microframework and yet it depends on two
libraries (namely Werkzeug and Jinja2).  Why shouldn’t it?  If we look
over to the Ruby side of web development there we have a protocol very
similar to WSGI.  Just that it’s called Rack there, but besides that it
looks very much like a WSGI rendition for Ruby.  But nearly all
applications in Ruby land do not work with Rack directly, but on top of a
library with the same name.  This Rack library has two equivalents in
Python: WebOb (formerly Paste) and Werkzeug.  Paste is still around but
from my understanding it’s sort of deprecated in favour of WebOb.  The
development of WebOb and Werkzeug started side by side with similar ideas
in mind: be a good implementation of WSGI for other applications to take
advantage.</p>
<p>Flask is a framework that takes advantage of the work already done by
Werkzeug to properly interface WSGI (which can be a complex task at
times).  Thanks to recent developments in the Python package
infrastructure, packages with dependencies are no longer an issue and
there are very few reasons against having libraries that depend on others.</p>
</div>
<div class="section" id="thread-locals">
<h4>Thread Locals<a class="headerlink" href="#thread-locals" title="Permalink to this headline">¶</a></h4>
<p>Flask uses thread local objects (context local objects in fact, they
support greenlet contexts as well) for request, session and an extra
object you can put your own things on (<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a>).  Why is that and
isn’t that a bad idea?</p>
<p>Yes it is usually not such a bright idea to use thread locals.  They cause
troubles for servers that are not based on the concept of threads and make
large applications harder to maintain.  However Flask is just not designed
for large applications or asynchronous servers.  Flask wants to make it
quick and easy to write a traditional web application.</p>
<p>Also see the <a class="reference internal" href="index.html#becomingbig"><span class="std std-ref">Becoming Big</span></a> section of the documentation for some
inspiration for larger applications based on Flask.</p>
</div>
<div class="section" id="what-flask-is-what-flask-is-not">
<h4>What Flask is, What Flask is Not<a class="headerlink" href="#what-flask-is-what-flask-is-not" title="Permalink to this headline">¶</a></h4>
<p>Flask will never have a database layer.  It will not have a form library
or anything else in that direction.  Flask itself just bridges to Werkzeug
to implement a proper WSGI application and to Jinja2 to handle templating.
It also binds to a few common standard library packages such as logging.
Everything else is up for extensions.</p>
<p>Why is this the case?  Because people have different preferences and
requirements and Flask could not meet those if it would force any of this
into the core.  The majority of web applications will need a template
engine in some sort.  However not every application needs a SQL database.</p>
<p>The idea of Flask is to build a good foundation for all applications.
Everything else is up to you or extensions.</p>
</div>
</div>
<span id="document-htmlfaq"></span><div class="section" id="html-xhtml-faq">
<h3>HTML/XHTML FAQ<a class="headerlink" href="#html-xhtml-faq" title="Permalink to this headline">¶</a></h3>
<p>The Flask documentation and example applications are using HTML5.  You
may notice that in many situations, when end tags are optional they are
not used, so that the HTML is cleaner and faster to load.  Because there
is much confusion about HTML and XHTML among developers, this document tries
to answer some of the major questions.</p>
<div class="section" id="history-of-xhtml">
<h4>History of XHTML<a class="headerlink" href="#history-of-xhtml" title="Permalink to this headline">¶</a></h4>
<p>For a while, it appeared that HTML was about to be replaced by XHTML.
However, barely any websites on the Internet are actual XHTML (which is
HTML processed using XML rules).  There are a couple of major reasons
why this is the case.  One of them is Internet Explorer’s lack of proper
XHTML support. The XHTML spec states that XHTML must be served with the MIME
type <em class="mimetype">application/xhtml+xml</em>, but Internet Explorer refuses to read files
with that MIME type.
While it is relatively easy to configure Web servers to serve XHTML properly,
few people do.  This is likely because properly using XHTML can be quite
painful.</p>
<p>One of the most important causes of pain is XML’s draconian (strict and
ruthless) error handling.  When an XML parsing error is encountered,
the browser is supposed to show the user an ugly error message, instead
of attempting to recover from the error and display what it can.  Most of
the (X)HTML generation on the web is based on non-XML template engines
(such as Jinja, the one used in Flask) which do not protect you from
accidentally creating invalid XHTML.  There are XML based template engines,
such as Kid and the popular Genshi, but they often come with a larger
runtime overhead and are not as straightforward to use because they have
to obey XML rules.</p>
<p>The majority of users, however, assumed they were properly using XHTML.
They wrote an XHTML doctype at the top of the document and self-closed all
the necessary tags (<code class="docutils literal notranslate"><span class="pre">&lt;br&gt;</span></code> becomes <code class="docutils literal notranslate"><span class="pre">&lt;br/&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;br&gt;&lt;/br&gt;</span></code> in XHTML).
However, even if the document properly validates as XHTML, what really
determines XHTML/HTML processing in browsers is the MIME type, which as
said before is often not set properly. So the valid XHTML was being treated
as invalid HTML.</p>
<p>XHTML also changed the way JavaScript is used. To properly work with XHTML,
programmers have to use the namespaced DOM interface with the XHTML
namespace to query for HTML elements.</p>
</div>
<div class="section" id="history-of-html5">
<h4>History of HTML5<a class="headerlink" href="#history-of-html5" title="Permalink to this headline">¶</a></h4>
<p>Development of the HTML5 specification was started in 2004 under the name
“Web Applications 1.0” by the Web Hypertext Application Technology Working
Group, or WHATWG (which was formed by the major browser vendors Apple,
Mozilla, and Opera) with the goal of writing a new and improved HTML
specification, based on existing browser behavior instead of unrealistic
and backwards-incompatible specifications.</p>
<p>For example, in HTML4 <code class="docutils literal notranslate"><span class="pre">&lt;title/Hello/</span></code> theoretically parses exactly the
same as <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;Hello&lt;/title&gt;</span></code>.  However, since people were using
XHTML-like tags along the lines of <code class="docutils literal notranslate"><span class="pre">&lt;link</span> <span class="pre">/&gt;</span></code>, browser vendors implemented
the XHTML syntax over the syntax defined by the specification.</p>
<p>In 2007, the specification was adopted as the basis of a new HTML
specification under the umbrella of the W3C, known as HTML5.  Currently,
it appears that XHTML is losing traction, as the XHTML 2 working group has
been disbanded and HTML5 is being implemented by all major browser vendors.</p>
</div>
<div class="section" id="html-versus-xhtml">
<h4>HTML versus XHTML<a class="headerlink" href="#html-versus-xhtml" title="Permalink to this headline">¶</a></h4>
<p>The following table gives you a quick overview of features available in
HTML 4.01, XHTML 1.1 and HTML5. (XHTML 1.0 is not included, as it was
superseded by XHTML 1.1 and the barely-used XHTML5.)</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 58%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>HTML4.01</p></th>
<th class="head"><p>XHTML1.1</p></th>
<th class="head"><p>HTML5</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;tag/value/</span></code> == <code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;value&lt;/tag&gt;</span></code></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /> <a class="footnote-reference brackets" href="#id4" id="id1">1</a></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;br/&gt;</span></code> supported</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /> <a class="footnote-reference brackets" href="#id5" id="id2">2</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;script/&gt;</span></code> supported</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>should be served as <cite>text/html</cite></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /> <a class="footnote-reference brackets" href="#id6" id="id3">3</a></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
</tr>
<tr class="row-even"><td><p>should be served as
<cite>application/xhtml+xml</cite></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>strict error handling</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
</tr>
<tr class="row-even"><td><p>inline SVG</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>inline MathML</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> tag</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> tag</p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
</tr>
<tr class="row-even"><td><p>New semantic tags like <code class="docutils literal notranslate"><span class="pre">&lt;article&gt;</span></code></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="No" src="_images/no.png" /></p></td>
<td><p><img alt="Yes" src="_images/yes.png" /></p></td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>This is an obscure feature inherited from SGML. It is usually not
supported by browsers, for reasons detailed above.</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>This is for compatibility with server code that generates XHTML for
tags such as <code class="docutils literal notranslate"><span class="pre">&lt;br&gt;</span></code>.  It should not be used in new code.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>XHTML 1.0 is the last XHTML standard that allows to be served
as <cite>text/html</cite> for backwards compatibility reasons.</p>
</dd>
</dl>
</div>
<div class="section" id="what-does-strict-mean">
<h4>What does “strict” mean?<a class="headerlink" href="#what-does-strict-mean" title="Permalink to this headline">¶</a></h4>
<p>HTML5 has strictly defined parsing rules, but it also specifies exactly
how a browser should react to parsing errors - unlike XHTML, which simply
states parsing should abort. Some people are confused by apparently
invalid syntax that still generates the expected results (for example,
missing end tags or unquoted attribute values).</p>
<p>Some of these work because of the lenient error handling most browsers use
when they encounter a markup error, others are actually specified.  The
following constructs are optional in HTML5 by standard, but have to be
supported by browsers:</p>
<ul class="simple">
<li><p>Wrapping the document in an <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> tag</p></li>
<li><p>Wrapping header elements in <code class="docutils literal notranslate"><span class="pre">&lt;head&gt;</span></code> or the body elements in
<code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code></p></li>
<li><p>Closing the <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;dt&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;dd&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;th&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tbody&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;thead&gt;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&lt;tfoot&gt;</span></code> tags.</p></li>
<li><p>Quoting attributes, so long as they contain no whitespace or
special characters (like <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">'</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>).</p></li>
<li><p>Requiring boolean attributes to have a value.</p></li>
</ul>
<p>This means the following page in HTML5 is perfectly valid:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello HTML5<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">header</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello HTML5<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">tagline</span><span class="p">&gt;</span>HTML5 is awesome
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">nav</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">/index</span><span class="p">&gt;</span>Index<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">/downloads</span><span class="p">&gt;</span>Downloads<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">/about</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>HTML5 is probably the future<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    There might be some other things around but in terms of
    browser vendor support, HTML5 is hard to beat.
  <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Key 1
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>Value 1
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Key 2
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>Value 2
  <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="new-technologies-in-html5">
<h4>New technologies in HTML5<a class="headerlink" href="#new-technologies-in-html5" title="Permalink to this headline">¶</a></h4>
<p>HTML5 adds many new features that make Web applications easier to write
and to use.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> tags provide a way to embed audio and
video without complicated add-ons like QuickTime or Flash.</p></li>
<li><p>Semantic elements like <code class="docutils literal notranslate"><span class="pre">&lt;article&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;header&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;nav&gt;</span></code>, and
<code class="docutils literal notranslate"><span class="pre">&lt;time&gt;</span></code> that make content easier to understand.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;canvas&gt;</span></code> tag, which supports a powerful drawing API, reducing
the need for server-generated images to present data graphically.</p></li>
<li><p>New form control types like <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=&quot;date&quot;&gt;</span></code> that allow user
agents to make entering and validating values easier.</p></li>
<li><p>Advanced JavaScript APIs like Web Storage, Web Workers, Web Sockets,
geolocation, and offline applications.</p></li>
</ul>
<p>Many other features have been added, as well. A good guide to new features
in HTML5 is Mark Pilgrim’s soon-to-be-published book, <a class="reference external" href="http://diveintohtml5.info/">Dive Into HTML5</a>.
Not all of them are supported in browsers yet, however, so use caution.</p>
</div>
<div class="section" id="what-should-be-used">
<h4>What should be used?<a class="headerlink" href="#what-should-be-used" title="Permalink to this headline">¶</a></h4>
<p>Currently, the answer is HTML5.  There are very few reasons to use XHTML
considering the latest developments in Web browsers.  To summarize the
reasons given above:</p>
<ul class="simple">
<li><p>Internet Explorer (which, sadly, currently leads in market share)
has poor support for XHTML.</p></li>
<li><p>Many JavaScript libraries also do not support XHTML, due to the more
complicated namespacing API it requires.</p></li>
<li><p>HTML5 adds several new features, including semantic tags and the
long-awaited <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> tags.</p></li>
<li><p>It has the support of most browser vendors behind it.</p></li>
<li><p>It is much easier to write, and more compact.</p></li>
</ul>
<p>For most applications, it is undoubtedly better to use HTML5 than XHTML.</p>
</div>
</div>
<span id="document-security"></span><div class="section" id="security-considerations">
<h3>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h3>
<p>Web applications usually face all kinds of security problems and it’s very
hard to get everything right.  Flask tries to solve a few of these things
for you, but there are a couple more you have to take care of yourself.</p>
<div class="section" id="cross-site-scripting-xss">
<span id="xss"></span><h4>Cross-Site Scripting (XSS)<a class="headerlink" href="#cross-site-scripting-xss" title="Permalink to this headline">¶</a></h4>
<p>Cross site scripting is the concept of injecting arbitrary HTML (and with
it JavaScript) into the context of a website.  To remedy this, developers
have to properly escape text so that it cannot include arbitrary HTML
tags.  For more information on that have a look at the Wikipedia article
on <a class="reference external" href="http://en.wikipedia.org/wiki/Cross-site_scripting">Cross-Site Scripting</a>.</p>
<p>Flask configures Jinja2 to automatically escape all values unless
explicitly told otherwise.  This should rule out all XSS problems caused
in templates, but there are still other places where you have to be
careful:</p>
<ul class="simple">
<li><p>generating HTML without the help of Jinja2</p></li>
<li><p>calling <a class="reference internal" href="index.html#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a> on data submitted by users</p></li>
<li><p>sending out HTML from uploaded files, never do that, use the
<code class="docutils literal notranslate"><span class="pre">Content-Disposition:</span> <span class="pre">attachment</span></code> header to prevent that problem.</p></li>
<li><p>sending out textfiles from uploaded files.  Some browsers are using
content-type guessing based on the first few bytes so users could
trick a browser to execute HTML.</p></li>
</ul>
<p>Another thing that is very important are unquoted attributes.  While
Jinja2 can protect you from XSS issues by escaping HTML, there is one
thing it cannot protect you from: XSS by attribute injection.  To counter
this possible attack vector, be sure to always quote your attributes with
either double or single quotes when using Jinja expressions in them:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">href</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>the text<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Why is this necessary?  Because if you would not be doing that, an
attacker could easily inject custom JavaScript handlers.  For example an
attacker could inject this piece of HTML+JavaScript:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>onmouseover=alert(document.cookie)
</pre></div>
</div>
<p>When the user would then move with the mouse over the link, the cookie
would be presented to the user in an alert window.  But instead of showing
the cookie to the user, a good attacker might also execute any other
JavaScript code.  In combination with CSS injections the attacker might
even make the element fill out the entire page so that the user would
just have to have the mouse anywhere on the page to trigger the attack.</p>
</div>
<div class="section" id="cross-site-request-forgery-csrf">
<h4>Cross-Site Request Forgery (CSRF)<a class="headerlink" href="#cross-site-request-forgery-csrf" title="Permalink to this headline">¶</a></h4>
<p>Another big problem is CSRF.  This is a very complex topic and I won’t
outline it here in detail just mention what it is and how to theoretically
prevent it.</p>
<p>If your authentication information is stored in cookies, you have implicit
state management.  The state of “being logged in” is controlled by a
cookie, and that cookie is sent with each request to a page.
Unfortunately that includes requests triggered by 3rd party sites.  If you
don’t keep that in mind, some people might be able to trick your
application’s users with social engineering to do stupid things without
them knowing.</p>
<p>Say you have a specific URL that, when you sent <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests to will
delete a user’s profile (say <code class="docutils literal notranslate"><span class="pre">http://example.com/user/delete</span></code>).  If an
attacker now creates a page that sends a post request to that page with
some JavaScript they just have to trick some users to load that page and
their profiles will end up being deleted.</p>
<p>Imagine you were to run Facebook with millions of concurrent users and
someone would send out links to images of little kittens.  When users
would go to that page, their profiles would get deleted while they are
looking at images of fluffy cats.</p>
<p>How can you prevent that?  Basically for each request that modifies
content on the server you would have to either use a one-time token and
store that in the cookie <strong>and</strong> also transmit it with the form data.
After receiving the data on the server again, you would then have to
compare the two tokens and ensure they are equal.</p>
<p>Why does Flask not do that for you?  The ideal place for this to happen is
the form validation framework, which does not exist in Flask.</p>
</div>
<div class="section" id="json-security">
<span id="id1"></span><h4>JSON Security<a class="headerlink" href="#json-security" title="Permalink to this headline">¶</a></h4>
<p>In Flask 0.10 and lower, <code class="xref py py-func docutils literal notranslate"><span class="pre">jsonify()</span></code> did not serialize top-level
arrays to JSON. This was because of a security vulnerability in ECMAScript 4.</p>
<p>ECMAScript 5 closed this vulnerability, so only extremely old browsers are
still vulnerable. All of these browsers have <a class="reference external" href="https://github.com/pallets/flask/issues/248#issuecomment-59934857">other more serious
vulnerabilities</a>, so
this behavior was changed and <code class="xref py py-func docutils literal notranslate"><span class="pre">jsonify()</span></code> now supports serializing
arrays.</p>
</div>
</div>
<span id="document-unicode"></span><div class="section" id="unicode-in-flask">
<h3>Unicode in Flask<a class="headerlink" href="#unicode-in-flask" title="Permalink to this headline">¶</a></h3>
<p>Flask, like Jinja2 and Werkzeug, is totally Unicode based when it comes to
text.  Not only these libraries, also the majority of web related Python
libraries that deal with text.  If you don’t know Unicode so far, you
should probably read <a class="reference external" href="http://www.joelonsoftware.com/articles/Unicode.html">The Absolute Minimum Every Software Developer
Absolutely, Positively Must Know About Unicode and Character Sets</a>.  This part of the
documentation just tries to cover the very basics so that you have a
pleasant experience with Unicode related things.</p>
<div class="section" id="automatic-conversion">
<h4>Automatic Conversion<a class="headerlink" href="#automatic-conversion" title="Permalink to this headline">¶</a></h4>
<p>Flask has a few assumptions about your application (which you can change
of course) that give you basic and painless Unicode support:</p>
<ul class="simple">
<li><p>the encoding for text on your website is UTF-8</p></li>
<li><p>internally you will always use Unicode exclusively for text except
for literal strings with only ASCII character points.</p></li>
<li><p>encoding and decoding happens whenever you are talking over a protocol
that requires bytes to be transmitted.</p></li>
</ul>
<p>So what does this mean to you?</p>
<p>HTTP is based on bytes.  Not only the protocol, also the system used to
address documents on servers (so called URIs or URLs).  However HTML which
is usually transmitted on top of HTTP supports a large variety of
character sets and which ones are used, are transmitted in an HTTP header.
To not make this too complex Flask just assumes that if you are sending
Unicode out you want it to be UTF-8 encoded.  Flask will do the encoding
and setting of the appropriate headers for you.</p>
<p>The same is true if you are talking to databases with the help of
SQLAlchemy or a similar ORM system.  Some databases have a protocol that
already transmits Unicode and if they do not, SQLAlchemy or your other ORM
should take care of that.</p>
</div>
<div class="section" id="the-golden-rule">
<h4>The Golden Rule<a class="headerlink" href="#the-golden-rule" title="Permalink to this headline">¶</a></h4>
<p>So the rule of thumb: if you are not dealing with binary data, work with
Unicode.  What does working with Unicode in Python 2.x mean?</p>
<ul class="simple">
<li><p>as long as you are using ASCII charpoints only (basically numbers,
some special characters of latin letters without umlauts or anything
fancy) you can use regular string literals (<code class="docutils literal notranslate"><span class="pre">'Hello</span> <span class="pre">World'</span></code>).</p></li>
<li><p>if you need anything else than ASCII in a string you have to mark
this string as Unicode string by prefixing it with a lowercase <cite>u</cite>.
(like <code class="docutils literal notranslate"><span class="pre">u'Hänsel</span> <span class="pre">und</span> <span class="pre">Gretel'</span></code>)</p></li>
<li><p>if you are using non-Unicode characters in your Python files you have
to tell Python which encoding your file uses.  Again, I recommend
UTF-8 for this purpose.  To tell the interpreter your encoding you can
put the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">-*-</span> <span class="pre">coding:</span> <span class="pre">utf-8</span> <span class="pre">-*-</span></code> into the first or second line of
your Python source file.</p></li>
<li><p>Jinja is configured to decode the template files from UTF-8.  So make
sure to tell your editor to save the file as UTF-8 there as well.</p></li>
</ul>
</div>
<div class="section" id="encoding-and-decoding-yourself">
<h4>Encoding and Decoding Yourself<a class="headerlink" href="#encoding-and-decoding-yourself" title="Permalink to this headline">¶</a></h4>
<p>If you are talking with a filesystem or something that is not really based
on Unicode you will have to ensure that you decode properly when working
with Unicode interface.  So for example if you want to load a file on the
filesystem and embed it into a Jinja2 template you will have to decode it
from the encoding of that file.  Here the old problem that text files do
not specify their encoding comes into play.  So do yourself a favour and
limit yourself to UTF-8 for text files as well.</p>
<p>Anyways.  To load such a file with Unicode you can use the built-in
<code class="xref py py-meth docutils literal notranslate"><span class="pre">str.decode()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span>
</pre></div>
</div>
<p>To go from Unicode into a specific charset such as UTF-8 you can use the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">unicode.encode()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">charset</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-editors">
<h4>Configuring Editors<a class="headerlink" href="#configuring-editors" title="Permalink to this headline">¶</a></h4>
<p>Most editors save as UTF-8 by default nowadays but in case your editor is
not configured to do this you have to change it.  Here some common ways to
set your editor to store as UTF-8:</p>
<ul>
<li><p>Vim: put <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">enc=utf-8</span></code> to your <code class="docutils literal notranslate"><span class="pre">.vimrc</span></code> file.</p></li>
<li><p>Emacs: either use an encoding cookie or put this into your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code>
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">prefer</span><span class="o">-</span><span class="n">coding</span><span class="o">-</span><span class="n">system</span> <span class="s1">&#39;utf-8)</span>
<span class="p">(</span><span class="n">setq</span> <span class="n">default</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">coding</span><span class="o">-</span><span class="n">system</span> <span class="s1">&#39;utf-8)</span>
</pre></div>
</div>
</li>
<li><p>Notepad++:</p>
<ol class="arabic simple">
<li><p>Go to <em>Settings -&gt; Preferences …</em></p></li>
<li><p>Select the “New Document/Default Directory” tab</p></li>
<li><p>Select “UTF-8 without BOM” as encoding</p></li>
</ol>
<p>It is also recommended to use the Unix newline format, you can select
it in the same panel but this is not a requirement.</p>
</li>
</ul>
</div>
</div>
<span id="document-extensiondev"></span><div class="section" id="flask-extension-development">
<span id="extension-dev"></span><h3>Flask Extension Development<a class="headerlink" href="#flask-extension-development" title="Permalink to this headline">¶</a></h3>
<p>Flask, being a microframework, often requires some repetitive steps to get
a third party library working.  Because very often these steps could be
abstracted to support multiple projects the <a class="reference external" href="http://flask.pocoo.org/extensions/">Flask Extension Registry</a>
was created.</p>
<p>If you want to create your own Flask extension for something that does not
exist yet, this guide to extension development will help you get your
extension running in no time and to feel like users would expect your
extension to behave.</p>
<div class="section" id="anatomy-of-an-extension">
<h4>Anatomy of an Extension<a class="headerlink" href="#anatomy-of-an-extension" title="Permalink to this headline">¶</a></h4>
<p>Extensions are all located in a package called <code class="docutils literal notranslate"><span class="pre">flask_something</span></code>
where “something” is the name of the library you want to bridge.  So for
example if you plan to add support for a library named <cite>simplexml</cite> to
Flask, you would name your extension’s package <code class="docutils literal notranslate"><span class="pre">flask_simplexml</span></code>.</p>
<p>The name of the actual extension (the human readable name) however would
be something like “Flask-SimpleXML”.  Make sure to include the name
“Flask” somewhere in that name and that you check the capitalization.
This is how users can then register dependencies to your extension in
their <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> files.</p>
<p>Flask sets up a redirect package called <code class="xref py py-data docutils literal notranslate"><span class="pre">flask.ext</span></code> where users
should import the extensions from.  If you for instance have a package
called <code class="docutils literal notranslate"><span class="pre">flask_something</span></code> users would import it as
<code class="docutils literal notranslate"><span class="pre">flask.ext.something</span></code>.  This is done to transition from the old
namespace packages.  See <a class="reference internal" href="#ext-import-transition"><span class="std std-ref">Extension Import Transition</span></a> for more details.</p>
<p>But what do extensions look like themselves?  An extension has to ensure
that it works with multiple Flask application instances at once.  This is
a requirement because many people will use patterns like the
<a class="reference internal" href="index.html#app-factories"><span class="std std-ref">Application Factories</span></a> pattern to create their application as needed to aid
unittests and to support multiple configurations.  Because of that it is
crucial that your application supports that kind of behavior.</p>
<p>Most importantly the extension must be shipped with a <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file and
registered on PyPI.  Also the development checkout link should work so
that people can easily install the development version into their
virtualenv without having to download the library by hand.</p>
<p>Flask extensions must be licensed under a BSD, MIT or more liberal license
to be able to be enlisted in the Flask Extension Registry.  Keep in mind
that the Flask Extension Registry is a moderated place and libraries will
be reviewed upfront if they behave as required.</p>
</div>
<div class="section" id="hello-flaskext">
<h4>“Hello Flaskext!”<a class="headerlink" href="#hello-flaskext" title="Permalink to this headline">¶</a></h4>
<p>So let’s get started with creating such a Flask extension.  The extension
we want to create here will provide very basic support for SQLite3.</p>
<p>First we create the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flask</span><span class="o">-</span><span class="n">sqlite3</span><span class="o">/</span>
    <span class="n">flask_sqlite3</span><span class="o">.</span><span class="n">py</span>
    <span class="n">LICENSE</span>
    <span class="n">README</span>
</pre></div>
</div>
<p>Here’s the contents of the most important files:</p>
<div class="section" id="setup-py">
<h5>setup.py<a class="headerlink" href="#setup-py" title="Permalink to this headline">¶</a></h5>
<p>The next file that is absolutely required is the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file which is
used to install your Flask extension.  The following contents are
something you can work with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Flask-SQLite3</span>
<span class="sd">-------------</span>

<span class="sd">This is the description for that library</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="k">import</span> <span class="n">setup</span>


<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Flask-SQLite3&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://example.com/flask-sqlite3/&#39;</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s1">&#39;BSD&#39;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;Your Name&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;your-email@example.com&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Very short description&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
    <span class="n">py_modules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flask_sqlite3&#39;</span><span class="p">],</span>
    <span class="c1"># if you would be using a package instead use packages instead</span>
    <span class="c1"># of py_modules:</span>
    <span class="c1"># packages=[&#39;flask_sqlite3&#39;],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">platforms</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Flask&#39;</span>
    <span class="p">],</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Environment :: Web Environment&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Intended Audience :: Developers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;License :: OSI Approved :: BSD License&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Operating System :: OS Independent&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Programming Language :: Python&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Internet :: WWW/HTTP :: Dynamic Content&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Software Development :: Libraries :: Python Modules&#39;</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>That’s a lot of code but you can really just copy/paste that from existing
extensions and adapt.</p>
</div>
<div class="section" id="flask-sqlite3-py">
<h5>flask_sqlite3.py<a class="headerlink" href="#flask-sqlite3-py" title="Permalink to this headline">¶</a></h5>
<p>Now this is where your extension code goes.  But how exactly should such
an extension look like?  What are the best practices?  Continue reading
for some insight.</p>
</div>
</div>
<div class="section" id="initializing-extensions">
<h4>Initializing Extensions<a class="headerlink" href="#initializing-extensions" title="Permalink to this headline">¶</a></h4>
<p>Many extensions will need some kind of initialization step.  For example,
consider an application that’s currently connecting to SQLite like the
documentation suggests (<a class="reference internal" href="index.html#sqlite3"><span class="std std-ref">Using SQLite 3 with Flask</span></a>).  So how does the extension
know the name of the application object?</p>
<p>Quite simple: you pass it to it.</p>
<p>There are two recommended ways for an extension to initialize:</p>
<p>initialization functions:</p>
<blockquote>
<div><p>If your extension is called <cite>helloworld</cite> you might have a function
called <code class="docutils literal notranslate"><span class="pre">init_helloworld(app[,</span> <span class="pre">extra_args])</span></code> that initializes the
extension for that application.  It could attach before / after
handlers etc.</p>
</div></blockquote>
<p>classes:</p>
<blockquote>
<div><p>Classes work mostly like initialization functions but can later be
used to further change the behavior.  For an example look at how the
<a class="reference external" href="http://pythonhosted.org/Flask-OAuth/">OAuth extension</a> works: there is an <cite>OAuth</cite> object that provides
some helper functions like <cite>OAuth.remote_app</cite> to create a reference to
a remote application that uses OAuth.</p>
</div></blockquote>
<p>What to use depends on what you have in mind.  For the SQLite 3 extension
we will use the class-based approach because it will provide users with an
object that handles opening and closing database connections.</p>
<p>What’s important about classes is that they encourage to be shared around
on module level.  In that case, the object itself must not under any
circumstances store any application specific state and must be shareable
between different application.</p>
</div>
<div class="section" id="the-extension-code">
<h4>The Extension Code<a class="headerlink" href="#the-extension-code" title="Permalink to this headline">¶</a></h4>
<p>Here’s the contents of the <cite>flask_sqlite3.py</cite> for copy/paste:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">current_app</span>

<span class="c1"># Find the stack on which we want to store the database connection.</span>
<span class="c1"># Starting with Flask 0.9, the _app_ctx_stack is the correct one,</span>
<span class="c1"># before that we need to use the _request_ctx_stack.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">_app_ctx_stack</span> <span class="k">as</span> <span class="n">stack</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">_request_ctx_stack</span> <span class="k">as</span> <span class="n">stack</span>


<span class="k">class</span> <span class="nc">SQLite3</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;SQLITE3_DATABASE&#39;</span><span class="p">,</span> <span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
        <span class="c1"># Use the newstyle teardown_appcontext if it&#39;s available,</span>
        <span class="c1"># otherwise fall back to the request context</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;teardown_appcontext&#39;</span><span class="p">):</span>
            <span class="n">app</span><span class="o">.</span><span class="n">teardown_appcontext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teardown</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">teardown_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">teardown</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQLITE3_DATABASE&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">top</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s1">&#39;sqlite3_db&#39;</span><span class="p">):</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">sqlite3_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">top</span>
        <span class="k">if</span> <span class="n">ctx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s1">&#39;sqlite3_db&#39;</span><span class="p">):</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">sqlite3_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">sqlite3_db</span>
</pre></div>
</div>
<p>So here’s what these lines of code do:</p>
<ol class="arabic">
<li><p>The <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method takes an optional app object and, if supplied, will
call <code class="docutils literal notranslate"><span class="pre">init_app</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">init_app</span></code> method exists so that the <code class="docutils literal notranslate"><span class="pre">SQLite3</span></code> object can be
instantiated without requiring an app object.  This method supports the
factory pattern for creating applications.  The <code class="docutils literal notranslate"><span class="pre">init_app</span></code> will set the
configuration for the database, defaulting to an in memory database if
no configuration is supplied.  In addition, the <code class="docutils literal notranslate"><span class="pre">init_app</span></code> method attaches
the <code class="docutils literal notranslate"><span class="pre">teardown</span></code> handler.  It will try to use the newstyle app context
handler and if it does not exist, falls back to the request context
one.</p></li>
<li><p>Next, we define a <code class="docutils literal notranslate"><span class="pre">connect</span></code> method that opens a database connection.</p></li>
<li><p>Finally, we add a <code class="docutils literal notranslate"><span class="pre">connection</span></code> property that on first access opens
the database connection and stores it on the context.  This is also
the recommended way to handling resources: fetch resources lazily the
first time they are used.</p>
<p>Note here that we’re attaching our database connection to the top
application context via <code class="docutils literal notranslate"><span class="pre">_app_ctx_stack.top</span></code>. Extensions should use
the top context for storing their own information with a sufficiently
complex name.  Note that we’re falling back to the
<code class="docutils literal notranslate"><span class="pre">_request_ctx_stack.top</span></code> if the application is using an older
version of Flask that does not support it.</p>
</li>
</ol>
<p>So why did we decide on a class-based approach here?  Because using our
extension looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask_sqlite3</span> <span class="k">import</span> <span class="n">SQLite3</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="s1">&#39;the-config.cfg&#39;</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLite3</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then use the database from views like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_all</span><span class="p">():</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Likewise if you are outside of a request but you are using Flask 0.9 or
later with the app context support, you can use the database in the same
way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>At the end of the <code class="docutils literal notranslate"><span class="pre">with</span></code> block the teardown handles will be executed
automatically.</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">init_app</span></code> method is used to support the factory pattern
for creating apps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">Sqlite3</span><span class="p">()</span>
<span class="c1"># Then later on.</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="s1">&#39;the-config.cfg&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Keep in mind that supporting this factory pattern for creating apps is required
for approved flask extensions (described below).</p>
<div class="admonition-note-on-init-app admonition">
<p class="admonition-title">Note on <code class="docutils literal notranslate"><span class="pre">init_app</span></code></p>
<p>As you noticed, <code class="docutils literal notranslate"><span class="pre">init_app</span></code> does not assign <code class="docutils literal notranslate"><span class="pre">app</span></code> to <code class="docutils literal notranslate"><span class="pre">self</span></code>.  This
is intentional!  Class based Flask extensions must only store the
application on the object when the application was passed to the
constructor.  This tells the extension: I am not interested in using
multiple applications.</p>
<p>When the extension needs to find the current application and it does
not have a reference to it, it must either use the
<a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> context local or change the API in a way
that you can pass the application explicitly.</p>
</div>
</div>
<div class="section" id="using-app-ctx-stack">
<h4>Using _app_ctx_stack<a class="headerlink" href="#using-app-ctx-stack" title="Permalink to this headline">¶</a></h4>
<p>In the example above, before every request, a <code class="docutils literal notranslate"><span class="pre">sqlite3_db</span></code> variable is
assigned to <code class="docutils literal notranslate"><span class="pre">_app_ctx_stack.top</span></code>.  In a view function, this variable is
accessible using the <code class="docutils literal notranslate"><span class="pre">connection</span></code> property of <code class="docutils literal notranslate"><span class="pre">SQLite3</span></code>.  During the
teardown of a request, the <code class="docutils literal notranslate"><span class="pre">sqlite3_db</span></code> connection is closed.  By using
this pattern, the <em>same</em> connection to the sqlite3 database is accessible
to anything that needs it for the duration of the request.</p>
<p>If the <a class="reference internal" href="index.html#flask._app_ctx_stack" title="flask._app_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">_app_ctx_stack</span></code></a> does not exist because the user uses
an old version of Flask, it is recommended to fall back to
<a class="reference internal" href="index.html#flask._request_ctx_stack" title="flask._request_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">_request_ctx_stack</span></code></a> which is bound to a request.</p>
</div>
<div class="section" id="teardown-behavior">
<h4>Teardown Behavior<a class="headerlink" href="#teardown-behavior" title="Permalink to this headline">¶</a></h4>
<p><em>This is only relevant if you want to support Flask 0.6 and older</em></p>
<p>Due to the change in Flask 0.7 regarding functions that are run at the end
of the request your extension will have to be extra careful there if it
wants to continue to support older versions of Flask.  The following
pattern is a good way to support both:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">sqlite3_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;teardown_request&#39;</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">teardown_request</span><span class="p">(</span><span class="n">close_connection</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">after_request</span><span class="p">(</span><span class="n">close_connection</span><span class="p">)</span>
</pre></div>
</div>
<p>Strictly speaking the above code is wrong, because teardown functions are
passed the exception and typically don’t return anything.  However because
the return value is discarded this will just work assuming that the code
in between does not touch the passed parameter.</p>
</div>
<div class="section" id="learn-from-others">
<h4>Learn from Others<a class="headerlink" href="#learn-from-others" title="Permalink to this headline">¶</a></h4>
<p>This documentation only touches the bare minimum for extension
development.  If you want to learn more, it’s a very good idea to check
out existing extensions on the <a class="reference external" href="http://flask.pocoo.org/extensions/">Flask Extension Registry</a>.  If you feel
lost there is still the <a class="reference external" href="http://flask.pocoo.org/mailinglist/">mailinglist</a> and the <a class="reference external" href="http://flask.pocoo.org/community/irc/">IRC channel</a> to get some
ideas for nice looking APIs.  Especially if you do something nobody before
you did, it might be a very good idea to get some more input.  This not
only to get an idea about what people might want to have from an
extension, but also to avoid having multiple developers working on pretty
much the same side by side.</p>
<p>Remember: good API design is hard, so introduce your project on the
mailinglist, and let other developers give you a helping hand with
designing the API.</p>
<p>The best Flask extensions are extensions that share common idioms for the
API.  And this can only work if collaboration happens early.</p>
</div>
<div class="section" id="approved-extensions">
<h4>Approved Extensions<a class="headerlink" href="#approved-extensions" title="Permalink to this headline">¶</a></h4>
<p>Flask also has the concept of approved extensions.  Approved extensions
are tested as part of Flask itself to ensure extensions do not break on
new releases.  These approved extensions are listed on the <a class="reference external" href="http://flask.pocoo.org/extensions/">Flask
Extension Registry</a> and marked appropriately.  If you want your own
extension to be approved you have to follow these guidelines:</p>
<ol class="arabic simple" start="0">
<li><p>An approved Flask extension requires a maintainer. In the event an
extension author would like to move beyond the project, the project should
find a new maintainer including full source hosting transition and PyPI
access.  If no maintainer is available, give access to the Flask core team.</p></li>
<li><p>An approved Flask extension must provide exactly one package or module
named <code class="docutils literal notranslate"><span class="pre">flask_extensionname</span></code>.</p></li>
<li><p>It must ship a testing suite that can either be invoked with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code>
or <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">test</span></code>.  For test suites invoked with <code class="docutils literal notranslate"><span class="pre">make</span>
<span class="pre">test</span></code> the extension has to ensure that all dependencies for the test
are installed automatically.  If tests are invoked with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span>
<span class="pre">test</span></code>, test dependencies can be specified in the <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file.  The
test suite also has to be part of the distribution.</p></li>
<li><p>APIs of approved extensions will be checked for the following
characteristics:</p>
<ul class="simple">
<li><p>an approved extension has to support multiple applications
running in the same Python process.</p></li>
<li><p>it must be possible to use the factory pattern for creating
applications.</p></li>
</ul>
</li>
<li><p>The license must be BSD/MIT/WTFPL licensed.</p></li>
<li><p>The naming scheme for official extensions is <em>Flask-ExtensionName</em> or
<em>ExtensionName-Flask</em>.</p></li>
<li><p>Approved extensions must define all their dependencies in the
<code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file unless a dependency cannot be met because it is not
available on PyPI.</p></li>
<li><p>The extension must have documentation that uses one of the two Flask
themes for Sphinx documentation.</p></li>
<li><p>The setup.py description (and thus the PyPI description) has to
link to the documentation, website (if there is one) and there
must be a link to automatically install the development version
(<code class="docutils literal notranslate"><span class="pre">PackageName==dev</span></code>).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">zip_safe</span></code> flag in the setup script must be set to <code class="docutils literal notranslate"><span class="pre">False</span></code>,
even if the extension would be safe for zipping.</p></li>
<li><p>An extension currently has to support Python 2.6 as well as
Python 2.7</p></li>
</ol>
</div>
<div class="section" id="extension-import-transition">
<span id="ext-import-transition"></span><h4>Extension Import Transition<a class="headerlink" href="#extension-import-transition" title="Permalink to this headline">¶</a></h4>
<p>In early versions of Flask we recommended using namespace packages for Flask
extensions, of the form <code class="docutils literal notranslate"><span class="pre">flaskext.foo</span></code>. This turned out to be problematic in
practice because it meant that multiple <code class="docutils literal notranslate"><span class="pre">flaskext</span></code> packages coexist.
Consequently we have recommended to name extensions <code class="docutils literal notranslate"><span class="pre">flask_foo</span></code> over
<code class="docutils literal notranslate"><span class="pre">flaskext.foo</span></code> for a long time.</p>
<p>Flask 0.8 introduced a redirect import system as a compatibility aid for app
developers: Importing <code class="docutils literal notranslate"><span class="pre">flask.ext.foo</span></code> would try <code class="docutils literal notranslate"><span class="pre">flask_foo</span></code> and
<code class="docutils literal notranslate"><span class="pre">flaskext.foo</span></code> in that order.</p>
<p>As of Flask 0.11, most Flask extensions have transitioned to the new naming
schema. The <code class="docutils literal notranslate"><span class="pre">flask.ext.foo</span></code> compatibility alias is still in Flask 0.11 but is
now deprecated – you should use <code class="docutils literal notranslate"><span class="pre">flask_foo</span></code>.</p>
</div>
</div>
<span id="document-styleguide"></span><div class="section" id="pocoo-styleguide">
<h3>Pocoo Styleguide<a class="headerlink" href="#pocoo-styleguide" title="Permalink to this headline">¶</a></h3>
<p>The Pocoo styleguide is the styleguide for all Pocoo Projects, including
Flask.  This styleguide is a requirement for Patches to Flask and a
recommendation for Flask extensions.</p>
<p>In general the Pocoo Styleguide closely follows <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0008"><strong>PEP 8</strong></a> with some small
differences and extensions.</p>
<div class="section" id="general-layout">
<h4>General Layout<a class="headerlink" href="#general-layout" title="Permalink to this headline">¶</a></h4>
<dl>
<dt>Indentation:</dt><dd><p>4 real spaces.  No tabs, no exceptions.</p>
</dd>
<dt>Maximum line length:</dt><dd><p>79 characters with a soft limit for 84 if absolutely necessary.  Try
to avoid too nested code by cleverly placing <cite>break</cite>, <cite>continue</cite> and
<cite>return</cite> statements.</p>
</dd>
<dt>Continuing long statements:</dt><dd><p>To continue a statement you can use backslashes in which case you should
align the next line with the last dot or equal sign, or indent four
spaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">this_is_a_very_long</span><span class="p">(</span><span class="n">function_call</span><span class="p">,</span> <span class="s1">&#39;with many parameters&#39;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">that_returns_an_object_with_an_attribute</span>

<span class="n">MyModel</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">scalar</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span> \
             <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">MyModel</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span> \
             <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>If you break in a statement with parentheses or braces, align to the
braces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">this_is_a_very_long</span><span class="p">(</span><span class="n">function_call</span><span class="p">,</span> <span class="s1">&#39;with many parameters&#39;</span><span class="p">,</span>
                    <span class="mi">23</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;and even more&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For lists or tuples with many items, break immediately after the
opening brace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;this is the first&#39;</span><span class="p">,</span> <span class="s1">&#39;set of items&#39;</span><span class="p">,</span> <span class="s1">&#39;with more items&#39;</span><span class="p">,</span>
    <span class="s1">&#39;to come in this line&#39;</span><span class="p">,</span> <span class="s1">&#39;like this&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</dd>
<dt>Blank lines:</dt><dd><p>Top level functions and classes are separated by two lines, everything
else by one.  Do not use too many blank lines to separate logical
segments in code.  Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;Hello </span><span class="si">%s</span><span class="s1">!&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;See you </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a simple docstring&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_annoying_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;!!!!111&#39;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="expressions-and-statements">
<h4>Expressions and Statements<a class="headerlink" href="#expressions-and-statements" title="Permalink to this headline">¶</a></h4>
<dl>
<dt>General whitespace rules:</dt><dd><ul class="simple">
<li><p>No whitespace for unary operators that are not words
(e.g.: <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">~</span></code> etc.) as well on the inner side of parentheses.</p></li>
<li><p>Whitespace is placed between binary operators.</p></li>
</ul>
<p>Good:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.05</span>
<span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">item_value</span> <span class="o">/</span> <span class="n">item_count</span><span class="p">)</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">/</span> <span class="n">exp</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">my_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Bad:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">1.05</span>
<span class="n">value</span> <span class="o">=</span> <span class="p">(</span> <span class="n">item_value</span> <span class="o">/</span> <span class="n">item_count</span> <span class="p">)</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">/</span> <span class="n">exp</span>
<span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">item_value</span><span class="o">/</span><span class="n">item_count</span><span class="p">)</span><span class="o">*</span><span class="n">offset</span><span class="o">/</span><span class="n">exp</span>
<span class="n">value</span><span class="o">=</span><span class="p">(</span> <span class="n">item_value</span><span class="o">/</span><span class="n">item_count</span> <span class="p">)</span> <span class="o">*</span> <span class="n">offset</span><span class="o">/</span><span class="n">exp</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">my_list</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span> <span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
<dt>Yoda statements are a no-go:</dt><dd><p>Never compare constant with variable, always variable with constant:</p>
<p>Good:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;md5&#39;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Bad:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;md5&#39;</span> <span class="o">==</span> <span class="n">method</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd>
<dt>Comparisons:</dt><dd><ul class="simple">
<li><p>against arbitrary types: <code class="docutils literal notranslate"><span class="pre">==</span></code> and <code class="docutils literal notranslate"><span class="pre">!=</span></code></p></li>
<li><p>against singletons with <code class="docutils literal notranslate"><span class="pre">is</span></code> and <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code> (eg: <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">is</span> <span class="pre">not</span>
<span class="pre">None</span></code>)</p></li>
<li><p>never compare something with <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (for example never
do <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">==</span> <span class="pre">False</span></code>, do <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">foo</span></code> instead)</p></li>
</ul>
</dd>
<dt>Negated containment checks:</dt><dd><p>use <code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">bar</span></code> instead of <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">foo</span> <span class="pre">in</span> <span class="pre">bar</span></code></p>
</dd>
<dt>Instance checks:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">isinstance(a,</span> <span class="pre">C)</span></code> instead of <code class="docutils literal notranslate"><span class="pre">type(A)</span> <span class="pre">is</span> <span class="pre">C</span></code>, but try to avoid
instance checks in general.  Check for features.</p>
</dd>
</dl>
</div>
<div class="section" id="naming-conventions">
<h4>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Class names: <code class="docutils literal notranslate"><span class="pre">CamelCase</span></code>, with acronyms kept uppercase (<code class="docutils literal notranslate"><span class="pre">HTTPWriter</span></code>
and not <code class="docutils literal notranslate"><span class="pre">HttpWriter</span></code>)</p></li>
<li><p>Variable names: <code class="docutils literal notranslate"><span class="pre">lowercase_with_underscores</span></code></p></li>
<li><p>Method and function names: <code class="docutils literal notranslate"><span class="pre">lowercase_with_underscores</span></code></p></li>
<li><p>Constants: <code class="docutils literal notranslate"><span class="pre">UPPERCASE_WITH_UNDERSCORES</span></code></p></li>
<li><p>precompiled regular expressions: <code class="docutils literal notranslate"><span class="pre">name_re</span></code></p></li>
</ul>
<p>Protected members are prefixed with a single underscore.  Double
underscores are reserved for mixin classes.</p>
<p>On classes with keywords, trailing underscores are appended.  Clashes with
builtins are allowed and <strong>must not</strong> be resolved by appending an
underline to the variable name.  If the function needs to access a
shadowed builtin, rebind the builtin to a different name instead.</p>
<dl class="simple">
<dt>Function and method arguments:</dt><dd><ul class="simple">
<li><p>class methods: <code class="docutils literal notranslate"><span class="pre">cls</span></code> as first parameter</p></li>
<li><p>instance methods: <code class="docutils literal notranslate"><span class="pre">self</span></code> as first parameter</p></li>
<li><p>lambdas for properties might have the first parameter replaced
with <code class="docutils literal notranslate"><span class="pre">x</span></code> like in <code class="docutils literal notranslate"><span class="pre">display_name</span> <span class="pre">=</span> <span class="pre">property(lambda</span> <span class="pre">x:</span> <span class="pre">x.real_name</span>
<span class="pre">or</span> <span class="pre">x.username)</span></code></p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="docstrings">
<h4>Docstrings<a class="headerlink" href="#docstrings" title="Permalink to this headline">¶</a></h4>
<dl>
<dt>Docstring conventions:</dt><dd><p>All docstrings are formatted with reStructuredText as understood by
Sphinx.  Depending on the number of lines in the docstring, they are
laid out differently.  If it’s just one line, the closing triple
quote is on the same line as the opening, otherwise the text is on
the same line as the opening quote and the triple quote that closes
the string on its own line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This is a simple docstring&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This is a longer docstring with so much information in there</span>
<span class="sd">    that it spans three lines.  In this case the closing triple quote</span>
<span class="sd">    is on its own line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</dd>
<dt>Module header:</dt><dd><p>The module header consists of an utf-8 encoding declaration (if non
ASCII letters are used, but it is recommended all the time) and a
standard docstring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    package.module</span>
<span class="sd">    ~~~~~~~~~~~~~~</span>

<span class="sd">    A brief description goes here.</span>

<span class="sd">    :copyright: (c) YEAR by AUTHOR.</span>
<span class="sd">    :license: LICENSE_NAME, see LICENSE_FILE for more details.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Please keep in mind that proper copyrights and license files are a
requirement for approved Flask extensions.</p>
</dd>
</dl>
</div>
<div class="section" id="comments">
<h4>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<p>Rules for comments are similar to docstrings.  Both are formatted with
reStructuredText.  If a comment is used to document an attribute, put a
colon after the opening pound sign (<code class="docutils literal notranslate"><span class="pre">#</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#: the name of the user as unicode string</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="c1">#: the sha1 hash of the password + inline salt</span>
    <span class="n">pw_hash</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-python3"></span><div class="section" id="python-3-support">
<span id="python3-support"></span><h3>Python 3 Support<a class="headerlink" href="#python-3-support" title="Permalink to this headline">¶</a></h3>
<p>Flask, its dependencies, and most Flask extensions support Python 3.
You should start using Python 3 for your next project,
but there are a few things to be aware of.</p>
<p>You need to use Python 3.3 or higher.  3.2 and older are <em>not</em> supported.</p>
<p>You should use the latest versions of all Flask-related packages.
Flask 0.10 and Werkzeug 0.9 were the first versions to introduce Python 3 support.</p>
<p>Python 3 changed how unicode and bytes are handled, which complicates how low
level code handles HTTP data.  This mainly affects WSGI middleware interacting
with the WSGI <code class="docutils literal notranslate"><span class="pre">environ</span></code> data.  Werkzeug wraps that information in high-level
helpers, so encoding issues should not affect you.</p>
<p>The majority of the upgrade work is in the lower-level libraries like
Flask and Werkzeug, not the high-level application code.
For example, all of the examples in the Flask repository work on both Python 2 and 3
and did not require a single line of code changed.</p>
</div>
<span id="document-upgrading"></span><div class="section" id="upgrading-to-newer-releases">
<h3>Upgrading to Newer Releases<a class="headerlink" href="#upgrading-to-newer-releases" title="Permalink to this headline">¶</a></h3>
<p>Flask itself is changing like any software is changing over time.  Most of
the changes are the nice kind, the kind where you don’t have to change
anything in your code to profit from a new release.</p>
<p>However every once in a while there are changes that do require some
changes in your code or there are changes that make it possible for you to
improve your own code quality by taking advantage of new features in
Flask.</p>
<p>This section of the documentation enumerates all the changes in Flask from
release to release and how you can change your code to have a painless
updating experience.</p>
<p>Use the <strong class="command">pip</strong> command to upgrade your existing Flask installation by
providing the <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install --upgrade Flask
</pre></div>
</div>
<div class="section" id="version-0-12">
<span id="upgrading-to-012"></span><h4>Version 0.12<a class="headerlink" href="#version-0-12" title="Permalink to this headline">¶</a></h4>
<div class="section" id="changes-to-send-file">
<h5>Changes to send_file<a class="headerlink" href="#changes-to-send-file" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">filename</span></code> is no longer automatically inferred from file-like objects.
This means that the following code will no longer automatically have
<code class="docutils literal notranslate"><span class="pre">X-Sendfile</span></code> support, etag generation or MIME-type guessing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/path/to/file.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Any of the following is functionally equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;/path/to/file.txt&#39;</span>

<span class="c1"># Just pass the filepath directly</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

<span class="c1"># Set the MIME-type and ETag explicitly</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_etag</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Set `attachment_filename` for MIME-type guessing</span>
<span class="c1"># ETag still needs to be manually set</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">attachment_filename</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_etag</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The reason for this is that some file-like objects have a invalid or even
misleading <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute. Silently swallowing errors in such cases was not
a satisfying solution.</p>
<p>Additionally the default of falling back to <code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code> has
been restricted. If Flask can’t guess one or the user didn’t provide one, the
function fails if no filename information was provided.</p>
</div>
</div>
<div class="section" id="version-0-11">
<span id="upgrading-to-011"></span><h4>Version 0.11<a class="headerlink" href="#version-0-11" title="Permalink to this headline">¶</a></h4>
<p>0.11 is an odd release in the Flask release cycle because it was supposed
to be the 1.0 release.  However because there was such a long lead time up
to the release we decided to push out a 0.11 release first with some
changes removed to make the transition easier.  If you have been tracking
the master branch which was 1.0 you might see some unexpected changes.</p>
<p>In case you did track the master branch you will notice that <strong class="command">flask --app</strong>
is removed now.  You need to use the environment variable to specify an
application.</p>
<div class="section" id="debugging">
<h5>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h5>
<p>Flask 0.11 removed the <code class="docutils literal notranslate"><span class="pre">debug_log_format</span></code> attribute from Flask
applications.  Instead the new <code class="docutils literal notranslate"><span class="pre">LOGGER_HANDLER_POLICY</span></code> configuration can
be used to disable the default log handlers and custom log handlers can be
set up.</p>
</div>
<div class="section" id="error-handling">
<h5>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h5>
<p>The behavior of error handlers was changed.
The precedence of handlers used to be based on the decoration/call order of
<a class="reference internal" href="index.html#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> and
<a class="reference internal" href="index.html#flask.Flask.register_error_handler" title="flask.Flask.register_error_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code></a>, respectively.
Now the inheritance hierarchy takes precedence and handlers for more
specific exception classes are executed instead of more general ones.
See <a class="reference internal" href="index.html#error-handlers"><span class="std std-ref">Error handlers</span></a> for specifics.</p>
<p>Trying to register a handler on an instance now raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There used to be a logic error allowing you to register handlers
only for exception <em>instances</em>. This was unintended and plain wrong,
and therefore was replaced with the intended behavior of registering
handlers only using exception classes and HTTP error codes.</p>
</div>
</div>
<div class="section" id="templating">
<h5>Templating<a class="headerlink" href="#templating" title="Permalink to this headline">¶</a></h5>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">render_template_string()</span></code> function has changed to
autoescape template variables by default. This better matches the behavior
of <code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code>.</p>
</div>
<div class="section" id="extension-imports">
<h5>Extension imports<a class="headerlink" href="#extension-imports" title="Permalink to this headline">¶</a></h5>
<p>Extension imports of the form <code class="docutils literal notranslate"><span class="pre">flask.ext.foo</span></code> are deprecated, you should use
<code class="docutils literal notranslate"><span class="pre">flask_foo</span></code>.</p>
<p>The old form still works, but Flask will issue a
<code class="docutils literal notranslate"><span class="pre">flask.exthook.ExtDeprecationWarning</span></code> for each extension you import the old
way. We also provide a migration utility called <a class="reference external" href="https://github.com/pallets/flask-ext-migrate">flask-ext-migrate</a> that is supposed to
automatically rewrite your imports for this.</p>
</div>
</div>
<div class="section" id="version-0-10">
<span id="upgrading-to-010"></span><h4>Version 0.10<a class="headerlink" href="#version-0-10" title="Permalink to this headline">¶</a></h4>
<p>The biggest change going from 0.9 to 0.10 is that the cookie serialization
format changed from pickle to a specialized JSON format.  This change has
been done in order to avoid the damage an attacker can do if the secret
key is leaked.  When you upgrade you will notice two major changes: all
sessions that were issued before the upgrade are invalidated and you can
only store a limited amount of types in the session.  The new sessions are
by design much more restricted to only allow JSON with a few small
extensions for tuples and strings with HTML markup.</p>
<p>In order to not break people’s sessions it is possible to continue using
the old session system by using the <a class="reference external" href="http://pythonhosted.org/Flask-OldSessions/">Flask-OldSessions</a> extension.</p>
<p>Flask also started storing the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a> object on the application
context instead of the request context.  This change should be transparent
for you but it means that you now can store things on the <code class="docutils literal notranslate"><span class="pre">g</span></code> object
when there is no request context yet but an application context.  The old
<code class="docutils literal notranslate"><span class="pre">flask.Flask.request_globals_class</span></code> attribute was renamed to
<a class="reference internal" href="index.html#flask.Flask.app_ctx_globals_class" title="flask.Flask.app_ctx_globals_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.app_ctx_globals_class</span></code></a>.</p>
</div>
<div class="section" id="version-0-9">
<h4>Version 0.9<a class="headerlink" href="#version-0-9" title="Permalink to this headline">¶</a></h4>
<p>The behavior of returning tuples from a function was simplified.  If you
return a tuple it no longer defines the arguments for the response object
you’re creating, it’s now always a tuple in the form <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">status,</span>
<span class="pre">headers)</span></code> where at least one item has to be provided.  If you depend on
the old behavior, you can add it easily by subclassing Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TraditionalFlask</span><span class="p">(</span><span class="n">Flask</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">make_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="p">(</span><span class="o">*</span><span class="n">rv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Flask</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv</span><span class="p">)</span>
</pre></div>
</div>
<p>If you maintain an extension that was using <a class="reference internal" href="index.html#flask._request_ctx_stack" title="flask._request_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">_request_ctx_stack</span></code></a>
before, please consider changing to <a class="reference internal" href="index.html#flask._app_ctx_stack" title="flask._app_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">_app_ctx_stack</span></code></a> if it makes
sense for your extension.  For instance, the app context stack makes sense for
extensions which connect to databases.  Using the app context stack instead of
the request context stack will make extensions more readily handle use cases
outside of requests.</p>
</div>
<div class="section" id="version-0-8">
<h4>Version 0.8<a class="headerlink" href="#version-0-8" title="Permalink to this headline">¶</a></h4>
<p>Flask introduced a new session interface system.  We also noticed that
there was a naming collision between <code class="docutils literal notranslate"><span class="pre">flask.session</span></code> the module that
implements sessions and <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.session</span></code></a> which is the global session
object.  With that introduction we moved the implementation details for
the session system into a new module called <code class="xref py py-mod docutils literal notranslate"><span class="pre">flask.sessions</span></code>.  If you
used the previously undocumented session support we urge you to upgrade.</p>
<p>If invalid JSON data was submitted Flask will now raise a
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.BadRequest" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BadRequest</span></code></a> exception instead of letting the
default <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> bubble up.  This has the advantage that you no
longer have to handle that error to avoid an internal server error showing
up for the user.  If you were catching this down explicitly in the past
as <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> you will need to change this.</p>
<p>Due to a bug in the test client Flask 0.7 did not trigger teardown
handlers when the test client was used in a with statement.  This was
since fixed but might require some changes in your test suites if you
relied on this behavior.</p>
</div>
<div class="section" id="version-0-7">
<h4>Version 0.7<a class="headerlink" href="#version-0-7" title="Permalink to this headline">¶</a></h4>
<p>In Flask 0.7 we cleaned up the code base internally a lot and did some
backwards incompatible changes that make it easier to implement larger
applications with Flask.  Because we want to make upgrading as easy as
possible we tried to counter the problems arising from these changes by
providing a script that can ease the transition.</p>
<p>The script scans your whole application and generates an unified diff with
changes it assumes are safe to apply.  However as this is an automated
tool it won’t be able to find all use cases and it might miss some.  We
internally spread a lot of deprecation warnings all over the place to make
it easy to find pieces of code that it was unable to upgrade.</p>
<p>We strongly recommend that you hand review the generated patchfile and
only apply the chunks that look good.</p>
<p>If you are using git as version control system for your project we
recommend applying the patch with <code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">-p1</span> <span class="pre">&lt;</span> <span class="pre">patchfile.diff</span></code> and then
using the interactive commit feature to only apply the chunks that look
good.</p>
<p>To apply the upgrade script do the following:</p>
<ol class="arabic">
<li><p>Download the script: <a class="reference external" href="https://raw.githubusercontent.com/pallets/flask/0.12.3/scripts/flask-07-upgrade.py">flask-07-upgrade.py</a></p></li>
<li><p>Run it in the directory of your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">flask</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="n">upgrade</span><span class="o">.</span><span class="n">py</span> <span class="o">&gt;</span> <span class="n">patchfile</span><span class="o">.</span><span class="n">diff</span>
</pre></div>
</div>
</li>
<li><p>Review the generated patchfile.</p></li>
<li><p>Apply the patch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">patch</span> <span class="o">-</span><span class="n">p1</span> <span class="o">&lt;</span> <span class="n">patchfile</span><span class="o">.</span><span class="n">diff</span>
</pre></div>
</div>
</li>
<li><p>If you were using per-module template folders you need to move some
templates around.  Previously if you had a folder named <code class="file docutils literal notranslate"><span class="pre">templates</span></code>
next to a blueprint named <code class="docutils literal notranslate"><span class="pre">admin</span></code> the implicit template path
automatically was <code class="file docutils literal notranslate"><span class="pre">admin/index.html</span></code> for a template file called
<code class="file docutils literal notranslate"><span class="pre">templates/index.html</span></code>.  This no longer is the case.  Now you need
to name the template <code class="file docutils literal notranslate"><span class="pre">templates/admin/index.html</span></code>.  The tool will
not detect this so you will have to do that on your own.</p></li>
</ol>
<p>Please note that deprecation warnings are disabled by default starting
with Python 2.7.  In order to see the deprecation warnings that might be
emitted you have to enabled them with the <a class="reference external" href="https://docs.python.org/3/library/warnings.html#module-warnings" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code></a> module.</p>
<p>If you are working with windows and you lack the <code class="docutils literal notranslate"><span class="pre">patch</span></code> command line
utility you can get it as part of various Unix runtime environments for
windows including cygwin, msysgit or ming32.  Also source control systems
like svn, hg or git have builtin support for applying unified diffs as
generated by the tool.  Check the manual of your version control system
for more information.</p>
<div class="section" id="bug-in-request-locals">
<h5>Bug in Request Locals<a class="headerlink" href="#bug-in-request-locals" title="Permalink to this headline">¶</a></h5>
<p>Due to a bug in earlier implementations the request local proxies now
raise a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> instead of an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> when they
are unbound.  If you caught these exceptions with <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a>
before, you should catch them with <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> now.</p>
<p>Additionally the <a class="reference internal" href="index.html#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> function is now issuing
deprecation warnings if you depend on functionality that will be removed
in Flask 0.11.  Previously it was possible to use etags and mimetypes
when file objects were passed.  This was unreliable and caused issues
for a few setups.  If you get a deprecation warning, make sure to
update your application to work with either filenames there or disable
etag attaching and attach them yourself.</p>
<p>Old code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">my_file_object</span><span class="p">)</span>
<span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">my_file_object</span><span class="p">)</span>
</pre></div>
</div>
<p>New code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">my_file_object</span><span class="p">,</span> <span class="n">add_etags</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="upgrading-to-new-teardown-handling">
<span id="id1"></span><h5>Upgrading to new Teardown Handling<a class="headerlink" href="#upgrading-to-new-teardown-handling" title="Permalink to this headline">¶</a></h5>
<p>We streamlined the behavior of the callbacks for request handling.  For
things that modify the response the <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>
decorators continue to work as expected, but for things that absolutely
must happen at the end of request we introduced the new
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorator.  Unfortunately that
change also made after-request work differently under error conditions.
It’s not consistently skipped if exceptions happen whereas previously it
might have been called twice to ensure it is executed at the end of the
request.</p>
<p>If you have database connection code that looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>You are now encouraged to use this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_request</span>
<span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>On the upside this change greatly improves the internal code flow and
makes it easier to customize the dispatching and error handling.  This
makes it now a lot easier to write unit tests as you can prevent closing
down of database connections for a while.  You can take advantage of the
fact that the teardown callbacks are called when the response context is
removed from the stack so a test can query the database after request
handling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="c1"># g.db is still bound if there is such a thing</span>

<span class="c1"># and here it&#39;s gone</span>
</pre></div>
</div>
</div>
<div class="section" id="manual-error-handler-attaching">
<h5>Manual Error Handler Attaching<a class="headerlink" href="#manual-error-handler-attaching" title="Permalink to this headline">¶</a></h5>
<p>While it is still possible to attach error handlers to
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.error_handlers</span></code> it’s discouraged to do so and in fact
deprecated.  In general we no longer recommend custom error handler
attaching via assignments to the underlying dictionary due to the more
complex internal handling to support arbitrary exception classes and
blueprints.  See <code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.errorhandler()</span></code> for more information.</p>
<p>The proper upgrade is to change this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">error_handlers</span><span class="p">[</span><span class="mi">403</span><span class="p">]</span> <span class="o">=</span> <span class="n">handle_error</span>
</pre></div>
</div>
<p>Into this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="n">handle_error</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively you should just attach the function with a decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>(Note that <code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code> is new in Flask 0.7)</p>
</div>
<div class="section" id="blueprint-support">
<h5>Blueprint Support<a class="headerlink" href="#blueprint-support" title="Permalink to this headline">¶</a></h5>
<p>Blueprints replace the previous concept of “Modules” in Flask.  They
provide better semantics for various features and work better with large
applications.  The update script provided should be able to upgrade your
applications automatically, but there might be some cases where it fails
to upgrade.  What changed?</p>
<ul class="simple">
<li><p>Blueprints need explicit names.  Modules had an automatic name
guessing scheme where the shortname for the module was taken from the
last part of the import module.  The upgrade script tries to guess
that name but it might fail as this information could change at
runtime.</p></li>
<li><p>Blueprints have an inverse behavior for <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code>.  Previously
<code class="docutils literal notranslate"><span class="pre">.foo</span></code> told <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code> that it should look for the endpoint
<code class="docutils literal notranslate"><span class="pre">foo</span></code> on the application.  Now it means “relative to current module”.
The script will inverse all calls to <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code> automatically for
you.  It will do this in a very eager way so you might end up with
some unnecessary leading dots in your code if you’re not using
modules.</p></li>
<li><p>Blueprints do not automatically provide static folders.  They will
also no longer automatically export templates from a folder called
<code class="file docutils literal notranslate"><span class="pre">templates</span></code> next to their location however but it can be enabled from
the constructor.  Same with static files: if you want to continue
serving static files you need to tell the constructor explicitly the
path to the static folder (which can be relative to the blueprint’s
module path).</p></li>
<li><p>Rendering templates was simplified.  Now the blueprints can provide
template folders which are added to a general template searchpath.
This means that you need to add another subfolder with the blueprint’s
name into that folder if you want <code class="file docutils literal notranslate"><span class="pre">blueprintname/template.html</span></code> as
the template name.</p></li>
</ul>
<p>If you continue to use the <code class="docutils literal notranslate"><span class="pre">Module</span></code> object which is deprecated, Flask will
restore the previous behavior as good as possible.  However we strongly
recommend upgrading to the new blueprints as they provide a lot of useful
improvement such as the ability to attach a blueprint multiple times,
blueprint specific error handlers and a lot more.</p>
</div>
</div>
<div class="section" id="version-0-6">
<h4>Version 0.6<a class="headerlink" href="#version-0-6" title="Permalink to this headline">¶</a></h4>
<p>Flask 0.6 comes with a backwards incompatible change which affects the
order of after-request handlers.  Previously they were called in the order
of the registration, now they are called in reverse order.  This change
was made so that Flask behaves more like people expected it to work and
how other systems handle request pre- and post-processing.  If you
depend on the order of execution of post-request functions, be sure to
change the order.</p>
<p>Another change that breaks backwards compatibility is that context
processors will no longer override values passed directly to the template
rendering function.  If for example <code class="docutils literal notranslate"><span class="pre">request</span></code> is as variable passed
directly to the template, the default context processor will not override
it with the current request object.  This makes it easier to extend
context processors later to inject additional variables without breaking
existing template not expecting them.</p>
</div>
<div class="section" id="version-0-5">
<h4>Version 0.5<a class="headerlink" href="#version-0-5" title="Permalink to this headline">¶</a></h4>
<p>Flask 0.5 is the first release that comes as a Python package instead of a
single module.  There were a couple of internal refactoring so if you
depend on undocumented internal details you probably have to adapt the
imports.</p>
<p>The following changes may be relevant to your application:</p>
<ul class="simple">
<li><p>autoescaping no longer happens for all templates.  Instead it is
configured to only happen on files ending with <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.htm</span></code>,
<code class="docutils literal notranslate"><span class="pre">.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code>.  If you have templates with different
extensions you should override the
<a class="reference internal" href="index.html#flask.Flask.select_jinja_autoescape" title="flask.Flask.select_jinja_autoescape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_jinja_autoescape()</span></code></a> method.</p></li>
<li><p>Flask no longer supports zipped applications in this release.  This
functionality might come back in future releases if there is demand
for this feature.  Removing support for this makes the Flask internal
code easier to understand and fixes a couple of small issues that make
debugging harder than necessary.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">create_jinja_loader</span></code> function is gone.  If you want to customize
the Jinja loader now, use the
<a class="reference internal" href="index.html#flask.Flask.create_jinja_environment" title="flask.Flask.create_jinja_environment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_jinja_environment()</span></code></a> method instead.</p></li>
</ul>
</div>
<div class="section" id="version-0-4">
<h4>Version 0.4<a class="headerlink" href="#version-0-4" title="Permalink to this headline">¶</a></h4>
<p>For application developers there are no changes that require changes in
your code.  In case you are developing on a Flask extension however, and
that extension has a unittest-mode you might want to link the activation
of that mode to the new <code class="docutils literal notranslate"><span class="pre">TESTING</span></code> flag.</p>
</div>
<div class="section" id="version-0-3">
<h4>Version 0.3<a class="headerlink" href="#version-0-3" title="Permalink to this headline">¶</a></h4>
<p>Flask 0.3 introduces configuration support and logging as well as
categories for flashing messages.  All these are features that are 100%
backwards compatible but you might want to take advantage of them.</p>
<div class="section" id="configuration-support">
<h5>Configuration Support<a class="headerlink" href="#configuration-support" title="Permalink to this headline">¶</a></h5>
<p>The configuration support makes it easier to write any kind of application
that requires some sort of configuration.  (Which most likely is the case
for any application out there).</p>
<p>If you previously had code like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">SECRET_KEY</span>
</pre></div>
</div>
<p>You no longer have to do that, instead you can just load a configuration
into the config object.  How this works is outlined in <a class="reference internal" href="index.html#config"><span class="std std-ref">Configuration Handling</span></a>.</p>
</div>
<div class="section" id="logging-integration">
<h5>Logging Integration<a class="headerlink" href="#logging-integration" title="Permalink to this headline">¶</a></h5>
<p>Flask now configures a logger for you with some basic and useful defaults.
If you run your application in production and want to profit from
automatic error logging, you might be interested in attaching a proper log
handler.  Also you can start logging warnings and errors into the logger
when appropriately.  For more information on that, read
<a class="reference internal" href="index.html#application-errors"><span class="std std-ref">Application Errors</span></a>.</p>
</div>
<div class="section" id="categories-for-flash-messages">
<h5>Categories for Flash Messages<a class="headerlink" href="#categories-for-flash-messages" title="Permalink to this headline">¶</a></h5>
<p>Flash messages can now have categories attached.  This makes it possible
to render errors, warnings or regular messages differently for example.
This is an opt-in feature because it requires some rethinking in the code.</p>
<p>Read all about that in the <a class="reference internal" href="index.html#message-flashing-pattern"><span class="std std-ref">Message Flashing</span></a> pattern.</p>
</div>
</div>
</div>
<span id="document-changelog"></span><div class="section" id="flask-changelog">
<h3>Flask Changelog<a class="headerlink" href="#flask-changelog" title="Permalink to this headline">¶</a></h3>
<div class="section" id="version-0-12-5">
<h4>Version 0.12.5<a class="headerlink" href="#version-0-12-5" title="Permalink to this headline">¶</a></h4>
<p>Released on February 10 2020</p>
<ul class="simple">
<li><p>Pin Werkzeug to &lt; 1.0.0.  (<a class="reference external" href="https://github.com/pallets/flask/issues/3497">#3497</a>)</p></li>
</ul>
</div>
<div class="section" id="version-0-12-4">
<h4>Version 0.12.4<a class="headerlink" href="#version-0-12-4" title="Permalink to this headline">¶</a></h4>
<p>Released on April 29 2018</p>
<ul class="simple">
<li><p>Repackage 0.12.3 to fix package layout issue. (<a class="reference external" href="https://github.com/pallets/flask/issues/2728">#2728</a>)</p></li>
</ul>
</div>
<div class="section" id="version-0-12-3">
<h4>Version 0.12.3<a class="headerlink" href="#version-0-12-3" title="Permalink to this headline">¶</a></h4>
<p>Released on April 26th 2018</p>
<ul class="simple">
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">Request.get_json()</span></code> no longer accepts arbitrary encodings.
Incoming JSON should be encoded using UTF-8 per <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc8259.html"><strong>RFC 8259</strong></a>, but
Flask will autodetect UTF-8, -16, or -32. (<a class="reference external" href="https://github.com/pallets/flask/issues/2692">#2692</a>)</p></li>
<li><p>Fix a Python warning about imports when using <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">flask</span></code>.
(<a class="reference external" href="https://github.com/pallets/flask/issues/2666">#2666</a>)</p></li>
<li><p>Fix a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> caused by invalid <code class="docutils literal notranslate"><span class="pre">Range</span></code> requests in some
cases.</p></li>
</ul>
</div>
<div class="section" id="version-0-12-2">
<h4>Version 0.12.2<a class="headerlink" href="#version-0-12-2" title="Permalink to this headline">¶</a></h4>
<p>Released on May 16 2017</p>
<ul class="simple">
<li><p>Fix a bug in <cite>safe_join</cite> on Windows.</p></li>
</ul>
</div>
<div class="section" id="version-0-12-1">
<h4>Version 0.12.1<a class="headerlink" href="#version-0-12-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on March 31st 2017</p>
<ul class="simple">
<li><p>Prevent <cite>flask run</cite> from showing a NoAppException when an ImportError occurs
within the imported application module.</p></li>
<li><p>Fix encoding behavior of <code class="docutils literal notranslate"><span class="pre">app.config.from_pyfile</span></code> for Python 3. Fix
<code class="docutils literal notranslate"><span class="pre">#2118</span></code>.</p></li>
<li><p>Call <cite>ctx.auto_pop</cite> with the exception object instead of <cite>None</cite>, in the
event that a <cite>BaseException</cite> such as <cite>KeyboardInterrupt</cite> is raised in a
request handler.</p></li>
</ul>
</div>
<div class="section" id="version-0-12">
<h4>Version 0.12<a class="headerlink" href="#version-0-12" title="Permalink to this headline">¶</a></h4>
<p>Released on December 21st 2016, codename Punsch.</p>
<ul class="simple">
<li><p>the cli command now responds to <cite>–version</cite>.</p></li>
<li><p>Mimetype guessing and ETag generation for file-like objects in <code class="docutils literal notranslate"><span class="pre">send_file</span></code>
has been removed, as per issue <code class="docutils literal notranslate"><span class="pre">#104</span></code>.  See pull request <code class="docutils literal notranslate"><span class="pre">#1849</span></code>.</p></li>
<li><p>Mimetype guessing in <code class="docutils literal notranslate"><span class="pre">send_file</span></code> now fails loudly and doesn’t fall back to
<code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code>. See pull request <code class="docutils literal notranslate"><span class="pre">#1988</span></code>.</p></li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">flask.safe_join</span></code> able to join multiple paths like <code class="docutils literal notranslate"><span class="pre">os.path.join</span></code>
(pull request <code class="docutils literal notranslate"><span class="pre">#1730</span></code>).</p></li>
<li><p>Revert a behavior change that made the dev server crash instead of returning
a Internal Server Error (pull request <code class="docutils literal notranslate"><span class="pre">#2006</span></code>).</p></li>
<li><p>Correctly invoke response handlers for both regular request dispatching as
well as error handlers.</p></li>
<li><p>Disable logger propagation by default for the app logger.</p></li>
<li><p>Add support for range requests in <code class="docutils literal notranslate"><span class="pre">send_file</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">app.test_client</span></code> includes preset default environment, which can now be
directly set, instead of per <code class="docutils literal notranslate"><span class="pre">client.get</span></code>.</p></li>
</ul>
</div>
<div class="section" id="version-0-11-2">
<h4>Version 0.11.2<a class="headerlink" href="#version-0-11-2" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, unreleased</p>
<ul class="simple">
<li><p>Fix crash when running under PyPy3, see pull request <code class="docutils literal notranslate"><span class="pre">#1814</span></code>.</p></li>
</ul>
</div>
<div class="section" id="version-0-11-1">
<h4>Version 0.11.1<a class="headerlink" href="#version-0-11-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on June 7th 2016.</p>
<ul class="simple">
<li><p>Fixed a bug that prevented <code class="docutils literal notranslate"><span class="pre">FLASK_APP=foobar/__init__.py</span></code> from working. See
pull request <code class="docutils literal notranslate"><span class="pre">#1872</span></code>.</p></li>
</ul>
</div>
<div class="section" id="version-0-11">
<h4>Version 0.11<a class="headerlink" href="#version-0-11" title="Permalink to this headline">¶</a></h4>
<p>Released on May 29th 2016, codename Absinthe.</p>
<ul class="simple">
<li><p>Added support to serializing top-level arrays to <code class="xref py py-func docutils literal notranslate"><span class="pre">flask.jsonify()</span></code>. This
introduces a security risk in ancient browsers. See
<a class="reference internal" href="index.html#json-security"><span class="std std-ref">JSON Security</span></a> for details.</p></li>
<li><p>Added before_render_template signal.</p></li>
<li><p>Added <cite>**kwargs</cite> to <code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Test.test_client()</span></code> to support passing
additional keyword arguments to the constructor of
<a class="reference internal" href="index.html#flask.Flask.test_client_class" title="flask.Flask.test_client_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.test_client_class</span></code></a>.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">SESSION_REFRESH_EACH_REQUEST</span></code> config key that controls the
set-cookie behavior.  If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> a permanent session will be
refreshed each request and get their lifetime extended, if set to
<code class="docutils literal notranslate"><span class="pre">False</span></code> it will only be modified if the session actually modifies.
Non permanent sessions are not affected by this and will always
expire if the browser window closes.</p></li>
<li><p>Made Flask support custom JSON mimetypes for incoming data.</p></li>
<li><p>Added support for returning tuples in the form <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">headers)</span></code>
from a view function.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.Config.from_json" title="flask.Config.from_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Config.from_json()</span></code></a>.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.Flask.config_class" title="flask.Flask.config_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.config_class</span></code></a>.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.Config.get_namespace" title="flask.Config.get_namespace"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Config.get_namespace()</span></code></a>.</p></li>
<li><p>Templates are no longer automatically reloaded outside of debug mode. This
can be configured with the new <code class="docutils literal notranslate"><span class="pre">TEMPLATES_AUTO_RELOAD</span></code> config key.</p></li>
<li><p>Added a workaround for a limitation in Python 3.3’s namespace loader.</p></li>
<li><p>Added support for explicit root paths when using Python 3.3’s namespace
packages.</p></li>
<li><p>Added <strong class="command">flask</strong> and the <code class="docutils literal notranslate"><span class="pre">flask.cli</span></code> module to start the local
debug server through the click CLI system.  This is recommended over the old
<code class="docutils literal notranslate"><span class="pre">flask.run()</span></code> method as it works faster and more reliable due to a
different design and also replaces <code class="docutils literal notranslate"><span class="pre">Flask-Script</span></code>.</p></li>
<li><p>Error handlers that match specific classes are now checked first,
thereby allowing catching exceptions that are subclasses of HTTP
exceptions (in <code class="docutils literal notranslate"><span class="pre">werkzeug.exceptions</span></code>).  This makes it possible
for an extension author to create exceptions that will by default
result in the HTTP error of their choosing, but may be caught with
a custom error handler if desired.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.Config.from_mapping" title="flask.Config.from_mapping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Config.from_mapping()</span></code></a>.</p></li>
<li><p>Flask will now log by default even if debug is disabled.  The log format is
now hardcoded but the default log handling can be disabled through the
<code class="docutils literal notranslate"><span class="pre">LOGGER_HANDLER_POLICY</span></code> configuration key.</p></li>
<li><p>Removed deprecated module functionality.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">EXPLAIN_TEMPLATE_LOADING</span></code> config flag which when enabled will
instruct Flask to explain how it locates templates.  This should help
users debug when the wrong templates are loaded.</p></li>
<li><p>Enforce blueprint handling in the order they were registered for template
loading.</p></li>
<li><p>Ported test suite to py.test.</p></li>
<li><p>Deprecated <code class="docutils literal notranslate"><span class="pre">request.json</span></code> in favour of <code class="docutils literal notranslate"><span class="pre">request.get_json()</span></code>.</p></li>
<li><p>Add “pretty” and “compressed” separators definitions in jsonify() method.
Reduces JSON response size when JSONIFY_PRETTYPRINT_REGULAR=False by removing
unnecessary white space included by default after separators.</p></li>
<li><p>JSON responses are now terminated with a newline character, because it is a
convention that UNIX text files end with a newline and some clients don’t
deal well when this newline is missing. See
<a class="reference external" href="https://github.com/pallets/flask/pull/1262">https://github.com/pallets/flask/pull/1262</a> – this came up originally as a
part of <a class="reference external" href="https://github.com/kennethreitz/httpbin/issues/168">https://github.com/kennethreitz/httpbin/issues/168</a></p></li>
<li><p>The automatically provided <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> method is now correctly disabled if
the user registered an overriding rule with the lowercase-version
<code class="docutils literal notranslate"><span class="pre">options</span></code> (issue <code class="docutils literal notranslate"><span class="pre">#1288</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.json.jsonify</span></code> now supports the <code class="docutils literal notranslate"><span class="pre">datetime.date</span></code> type (pull request
<code class="docutils literal notranslate"><span class="pre">#1326</span></code>).</p></li>
<li><p>Don’t leak exception info of already catched exceptions to context teardown
handlers (pull request <code class="docutils literal notranslate"><span class="pre">#1393</span></code>).</p></li>
<li><p>Allow custom Jinja environment subclasses (pull request <code class="docutils literal notranslate"><span class="pre">#1422</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.g</span></code> now has <code class="docutils literal notranslate"><span class="pre">pop()</span></code> and <code class="docutils literal notranslate"><span class="pre">setdefault</span></code> methods.</p></li>
<li><p>Turn on autoescape for <code class="docutils literal notranslate"><span class="pre">flask.templating.render_template_string</span></code> by default
(pull request <code class="docutils literal notranslate"><span class="pre">#1515</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.ext</span></code> is now deprecated (pull request <code class="docutils literal notranslate"><span class="pre">#1484</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">send_from_directory</span></code> now raises BadRequest if the filename is invalid on
the server OS (pull request <code class="docutils literal notranslate"><span class="pre">#1763</span></code>).</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">JSONIFY_MIMETYPE</span></code> configuration variable (pull request <code class="docutils literal notranslate"><span class="pre">#1728</span></code>).</p></li>
<li><p>Exceptions during teardown handling will no longer leave bad application
contexts lingering around.</p></li>
</ul>
</div>
<div class="section" id="version-0-10-2">
<h4>Version 0.10.2<a class="headerlink" href="#version-0-10-2" title="Permalink to this headline">¶</a></h4>
<p>(bugfix release, release date to be announced)</p>
<ul class="simple">
<li><p>Fixed broken <cite>test_appcontext_signals()</cite> test case.</p></li>
<li><p>Raise an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> in <code class="xref py py-func docutils literal notranslate"><span class="pre">flask.helpers.find_package()</span></code> with a
useful message explaining why it is raised when a PEP 302 import hook is used
without an <cite>is_package()</cite> method.</p></li>
<li><p>Fixed an issue causing exceptions raised before entering a request or app
context to be passed to teardown handlers.</p></li>
<li><p>Fixed an issue with query parameters getting removed from requests in
the test client when absolute URLs were requested.</p></li>
<li><p>Made <cite>&#64;before_first_request</cite> into a decorator as intended.</p></li>
<li><p>Fixed an etags bug when sending a file streams with a name.</p></li>
<li><p>Fixed <cite>send_from_directory</cite> not expanding to the application root path
correctly.</p></li>
<li><p>Changed logic of before first request handlers to flip the flag after
invoking.  This will allow some uses that are potentially dangerous but
should probably be permitted.</p></li>
<li><p>Fixed Python 3 bug when a handler from <cite>app.url_build_error_handlers</cite>
reraises the <cite>BuildError</cite>.</p></li>
</ul>
</div>
<div class="section" id="version-0-10-1">
<h4>Version 0.10.1<a class="headerlink" href="#version-0-10-1" title="Permalink to this headline">¶</a></h4>
<p>(bugfix release, released on June 14th 2013)</p>
<ul class="simple">
<li><p>Fixed an issue where <code class="docutils literal notranslate"><span class="pre">|tojson</span></code> was not quoting single quotes which
made the filter not work properly in HTML attributes.  Now it’s
possible to use that filter in single quoted attributes.  This should
make using that filter with angular.js easier.</p></li>
<li><p>Added support for byte strings back to the session system.  This broke
compatibility with the common case of people putting binary data for
token verification into the session.</p></li>
<li><p>Fixed an issue where registering the same method twice for the same endpoint
would trigger an exception incorrectly.</p></li>
</ul>
</div>
<div class="section" id="version-0-10">
<h4>Version 0.10<a class="headerlink" href="#version-0-10" title="Permalink to this headline">¶</a></h4>
<p>Released on June 13th 2013, codename Limoncello.</p>
<ul class="simple">
<li><p>Changed default cookie serialization format from pickle to JSON to
limit the impact an attacker can do if the secret key leaks.  See
<a class="reference internal" href="index.html#upgrading-to-010"><span class="std std-ref">Version 0.10</span></a> for more information.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">template_test</span></code> methods in addition to the already existing
<code class="docutils literal notranslate"><span class="pre">template_filter</span></code> method family.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">template_global</span></code> methods in addition to the already existing
<code class="docutils literal notranslate"><span class="pre">template_filter</span></code> method family.</p></li>
<li><p>Set the content-length header for x-sendfile.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tojson</span></code> filter now does not escape script blocks in HTML5 parsers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tojson</span></code> used in templates is now safe by default due.  This was
allowed due to the different escaping behavior.</p></li>
<li><p>Flask will now raise an error if you attempt to register a new function
on an already used endpoint.</p></li>
<li><p>Added wrapper module around simplejson and added default serialization
of datetime objects.  This allows much easier customization of how
JSON is handled by Flask or any Flask extension.</p></li>
<li><p>Removed deprecated internal <code class="docutils literal notranslate"><span class="pre">flask.session</span></code> module alias.  Use
<code class="docutils literal notranslate"><span class="pre">flask.sessions</span></code> instead to get the session module.  This is not to
be confused with <code class="docutils literal notranslate"><span class="pre">flask.session</span></code> the session proxy.</p></li>
<li><p>Templates can now be rendered without request context.  The behavior is
slightly different as the <code class="docutils literal notranslate"><span class="pre">request</span></code>, <code class="docutils literal notranslate"><span class="pre">session</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> objects
will not be available and blueprint’s context processors are not
called.</p></li>
<li><p>The config object is now available to the template as a real global and
not through a context processor which makes it available even in imported
templates by default.</p></li>
<li><p>Added an option to generate non-ascii encoded JSON which should result
in less bytes being transmitted over the network.  It’s disabled by
default to not cause confusion with existing libraries that might expect
<code class="docutils literal notranslate"><span class="pre">flask.json.dumps</span></code> to return bytestrings by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.g</span></code> is now stored on the app context instead of the request
context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.g</span></code> now gained a <code class="docutils literal notranslate"><span class="pre">get()</span></code> method for not erroring out on non
existing items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.g</span></code> now can be used with the <code class="docutils literal notranslate"><span class="pre">in</span></code> operator to see what’s defined
and it now is iterable and will yield all attributes stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flask.Flask.request_globals_class</span></code> got renamed to
<code class="docutils literal notranslate"><span class="pre">flask.Flask.app_ctx_globals_class</span></code> which is a better name to what it
does since 0.10.</p></li>
<li><p><cite>request</cite>, <cite>session</cite> and <cite>g</cite> are now also added as proxies to the template
context which makes them available in imported templates.  One has to be
very careful with those though because usage outside of macros might
cause caching.</p></li>
<li><p>Flask will no longer invoke the wrong error handlers if a proxy
exception is passed through.</p></li>
<li><p>Added a workaround for chrome’s cookies in localhost not working
as intended with domain names.</p></li>
<li><p>Changed logic for picking defaults for cookie values from sessions
to work better with Google Chrome.</p></li>
<li><p>Added <cite>message_flashed</cite> signal that simplifies flashing testing.</p></li>
<li><p>Added support for copying of request contexts for better working with
greenlets.</p></li>
<li><p>Removed custom JSON HTTP exception subclasses.  If you were relying on them
you can reintroduce them again yourself trivially.  Using them however is
strongly discouraged as the interface was flawed.</p></li>
<li><p>Python requirements changed: requiring Python 2.6 or 2.7 now to prepare
for Python 3.3 port.</p></li>
<li><p>Changed how the teardown system is informed about exceptions.  This is now
more reliable in case something handles an exception halfway through
the error handling process.</p></li>
<li><p>Request context preservation in debug mode now keeps the exception
information around which means that teardown handlers are able to
distinguish error from success cases.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code> configuration variable.</p></li>
<li><p>Flask now orders JSON keys by default to not trash HTTP caches due to
different hash seeds between different workers.</p></li>
<li><p>Added <cite>appcontext_pushed</cite> and <cite>appcontext_popped</cite> signals.</p></li>
<li><p>The builtin run method now takes the <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> into account when
picking the default port to run on.</p></li>
<li><p>Added <cite>flask.request.get_json()</cite> as a replacement for the old
<cite>flask.request.json</cite> property.</p></li>
</ul>
</div>
<div class="section" id="version-0-9">
<h4>Version 0.9<a class="headerlink" href="#version-0-9" title="Permalink to this headline">¶</a></h4>
<p>Released on July 1st 2012, codename Campari.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="index.html#flask.Request.on_json_loading_failed" title="flask.Request.on_json_loading_failed"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.Request.on_json_loading_failed()</span></code></a> now returns a JSON formatted
response by default.</p></li>
<li><p>The <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.url_for()</span></code></a> function now can generate anchors to the
generated links.</p></li>
<li><p>The <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.url_for()</span></code></a> function now can also explicitly generate
URL rules specific to a given HTTP method.</p></li>
<li><p>Logger now only returns the debug log setting if it was not set
explicitly.</p></li>
<li><p>Unregister a circular dependency between the WSGI environment and
the request object when shutting down the request.  This means that
environ <code class="docutils literal notranslate"><span class="pre">werkzeug.request</span></code> will be <code class="docutils literal notranslate"><span class="pre">None</span></code> after the response was
returned to the WSGI server but has the advantage that the garbage
collector is not needed on CPython to tear down the request unless
the user created circular dependencies themselves.</p></li>
<li><p>Session is now stored after callbacks so that if the session payload
is stored in the session you can still modify it in an after
request callback.</p></li>
<li><p>The <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.Flask</span></code></a> class will avoid importing the provided import name
if it can (the required first parameter), to benefit tools which build Flask
instances programmatically.  The Flask class will fall back to using import
on systems with custom module hooks, e.g. Google App Engine, or when the
import name is inside a zip archive (usually a .egg) prior to Python 2.7.</p></li>
<li><p>Blueprints now have a decorator to add custom template filters application
wide, <a class="reference internal" href="index.html#flask.Blueprint.app_template_filter" title="flask.Blueprint.app_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Blueprint.app_template_filter()</span></code></a>.</p></li>
<li><p>The Flask and Blueprint classes now have a non-decorator method for adding
custom template filters application wide,
<a class="reference internal" href="index.html#flask.Flask.add_template_filter" title="flask.Flask.add_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.add_template_filter()</span></code></a> and
<a class="reference internal" href="index.html#flask.Blueprint.add_app_template_filter" title="flask.Blueprint.add_app_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Blueprint.add_app_template_filter()</span></code></a>.</p></li>
<li><p>The <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.get_flashed_messages()</span></code></a> function now allows rendering flashed
message categories in separate blocks, through a <code class="docutils literal notranslate"><span class="pre">category_filter</span></code>
argument.</p></li>
<li><p>The <a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.run()</span></code></a> method now accepts <code class="docutils literal notranslate"><span class="pre">None</span></code> for <cite>host</cite> and <cite>port</cite>
arguments, using default values when <code class="docutils literal notranslate"><span class="pre">None</span></code>.  This allows for calling run
using configuration values, e.g. <code class="docutils literal notranslate"><span class="pre">app.run(app.config.get('MYHOST'),</span>
<span class="pre">app.config.get('MYPORT'))</span></code>, with proper behavior whether or not a config
file is provided.</p></li>
<li><p>The <a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.render_template()</span></code></a> method now accepts a either an iterable of
template names or a single template name.  Previously, it only accepted a
single template name.  On an iterable, the first template found is rendered.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.Flask.app_context" title="flask.Flask.app_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.app_context()</span></code></a> which works very similar to the
request context but only provides access to the current application.  This
also adds support for URL generation without an active request context.</p></li>
<li><p>View functions can now return a tuple with the first instance being an
instance of <a class="reference internal" href="index.html#flask.Response" title="flask.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.Response</span></code></a>.  This allows for returning
<code class="docutils literal notranslate"><span class="pre">jsonify(error=&quot;error</span> <span class="pre">msg&quot;),</span> <span class="pre">400</span></code> from a view function.</p></li>
<li><p><a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> and <a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a> now provide a
<a class="reference internal" href="index.html#flask.Flask.get_send_file_max_age" title="flask.Flask.get_send_file_max_age"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_send_file_max_age()</span></code></a> hook for subclasses to override
behavior of serving static files from Flask when using
<a class="reference internal" href="index.html#flask.Flask.send_static_file" title="flask.Flask.send_static_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.send_static_file()</span></code></a> (used for the default static file
handler) and <code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code>.  This hook is provided a
filename, which for example allows changing cache controls by file extension.
The default max-age for <cite>send_file</cite> and static files can be configured
through a new <code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code> configuration variable, which is
used in the default <cite>get_send_file_max_age</cite> implementation.</p></li>
<li><p>Fixed an assumption in sessions implementation which could break message
flashing on sessions implementations which use external storage.</p></li>
<li><p>Changed the behavior of tuple return values from functions.  They are no
longer arguments to the response object, they now have a defined meaning.</p></li>
<li><p>Added <code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.request_globals_class</span></code> to allow a specific class to
be used on creation of the <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> instance of each request.</p></li>
<li><p>Added <cite>required_methods</cite> attribute to view functions to force-add methods
on registration.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.after_this_request" title="flask.after_this_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.after_this_request()</span></code></a>.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.stream_with_context" title="flask.stream_with_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.stream_with_context()</span></code></a> and the ability to push contexts
multiple times without producing unexpected behavior.</p></li>
</ul>
</div>
<div class="section" id="version-0-8-1">
<h4>Version 0.8.1<a class="headerlink" href="#version-0-8-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on July 1st 2012</p>
<ul class="simple">
<li><p>Fixed an issue with the undocumented <cite>flask.session</cite> module to not
work properly on Python 2.5.  It should not be used but did cause
some problems for package managers.</p></li>
</ul>
</div>
<div class="section" id="version-0-8">
<h4>Version 0.8<a class="headerlink" href="#version-0-8" title="Permalink to this headline">¶</a></h4>
<p>Released on September 29th 2011, codename Rakija</p>
<ul class="simple">
<li><p>Refactored session support into a session interface so that
the implementation of the sessions can be changed without
having to override the Flask class.</p></li>
<li><p>Empty session cookies are now deleted properly automatically.</p></li>
<li><p>View functions can now opt out of getting the automatic
OPTIONS implementation.</p></li>
<li><p>HTTP exceptions and Bad Request errors can now be trapped so that they
show up normally in the traceback.</p></li>
<li><p>Flask in debug mode is now detecting some common problems and tries to
warn you about them.</p></li>
<li><p>Flask in debug mode will now complain with an assertion error if a view
was attached after the first request was handled.  This gives earlier
feedback when users forget to import view code ahead of time.</p></li>
<li><p>Added the ability to register callbacks that are only triggered once at
the beginning of the first request. (<code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_first_request()</span></code>)</p></li>
<li><p>Malformed JSON data will now trigger a bad request HTTP exception instead
of a value error which usually would result in a 500 internal server
error if not handled.  This is a backwards incompatible change.</p></li>
<li><p>Applications now not only have a root path where the resources and modules
are located but also an instance path which is the designated place to
drop files that are modified at runtime (uploads etc.).  Also this is
conceptually only instance depending and outside version control so it’s
the perfect place to put configuration files etc.  For more information
see <a class="reference internal" href="index.html#instance-folders"><span class="std std-ref">Instance Folders</span></a>.</p></li>
<li><p>Added the <code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code> configuration variable.</p></li>
<li><p>Implemented <code class="xref py py-meth docutils literal notranslate"><span class="pre">session_transaction()</span></code> to
easily modify sessions from the test environment.</p></li>
<li><p>Refactored test client internally.  The <code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code> configuration
variable as well as <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> are now properly used by the test client
as defaults.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.views.View.decorators" title="flask.views.View.decorators"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.views.View.decorators</span></code></a> to support simpler decorating of
pluggable (class-based) views.</p></li>
<li><p>Fixed an issue where the test client if used with the “with” statement did not
trigger the execution of the teardown handlers.</p></li>
<li><p>Added finer control over the session cookie parameters.</p></li>
<li><p>HEAD requests to a method view now automatically dispatch to the <cite>get</cite>
method if no handler was implemented.</p></li>
<li><p>Implemented the virtual <code class="xref py py-mod docutils literal notranslate"><span class="pre">flask.ext</span></code> package to import extensions from.</p></li>
<li><p>The context preservation on exceptions is now an integral component of
Flask itself and no longer of the test client.  This cleaned up some
internal logic and lowers the odds of runaway request contexts in unittests.</p></li>
</ul>
</div>
<div class="section" id="version-0-7-3">
<h4>Version 0.7.3<a class="headerlink" href="#version-0-7-3" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, release date to be decided</p>
<ul class="simple">
<li><p>Fixed the Jinja2 environment’s list_templates method not returning the
correct names when blueprints or modules were involved.</p></li>
</ul>
</div>
<div class="section" id="version-0-7-2">
<h4>Version 0.7.2<a class="headerlink" href="#version-0-7-2" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on July 6th 2011</p>
<ul class="simple">
<li><p>Fixed an issue with URL processors not properly working on
blueprints.</p></li>
</ul>
</div>
<div class="section" id="version-0-7-1">
<h4>Version 0.7.1<a class="headerlink" href="#version-0-7-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on June 29th 2011</p>
<ul class="simple">
<li><p>Added missing future import that broke 2.5 compatibility.</p></li>
<li><p>Fixed an infinite redirect issue with blueprints.</p></li>
</ul>
</div>
<div class="section" id="version-0-7">
<h4>Version 0.7<a class="headerlink" href="#version-0-7" title="Permalink to this headline">¶</a></h4>
<p>Released on June 28th 2011, codename Grappa</p>
<ul class="simple">
<li><p>Added <a class="reference internal" href="index.html#flask.Flask.make_default_options_response" title="flask.Flask.make_default_options_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_default_options_response()</span></code></a>
which can be used by subclasses to alter the default
behavior for <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> responses.</p></li>
<li><p>Unbound locals now raise a proper <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> instead
of an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a>.</p></li>
<li><p>Mimetype guessing and etag support based on file objects is now
deprecated for <a class="reference internal" href="index.html#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.send_file()</span></code></a> because it was unreliable.
Pass filenames instead or attach your own etags and provide a
proper mimetype by hand.</p></li>
<li><p>Static file handling for modules now requires the name of the
static folder to be supplied explicitly.  The previous autodetection
was not reliable and caused issues on Google’s App Engine.  Until
1.0 the old behavior will continue to work but issue dependency
warnings.</p></li>
<li><p>fixed a problem for Flask to run on jython.</p></li>
<li><p>added a <code class="docutils literal notranslate"><span class="pre">PROPAGATE_EXCEPTIONS</span></code> configuration variable that can be
used to flip the setting of exception propagation which previously
was linked to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> alone and is now linked to either <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> or
<code class="docutils literal notranslate"><span class="pre">TESTING</span></code>.</p></li>
<li><p>Flask no longer internally depends on rules being added through the
<cite>add_url_rule</cite> function and can now also accept regular werkzeug
rules added to the url map.</p></li>
<li><p>Added an <cite>endpoint</cite> method to the flask application object which
allows one to register a callback to an arbitrary endpoint with
a decorator.</p></li>
<li><p>Use Last-Modified for static file sending instead of Date which
was incorrectly introduced in 0.6.</p></li>
<li><p>Added <cite>create_jinja_loader</cite> to override the loader creation process.</p></li>
<li><p>Implemented a silent flag for <cite>config.from_pyfile</cite>.</p></li>
<li><p>Added <cite>teardown_request</cite> decorator, for functions that should run at the end
of a request regardless of whether an exception occurred.  Also the behavior
for <cite>after_request</cite> was changed.  It’s now no longer executed when an exception
is raised.  See <a class="reference internal" href="index.html#upgrading-to-new-teardown-handling"><span class="std std-ref">Upgrading to new Teardown Handling</span></a></p></li>
<li><p>Implemented <a class="reference internal" href="index.html#flask.has_request_context" title="flask.has_request_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.has_request_context()</span></code></a></p></li>
<li><p>Deprecated <cite>init_jinja_globals</cite>.  Override the
<a class="reference internal" href="index.html#flask.Flask.create_jinja_environment" title="flask.Flask.create_jinja_environment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_jinja_environment()</span></code></a> method instead to
achieve the same functionality.</p></li>
<li><p>Added <a class="reference internal" href="index.html#flask.safe_join" title="flask.safe_join"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.safe_join()</span></code></a></p></li>
<li><p>The automatic JSON request data unpacking now looks at the charset
mimetype parameter.</p></li>
<li><p>Don’t modify the session on <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.get_flashed_messages()</span></code></a> if there
are no messages in the session.</p></li>
<li><p><cite>before_request</cite> handlers are now able to abort requests with errors.</p></li>
<li><p>it is not possible to define user exception handlers.  That way you can
provide custom error messages from a central hub for certain errors that
might occur during request processing (for instance database connection
errors, timeouts from remote resources etc.).</p></li>
<li><p>Blueprints can provide blueprint specific error handlers.</p></li>
<li><p>Implemented generic <a class="reference internal" href="index.html#views"><span class="std std-ref">Pluggable Views</span></a> (class-based views).</p></li>
</ul>
</div>
<div class="section" id="version-0-6-1">
<h4>Version 0.6.1<a class="headerlink" href="#version-0-6-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on December 31st 2010</p>
<ul class="simple">
<li><p>Fixed an issue where the default <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> response was
not exposing all valid methods in the <code class="docutils literal notranslate"><span class="pre">Allow</span></code> header.</p></li>
<li><p>Jinja2 template loading syntax now allows “./” in front of
a template load path.  Previously this caused issues with
module setups.</p></li>
<li><p>Fixed an issue where the subdomain setting for modules was
ignored for the static folder.</p></li>
<li><p>Fixed a security problem that allowed clients to download arbitrary files
if the host server was a windows based operating system and the client
uses backslashes to escape the directory the files where exposed from.</p></li>
</ul>
</div>
<div class="section" id="version-0-6">
<h4>Version 0.6<a class="headerlink" href="#version-0-6" title="Permalink to this headline">¶</a></h4>
<p>Released on July 27th 2010, codename Whisky</p>
<ul class="simple">
<li><p>after request functions are now called in reverse order of
registration.</p></li>
<li><p>OPTIONS is now automatically implemented by Flask unless the
application explicitly adds ‘OPTIONS’ as method to the URL rule.
In this case no automatic OPTIONS handling kicks in.</p></li>
<li><p>static rules are now even in place if there is no static folder
for the module.  This was implemented to aid GAE which will
remove the static folder if it’s part of a mapping in the .yml
file.</p></li>
<li><p>the <a class="reference internal" href="index.html#flask.Flask.config" title="flask.Flask.config"><code class="xref py py-attr docutils literal notranslate"><span class="pre">config</span></code></a> is now available in the templates
as <cite>config</cite>.</p></li>
<li><p>context processors will no longer override values passed directly
to the render function.</p></li>
<li><p>added the ability to limit the incoming request data with the
new <code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code> configuration value.</p></li>
<li><p>the endpoint for the <code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Module.add_url_rule()</span></code> method
is now optional to be consistent with the function of the
same name on the application object.</p></li>
<li><p>added a <a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.make_response()</span></code></a> function that simplifies
creating response object instances in views.</p></li>
<li><p>added signalling support based on blinker.  This feature is currently
optional and supposed to be used by extensions and applications.  If
you want to use it, make sure to have <a class="reference external" href="https://pypi.org/project/blinker/">blinker</a> installed.</p></li>
<li><p>refactored the way URL adapters are created.  This process is now
fully customizable with the <a class="reference internal" href="index.html#flask.Flask.create_url_adapter" title="flask.Flask.create_url_adapter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_url_adapter()</span></code></a>
method.</p></li>
<li><p>modules can now register for a subdomain instead of just an URL
prefix.  This makes it possible to bind a whole module to a
configurable subdomain.</p></li>
</ul>
</div>
<div class="section" id="version-0-5-2">
<h4>Version 0.5.2<a class="headerlink" href="#version-0-5-2" title="Permalink to this headline">¶</a></h4>
<p>Bugfix Release, released on July 15th 2010</p>
<ul class="simple">
<li><p>fixed another issue with loading templates from directories when
modules were used.</p></li>
</ul>
</div>
<div class="section" id="version-0-5-1">
<h4>Version 0.5.1<a class="headerlink" href="#version-0-5-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix Release, released on July 6th 2010</p>
<ul class="simple">
<li><p>fixes an issue with template loading from directories when modules
where used.</p></li>
</ul>
</div>
<div class="section" id="version-0-5">
<h4>Version 0.5<a class="headerlink" href="#version-0-5" title="Permalink to this headline">¶</a></h4>
<p>Released on July 6th 2010, codename Calvados</p>
<ul class="simple">
<li><p>fixed a bug with subdomains that was caused by the inability to
specify the server name.  The server name can now be set with
the <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> config key.  This key is now also used to set
the session cookie cross-subdomain wide.</p></li>
<li><p>autoescaping is no longer active for all templates.  Instead it
is only active for <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.htm</span></code>, <code class="docutils literal notranslate"><span class="pre">.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code>.
Inside templates this behavior can be changed with the
<code class="docutils literal notranslate"><span class="pre">autoescape</span></code> tag.</p></li>
<li><p>refactored Flask internally.  It now consists of more than a
single file.</p></li>
<li><p><a class="reference internal" href="index.html#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.send_file()</span></code></a> now emits etags and has the ability to
do conditional responses builtin.</p></li>
<li><p>(temporarily) dropped support for zipped applications.  This was a
rarely used feature and led to some confusing behavior.</p></li>
<li><p>added support for per-package template and static-file directories.</p></li>
<li><p>removed support for <cite>create_jinja_loader</cite> which is no longer used
in 0.5 due to the improved module support.</p></li>
<li><p>added a helper function to expose files from any directory.</p></li>
</ul>
</div>
<div class="section" id="version-0-4">
<h4>Version 0.4<a class="headerlink" href="#version-0-4" title="Permalink to this headline">¶</a></h4>
<p>Released on June 18th 2010, codename Rakia</p>
<ul class="simple">
<li><p>added the ability to register application wide error handlers
from modules.</p></li>
<li><p><a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> handlers are now also invoked
if the request dies with an exception and an error handling page
kicks in.</p></li>
<li><p>test client has not the ability to preserve the request context
for a little longer.  This can also be used to trigger custom
requests that do not pop the request stack for testing.</p></li>
<li><p>because the Python standard library caches loggers, the name of
the logger is configurable now to better support unittests.</p></li>
<li><p>added <code class="docutils literal notranslate"><span class="pre">TESTING</span></code> switch that can activate unittesting helpers.</p></li>
<li><p>the logger switches to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> mode now if debug is enabled.</p></li>
</ul>
</div>
<div class="section" id="version-0-3-1">
<h4>Version 0.3.1<a class="headerlink" href="#version-0-3-1" title="Permalink to this headline">¶</a></h4>
<p>Bugfix release, released on May 28th 2010</p>
<ul class="simple">
<li><p>fixed a error reporting bug with <a class="reference internal" href="index.html#flask.Config.from_envvar" title="flask.Config.from_envvar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Config.from_envvar()</span></code></a></p></li>
<li><p>removed some unused code from flask</p></li>
<li><p>release does no longer include development leftover files (.git
folder for themes, built documentation in zip and pdf file and
some .pyc files)</p></li>
</ul>
</div>
<div class="section" id="version-0-3">
<h4>Version 0.3<a class="headerlink" href="#version-0-3" title="Permalink to this headline">¶</a></h4>
<p>Released on May 28th 2010, codename Schnaps</p>
<ul class="simple">
<li><p>added support for categories for flashed messages.</p></li>
<li><p>the application now configures a <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Handler" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Handler</span></code></a> and will
log request handling exceptions to that logger when not in debug
mode.  This makes it possible to receive mails on server errors
for example.</p></li>
<li><p>added support for context binding that does not require the use of
the with statement for playing in the console.</p></li>
<li><p>the request context is now available within the with statement making
it possible to further push the request context or pop it.</p></li>
<li><p>added support for configurations.</p></li>
</ul>
</div>
<div class="section" id="version-0-2">
<h4>Version 0.2<a class="headerlink" href="#version-0-2" title="Permalink to this headline">¶</a></h4>
<p>Released on May 12th 2010, codename Jägermeister</p>
<ul class="simple">
<li><p>various bugfixes</p></li>
<li><p>integrated JSON support</p></li>
<li><p>added <a class="reference internal" href="index.html#flask.get_template_attribute" title="flask.get_template_attribute"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_template_attribute()</span></code></a> helper function.</p></li>
<li><p><a class="reference internal" href="index.html#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> can now also register a
view function.</p></li>
<li><p>refactored internal request dispatching.</p></li>
<li><p>server listens on 127.0.0.1 by default now to fix issues with chrome.</p></li>
<li><p>added external URL support.</p></li>
<li><p>added support for <a class="reference internal" href="index.html#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a></p></li>
<li><p>module support and internal request handling refactoring
to better support pluggable applications.</p></li>
<li><p>sessions can be set to be permanent now on a per-session basis.</p></li>
<li><p>better error reporting on missing secret keys.</p></li>
<li><p>added support for Google Appengine.</p></li>
</ul>
</div>
<div class="section" id="version-0-1">
<h4>Version 0.1<a class="headerlink" href="#version-0-1" title="Permalink to this headline">¶</a></h4>
<p>First public preview release.</p>
</div>
</div>
<span id="document-license"></span><div class="section" id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<p>Flask is licensed under a three clause BSD License.  It basically means:
do whatever you want with it as long as the copyright in Flask sticks
around, the conditions are not modified and the disclaimer is present.
Furthermore you must not use the names of the authors to promote derivatives
of the software without written consent.</p>
<p>The full license text can be found below (<a class="reference internal" href="#flask-license"><span class="std std-ref">Flask License</span></a>).  For the
documentation and artwork different licenses apply.</p>
<div class="section" id="authors">
<span id="id1"></span><h4>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h4>
<p>Flask is written and maintained by Armin Ronacher and
various contributors:</p>
<div class="section" id="development-lead">
<h5>Development Lead<a class="headerlink" href="#development-lead" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Armin Ronacher &lt;<a class="reference external" href="mailto:armin&#46;ronacher&#37;&#52;&#48;active-4&#46;com">armin<span>&#46;</span>ronacher<span>&#64;</span>active-4<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
<div class="section" id="patches-and-suggestions">
<h5>Patches and Suggestions<a class="headerlink" href="#patches-and-suggestions" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Adam Zapletal</p></li>
<li><p>Ali Afshar</p></li>
<li><p>Chris Edgemon</p></li>
<li><p>Chris Grindstaff</p></li>
<li><p>Christopher Grebs</p></li>
<li><p>Daniel Neuhäuser</p></li>
<li><p>Dan Sully</p></li>
<li><p>David Lord &#64;davidism</p></li>
<li><p>Edmond Burnett</p></li>
<li><p>Florent Xicluna</p></li>
<li><p>Georg Brandl</p></li>
<li><p>Jeff Widman &#64;jeffwidman</p></li>
<li><p>Justin Quick</p></li>
<li><p>Kenneth Reitz</p></li>
<li><p>Keyan Pishdadian</p></li>
<li><p>Marian Sigler</p></li>
<li><p>Martijn Pieters</p></li>
<li><p>Matt Campell</p></li>
<li><p>Matthew Frazier</p></li>
<li><p>Michael van Tellingen</p></li>
<li><p>Ron DuPlain</p></li>
<li><p>Sebastien Estienne</p></li>
<li><p>Simon Sapin</p></li>
<li><p>Stephane Wirtel</p></li>
<li><p>Thomas Schranz</p></li>
<li><p>Zhao Xiaohong</p></li>
</ul>
</div>
</div>
<div class="section" id="general-license-definitions">
<h4>General License Definitions<a class="headerlink" href="#general-license-definitions" title="Permalink to this headline">¶</a></h4>
<p>The following section contains the full license texts for Flask and the
documentation.</p>
<ul class="simple">
<li><p>“AUTHORS” hereby refers to all the authors listed in the
<a class="reference internal" href="#authors"><span class="std std-ref">Authors</span></a> section.</p></li>
<li><p>The “<a class="reference internal" href="#flask-license"><span class="std std-ref">Flask License</span></a>” applies to all the source code shipped as
part of Flask (Flask itself as well as the examples and the unittests)
as well as documentation.</p></li>
<li><p>The “<a class="reference internal" href="#artwork-license"><span class="std std-ref">Flask Artwork License</span></a>” applies to the project’s Horn-Logo.</p></li>
</ul>
</div>
<div class="section" id="flask-license">
<span id="id2"></span><h4>Flask License<a class="headerlink" href="#flask-license" title="Permalink to this headline">¶</a></h4>
<p>Copyright (c) 2015 by Armin Ronacher and contributors.  See AUTHORS
for more details.</p>
<p>Some rights reserved.</p>
<p>Redistribution and use in source and binary forms of the software as well
as documentation, with or without modification, are permitted provided
that the following conditions are met:</p>
<ul class="simple">
<li><p>Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.</p></li>
<li><p>Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials provided
with the distribution.</p></li>
<li><p>The names of the contributors may not be used to endorse or
promote products derived from this software without specific
prior written permission.</p></li>
</ul>
<p>THIS SOFTWARE AND DOCUMENTATION IS PROVIDED BY THE COPYRIGHT HOLDERS AND
CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT
NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE AND DOCUMENTATION, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.</p>
</div>
<div class="section" id="flask-artwork-license">
<span id="artwork-license"></span><h4>Flask Artwork License<a class="headerlink" href="#flask-artwork-license" title="Permalink to this headline">¶</a></h4>
<p>Copyright (c) 2010 by Armin Ronacher.</p>
<p>Some rights reserved.</p>
<p>This logo or a modified version may be used by anyone to refer to the
Flask project, but does not indicate endorsement by the project.</p>
<p>Redistribution and use in source (the SVG file) and binary forms (rendered
PNG files etc.) of the image, with or without modification, are permitted
provided that the following conditions are met:</p>
<ul class="simple">
<li><p>Redistributions of source code must retain the above copyright
notice and this list of conditions.</p></li>
<li><p>The names of the contributors to the Flask software (see AUTHORS) may
not be used to endorse or promote products derived from this software
without specific prior written permission.</p></li>
</ul>
<p>Note: we would appreciate that you make the image a link to
<a class="reference external" href="http://flask.pocoo.org/">http://flask.pocoo.org/</a> if you use it on a web page.</p>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  

  <h3>Project Links</h3>
  <ul>
    <li><a href="https://palletsprojects.com/donate">Donate to Pallets</a>
  
    <li><a href="https://palletsprojects.com/p/flask/">Flask Website</a>
  
    <li><a href="https://pypi.org/project/Flask/">PyPI releases</a>
  
    <li><a href="https://github.com/pallets/flask/">Source Code</a>
  
    <li><a href="https://github.com/pallets/flask/issues/">Issue Tracker</a>
  </ul>
  <h3>Contents</h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-foreword">Foreword</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-does-micro-mean">What does “micro” mean?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration-and-conventions">Configuration and Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#growing-with-flask">Growing with Flask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-advanced_foreword">Foreword for Experienced Programmers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#thread-locals-in-flask">Thread-Locals in Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#develop-for-the-web-with-caution">Develop for the Web with Caution</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#python-3-support-in-flask">Python 3 Support in Flask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#virtualenv">virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#system-wide-installation">System-Wide Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#living-on-the-edge">Living on the Edge</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pip-and-setuptools-on-windows"><cite>pip</cite> and <cite>setuptools</cite> on Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-quickstart">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#a-minimal-application">A Minimal Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-to-do-if-the-server-does-not-start">What to do if the Server does not Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#debug-mode">Debug Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#routing">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#static-files">Static Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#rendering-templates">Rendering Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#accessing-request-data">Accessing Request Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#redirects-and-errors">Redirects and Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-responses">About Responses</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sessions">Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#message-flashing">Message Flashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hooking-in-wsgi-middlewares">Hooking in WSGI Middlewares</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-flask-extensions">Using Flask Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#deploying-to-a-web-server">Deploying to a Web Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tutorial/index">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/introduction">Introducing Flaskr</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/folders">Step 0: Creating The Folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/schema">Step 1: Database Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/setup">Step 2: Application Setup Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/packaging">Step 3: Installing flaskr as a Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/dbcon">Step 4: Database Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/dbinit">Step 5: Creating The Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/views">Step 6: The View Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/templates">Step 7: The Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/css">Step 8: Adding Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/testing">Bonus: Testing the Application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-templating">Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#jinja-setup">Jinja Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#standard-context">Standard Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#standard-filters">Standard Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#controlling-autoescaping">Controlling Autoescaping</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registering-filters">Registering Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#context-processors">Context Processors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-testing">Testing Flask Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-application">The Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-testing-skeleton">The Testing Skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-first-test">The First Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#logging-in-and-out">Logging In and Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#test-adding-messages">Test Adding Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-testing-tricks">Other Testing Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#faking-resources-and-context">Faking Resources and Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#keeping-the-context-around">Keeping the Context Around</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#accessing-and-modifying-sessions">Accessing and Modifying Sessions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-errorhandling">Application Errors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#error-logging-tools">Error Logging Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#error-handlers">Error handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#error-mails">Error Mails</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#logging-to-a-file">Logging to a File</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#controlling-the-log-format">Controlling the Log Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#other-libraries">Other Libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#debugging-application-errors">Debugging Application Errors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#when-in-doubt-run-manually">When in Doubt, Run Manually</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-debuggers">Working with Debuggers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-config">Configuration Handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration-basics">Configuration Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#builtin-configuration-values">Builtin Configuration Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-from-files">Configuring from Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration-best-practices">Configuration Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#development-production">Development / Production</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#instance-folders">Instance Folders</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-signals">Signals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#subscribing-to-signals">Subscribing to Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-signals">Creating Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sending-signals">Sending Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#signals-and-flask-s-request-context">Signals and Flask’s Request Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#decorator-based-signal-subscriptions">Decorator Based Signal Subscriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#core-signals">Core Signals</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-views">Pluggable Views</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-principle">Basic Principle</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#method-hints">Method Hints</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#method-based-dispatching">Method Based Dispatching</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#decorating-views">Decorating Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#method-views-for-apis">Method Views for APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-appcontext">The Application Context</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#purpose-of-the-application-context">Purpose of the Application Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-an-application-context">Creating an Application Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#locality-of-the-context">Locality of the Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#context-usage">Context Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-reqcontext">The Request Context</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#diving-into-context-locals">Diving into Context Locals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-the-context-works">How the Context Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#callbacks-and-errors">Callbacks and Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#teardown-callbacks">Teardown Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#notes-on-proxies">Notes On Proxies</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#context-preservation-on-error">Context Preservation on Error</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-blueprints">Modular Applications with Blueprints</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#why-blueprints">Why Blueprints?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-concept-of-blueprints">The Concept of Blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#my-first-blueprint">My First Blueprint</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registering-blueprints">Registering Blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blueprint-resources">Blueprint Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#building-urls">Building URLs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#error-handlers">Error Handlers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extensions">Flask Extensions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#finding-extensions">Finding Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-extensions">Using Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#building-extensions">Building Extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cli">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#virtualenv-integration">Virtualenv Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#debug-flag">Debug Flag</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-a-shell">Running a Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#custom-commands">Custom Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#application-context">Application Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#factory-functions">Factory Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#custom-scripts">Custom Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cli-plugins">CLI Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-server">Development Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#command-line">Command Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#in-code">In Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-shell">Working with the Shell</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#command-line-interface">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-a-request-context">Creating a Request Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#firing-before-after-request">Firing Before/After Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#further-improving-the-shell-experience">Further Improving the Shell Experience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-patterns/index">Patterns for Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/packages">Larger Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/appfactories">Application Factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/appdispatch">Application Dispatching</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/apierrors">Implementing API Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/urlprocessors">Using URL Processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/distribute">Deploying with Setuptools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/fabric">Deploying with Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/sqlite3">Using SQLite 3 with Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/sqlalchemy">SQLAlchemy in Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/fileuploads">Uploading Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/viewdecorators">View Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/wtforms">Form Validation with WTForms</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/templateinheritance">Template Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/flashing">Message Flashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/jquery">AJAX with jQuery</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/errorpages">Custom Error Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/lazyloading">Lazily Loading Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/mongokit">MongoKit in Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/favicon">Adding a favicon</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/streaming">Streaming Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/deferredcallbacks">Deferred Request Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/methodoverrides">Adding HTTP Method Overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/requestchecksum">Request Content Checksums</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/celery">Celery Based Background Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/subclassing">Subclassing Flask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-deploying/index">Deployment Options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#hosted-options">Hosted options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#self-hosted-options">Self-hosted options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-becomingbig">Becoming Big</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#read-the-source">Read the Source.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hook-extend">Hook. Extend.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#subclass">Subclass.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#wrap-with-middleware">Wrap with middleware.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fork">Fork.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#scale-like-a-pro">Scale like a pro.</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#discuss-with-the-community">Discuss with the community.</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#application-object">Application Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blueprint-objects">Blueprint Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#incoming-request-data">Incoming Request Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#response-objects">Response Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sessions">Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#session-interface">Session Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#test-client">Test Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#application-globals">Application Globals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#useful-functions-and-classes">Useful Functions and Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#message-flashing">Message Flashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#module-flask.json">JSON Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#template-rendering">Template Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extensions">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#stream-helpers">Stream Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#useful-internals">Useful Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#signals">Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-based-views">Class-Based Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#url-route-registrations">URL Route Registrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#view-function-options">View Function Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#command-line-interface">Command Line Interface</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-design">Design Decisions in Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-explicit-application-object">The Explicit Application Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-routing-system">The Routing System</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#one-template-engine">One Template Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#micro-with-dependencies">Micro with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#thread-locals">Thread Locals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-flask-is-what-flask-is-not">What Flask is, What Flask is Not</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-htmlfaq">HTML/XHTML FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#history-of-xhtml">History of XHTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#history-of-html5">History of HTML5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#html-versus-xhtml">HTML versus XHTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-does-strict-mean">What does “strict” mean?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#new-technologies-in-html5">New technologies in HTML5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-should-be-used">What should be used?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security">Security Considerations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#cross-site-scripting-xss">Cross-Site Scripting (XSS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cross-site-request-forgery-csrf">Cross-Site Request Forgery (CSRF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#json-security">JSON Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-unicode">Unicode in Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#automatic-conversion">Automatic Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-golden-rule">The Golden Rule</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#encoding-and-decoding-yourself">Encoding and Decoding Yourself</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-editors">Configuring Editors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extensiondev">Flask Extension Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#anatomy-of-an-extension">Anatomy of an Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hello-flaskext">“Hello Flaskext!”</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#initializing-extensions">Initializing Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-extension-code">The Extension Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-app-ctx-stack">Using _app_ctx_stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#teardown-behavior">Teardown Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#learn-from-others">Learn from Others</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#approved-extensions">Approved Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extension-import-transition">Extension Import Transition</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-styleguide">Pocoo Styleguide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#general-layout">General Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#expressions-and-statements">Expressions and Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#naming-conventions">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#docstrings">Docstrings</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-python3">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-upgrading">Upgrading to Newer Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12">Version 0.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-11">Version 0.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-10">Version 0.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-9">Version 0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-8">Version 0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-7">Version 0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-6">Version 0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-5">Version 0.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-4">Version 0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-3">Version 0.3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-changelog">Flask Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12-5">Version 0.12.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12-4">Version 0.12.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12-3">Version 0.12.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12-2">Version 0.12.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12-1">Version 0.12.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-12">Version 0.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-11-2">Version 0.11.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-11-1">Version 0.11.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-11">Version 0.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-10-2">Version 0.10.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-10-1">Version 0.10.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-10">Version 0.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-9">Version 0.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-8-1">Version 0.8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-8">Version 0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-7-3">Version 0.7.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-7-2">Version 0.7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-7-1">Version 0.7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-7">Version 0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-6-1">Version 0.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-6">Version 0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-5-2">Version 0.5.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-5-1">Version 0.5.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-5">Version 0.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-4">Version 0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-3-1">Version 0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-3">Version 0.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-2">Version 0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#version-0-1">Version 0.1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-license">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#general-license-definitions">General License Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#flask-license">Flask License</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#flask-artwork-license">Flask Artwork License</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010 Pallets.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
    <script>
      if (typeof READTHEDOCS_DATA !== 'undefined') {
        if (!READTHEDOCS_DATA.features) {
          READTHEDOCS_DATA.features = {};
        }
        READTHEDOCS_DATA.features.docsearch_disabled = true;
      }
    </script>
  <script type="text/javascript" src="_static/version_warning_offset.js"></script>

  </body>
</html>